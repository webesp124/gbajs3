import{r as P,z as Sm,A as St,j as o,B as Le,D as Em,E as I,q as Wr,F as Pe,H as Cm,I as km,J as qn,K as Vn,L as Hn,M as jm,N as Lm,O as Rn,Q as Tn,S as Fm,U as Rm,V as Tm,W as Pm,X as _t,Y as ar,Z as Et,$ as Mm,a0 as Ze,a1 as Am,a2 as Dm,a3 as Bm,a4 as Im,a5 as $m,a6 as Ct,a7 as Nm,a8 as Wn,a9 as lr,aa as Um,ab as Xr,ac as Xn,ad as kt,ae as yt,af as Om,ag as zm,ah as Gm,ai as qm,aj as Vm,ak as Hm,al as Pn,am as Wm,an as Xm,ao as Mn,ap as Km,aq as An,ar as Ym,as as Qm,at as Jm,au as Zm,av as ep,aw as rp,ax as tp,ay as np,az as ap,aA as op}from"./vendor-Cc5P5tDO.js";import{S as gt,c as sp}from"./vendor_react-joyride-VqvkxE5R.js";import{u as or,S as ip,I as er,B as pe,F as Kn,C as lp,T as gr,a as cp,b as dp,c as Dn,d as jt,s as up,e as fp,t as xt,f as mp,g as pp,D as Yn}from"./vendor_@mui-CKDeRCdY.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))h(b);new MutationObserver(b=>{for(const _ of b)if(_.type==="childList")for(const g of _.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&h(g)}).observe(document,{childList:!0,subtree:!0});function i(b){const _={};return b.integrity&&(_.integrity=b.integrity),b.referrerPolicy&&(_.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?_.credentials="include":b.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function h(b){if(b.ep)return;b.ep=!0;const _=i(b);fetch(b.href,_)}})();const Qn="currentEmulatorVolume",Jn="currentEmulatorKeyBindings",Zn="currentGameName",ea="currentFastForward",Cr=({fetchFn:l,loadOnMount:m=!1,clearDataOnLoad:i=!1})=>{const[h,b]=P.useState(null),[_,g]=P.useState(null),[y,j]=P.useState(!1),k=()=>g(null),E=P.useCallback(async L=>{j(!0),g(null),i&&b(null);try{const R=await l(L);b(R),j(!1)}catch(R){g(R),j(!1)}},[i,l]);return P.useEffect(()=>{m&&l&&E()},[]),{data:h,isLoading:y,error:_,clearError:k,execute:E}},hp=({loadOnMount:l=!1}={})=>{const i=P.useCallback(async()=>(await fetch("undefined/api/tokens/refresh",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json(),[void 0]),{data:h,isLoading:b,error:_,clearError:g,execute:y}=Cr({fetchFn:i,clearDataOnLoad:!0,loadOnMount:l});return{data:h,isLoading:b,error:_,clearError:g,execute:y}},Lt=P.createContext(null);Lt.displayName="AuthContext";const vp=({children:l})=>{const[h,b]=P.useState(null),[_,g]=P.useState(null),{data:y,isLoading:j,execute:k,error:E,clearError:L}=hp({loadOnMount:!1}),R=!j&&!!y;P.useEffect(()=>{R&&(b(y),g("refresh"))},[R,y]);const $=P.useCallback(()=>{if(h){const{exp:D}=Sm(h);if(D&&Date.now()<=D*1e3)return!0}return!1},[h]),U=$()&&!y&&_!=="refresh";return P.useEffect(()=>{U&&L()},[U,L]),St(async()=>{await k()},$()&&!E?24e4:null),o.jsx(Lt.Provider,{value:{accessToken:h,setAccessToken:b,setAccessTokenSource:g,isAuthenticated:$},children:l})},Ft=P.createContext(null);Ft.displayName="DragContext";const gp=({children:l})=>{const[m,i]=P.useState(!1);return o.jsx(Ft.Provider,{value:{areItemsDraggable:m,setAreItemsDraggable:i},children:l})},Xe=0,xp=3,bp=l=>{const m=l.filePaths(),i=(y,j)=>{var E,L;let k=(E=y==null?void 0:y.split("/"))==null?void 0:E.pop();if(j){const R="."+((L=k==null?void 0:k.split("."))==null?void 0:L.pop());k=k==null?void 0:k.replace(R,j)}return k},h=()=>{const y={path:m.root,isDir:!0,children:[]},j=[".",".."],k=({path:E,children:L})=>{for(const R of l.FS.readdir(E)){if(j.includes(R))continue;const $=`${E}/${R}`,{mode:U}=l.FS.lookupPath($,{}).node,D={path:$,isDir:l.FS.isDir(U),children:[]};L==null||L.push(D),D.isDir&&k(D)}};return k(y),y},b=y=>{var R;const j=y.split(`
`),k=["cheats = ",""];if(!((R=j==null?void 0:j[0])!=null&&R.match("^cheats = [0-9]+$")))return[];const E={},L={desc:"desc",code:"code",enable:"enable"};for(const $ of j){if(k.includes($))continue;const U=$.match(/^cheat([0-9]+)_([a-zA-Z]+)\s*=\s*"?([a-zA-Z0-9\s+:_]+)"?$/);if(U){const[,D,H,z]=U,Y=L[H];E[D]=E[D]||{desc:"",code:"",enable:!1},Y&&(E[D][Y]=Y===L.enable?z.toLowerCase()==="true":z)}}return Object.values(E)},_=y=>{const j=y.map((L,R)=>`cheat${R}_desc = "${L.desc}"
cheat${R}_enable = ${L.enable}
cheat${R}_code = "${L.code}"
`),k=`cheats = ${j==null?void 0:j.length}

`,E=i(l.gameName,".cheats");if(j!=null&&j.length&&E){const L=k+j.join(`
`),R=new Blob([L],{type:"text/plain"});return new File([R],E)}return null},g=({key:y,location:j})=>{let k=j===xp?`Keypad ${y}`:y;return k.toLowerCase().includes("enter")&&(k=k.replace(/enter/gi,"Return")),k.toLowerCase().includes("arrow")&&(k=k.replace(/arrow/gi,"")),k};return{autoLoadCheats:l.autoLoadCheats,createSaveState:l.saveState,defaultKeyBindings:()=>[{gbaInput:"A",key:"X",location:Xe},{gbaInput:"B",key:"Z",location:Xe},{gbaInput:"L",key:"A",location:Xe},{gbaInput:"R",key:"S",location:Xe},{gbaInput:"Start",key:"Enter",location:Xe},{gbaInput:"Select",key:"Backspace",location:Xe},{gbaInput:"Up",key:"ArrowUp",location:Xe},{gbaInput:"Down",key:"ArrowDown",location:Xe},{gbaInput:"Left",key:"ArrowLeft",location:Xe},{gbaInput:"Right",key:"ArrowRight",location:Xe}],loadSaveState:l.loadState,listSaveStates:()=>l.FS.readdir(m.saveStatePath),listRoms:()=>l.FS.readdir(m.gamePath),setVolume:async y=>{(l.SDL2.audioContext.state==="suspended"||l.SDL2.audioContext.state==="interrupted")&&await l.SDL2.audioContext.resume(),l.setVolume(y)},getVolume:l.getVolume,enableKeyboardInput:()=>l.toggleInput(!0),disableKeyboardInput:()=>l.toggleInput(!1),simulateKeyDown:l.buttonPress,simulateKeyUp:l.buttonUnpress,setFastForwardMultiplier:l.setFastForwardMultiplier,isFastForwardEnabled:()=>l.getFastForwardMultiplier()>1,run:l.loadGame,getCurrentRom:()=>l.gameName?l.FS.readFile(l.gameName):null,getCurrentGameName:()=>i(l.gameName),setCurrentGameName:y=>{y&&!l.gameName&&(l.gameName=y)},getCurrentSave:()=>l.saveName?l.getSave():null,getCurrentSaveName:()=>i(l.saveName),getFile:y=>l.FS.readFile(y),uploadCheats:l.uploadCheats,uploadRom:l.uploadRom,uploadSaveOrSaveState:l.uploadSaveOrSaveState,deleteSaveState:y=>{const j=i(l.saveName,".ss"+y),k=`${m.saveStatePath}/${j}`;l.FS.unlink(k)},deleteFile:l.FS.unlink,pause:l.pauseGame,resume:l.resumeGame,quitGame:l.quitGame,quitEmulator:l.quitMgba,quickReload:l.quickReload,getCurrentCheatsFile:()=>{const y=i(l.gameName,".cheats"),j=`${m.cheatsPath}/${y}`;return l.FS.analyzePath(j).exists?l.FS.readFile(j):new Uint8Array},getCurrentCheatsFileName:()=>i(l.gameName,".cheats"),screenshot:l.screenshot,remapKeyBindings:y=>y.forEach(j=>l.bindKey(g(j),j.gbaInput)),filePaths:l.filePaths,fsSync:l.FSSync,listAllFiles:h,parseCheatsString:b,parsedCheatsToFile:_}};var _p=(()=>{var l=import.meta.url;return function(m={}){var i=m,h,b;i.ready=new Promise((e,r)=>{h=e,b=r}),i.loadGame=e=>{if(fe("loadGame","number",["string"])(e)){const t=e.split(".");t.pop();const n=t.join(".")+".sav";return i.gameName=e,i.saveName=n.replace("/data/games/","/data/saves/"),!0}return!1},i.getSave=()=>c.readFile(i.saveName),i.listRoms=()=>c.readdir("/data/games/"),i.listSaves=()=>c.readdir("/data/saves/"),i.FSInit=()=>new Promise((e,r)=>{c.mkdir("/data"),c.mount(c.filesystems.IDBFS,{},"/data"),c.syncfs(!0,t=>{t&&r(new Error(`Error syncing app data from IndexedDB: ${t}`));try{c.mkdir("/data/saves")}catch{}try{c.mkdir("/data/states")}catch{}try{c.mkdir("/data/games")}catch{}try{c.mkdir("/data/cheats")}catch{}try{c.mkdir("/data/screenshots")}catch{}e()})}),i.FSSync=()=>new Promise((e,r)=>{c.syncfs(t=>{t&&r(new Error(`Error syncing app data to IndexedDB: ${t}`)),e()})}),i.filePaths=()=>({root:"/data",cheatsPath:"/data/cheats",gamePath:"/data/games",savePath:"/data/saves",saveStatePath:"/data/states",screenshotsPath:"/data/screenshots"}),i.uploadSaveOrSaveState=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="sav")a="/data/saves/";else if(n.startsWith("ss"))a="/data/states/";else{console.warn("unrecognized file extension: "+n);return}const s=new FileReader;s.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},s.readAsArrayBuffer(e)},i.uploadRom=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(["gba","gbc","gb","zip","7z"].includes(n))a="/data/games/";else{console.warn("unrecognized file extension: "+n);return}const s=new FileReader;s.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},s.readAsArrayBuffer(e)},i.uploadCheats=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="cheats")a="/data/cheats/";else{console.warn("unrecognized file extension: "+n);return}const s=new FileReader;s.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},s.readAsArrayBuffer(e)};const _=new Map([["a",0],["b",1],["select",2],["start",3],["right",4],["left",5],["up",6],["down",7],["r",8],["l",9]]);i.buttonPress=e=>{fe("buttonPress",null,["number"])(_.get(e.toLowerCase()))},i.buttonUnpress=e=>{fe("buttonUnpress",null,["number"])(_.get(e.toLowerCase()))},i.bindKey=(e,r)=>{fe("bindKey",null,["string","number"])(e,_.get(r.toLowerCase()))},i.pauseGame=()=>{fe("pauseGame",null,[])()},i.resumeGame=()=>{fe("resumeGame",null,[])()},i.getVolume=()=>fe("getVolume","number",[])(),i.setVolume=e=>{fe("setVolume",null,["number"])(e)},i.getMainLoopTimingMode=()=>fe("getMainLoopTimingMode","number",[])(),i.getMainLoopTimingValue=()=>fe("getMainLoopTimingValue","number",[])(),i.setMainLoopTiming=(e,r)=>{fe("setMainLoopTiming","number",["number","number"])(e,r)},i.quitGame=()=>{fe("quitGame",null,[])()},i.quitMgba=()=>{fe("quitMgba",null,[])()},i.quickReload=()=>{fe("quickReload",null,[])()},i.toggleInput=e=>{fe("setEventEnable",null,["boolean"])(e)},i.screenshot=e=>fe("screenshot","boolean",["string"])(e),i.saveState=e=>fe("saveState","boolean",["number"])(e),i.loadState=e=>fe("loadState","boolean",["number"])(e),i.saveStateSlot=(e,r)=>{var t=fe("saveStateSlot","number",["number","number"]);return i.saveStateSlot=(n,a)=>(a===void 0&&(a=63),t(n,a)),i.saveStateSlot(e,r)},i.loadStateSlot=(e,r)=>{var t=fe("loadStateSlot","number",["number","number"]);return i.loadStateSlot=(n,a)=>(a===void 0&&(a=61),t(n,a)),i.loadStateSlot(e,r)},i.autoLoadCheats=()=>fe("autoLoadCheats","bool",[])(),i.setFastForwardMultiplier=e=>{fe("setFastForwardMultiplier",null,["number"])(e)},i.getFastForwardMultiplier=()=>fe("getFastForwardMultiplier","number",[])();var g=Object.assign({},i),y="./this.program",j=(e,r)=>{throw r},k=!0,E="";function L(e){return i.locateFile?i.locateFile(e,E):E+e}var R,$;typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),l&&(E=l),E.startsWith("blob:")?E="":E=E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),R=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},$=(e,r,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){r(n.response);return}t()},n.onerror=t,n.send(null)};var U=i.print||console.log.bind(console),D=i.printErr||console.error.bind(console);Object.assign(i,g),g=null,i.arguments&&i.arguments,i.thisProgram&&(y=i.thisProgram),i.quit&&(j=i.quit);var H;i.wasmBinary&&(H=i.wasmBinary),typeof WebAssembly!="object"&&Qe("no native wasm support detected");var z,Y=!1,te;function K(e,r){e||Qe(r)}var G,q,V,O,f,W,X,oe;function Oe(){var e=z.buffer;i.HEAP8=G=new Int8Array(e),i.HEAP16=V=new Int16Array(e),i.HEAPU8=q=new Uint8Array(e),i.HEAPU16=O=new Uint16Array(e),i.HEAP32=f=new Int32Array(e),i.HEAPU32=W=new Uint32Array(e),i.HEAPF32=X=new Float32Array(e),i.HEAPF64=oe=new Float64Array(e)}var He=[],ne=[],se=[],ie=[];function le(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)jr(i.preRun.shift());Fr(He)}function Me(){!i.noFSInit&&!c.init.initialized&&c.init(),c.ignorePermissions=!1,Fr(ne)}function Ae(){Fr(se)}function Ye(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)De(i.postRun.shift());Fr(ie)}function jr(e){He.unshift(e)}function he(e){ne.unshift(e)}function De(e){ie.unshift(e)}var Ee=0,dr=null;function It(e){return e}function Jr(e){var r;Ee++,(r=i.monitorRunDependencies)==null||r.call(i,Ee)}function Lr(e){var t;if(Ee--,(t=i.monitorRunDependencies)==null||t.call(i,Ee),Ee==0&&dr){var r=dr;dr=null,r()}}function Qe(e){var t;(t=i.onAbort)==null||t.call(i,e),e="Aborted("+e+")",D(e),Y=!0,te=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw b(r),r}var ha="data:application/octet-stream;base64,",$t=e=>e.startsWith(ha),tr;i.locateFile?(tr="mgba.wasm",$t(tr)||(tr=L(tr))):tr=new URL(""+new URL("mgba-xM1paPxV.wasm",import.meta.url).href,import.meta.url).href;function Nt(e){if(e==tr&&H)return new Uint8Array(H);throw"both async and sync fetching of the wasm failed"}function va(e){return!H&&k&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at '${e}'`;return r.arrayBuffer()}).catch(()=>Nt(e)):Promise.resolve().then(()=>Nt(e))}function Ut(e,r,t){return va(e).then(n=>WebAssembly.instantiate(n,r)).then(n=>n).then(t,n=>{D(`failed to asynchronously prepare wasm: ${n}`),Qe(n)})}function ga(e,r,t,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!$t(r)&&typeof fetch=="function"?fetch(r,{credentials:"same-origin"}).then(a=>{var s=WebAssembly.instantiateStreaming(a,t);return s.then(n,function(d){return D(`wasm streaming compile failed: ${d}`),D("falling back to ArrayBuffer instantiation"),Ut(r,t,n)})}):Ut(r,t,n)}function xa(){var e={a:dm};function r(n,a){return re=n.exports,z=re._d,Oe(),Gt=re.ze,he(re.$d),Lr(),re}Jr();function t(n){r(n.instance)}if(i.instantiateWasm)try{return i.instantiateWasm(e,r)}catch(n){D(`Module.instantiateWasm callback failed with error: ${n}`),b(n)}return ga(H,tr,e,t).catch(b),{}}var J,de,Ot={272368:(e,r)=>{i.canvas.width=e,i.canvas.height=r},272425:(e,r,t,n,a,s,d)=>{i.version={gitCommit:je(e),gitShort:je(r),gitBranch:je(t),gitRevision:n,binaryName:je(a),projectName:je(s),projectVersion:je(d)}},272657:()=>{c.syncfs(function(e){K(!e)})},272701:()=>typeof AudioContext<"u"?!0:typeof webkitAudioContext<"u",272848:()=>typeof navigator.mediaDevices<"u"&&typeof navigator.mediaDevices.getUserMedia<"u"?!0:typeof navigator.webkitGetUserMedia<"u",273082:e=>{typeof i.SDL2>"u"&&(i.SDL2={});var r=i.SDL2;return e?r.capture={}:r.audio={},r.audioContext||(typeof AudioContext<"u"?r.audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(r.audioContext=new webkitAudioContext),r.audioContext&&_a(r.audioContext)),r.audioContext===void 0?-1:0},273575:()=>{var e=i.SDL2;return e.audioContext.sampleRate},273643:(e,r,t,n)=>{var a=i.SDL2,s=function(p){a.capture.silenceTimer!==void 0&&(clearTimeout(a.capture.silenceTimer),a.capture.silenceTimer=void 0),a.capture.mediaStreamNode=a.audioContext.createMediaStreamSource(p),a.capture.scriptProcessorNode=a.audioContext.createScriptProcessor(r,e,1),a.capture.scriptProcessorNode.onaudioprocess=function(v){a===void 0||a.capture===void 0||(v.outputBuffer.getChannelData(0).fill(0),a.capture.currentCaptureBuffer=v.inputBuffer,Zr("vi",t,[n]))},a.capture.mediaStreamNode.connect(a.capture.scriptProcessorNode),a.capture.scriptProcessorNode.connect(a.audioContext.destination),a.capture.stream=p},d=function(p){};a.capture.silenceBuffer=a.audioContext.createBuffer(e,r,a.audioContext.sampleRate),a.capture.silenceBuffer.getChannelData(0).fill(0);var u=function(){a.capture.currentCaptureBuffer=a.capture.silenceBuffer,Zr("vi",t,[n])};a.capture.silenceTimer=setTimeout(u,r/a.audioContext.sampleRate*1e3),navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(s).catch(d):navigator.webkitGetUserMedia!==void 0&&navigator.webkitGetUserMedia({audio:!0,video:!1},s,d)},275295:(e,r,t,n)=>{var a=i.SDL2;a.audio.scriptProcessorNode=a.audioContext.createScriptProcessor(r,0,e),a.audio.scriptProcessorNode.onaudioprocess=function(s){a===void 0||a.audio===void 0||(a.audio.currentOutputBuffer=s.outputBuffer,Zr("vi",t,[n]))},a.audio.scriptProcessorNode.connect(a.audioContext.destination)},275705:(e,r)=>{for(var t=i.SDL2,n=t.capture.currentCaptureBuffer.numberOfChannels,a=0;a<n;++a){var s=t.capture.currentCaptureBuffer.getChannelData(a);if(s.length!=r)throw"Web Audio capture buffer length mismatch! Destination size: "+s.length+" samples vs expected "+r+" samples!";if(n==1)for(var d=0;d<r;++d)qt(e+d*4,s[d],"float");else for(var d=0;d<r;++d)qt(e+(d*n+a)*4,s[d],"float")}},276310:(e,r)=>{for(var t=i.SDL2,n=t.audio.currentOutputBuffer.numberOfChannels,a=0;a<n;++a){var s=t.audio.currentOutputBuffer.getChannelData(a);if(s.length!=r)throw"Web Audio output buffer length mismatch! Destination size: "+s.length+" samples vs expected "+r+" samples!";for(var d=0;d<r;++d)s[d]=X[e+(d*n+a<<2)>>2]}},276790:e=>{var r=i.SDL2;if(e){if(r.capture.silenceTimer!==void 0&&clearTimeout(r.capture.silenceTimer),r.capture.stream!==void 0){for(var t=r.capture.stream.getAudioTracks(),n=0;n<t.length;n++)r.capture.stream.removeTrack(t[n]);r.capture.stream=void 0}r.capture.scriptProcessorNode!==void 0&&(r.capture.scriptProcessorNode.onaudioprocess=function(a){},r.capture.scriptProcessorNode.disconnect(),r.capture.scriptProcessorNode=void 0),r.capture.mediaStreamNode!==void 0&&(r.capture.mediaStreamNode.disconnect(),r.capture.mediaStreamNode=void 0),r.capture.silenceBuffer!==void 0&&(r.capture.silenceBuffer=void 0),r.capture=void 0}else r.audio.scriptProcessorNode!=null&&(r.audio.scriptProcessorNode.disconnect(),r.audio.scriptProcessorNode=void 0),r.audio=void 0;r.audioContext!==void 0&&r.audio===void 0&&r.capture===void 0&&(r.audioContext.close(),r.audioContext=void 0)},277962:(e,r,t)=>{var n=e,a=r,s=t;i.SDL2||(i.SDL2={});var d=i.SDL2;d.ctxCanvas!==i.canvas&&(d.ctx=i.createContext(i.canvas,!1,!0),d.ctxCanvas=i.canvas),(d.w!==n||d.h!==a||d.imageCtx!==d.ctx)&&(d.image=d.ctx.createImageData(n,a),d.w=n,d.h=a,d.imageCtx=d.ctx);var u=d.image.data,p=s>>2,v=0,w;if(typeof CanvasPixelArray<"u"&&u instanceof CanvasPixelArray)for(w=u.length;v<w;){var F=f[p];u[v]=F&255,u[v+1]=F>>8&255,u[v+2]=F>>16&255,u[v+3]=255,p++,v+=4}else{d.data32Data!==u&&(d.data32=new Int32Array(u.buffer),d.data8=new Uint8Array(u.buffer),d.data32Data=u);var B=d.data32;w=B.length,B.set(f.subarray(p,p+w));var T=d.data8,A=3,Q=A+4*w;if(w%8==0)for(;A<Q;)T[A]=255,A=A+4|0,T[A]=255,A=A+4|0,T[A]=255,A=A+4|0,T[A]=255,A=A+4|0,T[A]=255,A=A+4|0,T[A]=255,A=A+4|0,T[A]=255,A=A+4|0,T[A]=255,A=A+4|0;else for(;A<Q;)T[A]=255,A=A+4|0}d.ctx.putImageData(d.image,0,0)},279431:(e,r,t,n,a)=>{var s=e,d=r,u=t,p=n,v=a,w=document.createElement("canvas");w.width=s,w.height=d;var F=w.getContext("2d"),B=F.createImageData(s,d),T=B.data,A=v>>2,Q=0,xe;if(typeof CanvasPixelArray<"u"&&T instanceof CanvasPixelArray)for(xe=T.length;Q<xe;){var me=f[A];T[Q]=me&255,T[Q+1]=me>>8&255,T[Q+2]=me>>16&255,T[Q+3]=me>>24&255,A++,Q+=4}else{var Se=new Int32Array(T.buffer);xe=Se.length,Se.set(f.subarray(A,A+xe))}F.putImageData(B,0,0);var be=u===0&&p===0?"url("+w.toDataURL()+"), auto":"url("+w.toDataURL()+") "+u+" "+p+", auto",_e=Ie(be.length+1);return ve(be,_e,be.length+1),_e},280420:e=>{i.canvas&&(i.canvas.style.cursor=je(e))},280503:()=>{i.canvas&&(i.canvas.style.cursor="none")},280572:()=>window.innerWidth,280602:()=>window.innerHeight};function zt(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var ba=(e,r,t)=>{e.addEventListener(r,t,{once:!0})},_a=(e,r)=>{r||(r=[document,document.getElementById("canvas")]),["keydown","mousedown","touchstart"].forEach(t=>{r.forEach(n=>{n&&ba(n,t,()=>{e.state==="suspended"&&e.resume()})})})},Fr=e=>{for(;e.length>0;)e.shift()(i)},ya=(e,r,t)=>{var n=i["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)},Rr=[],Gt,ce=e=>{var r=Rr[e];return r||(e>=Rr.length&&(Rr.length=e+1),Rr[e]=r=Gt.get(e)),r},Zr=(e,r,t)=>{if(e.includes("j"))return ya(e,r,t);var n=ce(r).apply(null,t);return n},wa=i.noExitRuntime||!0;function qt(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":G[e>>0]=r;break;case"i8":G[e>>0]=r;break;case"i16":V[e>>1]=r;break;case"i32":f[e>>2]=r;break;case"i64":Qe("to do setValue(i64) use WASM_BIGINT");case"float":X[e>>2]=r;break;case"double":oe[e>>3]=r;break;case"*":W[e>>2]=r;break;default:Qe(`invalid type for setValue: ${t}`)}}var ae={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var t=0,n=e.length-1;n>=0;n--){var a=e[n];a==="."?e.splice(n,1):a===".."?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t;t--)e.unshift("..");return e},normalize:e=>{var r=ae.isAbs(e),t=e.substr(-1)==="/";return e=ae.normalizeArray(e.split("/").filter(n=>!!n),!r).join("/"),!e&&!r&&(e="."),e&&t&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=ae.splitPath(e),t=r[0],n=r[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)},basename:e=>{if(e==="/")return"/";e=ae.normalize(e),e=e.replace(/\/$/,"");var r=e.lastIndexOf("/");return r===-1?e:e.substr(r+1)},join:function(){var e=Array.prototype.slice.call(arguments);return ae.normalize(e.join("/"))},join2:(e,r)=>ae.normalize(e+"/"+r)},Sa=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);Qe("initRandomDevice")},Vt=e=>(Vt=Sa())(e),Ke={resolve:function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var n=t>=0?arguments[t]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,r=ae.isAbs(n)}return e=ae.normalizeArray(e.split("/").filter(a=>!!a),!r).join("/"),(r?"/":"")+e||"."},relative:(e,r)=>{e=Ke.resolve(e).substr(1),r=Ke.resolve(r).substr(1);function t(v){for(var w=0;w<v.length&&v[w]==="";w++);for(var F=v.length-1;F>=0&&v[F]==="";F--);return w>F?[]:v.slice(w,F-w+1)}for(var n=t(e.split("/")),a=t(r.split("/")),s=Math.min(n.length,a.length),d=s,u=0;u<s;u++)if(n[u]!==a[u]){d=u;break}for(var p=[],u=d;u<n.length;u++)p.push("..");return p=p.concat(a.slice(d)),p.join("/")}},Ht=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ur=(e,r,t)=>{for(var n=r+t,a=r;e[a]&&!(a>=n);)++a;if(a-r>16&&e.buffer&&Ht)return Ht.decode(e.subarray(r,a));for(var s="";r<a;){var d=e[r++];if(!(d&128)){s+=String.fromCharCode(d);continue}var u=e[r++]&63;if((d&224)==192){s+=String.fromCharCode((d&31)<<6|u);continue}var p=e[r++]&63;if((d&240)==224?d=(d&15)<<12|u<<6|p:d=(d&7)<<18|u<<12|p<<6|e[r++]&63,d<65536)s+=String.fromCharCode(d);else{var v=d-65536;s+=String.fromCharCode(55296|v>>10,56320|v&1023)}}return s},et=[],fr=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},rt=(e,r,t,n)=>{if(!(n>0))return 0;for(var a=t,s=t+n-1,d=0;d<e.length;++d){var u=e.charCodeAt(d);if(u>=55296&&u<=57343){var p=e.charCodeAt(++d);u=65536+((u&1023)<<10)|p&1023}if(u<=127){if(t>=s)break;r[t++]=u}else if(u<=2047){if(t+1>=s)break;r[t++]=192|u>>6,r[t++]=128|u&63}else if(u<=65535){if(t+2>=s)break;r[t++]=224|u>>12,r[t++]=128|u>>6&63,r[t++]=128|u&63}else{if(t+3>=s)break;r[t++]=240|u>>18,r[t++]=128|u>>12&63,r[t++]=128|u>>6&63,r[t++]=128|u&63}}return r[t]=0,t-a};function tt(e,r,t){var n=fr(e)+1,a=new Array(n),s=rt(e,a,0,a.length);return a.length=s,a}var Ea=()=>{if(!et.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"?(e=window.prompt("Input: "),e!==null&&(e+=`
`)):typeof readline=="function"&&(e=readline(),e!==null&&(e+=`
`)),!e)return null;et=tt(e)}return et.shift()},nr={ttys:[],init(){},shutdown(){},register(e,r){nr.ttys[e]={input:[],output:[],ops:r},c.registerDevice(e,nr.stream_ops)},stream_ops:{open(e){var r=nr.ttys[e.node.rdev];if(!r)throw new c.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,t,n,a){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var s=0,d=0;d<n;d++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&s===0)throw new c.ErrnoError(6);if(u==null)break;s++,r[t+d]=u}return s&&(e.node.timestamp=Date.now()),s},write(e,r,t,n,a){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var s=0;s<n;s++)e.tty.ops.put_char(e.tty,r[t+s])}catch{throw new c.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),s}},default_tty_ops:{get_char(e){return Ea()},put_char(e,r){r===null||r===10?(U(ur(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(U(ur(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,t){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(D(ur(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(D(ur(e.output,0)),e.output=[])}}},Ca=(e,r)=>(q.fill(0,e,e+r),e),ka=(e,r)=>Math.ceil(e/r)*r,Wt=e=>{e=ka(e,65536);var r=jn(65536,e);return r?Ca(r,e):0},ee={ops_table:null,mount(e){return ee.createNode(null,"/",16895,0)},createNode(e,r,t,n){if(c.isBlkdev(t)||c.isFIFO(t))throw new c.ErrnoError(63);ee.ops_table||(ee.ops_table={dir:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,lookup:ee.node_ops.lookup,mknod:ee.node_ops.mknod,rename:ee.node_ops.rename,unlink:ee.node_ops.unlink,rmdir:ee.node_ops.rmdir,readdir:ee.node_ops.readdir,symlink:ee.node_ops.symlink},stream:{llseek:ee.stream_ops.llseek}},file:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:{llseek:ee.stream_ops.llseek,read:ee.stream_ops.read,write:ee.stream_ops.write,allocate:ee.stream_ops.allocate,mmap:ee.stream_ops.mmap,msync:ee.stream_ops.msync}},link:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,readlink:ee.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:c.chrdev_stream_ops}});var a=c.createNode(e,r,t,n);return c.isDir(a.mode)?(a.node_ops=ee.ops_table.dir.node,a.stream_ops=ee.ops_table.dir.stream,a.contents={}):c.isFile(a.mode)?(a.node_ops=ee.ops_table.file.node,a.stream_ops=ee.ops_table.file.stream,a.usedBytes=0,a.contents=null):c.isLink(a.mode)?(a.node_ops=ee.ops_table.link.node,a.stream_ops=ee.ops_table.link.stream):c.isChrdev(a.mode)&&(a.node_ops=ee.ops_table.chrdev.node,a.stream_ops=ee.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[r]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var t=e.contents?e.contents.length:0;if(!(t>=r)){var n=1024*1024;r=Math.max(r,t*(t<n?2:1.125)>>>0),t!=0&&(r=Math.max(r,256));var a=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var t=e.contents;e.contents=new Uint8Array(r),t&&e.contents.set(t.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=c.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,c.isDir(e.mode)?r.size=4096:c.isFile(e.mode)?r.size=e.usedBytes:c.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.timestamp),r.mtime=new Date(e.timestamp),r.ctime=new Date(e.timestamp),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){r.mode!==void 0&&(e.mode=r.mode),r.timestamp!==void 0&&(e.timestamp=r.timestamp),r.size!==void 0&&ee.resizeFileStorage(e,r.size)},lookup(e,r){throw c.genericErrors[44]},mknod(e,r,t,n){return ee.createNode(e,r,t,n)},rename(e,r,t){if(c.isDir(e.mode)){var n;try{n=c.lookupNode(r,t)}catch{}if(n)for(var a in n.contents)throw new c.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=t,r.contents[t]=e,r.timestamp=e.parent.timestamp,e.parent=r},unlink(e,r){delete e.contents[r],e.timestamp=Date.now()},rmdir(e,r){var t=c.lookupNode(e,r);for(var n in t.contents)throw new c.ErrnoError(55);delete e.contents[r],e.timestamp=Date.now()},readdir(e){var r=[".",".."];for(var t of Object.keys(e.contents))r.push(t);return r},symlink(e,r,t){var n=ee.createNode(e,r,41471,0);return n.link=t,n},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,r,t,n,a){var s=e.node.contents;if(a>=e.node.usedBytes)return 0;var d=Math.min(e.node.usedBytes-a,n);if(d>8&&s.subarray)r.set(s.subarray(a,a+d),t);else for(var u=0;u<d;u++)r[t+u]=s[a+u];return d},write(e,r,t,n,a,s){if(r.buffer===G.buffer&&(s=!1),!n)return 0;var d=e.node;if(d.timestamp=Date.now(),r.subarray&&(!d.contents||d.contents.subarray)){if(s)return d.contents=r.subarray(t,t+n),d.usedBytes=n,n;if(d.usedBytes===0&&a===0)return d.contents=r.slice(t,t+n),d.usedBytes=n,n;if(a+n<=d.usedBytes)return d.contents.set(r.subarray(t,t+n),a),n}if(ee.expandFileStorage(d,a+n),d.contents.subarray&&r.subarray)d.contents.set(r.subarray(t,t+n),a);else for(var u=0;u<n;u++)d.contents[a+u]=r[t+u];return d.usedBytes=Math.max(d.usedBytes,a+n),n},llseek(e,r,t){var n=r;if(t===1?n+=e.position:t===2&&c.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new c.ErrnoError(28);return n},allocate(e,r,t){ee.expandFileStorage(e.node,r+t),e.node.usedBytes=Math.max(e.node.usedBytes,r+t)},mmap(e,r,t,n,a){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var s,d,u=e.node.contents;if(!(a&2)&&u.buffer===G.buffer)d=!1,s=u.byteOffset;else{if((t>0||t+r<u.length)&&(u.subarray?u=u.subarray(t,t+r):u=Array.prototype.slice.call(u,t,t+r)),d=!0,s=Wt(r),!s)throw new c.ErrnoError(48);G.set(u,s)}return{ptr:s,allocated:d}},msync(e,r,t,n,a){return ee.stream_ops.write(e,r,0,n,t,!1),0}}},ja=(e,r,t,n)=>{var a=`al ${e}`;$(e,s=>{r(new Uint8Array(s)),a&&Lr()},s=>{if(t)t();else throw`Loading data file "${e}" failed.`}),a&&Jr()},La=(e,r,t,n,a,s)=>{c.createDataFile(e,r,t,n,a,s)},nt=i.preloadPlugins||[],Fa=(e,r,t,n)=>{typeof S<"u"&&S.init();var a=!1;return nt.forEach(s=>{a||s.canHandle(r)&&(s.handle(e,r,t,n),a=!0)}),a},Ra=(e,r,t,n,a,s,d,u,p,v)=>{var w=r?Ke.resolve(ae.join2(e,r)):e;function F(B){function T(A){v==null||v(),u||La(e,r,A,n,a,p),s==null||s(),Lr()}Fa(B,w,T,()=>{d==null||d(),Lr()})||T(B)}Jr(),typeof t=="string"?ja(t,F,d):F(t)},Ta=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},t=r[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},at=(e,r)=>{var t=0;return e&&(t|=365),r&&(t|=146),t},ue={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var e=null;return typeof window=="object"&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),K(e,"IDBFS used, but indexedDB not supported"),e},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:function(e){return ee.mount.apply(null,arguments)},syncfs:(e,r,t)=>{ue.getLocalSet(e,(n,a)=>{if(n)return t(n);ue.getRemoteSet(e,(s,d)=>{if(s)return t(s);var u=r?d:a,p=r?a:d;ue.reconcile(u,p,t)})})},quit:()=>{Object.values(ue.dbs).forEach(e=>e.close()),ue.dbs={}},getDB:(e,r)=>{var t=ue.dbs[e];if(t)return r(null,t);var n;try{n=ue.indexedDB().open(e,ue.DB_VERSION)}catch(a){return r(a)}if(!n)return r("Unable to connect to IndexedDB");n.onupgradeneeded=a=>{var s=a.target.result,d=a.target.transaction,u;s.objectStoreNames.contains(ue.DB_STORE_NAME)?u=d.objectStore(ue.DB_STORE_NAME):u=s.createObjectStore(ue.DB_STORE_NAME),u.indexNames.contains("timestamp")||u.createIndex("timestamp","timestamp",{unique:!1})},n.onsuccess=()=>{t=n.result,ue.dbs[e]=t,r(null,t)},n.onerror=a=>{r(a.target.error),a.preventDefault()}},getLocalSet:(e,r)=>{var t={};function n(p){return p!=="."&&p!==".."}function a(p){return v=>ae.join2(p,v)}for(var s=c.readdir(e.mountpoint).filter(n).map(a(e.mountpoint));s.length;){var d=s.pop(),u;try{u=c.stat(d)}catch(p){return r(p)}c.isDir(u.mode)&&s.push.apply(s,c.readdir(d).filter(n).map(a(d))),t[d]={timestamp:u.mtime}}return r(null,{type:"local",entries:t})},getRemoteSet:(e,r)=>{var t={};ue.getDB(e.mountpoint,(n,a)=>{if(n)return r(n);try{var s=a.transaction([ue.DB_STORE_NAME],"readonly");s.onerror=p=>{r(p.target.error),p.preventDefault()};var d=s.objectStore(ue.DB_STORE_NAME),u=d.index("timestamp");u.openKeyCursor().onsuccess=p=>{var v=p.target.result;if(!v)return r(null,{type:"remote",db:a,entries:t});t[v.primaryKey]={timestamp:v.key},v.continue()}}catch(p){return r(p)}})},loadLocalEntry:(e,r)=>{var t,n;try{var a=c.lookupPath(e);n=a.node,t=c.stat(e)}catch(s){return r(s)}return c.isDir(t.mode)?r(null,{timestamp:t.mtime,mode:t.mode}):c.isFile(t.mode)?(n.contents=ee.getFileDataAsTypedArray(n),r(null,{timestamp:t.mtime,mode:t.mode,contents:n.contents})):r(new Error("node type not supported"))},storeLocalEntry:(e,r,t)=>{try{if(c.isDir(r.mode))c.mkdirTree(e,r.mode);else if(c.isFile(r.mode))c.writeFile(e,r.contents,{canOwn:!0});else return t(new Error("node type not supported"));c.chmod(e,r.mode),c.utime(e,r.timestamp,r.timestamp)}catch(n){return t(n)}t(null)},removeLocalEntry:(e,r)=>{try{var t=c.stat(e);c.isDir(t.mode)?c.rmdir(e):c.isFile(t.mode)&&c.unlink(e)}catch(n){return r(n)}r(null)},loadRemoteEntry:(e,r,t)=>{var n=e.get(r);n.onsuccess=a=>t(null,a.target.result),n.onerror=a=>{t(a.target.error),a.preventDefault()}},storeRemoteEntry:(e,r,t,n)=>{try{var a=e.put(t,r)}catch(s){n(s);return}a.onsuccess=s=>n(),a.onerror=s=>{n(s.target.error),s.preventDefault()}},removeRemoteEntry:(e,r,t)=>{var n=e.delete(r);n.onsuccess=a=>t(),n.onerror=a=>{t(a.target.error),a.preventDefault()}},reconcile:(e,r,t)=>{var n=0,a=[];Object.keys(e.entries).forEach(function(F){var B=e.entries[F],T=r.entries[F];(!T||B.timestamp.getTime()!=T.timestamp.getTime())&&(a.push(F),n++)});var s=[];if(Object.keys(r.entries).forEach(function(F){e.entries[F]||(s.push(F),n++)}),!n)return t(null);var d=!1,u=e.type==="remote"?e.db:r.db,p=u.transaction([ue.DB_STORE_NAME],"readwrite"),v=p.objectStore(ue.DB_STORE_NAME);function w(F){if(F&&!d)return d=!0,t(F)}p.onerror=F=>{w(this.error),F.preventDefault()},p.oncomplete=F=>{d||t(null)},a.sort().forEach(F=>{r.type==="local"?ue.loadRemoteEntry(v,F,(B,T)=>{if(B)return w(B);ue.storeLocalEntry(F,T,w)}):ue.loadLocalEntry(F,(B,T)=>{if(B)return w(B);ue.storeRemoteEntry(v,F,T,w)})}),s.sort().reverse().forEach(F=>{r.type==="local"?ue.removeLocalEntry(F,w):ue.removeRemoteEntry(v,F,w)})}},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){this.name="ErrnoError",this.errno=e}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(e,r={}){if(e=Ke.resolve(e),!e)return{path:"",node:null};var t={follow_mount:!0,recurse_count:0};if(r=Object.assign(t,r),r.recurse_count>8)throw new c.ErrnoError(32);for(var n=e.split("/").filter(F=>!!F),a=c.root,s="/",d=0;d<n.length;d++){var u=d===n.length-1;if(u&&r.parent)break;if(a=c.lookupNode(a,n[d]),s=ae.join2(s,n[d]),c.isMountpoint(a)&&(!u||u&&r.follow_mount)&&(a=a.mounted.root),!u||r.follow)for(var p=0;c.isLink(a.mode);){var v=c.readlink(s);s=Ke.resolve(ae.dirname(s),v);var w=c.lookupPath(s,{recurse_count:r.recurse_count+1});if(a=w.node,p++>40)throw new c.ErrnoError(32)}}return{path:s,node:a}},getPath(e){for(var r;;){if(c.isRoot(e)){var t=e.mount.mountpoint;return r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var t=0,n=0;n<r.length;n++)t=(t<<5)-t+r.charCodeAt(n)|0;return(e+t>>>0)%c.nameTable.length},hashAddNode(e){var r=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[r],c.nameTable[r]=e},hashRemoveNode(e){var r=c.hashName(e.parent.id,e.name);if(c.nameTable[r]===e)c.nameTable[r]=e.name_next;else for(var t=c.nameTable[r];t;){if(t.name_next===e){t.name_next=e.name_next;break}t=t.name_next}},lookupNode(e,r){var t=c.mayLookup(e);if(t)throw new c.ErrnoError(t);for(var n=c.hashName(e.id,r),a=c.nameTable[n];a;a=a.name_next){var s=a.name;if(a.parent.id===e.id&&s===r)return a}return c.lookup(e,r)},createNode(e,r,t,n){var a=new c.FSNode(e,r,t,n);return c.hashAddNode(a),a},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return c.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var r=c.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){try{var t=c.lookupNode(e,r);return 20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,r,t){var n;try{n=c.lookupNode(e,r)}catch(s){return s.errno}var a=c.nodePermissions(e,"wx");if(a)return a;if(t){if(!c.isDir(n.mode))return 54;if(c.isRoot(n)||c.getPath(n)===c.cwd())return 10}else if(c.isDir(n.mode))return 31;return 0},mayOpen(e,r){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(r)!=="r"||r&512)?31:c.nodePermissions(e,c.flagsToPermissionString(r)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var r=c.getStream(e);if(!r)throw new c.ErrnoError(8);return r},getStream:e=>c.streams[e],createStream(e,r=-1){return c.FSStream||(c.FSStream=function(){this.shared={}},c.FSStream.prototype={},Object.defineProperties(c.FSStream.prototype,{object:{get(){return this.node},set(t){this.node=t}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(t){this.shared.flags=t}},position:{get(){return this.shared.position},set(t){this.shared.position=t}}})),e=Object.assign(new c.FSStream,e),r==-1&&(r=c.nextfd()),e.fd=r,c.streams[r]=e,e},closeStream(e){c.streams[e]=null},chrdev_stream_ops:{open(e){var t,n;var r=c.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,(n=(t=e.stream_ops).open)==null||n.call(t,e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){c.devices[e]={stream_ops:r}},getDevice:e=>c.devices[e],getMounts(e){for(var r=[],t=[e];t.length;){var n=t.pop();r.push(n),t.push.apply(t,n.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&D(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var t=c.getMounts(c.root.mount),n=0;function a(d){return c.syncFSRequests--,r(d)}function s(d){if(d)return s.errored?void 0:(s.errored=!0,a(d));++n>=t.length&&a(null)}t.forEach(d=>{if(!d.type.syncfs)return s(null);d.type.syncfs(d,e,s)})},mount(e,r,t){var n=t==="/",a=!t,s;if(n&&c.root)throw new c.ErrnoError(10);if(!n&&!a){var d=c.lookupPath(t,{follow_mount:!1});if(t=d.path,s=d.node,c.isMountpoint(s))throw new c.ErrnoError(10);if(!c.isDir(s.mode))throw new c.ErrnoError(54)}var u={type:e,opts:r,mountpoint:t,mounts:[]},p=e.mount(u);return p.mount=u,u.root=p,n?c.root=p:s&&(s.mounted=u,s.mount&&s.mount.mounts.push(u)),p},unmount(e){var r=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(r.node))throw new c.ErrnoError(28);var t=r.node,n=t.mounted,a=c.getMounts(n);Object.keys(c.nameTable).forEach(d=>{for(var u=c.nameTable[d];u;){var p=u.name_next;a.includes(u.mount)&&c.destroyNode(u),u=p}}),t.mounted=null;var s=t.mount.mounts.indexOf(n);t.mount.mounts.splice(s,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,t){var n=c.lookupPath(e,{parent:!0}),a=n.node,s=ae.basename(e);if(!s||s==="."||s==="..")throw new c.ErrnoError(28);var d=c.mayCreate(a,s);if(d)throw new c.ErrnoError(d);if(!a.node_ops.mknod)throw new c.ErrnoError(63);return a.node_ops.mknod(a,s,r,t)},create(e,r){return r=r!==void 0?r:438,r&=4095,r|=32768,c.mknod(e,r,0)},mkdir(e,r){return r=r!==void 0?r:511,r&=1023,r|=16384,c.mknod(e,r,0)},mkdirTree(e,r){for(var t=e.split("/"),n="",a=0;a<t.length;++a)if(t[a]){n+="/"+t[a];try{c.mkdir(n,r)}catch(s){if(s.errno!=20)throw s}}},mkdev(e,r,t){return typeof t>"u"&&(t=r,r=438),r|=8192,c.mknod(e,r,t)},symlink(e,r){if(!Ke.resolve(e))throw new c.ErrnoError(44);var t=c.lookupPath(r,{parent:!0}),n=t.node;if(!n)throw new c.ErrnoError(44);var a=ae.basename(r),s=c.mayCreate(n,a);if(s)throw new c.ErrnoError(s);if(!n.node_ops.symlink)throw new c.ErrnoError(63);return n.node_ops.symlink(n,a,e)},rename(e,r){var t=ae.dirname(e),n=ae.dirname(r),a=ae.basename(e),s=ae.basename(r),d,u,p;if(d=c.lookupPath(e,{parent:!0}),u=d.node,d=c.lookupPath(r,{parent:!0}),p=d.node,!u||!p)throw new c.ErrnoError(44);if(u.mount!==p.mount)throw new c.ErrnoError(75);var v=c.lookupNode(u,a),w=Ke.relative(e,n);if(w.charAt(0)!==".")throw new c.ErrnoError(28);if(w=Ke.relative(r,t),w.charAt(0)!==".")throw new c.ErrnoError(55);var F;try{F=c.lookupNode(p,s)}catch{}if(v!==F){var B=c.isDir(v.mode),T=c.mayDelete(u,a,B);if(T)throw new c.ErrnoError(T);if(T=F?c.mayDelete(p,s,B):c.mayCreate(p,s),T)throw new c.ErrnoError(T);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(v)||F&&c.isMountpoint(F))throw new c.ErrnoError(10);if(p!==u&&(T=c.nodePermissions(u,"w"),T))throw new c.ErrnoError(T);c.hashRemoveNode(v);try{u.node_ops.rename(v,p,s)}catch(A){throw A}finally{c.hashAddNode(v)}}},rmdir(e){var r=c.lookupPath(e,{parent:!0}),t=r.node,n=ae.basename(e),a=c.lookupNode(t,n),s=c.mayDelete(t,n,!0);if(s)throw new c.ErrnoError(s);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.rmdir(t,n),c.destroyNode(a)},readdir(e){var r=c.lookupPath(e,{follow:!0}),t=r.node;if(!t.node_ops.readdir)throw new c.ErrnoError(54);return t.node_ops.readdir(t)},unlink(e){var r=c.lookupPath(e,{parent:!0}),t=r.node;if(!t)throw new c.ErrnoError(44);var n=ae.basename(e),a=c.lookupNode(t,n),s=c.mayDelete(t,n,!1);if(s)throw new c.ErrnoError(s);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.unlink(t,n),c.destroyNode(a)},readlink(e){var r=c.lookupPath(e),t=r.node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return Ke.resolve(c.getPath(t.parent),t.node_ops.readlink(t))},stat(e,r){var t=c.lookupPath(e,{follow:!r}),n=t.node;if(!n)throw new c.ErrnoError(44);if(!n.node_ops.getattr)throw new c.ErrnoError(63);return n.node_ops.getattr(n)},lstat(e){return c.stat(e,!0)},chmod(e,r,t){var n;if(typeof e=="string"){var a=c.lookupPath(e,{follow:!t});n=a.node}else n=e;if(!n.node_ops.setattr)throw new c.ErrnoError(63);n.node_ops.setattr(n,{mode:r&4095|n.mode&-4096,timestamp:Date.now()})},lchmod(e,r){c.chmod(e,r,!0)},fchmod(e,r){var t=c.getStreamChecked(e);c.chmod(t.node,r)},chown(e,r,t,n){var a;if(typeof e=="string"){var s=c.lookupPath(e,{follow:!n});a=s.node}else a=e;if(!a.node_ops.setattr)throw new c.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown(e,r,t){c.chown(e,r,t,!0)},fchown(e,r,t){var n=c.getStreamChecked(e);c.chown(n.node,r,t)},truncate(e,r){if(r<0)throw new c.ErrnoError(28);var t;if(typeof e=="string"){var n=c.lookupPath(e,{follow:!0});t=n.node}else t=e;if(!t.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var a=c.nodePermissions(t,"w");if(a)throw new c.ErrnoError(a);t.node_ops.setattr(t,{size:r,timestamp:Date.now()})},ftruncate(e,r){var t=c.getStreamChecked(e);if(!(t.flags&2097155))throw new c.ErrnoError(28);c.truncate(t.node,r)},utime(e,r,t){var n=c.lookupPath(e,{follow:!0}),a=n.node;a.node_ops.setattr(a,{timestamp:Math.max(r,t)})},open(e,r,t){if(e==="")throw new c.ErrnoError(44);r=typeof r=="string"?Ta(r):r,t=typeof t>"u"?438:t,r&64?t=t&4095|32768:t=0;var n;if(typeof e=="object")n=e;else{e=ae.normalize(e);try{var a=c.lookupPath(e,{follow:!(r&131072)});n=a.node}catch{}}var s=!1;if(r&64)if(n){if(r&128)throw new c.ErrnoError(20)}else n=c.mknod(e,t,0),s=!0;if(!n)throw new c.ErrnoError(44);if(c.isChrdev(n.mode)&&(r&=-513),r&65536&&!c.isDir(n.mode))throw new c.ErrnoError(54);if(!s){var d=c.mayOpen(n,r);if(d)throw new c.ErrnoError(d)}r&512&&!s&&c.truncate(n,0),r&=-131713;var u=c.createStream({node:n,path:c.getPath(n),flags:r,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),i.logReadFiles&&!(r&1)&&(c.readFiles||(c.readFiles={}),e in c.readFiles||(c.readFiles[e]=1)),u},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(t!=0&&t!=1&&t!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,t),e.ungotten=[],e.position},read(e,r,t,n,a){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var s=typeof a<"u";if(!s)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var d=e.stream_ops.read(e,r,t,n,a);return s||(e.position+=d),d},write(e,r,t,n,a,s){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,r,t,n,a,s);return d||(e.position+=u),u},allocate(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(r<0||t<=0)throw new c.ErrnoError(28);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(!c.isFile(e.node.mode)&&!c.isDir(e.node.mode))throw new c.ErrnoError(43);if(!e.stream_ops.allocate)throw new c.ErrnoError(138);e.stream_ops.allocate(e,r,t)},mmap(e,r,t,n,a){if(n&2&&!(a&2)&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);return e.stream_ops.mmap(e,r,t,n,a)},msync(e,r,t,n,a){return e.stream_ops.msync?e.stream_ops.msync(e,r,t,n,a):0},munmap:e=>0,ioctl(e,r,t){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,r,t)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var t,n=c.open(e,r.flags),a=c.stat(e),s=a.size,d=new Uint8Array(s);return c.read(n,d,0,s,0),r.encoding==="utf8"?t=ur(d,0):r.encoding==="binary"&&(t=d),c.close(n),t},writeFile(e,r,t={}){t.flags=t.flags||577;var n=c.open(e,t.flags,t.mode);if(typeof r=="string"){var a=new Uint8Array(fr(r)+1),s=rt(r,a,0,a.length);c.write(n,a,0,s,void 0,t.canOwn)}else if(ArrayBuffer.isView(r))c.write(n,r,0,r.byteLength,void 0,t.canOwn);else throw new Error("Unsupported data type");c.close(n)},cwd:()=>c.currentPath,chdir(e){var r=c.lookupPath(e,{follow:!0});if(r.node===null)throw new c.ErrnoError(44);if(!c.isDir(r.node.mode))throw new c.ErrnoError(54);var t=c.nodePermissions(r.node,"x");if(t)throw new c.ErrnoError(t);c.currentPath=r.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(n,a,s,d,u)=>d}),c.mkdev("/dev/null",c.makedev(1,3)),nr.register(c.makedev(5,0),nr.default_tty_ops),nr.register(c.makedev(6,0),nr.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),r=0,t=()=>(r===0&&(r=Vt(e).byteLength),e[--r]);c.createDevice("/dev","random",t),c.createDevice("/dev","urandom",t),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var r=c.createNode(e,"fd",16895,73);return r.node_ops={lookup(t,n){var a=+n,s=c.getStreamChecked(a),d={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>s.path}};return d.parent=d,d}},r}},{},"/proc/self/fd")},createStandardStreams(){i.stdin?c.createDevice("/dev","stdin",i.stdin):c.symlink("/dev/tty","/dev/stdin"),i.stdout?c.createDevice("/dev","stdout",null,i.stdout):c.symlink("/dev/tty","/dev/stdout"),i.stderr?c.createDevice("/dev","stderr",null,i.stderr):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){[44].forEach(e=>{c.genericErrors[e]=new c.ErrnoError(e),c.genericErrors[e].stack="<generic error, no stack>"}),c.nameTable=new Array(4096),c.mount(ee,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:ee,IDBFS:ue}},init(e,r,t){c.init.initialized=!0,i.stdin=e||i.stdin,i.stdout=r||i.stdout,i.stderr=t||i.stderr,c.createStandardStreams()},quit(){c.init.initialized=!1;for(var e=0;e<c.streams.length;e++){var r=c.streams[e];r&&c.close(r)}},findObject(e,r){var t=c.analyzePath(e,r);return t.exists?t.object:null},analyzePath(e,r){try{var t=c.lookupPath(e,{follow:!r});e=t.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=c.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=ae.basename(e),t=c.lookupPath(e,{follow:!r}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot=t.path==="/"}catch(a){n.error=a.errno}return n},createPath(e,r,t,n){e=typeof e=="string"?e:c.getPath(e);for(var a=r.split("/").reverse();a.length;){var s=a.pop();if(s){var d=ae.join2(e,s);try{c.mkdir(d)}catch{}e=d}}return d},createFile(e,r,t,n,a){var s=ae.join2(typeof e=="string"?e:c.getPath(e),r),d=at(n,a);return c.create(s,d)},createDataFile(e,r,t,n,a,s){var d=r;e&&(e=typeof e=="string"?e:c.getPath(e),d=r?ae.join2(e,r):e);var u=at(n,a),p=c.create(d,u);if(t){if(typeof t=="string"){for(var v=new Array(t.length),w=0,F=t.length;w<F;++w)v[w]=t.charCodeAt(w);t=v}c.chmod(p,u|146);var B=c.open(p,577);c.write(B,t,0,t.length,0,s),c.close(B),c.chmod(p,u)}},createDevice(e,r,t,n){var a=ae.join2(typeof e=="string"?e:c.getPath(e),r),s=at(!!t,!!n);c.createDevice.major||(c.createDevice.major=64);var d=c.makedev(c.createDevice.major++,0);return c.registerDevice(d,{open(u){u.seekable=!1},close(u){var p;(p=n==null?void 0:n.buffer)!=null&&p.length&&n(10)},read(u,p,v,w,F){for(var B=0,T=0;T<w;T++){var A;try{A=t()}catch{throw new c.ErrnoError(29)}if(A===void 0&&B===0)throw new c.ErrnoError(6);if(A==null)break;B++,p[v+T]=A}return B&&(u.node.timestamp=Date.now()),B},write(u,p,v,w,F){for(var B=0;B<w;B++)try{n(p[v+B])}catch{throw new c.ErrnoError(29)}return w&&(u.node.timestamp=Date.now()),B}}),c.mkdev(a,s,d)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(R)try{e.contents=tt(R(e.url),!0),e.usedBytes=e.contents.length}catch{throw new c.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,r,t,n,a){function s(){this.lengthKnown=!1,this.chunks=[]}if(s.prototype.get=function(T){if(!(T>this.length-1||T<0)){var A=T%this.chunkSize,Q=T/this.chunkSize|0;return this.getter(Q)[A]}},s.prototype.setDataGetter=function(T){this.getter=T},s.prototype.cacheLength=function(){var T=new XMLHttpRequest;if(T.open("HEAD",t,!1),T.send(null),!(T.status>=200&&T.status<300||T.status===304))throw new Error("Couldn't load "+t+". Status: "+T.status);var A=Number(T.getResponseHeader("Content-length")),Q,xe=(Q=T.getResponseHeader("Accept-Ranges"))&&Q==="bytes",me=(Q=T.getResponseHeader("Content-Encoding"))&&Q==="gzip",Se=1024*1024;xe||(Se=A);var be=(Ce,Ue)=>{if(Ce>Ue)throw new Error("invalid range ("+Ce+", "+Ue+") or no bytes requested!");if(Ue>A-1)throw new Error("only "+A+" bytes available! programmer error!");var ye=new XMLHttpRequest;if(ye.open("GET",t,!1),A!==Se&&ye.setRequestHeader("Range","bytes="+Ce+"-"+Ue),ye.responseType="arraybuffer",ye.overrideMimeType&&ye.overrideMimeType("text/plain; charset=x-user-defined"),ye.send(null),!(ye.status>=200&&ye.status<300||ye.status===304))throw new Error("Couldn't load "+t+". Status: "+ye.status);return ye.response!==void 0?new Uint8Array(ye.response||[]):tt(ye.responseText||"")},_e=this;_e.setDataGetter(Ce=>{var Ue=Ce*Se,ye=(Ce+1)*Se-1;if(ye=Math.min(ye,A-1),typeof _e.chunks[Ce]>"u"&&(_e.chunks[Ce]=be(Ue,ye)),typeof _e.chunks[Ce]>"u")throw new Error("doXHR failed!");return _e.chunks[Ce]}),(me||!A)&&(Se=A=1,A=this.getter(0).length,Se=A,U("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=A,this._chunkSize=Se,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var d,u}else var u={isDevice:!1,url:t};var p=c.createFile(e,r,u,n,a);u.contents?p.contents=u.contents:u.url&&(p.contents=null,p.url=u.url),Object.defineProperties(p,{usedBytes:{get:function(){return this.contents.length}}});var v={},w=Object.keys(p.stream_ops);w.forEach(B=>{var T=p.stream_ops[B];v[B]=function(){return c.forceLoadFile(p),T.apply(null,arguments)}});function F(B,T,A,Q,xe){var me=B.node.contents;if(xe>=me.length)return 0;var Se=Math.min(me.length-xe,Q);if(me.slice)for(var be=0;be<Se;be++)T[A+be]=me[xe+be];else for(var be=0;be<Se;be++)T[A+be]=me.get(xe+be);return Se}return v.read=(B,T,A,Q,xe)=>(c.forceLoadFile(p),F(B,T,A,Q,xe)),v.mmap=(B,T,A,Q,xe)=>{c.forceLoadFile(p);var me=Wt(T);if(!me)throw new c.ErrnoError(48);return F(B,G,me,T,A),{ptr:me,allocated:!0}},p.stream_ops=v,p}},je=(e,r)=>e?ur(q,e,r):"",Z={DEFAULT_POLLMASK:5,calculateAt(e,r,t){if(ae.isAbs(r))return r;var n;if(e===-100)n=c.cwd();else{var a=Z.getStreamFromFD(e);n=a.path}if(r.length==0){if(!t)throw new c.ErrnoError(44);return n}return ae.join2(n,r)},doStat(e,r,t){var n=e(r);f[t>>2]=n.dev,f[t+4>>2]=n.mode,W[t+8>>2]=n.nlink,f[t+12>>2]=n.uid,f[t+16>>2]=n.gid,f[t+20>>2]=n.rdev,de=[n.size>>>0,(J=n.size,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+24>>2]=de[0],f[t+28>>2]=de[1],f[t+32>>2]=4096,f[t+36>>2]=n.blocks;var a=n.atime.getTime(),s=n.mtime.getTime(),d=n.ctime.getTime();return de=[Math.floor(a/1e3)>>>0,(J=Math.floor(a/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+40>>2]=de[0],f[t+44>>2]=de[1],W[t+48>>2]=a%1e3*1e3,de=[Math.floor(s/1e3)>>>0,(J=Math.floor(s/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+56>>2]=de[0],f[t+60>>2]=de[1],W[t+64>>2]=s%1e3*1e3,de=[Math.floor(d/1e3)>>>0,(J=Math.floor(d/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+72>>2]=de[0],f[t+76>>2]=de[1],W[t+80>>2]=d%1e3*1e3,de=[n.ino>>>0,(J=n.ino,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+88>>2]=de[0],f[t+92>>2]=de[1],0},doMsync(e,r,t,n,a){if(!c.isFile(r.node.mode))throw new c.ErrnoError(43);if(n&2)return 0;var s=q.slice(e,e+t);c.msync(r,s,a,t,n)},varargs:void 0,get(){var e=f[+Z.varargs>>2];return Z.varargs+=4,e},getp(){return Z.get()},getStr(e){var r=je(e);return r},getStreamFromFD(e){var r=c.getStreamChecked(e);return r}};function Pa(e,r,t){Z.varargs=t;try{var n=Z.getStreamFromFD(e);switch(r){case 0:{var a=Z.get();if(a<0)return-28;for(;c.streams[a];)a++;var s;return s=c.createStream(n,a),s.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var a=Z.get();return n.flags|=a,0}case 12:{var a=Z.getp(),d=0;return V[a+d>>1]=2,0}case 13:case 14:return 0}return-28}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Ma(e,r){try{var t=Z.getStreamFromFD(e);return Z.doStat(c.stat,t.path,r)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var mr=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function Aa(e,r,t){var n=mr(r,t);try{return isNaN(n)?61:(c.ftruncate(e,n),0)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var ve=(e,r,t)=>rt(e,q,r,t);function Da(e,r){try{if(r===0)return-28;var t=c.cwd(),n=fr(t)+1;return r<n?-68:(ve(t,e,r),n)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Ba(e,r,t){try{var n=Z.getStreamFromFD(e);n.getdents||(n.getdents=c.readdir(n.path));for(var a=280,s=0,d=c.llseek(n,0,1),u=Math.floor(d/a);u<n.getdents.length&&s+a<=t;){var p,v,w=n.getdents[u];if(w===".")p=n.node.id,v=4;else if(w===".."){var F=c.lookupPath(n.path,{parent:!0});p=F.node.id,v=4}else{var B=c.lookupNode(n.node,w);p=B.id,v=c.isChrdev(B.mode)?2:c.isDir(B.mode)?4:c.isLink(B.mode)?10:8}de=[p>>>0,(J=p,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[r+s>>2]=de[0],f[r+s+4>>2]=de[1],de=[(u+1)*a>>>0,(J=(u+1)*a,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[r+s+8>>2]=de[0],f[r+s+12>>2]=de[1],V[r+s+16>>1]=280,G[r+s+18>>0]=v,ve(w,r+s+19,256),s+=a,u+=1}return c.llseek(n,u*a,0),s}catch(T){if(typeof c>"u"||T.name!=="ErrnoError")throw T;return-T.errno}}function Ia(e,r,t){Z.varargs=t;try{var n=Z.getStreamFromFD(e);switch(r){case 21509:return n.tty?0:-59;case 21505:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var a=n.tty.ops.ioctl_tcgets(n),s=Z.getp();f[s>>2]=a.c_iflag||0,f[s+4>>2]=a.c_oflag||0,f[s+8>>2]=a.c_cflag||0,f[s+12>>2]=a.c_lflag||0;for(var d=0;d<32;d++)G[s+d+17>>0]=a.c_cc[d]||0;return 0}return 0}case 21510:case 21511:case 21512:return n.tty?0:-59;case 21506:case 21507:case 21508:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){for(var s=Z.getp(),u=f[s>>2],p=f[s+4>>2],v=f[s+8>>2],w=f[s+12>>2],F=[],d=0;d<32;d++)F.push(G[s+d+17>>0]);return n.tty.ops.ioctl_tcsets(n.tty,r,{c_iflag:u,c_oflag:p,c_cflag:v,c_lflag:w,c_cc:F})}return 0}case 21519:{if(!n.tty)return-59;var s=Z.getp();return f[s>>2]=0,0}case 21520:return n.tty?-28:-59;case 21531:{var s=Z.getp();return c.ioctl(n,r,s)}case 21523:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var B=n.tty.ops.ioctl_tiocgwinsz(n.tty),s=Z.getp();V[s>>1]=B[0],V[s+2>>1]=B[1]}return 0}case 21524:return n.tty?0:-59;case 21515:return n.tty?0:-59;default:return-28}}catch(T){if(typeof c>"u"||T.name!=="ErrnoError")throw T;return-T.errno}}function $a(e,r){try{return e=Z.getStr(e),Z.doStat(c.lstat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function Na(e,r,t){try{return r=Z.getStr(r),r=Z.calculateAt(e,r),r=ae.normalize(r),r[r.length-1]==="/"&&(r=r.substr(0,r.length-1)),c.mkdir(r,t,0),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function Ua(e,r,t,n){try{r=Z.getStr(r);var a=n&256,s=n&4096;return n=n&-6401,r=Z.calculateAt(e,r,s),Z.doStat(a?c.lstat:c.stat,r,t)}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function Oa(e,r,t,n){Z.varargs=n;try{r=Z.getStr(r),r=Z.calculateAt(e,r);var a=n?Z.get():0;return c.open(r,t,a).fd}catch(s){if(typeof c>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function za(e,r,t,n){try{if(r=Z.getStr(r),r=Z.calculateAt(e,r),n<=0)return-28;var a=c.readlink(r),s=Math.min(n,fr(a)),d=G[t+s];return ve(a,t,n+1),G[t+s]=d,s}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Ga(e){try{return e=Z.getStr(e),c.rmdir(e),0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function qa(e,r){try{return e=Z.getStr(e),Z.doStat(c.stat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function Va(e,r,t){try{return r=Z.getStr(r),r=Z.calculateAt(e,r),t===0?c.unlink(r):t===512?c.rmdir(r):Qe("Invalid flags passed to unlinkat"),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var Xt=e=>W[e>>2]+f[e+4>>2]*4294967296;function Ha(e,r,t,n){try{if(r=Z.getStr(r),r=Z.calculateAt(e,r,!0),t){var d=Xt(t),u=f[t+8>>2];a=d*1e3+u/(1e3*1e3),t+=16,d=Xt(t),u=f[t+8>>2],s=d*1e3+u/(1e3*1e3)}else var a=Date.now(),s=a;return c.utime(r,a,s),0}catch(p){if(typeof c>"u"||p.name!=="ErrnoError")throw p;return-p.errno}}var Wa=1,Xa=()=>Wa,Ka=()=>{throw 1/0},Ya=e=>e%4===0&&(e%100!==0||e%400===0),Qa=[0,31,60,91,121,152,182,213,244,274,305,335],Ja=[0,31,59,90,120,151,181,212,243,273,304,334],Kt=e=>{var r=Ya(e.getFullYear()),t=r?Qa:Ja,n=t[e.getMonth()]+e.getDate()-1;return n};function Za(e,r,t){var n=mr(e,r),a=new Date(n*1e3);f[t>>2]=a.getSeconds(),f[t+4>>2]=a.getMinutes(),f[t+8>>2]=a.getHours(),f[t+12>>2]=a.getDate(),f[t+16>>2]=a.getMonth(),f[t+20>>2]=a.getFullYear()-1900,f[t+24>>2]=a.getDay();var s=Kt(a)|0;f[t+28>>2]=s,f[t+36>>2]=-(a.getTimezoneOffset()*60);var d=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),p=d.getTimezoneOffset(),v=(u!=p&&a.getTimezoneOffset()==Math.min(p,u))|0;f[t+32>>2]=v}var eo=function(e){var r=(()=>{var t=new Date(f[e+20>>2]+1900,f[e+16>>2],f[e+12>>2],f[e+8>>2],f[e+4>>2],f[e>>2],0),n=f[e+32>>2],a=t.getTimezoneOffset(),s=new Date(t.getFullYear(),0,1),d=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=s.getTimezoneOffset(),p=Math.min(u,d);if(n<0)f[e+32>>2]=+(d!=u&&p==a);else if(n>0!=(p==a)){var v=Math.max(u,d),w=n>0?p:v;t.setTime(t.getTime()+(w-a)*6e4)}f[e+24>>2]=t.getDay();var F=Kt(t)|0;f[e+28>>2]=F,f[e>>2]=t.getSeconds(),f[e+4>>2]=t.getMinutes(),f[e+8>>2]=t.getHours(),f[e+12>>2]=t.getDate(),f[e+16>>2]=t.getMonth(),f[e+20>>2]=t.getYear();var B=t.getTime();return isNaN(B)?-1:B/1e3})();return kn((J=r,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)),r>>>0};function ro(e,r,t,n,a,s,d,u){var p=mr(a,s);try{if(isNaN(p))return 61;var v=Z.getStreamFromFD(n),w=c.mmap(v,e,p,r,t),F=w.ptr;return f[d>>2]=w.allocated,W[u>>2]=F,0}catch(B){if(typeof c>"u"||B.name!=="ErrnoError")throw B;return-B.errno}}function to(e,r,t,n,a,s,d){var u=mr(s,d);try{return isNaN(u)?61:(Z.doMsync(e,Z.getStreamFromFD(a),r,n,u),0)}catch(p){if(typeof c>"u"||p.name!=="ErrnoError")throw p;return-p.errno}}function no(e,r,t,n,a,s,d){var u=mr(s,d);try{if(isNaN(u))return 61;var p=Z.getStreamFromFD(a);t&2&&Z.doMsync(e,p,r,n,u),c.munmap(p)}catch(v){if(typeof c>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}var We=e=>{var r=fr(e)+1,t=Ie(r);return t&&ve(e,t,r),t},ao=(e,r,t)=>{var n=new Date().getFullYear(),a=new Date(n,0,1),s=new Date(n,6,1),d=a.getTimezoneOffset(),u=s.getTimezoneOffset(),p=Math.max(d,u);W[e>>2]=p*60,f[r>>2]=+(d!=u);function v(A){var Q=A.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Q?Q[1]:"GMT"}var w=v(a),F=v(s),B=We(w),T=We(F);u<d?(W[t>>2]=B,W[t+4>>2]=T):(W[t>>2]=T,W[t+4>>2]=B)},oo=()=>{Qe("")},pr=(e,r)=>{if(S.mainLoop.timingMode=e,S.mainLoop.timingValue=r,!S.mainLoop.func)return 1;if(S.mainLoop.running||(S.mainLoop.running=!0),e==0)S.mainLoop.scheduler=function(){var d=Math.max(0,S.mainLoop.tickStartTime+r-Tr())|0;setTimeout(S.mainLoop.runner,d)},S.mainLoop.method="timeout";else if(e==1)S.mainLoop.scheduler=function(){S.requestAnimationFrame(S.mainLoop.runner)},S.mainLoop.method="rAF";else if(e==2){if(typeof S.setImmediate>"u")if(typeof setImmediate>"u"){var t=[],n="setimmediate",a=s=>{(s.data===n||s.data.target===n)&&(s.stopPropagation(),t.shift()())};addEventListener("message",a,!0),S.setImmediate=function(d){t.push(d),postMessage(n,"*")}}else S.setImmediate=setImmediate;S.mainLoop.scheduler=function(){S.setImmediate(S.mainLoop.runner)},S.mainLoop.method="immediate"}return 0},Tr;Tr=()=>performance.now();var Yt=(e,r,t,n,a)=>{K(!S.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),S.mainLoop.func=e,S.mainLoop.arg=n;var s=S.mainLoop.currentlyRunningMainloop;function d(){return!(s<S.mainLoop.currentlyRunningMainloop)}if(S.mainLoop.running=!1,S.mainLoop.runner=function(){var F,B;if(!Y){if(S.mainLoop.queue.length>0){var p=S.mainLoop.queue.shift();if(p.func(p.arg),S.mainLoop.remainingBlockers){var v=S.mainLoop.remainingBlockers,w=v%1==0?v-1:Math.floor(v);p.counted?S.mainLoop.remainingBlockers=w:(w=w+.5,S.mainLoop.remainingBlockers=(8*v+w)/9)}if(S.mainLoop.updateStatus(),!d())return;setTimeout(S.mainLoop.runner,0);return}if(d()){if(S.mainLoop.currentFrameNumber=S.mainLoop.currentFrameNumber+1|0,S.mainLoop.timingMode==1&&S.mainLoop.timingValue>1&&S.mainLoop.currentFrameNumber%S.mainLoop.timingValue!=0){S.mainLoop.scheduler();return}else S.mainLoop.timingMode==0&&(S.mainLoop.tickStartTime=Tr());S.mainLoop.runIter(e),d()&&(typeof SDL=="object"&&((B=(F=SDL.audio)==null?void 0:F.queueNewAudioData)==null||B.call(F)),S.mainLoop.scheduler())}}},a||(r&&r>0?pr(0,1e3/r):pr(1,1),S.mainLoop.scheduler()),t)throw"unwind"},ot=e=>{if(e instanceof zt||e=="unwind")return te;j(1,e)},so=0,Qt=()=>wa||so>0,io=e=>{var r;te=e,Qt()||((r=i.onExit)==null||r.call(i,e),Y=!0),j(e,new zt(e))},Jt=(e,r)=>{te=e,io(e)},Zt=Jt,lo=()=>{if(!Qt())try{Zt(te)}catch(e){ot(e)}},st=e=>{if(!Y)try{e(),lo()}catch(r){ot(r)}},en=(e,r)=>setTimeout(()=>{st(e)},r),S={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){S.mainLoop.scheduler=null,S.mainLoop.currentlyRunningMainloop++},resume(){S.mainLoop.currentlyRunningMainloop++;var e=S.mainLoop.timingMode,r=S.mainLoop.timingValue,t=S.mainLoop.func;S.mainLoop.func=null,Yt(t,0,!1,S.mainLoop.arg,!0),pr(e,r),S.mainLoop.scheduler()},updateStatus(){if(i.setStatus){var e=i.statusMessage||"Please wait...",r=S.mainLoop.remainingBlockers,t=S.mainLoop.expectedBlockers;r?r<t?i.setStatus(e+" ("+(t-r)+"/"+t+")"):i.setStatus(e):i.setStatus("")}},runIter(e){var t;if(!Y){if(i.preMainLoop){var r=i.preMainLoop();if(r===!1)return}st(e),(t=i.postMainLoop)==null||t.call(i)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(S.initted)return;S.initted=!0;var e={};e.canHandle=function(s){return!i.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(s)},e.handle=function(s,d,u,p){var v=new Blob([s],{type:S.getMimetype(d)});v.size!==s.length&&(v=new Blob([new Uint8Array(s).buffer],{type:S.getMimetype(d)}));var w=URL.createObjectURL(v),F=new Image;F.onload=()=>{K(F.complete,`Image ${d} could not be decoded`);var B=document.createElement("canvas");B.width=F.width,B.height=F.height;var T=B.getContext("2d");T.drawImage(F,0,0),URL.revokeObjectURL(w),u==null||u(s)},F.onerror=B=>{D(`Image ${w} could not be decoded`),p==null||p()},F.src=w},nt.push(e);var r={};r.canHandle=function(s){return!i.noAudioDecoding&&s.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(s,d,u,p){var v=!1;function w(A){v||(v=!0,u==null||u(s))}var F=new Blob([s],{type:S.getMimetype(d)}),B=URL.createObjectURL(F),T=new Audio;T.addEventListener("canplaythrough",()=>w(),!1),T.onerror=function(Q){if(v)return;D(`warning: browser could not fully decode audio ${d}, trying slower base64 approach`);function xe(me){for(var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",be="=",_e="",Ce=0,Ue=0,ye=0;ye<me.length;ye++)for(Ce=Ce<<8|me[ye],Ue+=8;Ue>=6;){var wm=Ce>>Ue-6&63;Ue-=6,_e+=Se[wm]}return Ue==2?(_e+=Se[(Ce&3)<<4],_e+=be+be):Ue==4&&(_e+=Se[(Ce&15)<<2],_e+=be),_e}T.src="data:audio/x-"+d.substr(-3)+";base64,"+xe(s),w()},T.src=B,en(()=>{w()},1e4)},nt.push(r);function t(){S.pointerLock=document.pointerLockElement===i.canvas||document.mozPointerLockElement===i.canvas||document.webkitPointerLockElement===i.canvas||document.msPointerLockElement===i.canvas}var n=i.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),i.elementPointerLock&&n.addEventListener("click",a=>{!S.pointerLock&&i.canvas.requestPointerLock&&(i.canvas.requestPointerLock(),a.preventDefault())},!1))},createContext(e,r,t,n){if(r&&i.ctx&&e==i.canvas)return i.ctx;var a,s;if(r){var d={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var u in n)d[u]=n[u];typeof C<"u"&&(s=C.createContext(e,d),s&&(a=C.getContext(s).GLctx))}else a=e.getContext("2d");return a?(t&&(r||K(typeof x>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),i.ctx=a,r&&C.makeContextCurrent(s),i.useWebGL=r,S.moduleContextCreatedCallbacks.forEach(p=>p()),S.init()),a):null},destroyContext(e,r,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(e,r){S.lockPointer=e,S.resizeCanvas=r,typeof S.lockPointer>"u"&&(S.lockPointer=!0),typeof S.resizeCanvas>"u"&&(S.resizeCanvas=!1);var t=i.canvas;function n(){var d,u;S.isFullscreen=!1;var s=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===s?(t.exitFullscreen=S.exitFullscreen,S.lockPointer&&t.requestPointerLock(),S.isFullscreen=!0,S.resizeCanvas?S.setFullscreenCanvasSize():S.updateCanvasDimensions(t)):(s.parentNode.insertBefore(t,s),s.parentNode.removeChild(s),S.resizeCanvas?S.setWindowedCanvasSize():S.updateCanvasDimensions(t)),(d=i.onFullScreen)==null||d.call(i,S.isFullscreen),(u=i.onFullscreen)==null||u.call(i,S.isFullscreen)}S.fullscreenHandlersInstalled||(S.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?()=>a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(a.webkitRequestFullScreen?()=>a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),a.requestFullscreen()},exitFullscreen(){if(!S.isFullscreen)return!1;var e=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return e.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(e){var r=Date.now();if(S.nextRAF===0)S.nextRAF=r+1e3/60;else for(;r+2>=S.nextRAF;)S.nextRAF+=1e3/60;var t=Math.max(S.nextRAF-r,0);setTimeout(e,t)},requestAnimationFrame(e){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(e);return}var r=S.fakeRequestAnimationFrame;r(e)},safeSetTimeout(e,r){return en(e,r)},safeRequestAnimationFrame(e){return S.requestAnimationFrame(()=>{st(e)})},getMimetype(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta(e){var r=0;switch(e.type){case"DOMMouseScroll":r=e.detail/3;break;case"mousewheel":r=e.wheelDelta/120;break;case"wheel":switch(r=e.deltaY,e.deltaMode){case 0:r/=100;break;case 1:r/=3;break;case 2:r*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return r},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(e,r){var t=i.canvas.getBoundingClientRect(),n=i.canvas.width,a=i.canvas.height,s=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,d=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset,u=e-(s+t.left),p=r-(d+t.top);return u=u*(n/t.width),p=p*(a/t.height),{x:u,y:p}},setMouseCoords(e,r){const{x:t,y:n}=S.calculateMouseCoords(e,r);S.mouseMovementX=t-S.mouseX,S.mouseMovementY=n-S.mouseY,S.mouseX=t,S.mouseY=n},calculateMouseEvent(e){if(S.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?S.mouseMovementX=S.mouseMovementY=0:(S.mouseMovementX=S.getMovementX(e),S.mouseMovementY=S.getMovementY(e)),typeof SDL<"u"?(S.mouseX=SDL.mouseX+S.mouseMovementX,S.mouseY=SDL.mouseY+S.mouseMovementY):(S.mouseX+=S.mouseMovementX,S.mouseY+=S.mouseMovementY);else{if(e.type==="touchstart"||e.type==="touchend"||e.type==="touchmove"){var r=e.touch;if(r===void 0)return;var t=S.calculateMouseCoords(r.pageX,r.pageY);if(e.type==="touchstart")S.lastTouches[r.identifier]=t,S.touches[r.identifier]=t;else if(e.type==="touchend"||e.type==="touchmove"){var n=S.touches[r.identifier];n||(n=t),S.lastTouches[r.identifier]=n,S.touches[r.identifier]=t}return}S.setMouseCoords(e.pageX,e.pageY)}},resizeListeners:[],updateResizeListeners(){var e=i.canvas;S.resizeListeners.forEach(r=>r(e.width,e.height))},setCanvasSize(e,r,t){var n=i.canvas;S.updateCanvasDimensions(n,e,r),t||S.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var e=W[SDL.screen>>2];e=e|8388608,f[SDL.screen>>2]=e}S.updateCanvasDimensions(i.canvas),S.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var e=W[SDL.screen>>2];e=e&-8388609,f[SDL.screen>>2]=e}S.updateCanvasDimensions(i.canvas),S.updateResizeListeners()},updateCanvasDimensions(e,r,t){r&&t?(e.widthNative=r,e.heightNative=t):(r=e.widthNative,t=e.heightNative);var n=r,a=t;if(i.forcedAspectRatio&&i.forcedAspectRatio>0&&(n/a<i.forcedAspectRatio?n=Math.round(a*i.forcedAspectRatio):a=Math.round(n/i.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&typeof screen<"u"){var s=Math.min(screen.width/n,screen.height/a);n=Math.round(n*s),a=Math.round(a*s)}S.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=a&&(e.height=a),typeof e.style<"u"&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=r&&(e.width=r),e.height!=t&&(e.height=t),typeof e.style<"u"&&(n!=r||a!=t?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}},N={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode(e){N.errorCode=e},chooseConfig(e,r,t,n,a){if(e!=62e3)return N.setErrorCode(12296),0;if(r)for(;;){var s=f[r>>2];if(s==12321){var d=f[r+4>>2];N.contextAttributes.alpha=d>0}else if(s==12325){var u=f[r+4>>2];N.contextAttributes.depth=u>0}else if(s==12326){var p=f[r+4>>2];N.contextAttributes.stencil=p>0}else if(s==12337){var v=f[r+4>>2];N.contextAttributes.antialias=v>0}else if(s==12338){var v=f[r+4>>2];N.contextAttributes.antialias=v==1}else if(s==12544){var w=f[r+4>>2];N.contextAttributes.lowLatency=w!=12547}else if(s==12344)break;r+=8}return(!t||!n)&&!a?(N.setErrorCode(12300),0):(a&&(f[a>>2]=1),t&&n>0&&(W[t>>2]=62002),N.setErrorCode(12288),1)}},co=e=>e==12448?(N.setErrorCode(12288),1):(N.setErrorCode(12300),0),uo=(e,r,t,n,a)=>N.chooseConfig(e,r,t,n,a),fo=e=>{var r=e.getExtension("ANGLE_instanced_arrays");if(r)return e.vertexAttribDivisor=(t,n)=>r.vertexAttribDivisorANGLE(t,n),e.drawArraysInstanced=(t,n,a,s)=>r.drawArraysInstancedANGLE(t,n,a,s),e.drawElementsInstanced=(t,n,a,s,d)=>r.drawElementsInstancedANGLE(t,n,a,s,d),1},mo=e=>{var r=e.getExtension("OES_vertex_array_object");if(r)return e.createVertexArray=()=>r.createVertexArrayOES(),e.deleteVertexArray=t=>r.deleteVertexArrayOES(t),e.bindVertexArray=t=>r.bindVertexArrayOES(t),e.isVertexArray=t=>r.isVertexArrayOES(t),1},po=e=>{var r=e.getExtension("WEBGL_draw_buffers");if(r)return e.drawBuffers=(t,n)=>r.drawBuffersWEBGL(t,n),1},ho=e=>!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")),rn=function(e){var r=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_half_float","EXT_float_blend","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw"];return(e.getSupportedExtensions()||[]).filter(t=>r.includes(t))},C={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(r){C.lastError||(C.lastError=r)},getNewId:e=>{for(var r=C.counter++,t=e.length;t<r;t++)e[t]=null;return r},getSource:(e,r,t,n)=>{for(var a="",s=0;s<r;++s){var d=n?W[n+s*4>>2]:void 0;a+=je(W[t+s*4>>2],d)}return a},createContext:(e,r)=>{if(!e.getContextSafariWebGL2Fixed){let a=function(s,d){var u=e.getContextSafariWebGL2Fixed(s,d);return s=="webgl"==u instanceof WebGLRenderingContext?u:null};e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=a}var t=e.getContext("webgl",r);if(!t)return 0;var n=C.registerContext(t,r);return n},registerContext:(e,r)=>{var t=C.getNewId(C.contexts),n={handle:t,attributes:r,version:r.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),C.contexts[t]=n,(typeof r.enableExtensionsByDefault>"u"||r.enableExtensionsByDefault)&&C.initExtensions(n),t},makeContextCurrent:e=>{var r;return C.currentContext=C.contexts[e],i.ctx=x=(r=C.currentContext)==null?void 0:r.GLctx,!(e&&!x)},getContext:e=>C.contexts[e],deleteContext:e=>{C.currentContext===C.contexts[e]&&(C.currentContext=null),typeof M=="object"&&M.removeAllHandlersOnTarget(C.contexts[e].GLctx.canvas),C.contexts[e]&&C.contexts[e].GLctx.canvas&&(C.contexts[e].GLctx.canvas.GLctxObject=void 0),C.contexts[e]=null},initExtensions:e=>{if(e||(e=C.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var r=e.GLctx;fo(r),mo(r),po(r),r.disjointTimerQueryExt=r.getExtension("EXT_disjoint_timer_query"),ho(r),rn(r).forEach(t=>{!t.includes("lose_context")&&!t.includes("debug")&&r.getExtension(t)})}}},vo=(e,r,t,n)=>{if(e!=62e3)return N.setErrorCode(12296),0;for(var a=1;;){var s=f[n>>2];if(s==12440)a=f[n+4>>2];else{if(s==12344)break;return N.setErrorCode(12292),0}n+=8}return a!=2?(N.setErrorCode(12293),0):(N.contextAttributes.majorVersion=a-1,N.contextAttributes.minorVersion=0,N.context=C.createContext(i.canvas,N.contextAttributes),N.context!=0?(N.setErrorCode(12288),C.makeContextCurrent(N.context),i.useWebGL=!0,S.moduleContextCreatedCallbacks.forEach(function(d){d()}),C.makeContextCurrent(null),62004):(N.setErrorCode(12297),0))},go=(e,r,t,n)=>e!=62e3?(N.setErrorCode(12296),0):r!=62002?(N.setErrorCode(12293),0):(N.setErrorCode(12288),62006),xo=(e,r)=>e!=62e3?(N.setErrorCode(12296),0):r!=62004?(N.setErrorCode(12294),0):(C.deleteContext(N.context),N.setErrorCode(12288),N.currentContext==r&&(N.currentContext=0),1),bo=(e,r)=>e!=62e3?(N.setErrorCode(12296),0):r!=62006?(N.setErrorCode(12301),1):(N.currentReadSurface==r&&(N.currentReadSurface=0),N.currentDrawSurface==r&&(N.currentDrawSurface=0),N.setErrorCode(12288),1),_o=(e,r,t,n)=>{if(e!=62e3)return N.setErrorCode(12296),0;if(r!=62002)return N.setErrorCode(12293),0;if(!n)return N.setErrorCode(12300),0;switch(N.setErrorCode(12288),t){case 12320:return f[n>>2]=N.contextAttributes.alpha?32:24,1;case 12321:return f[n>>2]=N.contextAttributes.alpha?8:0,1;case 12322:return f[n>>2]=8,1;case 12323:return f[n>>2]=8,1;case 12324:return f[n>>2]=8,1;case 12325:return f[n>>2]=N.contextAttributes.depth?24:0,1;case 12326:return f[n>>2]=N.contextAttributes.stencil?8:0,1;case 12327:return f[n>>2]=12344,1;case 12328:return f[n>>2]=62002,1;case 12329:return f[n>>2]=0,1;case 12330:return f[n>>2]=4096,1;case 12331:return f[n>>2]=16777216,1;case 12332:return f[n>>2]=4096,1;case 12333:return f[n>>2]=0,1;case 12334:return f[n>>2]=0,1;case 12335:return f[n>>2]=12344,1;case 12337:return f[n>>2]=N.contextAttributes.antialias?4:0,1;case 12338:return f[n>>2]=N.contextAttributes.antialias?1:0,1;case 12339:return f[n>>2]=4,1;case 12340:return f[n>>2]=12344,1;case 12341:case 12342:case 12343:return f[n>>2]=-1,1;case 12345:case 12346:return f[n>>2]=0,1;case 12347:return f[n>>2]=0,1;case 12348:return f[n>>2]=1,1;case 12349:case 12350:return f[n>>2]=0,1;case 12351:return f[n>>2]=12430,1;case 12352:return f[n>>2]=4,1;case 12354:return f[n>>2]=0,1;default:return N.setErrorCode(12292),0}},yo=e=>(N.setErrorCode(12288),e!=0&&e!=1?0:62e3),wo=()=>N.errorCode,So=(e,r,t)=>e!=62e3?(N.setErrorCode(12296),0):(r&&(f[r>>2]=1),t&&(f[t>>2]=4),N.defaultDisplayInitialized=!0,N.setErrorCode(12288),1),Eo=(e,r,t,n)=>e!=62e3?(N.setErrorCode(12296),0):n!=0&&n!=62004?(N.setErrorCode(12294),0):t!=0&&t!=62006||r!=0&&r!=62006?(N.setErrorCode(12301),0):(C.makeContextCurrent(n?N.context:null),N.currentContext=n,N.currentDrawSurface=r,N.currentReadSurface=t,N.setErrorCode(12288),1),Co=(e,r)=>{if(e!=62e3)return N.setErrorCode(12296),0;if(N.setErrorCode(12288),N.stringCache[r])return N.stringCache[r];var t;switch(r){case 12371:t=We("Emscripten");break;case 12372:t=We("1.4 Emscripten EGL");break;case 12373:t=We("");break;case 12429:t=We("OpenGL_ES");break;default:return N.setErrorCode(12300),0}return N.stringCache[r]=t,t},ko=(e,r)=>{if(!N.defaultDisplayInitialized)N.setErrorCode(12289);else if(!i.ctx)N.setErrorCode(12290);else if(i.ctx.isContextLost())N.setErrorCode(12302);else return N.setErrorCode(12288),1;return 0},jo=(e,r)=>e!=62e3?(N.setErrorCode(12296),0):(r==0?pr(0,0):pr(1,r),N.setErrorCode(12288),1),Lo=e=>e!=62e3?(N.setErrorCode(12296),0):(N.currentContext=0,N.currentReadSurface=0,N.currentDrawSurface=0,N.defaultDisplayInitialized=!1,N.setErrorCode(12288),1),Fo=()=>(N.setErrorCode(12288),1),Ro=Fo,To=e=>(N.setErrorCode(12288),1),it=[],tn=(e,r)=>{it.length=0;for(var t;t=q[e++];){var n=t!=105;n&=t!=112,r+=n&&r%8?4:0,it.push(t==112?W[r>>2]:t==105?f[r>>2]:oe[r>>3]),r+=n?8:4}return it},Po=(e,r,t)=>{var n=tn(r,t);return Ot[e].apply(null,n)},Mo=(e,r,t)=>Po(e,r,t),Ao=(e,r,t,n)=>{var a=tn(r,t);return Ot[e].apply(null,a)},Do=(e,r,t)=>Ao(e,r,t),Bo=()=>Date.now(),nn=e=>{var r=$e(),t=e();return Ne(r),t},M={removeAllEventListeners(){for(;M.eventHandlers.length;)M._removeHandler(M.eventHandlers.length-1);M.deferredCalls=[]},inEventHandler:0,deferredCalls:[],deferCall(e,r,t){function n(d,u){if(d.length!=u.length)return!1;for(var p in d)if(d[p]!=u[p])return!1;return!0}for(var a in M.deferredCalls){var s=M.deferredCalls[a];if(s.targetFunction==e&&n(s.argsList,t))return}M.deferredCalls.push({targetFunction:e,precedence:r,argsList:t}),M.deferredCalls.sort((d,u)=>d.precedence<u.precedence)},removeDeferredCalls(e){for(var r=0;r<M.deferredCalls.length;++r)M.deferredCalls[r].targetFunction==e&&(M.deferredCalls.splice(r,1),--r)},canPerformEventHandlerRequests(){return navigator.userActivation?navigator.userActivation.isActive:M.inEventHandler&&M.currentEventHandler.allowsDeferredCalls},runDeferredCalls(){if(M.canPerformEventHandlerRequests())for(var e=0;e<M.deferredCalls.length;++e){var r=M.deferredCalls[e];M.deferredCalls.splice(e,1),--e,r.targetFunction.apply(null,r.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(e,r)=>{for(var t=0;t<M.eventHandlers.length;++t)M.eventHandlers[t].target==e&&(!r||r==M.eventHandlers[t].eventTypeString)&&M._removeHandler(t--)},_removeHandler(e){var r=M.eventHandlers[e];r.target.removeEventListener(r.eventTypeString,r.eventListenerFunc,r.useCapture),M.eventHandlers.splice(e,1)},registerOrRemoveHandler(e){if(!e.target)return-4;if(e.callbackfunc)e.eventListenerFunc=function(t){++M.inEventHandler,M.currentEventHandler=e,M.runDeferredCalls(),e.handlerFunc(t),M.runDeferredCalls(),--M.inEventHandler},e.target.addEventListener(e.eventTypeString,e.eventListenerFunc,e.useCapture),M.eventHandlers.push(e);else for(var r=0;r<M.eventHandlers.length;++r)M.eventHandlers[r].target==e.target&&M.eventHandlers[r].eventTypeString==e.eventTypeString&&M._removeHandler(r--);return 0},getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":(e==null?void 0:e.nodeName)||"":""},fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},Pr={},Io=e=>e>2?je(e):e,Mr=[0,document,window],Fe=e=>{e=Io(e);var r=Mr[e]||document.querySelector(e);return r},an=Fe,$o=(e,r,t)=>{var n=an(e);if(!n)return-4;f[r>>2]=n.width,f[t>>2]=n.height},lt=e=>{var r=fr(e)+1,t=Nr(r);return ve(e,t,r),t},on=e=>nn(()=>{var r=Nr(8),t=r+4,n=lt(e.id);$o(n,r,t);var a=[f[r>>2],f[t>>2]];return a}),sn=(e,r,t)=>{var n=an(e);return n?(n.width=r,n.height=t,0):-4},ln=(e,r,t)=>{e.controlTransferredOffscreen?nn(()=>{var n=lt(e.id);sn(n,r,t)}):(e.width=r,e.height=t)},No=e=>{var r=on(e),t=r[0],n=r[1],a=e.style.width,s=e.style.height,d=e.style.backgroundColor,u=document.body.style.backgroundColor,p=e.style.paddingLeft,v=e.style.paddingRight,w=e.style.paddingTop,F=e.style.paddingBottom,B=e.style.marginLeft,T=e.style.marginRight,A=e.style.marginTop,Q=e.style.marginBottom,xe=document.body.style.margin,me=document.documentElement.style.overflow,Se=document.body.scroll,be=e.style.imageRendering;function _e(){var Ce=document.fullscreenElement||document.webkitFullscreenElement;Ce||(document.removeEventListener("fullscreenchange",_e),document.removeEventListener("webkitfullscreenchange",_e),ln(e,t,n),e.style.width=a,e.style.height=s,e.style.backgroundColor=d,u||(document.body.style.backgroundColor="white"),document.body.style.backgroundColor=u,e.style.paddingLeft=p,e.style.paddingRight=v,e.style.paddingTop=w,e.style.paddingBottom=F,e.style.marginLeft=B,e.style.marginRight=T,e.style.marginTop=A,e.style.marginBottom=Q,document.body.style.margin=xe,document.documentElement.style.overflow=me,document.body.scroll=Se,e.style.imageRendering=be,e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,t,n),Pr.canvasResizedCallback&&ce(Pr.canvasResizedCallback)(37,0,Pr.canvasResizedCallbackUserData))}return document.addEventListener("fullscreenchange",_e),document.addEventListener("webkitfullscreenchange",_e),_e},ct=(e,r,t)=>{e.style.paddingLeft=e.style.paddingRight=t+"px",e.style.paddingTop=e.style.paddingBottom=r+"px"},Ar=e=>Mr.indexOf(e)<0?e.getBoundingClientRect():{left:0,top:0},Uo=(e,r)=>{var t=No(e),n=r.softFullscreen?innerWidth:screen.width,a=r.softFullscreen?innerHeight:screen.height,s=Ar(e),d=s.width,u=s.height,p=on(e),v=p[0],w=p[1];if(r.scaleMode==3)ct(e,(a-u)/2,(n-d)/2),n=d,a=u;else if(r.scaleMode==2)if(n*w<v*a){var F=w*n/v;ct(e,(a-F)/2,0),a=F}else{var B=v*a/w;ct(e,0,(n-B)/2),n=B}e.style.backgroundColor||(e.style.backgroundColor="black"),document.body.style.backgroundColor||(document.body.style.backgroundColor="black"),e.style.width=n+"px",e.style.height=a+"px",r.filteringMode==1&&(e.style.imageRendering="optimizeSpeed",e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated");var T=r.canvasResolutionScaleMode==2?devicePixelRatio:1;if(r.canvasResolutionScaleMode!=0){var A=n*T|0,Q=a*T|0;ln(e,A,Q),e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,A,Q)}return t},dt=(e,r)=>{if((r.scaleMode!=0||r.canvasResolutionScaleMode!=0)&&Uo(e,r),e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else return M.fullscreenEnabled()?-3:-1;return Pr=r,r.canvasResizedCallback&&ce(r.canvasResizedCallback)(37,0,r.canvasResizedCallbackUserData),0},Oo=()=>{if(!M.fullscreenEnabled())return-1;M.removeDeferredCalls(dt);var e=Mr[1];if(e.exitFullscreen)e.fullscreenElement&&e.exitFullscreen();else if(e.webkitExitFullscreen)e.webkitFullscreenElement&&e.webkitExitFullscreen();else return-1;return 0},ut=e=>{if(e.requestPointerLock)e.requestPointerLock();else return document.body.requestPointerLock?-3:-1;return 0},zo=()=>{if(M.removeDeferredCalls(ut),document.exitPointerLock)document.exitPointerLock();else return-1;return 0},Go=()=>devicePixelRatio,qo=(e,r,t)=>{if(e=Fe(e),!e)return-4;var n=Ar(e);return oe[r>>3]=n.width,oe[t>>3]=n.height,0},cn=(e,r)=>{oe[e>>3]=r.timestamp;for(var t=0;t<r.axes.length;++t)oe[e+t*8+16>>3]=r.axes[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?oe[e+t*8+528>>3]=r.buttons[t].value:oe[e+t*8+528>>3]=r.buttons[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?f[e+t*4+1040>>2]=r.buttons[t].pressed:f[e+t*4+1040>>2]=r.buttons[t]==1;f[e+1296>>2]=r.connected,f[e+1300>>2]=r.index,f[e+8>>2]=r.axes.length,f[e+12>>2]=r.buttons.length,ve(r.id,e+1304,64),ve(r.mapping,e+1368,64)},Vo=(e,r)=>e<0||e>=M.lastGamepadState.length?-5:M.lastGamepadState[e]?(cn(r,M.lastGamepadState[e]),0):-7,Ho=(e,r)=>{e&&(f[e>>2]=S.mainLoop.timingMode),r&&(f[r>>2]=S.mainLoop.timingValue)},Wo=()=>M.lastGamepadState.length,Xo=(e,r)=>{f[e>>2]=screen.width,f[r>>2]=screen.height};function Ko(e){x.activeTexture(e)}var Yo=Ko,Qo=(e,r)=>{x.attachShader(C.programs[e],C.shaders[r])},Jo=Qo,Zo=(e,r)=>{x.disjointTimerQueryExt.beginQueryEXT(e,C.queries[r])},es=Zo,rs=(e,r,t)=>{x.bindAttribLocation(C.programs[e],r,je(t))},ts=rs,ns=(e,r)=>{x.bindBuffer(e,C.buffers[r])},as=ns,os=(e,r)=>{x.bindFramebuffer(e,C.framebuffers[r])},ss=os,is=(e,r)=>{x.bindRenderbuffer(e,C.renderbuffers[r])},ls=is,cs=(e,r)=>{x.bindTexture(e,C.textures[r])},ds=cs,us=e=>{x.bindVertexArray(C.vaos[e])},fs=us,ms=fs;function ps(e,r,t,n){x.blendColor(e,r,t,n)}var hs=ps;function vs(e){x.blendEquation(e)}var gs=vs;function xs(e,r){x.blendEquationSeparate(e,r)}var bs=xs;function _s(e,r){x.blendFunc(e,r)}var ys=_s;function ws(e,r,t,n){x.blendFuncSeparate(e,r,t,n)}var Ss=ws,Es=(e,r,t,n)=>{x.bufferData(e,t?q.subarray(t,t+r):r,n)},Cs=Es,ks=(e,r,t,n)=>{x.bufferSubData(e,r,q.subarray(n,n+t))},js=ks;function Ls(e){return x.checkFramebufferStatus(e)}var Fs=Ls;function Rs(e){x.clear(e)}var Ts=Rs;function Ps(e,r,t,n){x.clearColor(e,r,t,n)}var Ms=Ps;function As(e){x.clearDepth(e)}var Ds=As;function Bs(e){x.clearStencil(e)}var Is=Bs,$s=(e,r,t,n)=>{x.colorMask(!!e,!!r,!!t,!!n)},Ns=$s,Us=e=>{x.compileShader(C.shaders[e])},Os=Us,zs=(e,r,t,n,a,s,d,u)=>{x.compressedTexImage2D(e,r,t,n,a,s,u?q.subarray(u,u+d):null)},Gs=zs,qs=(e,r,t,n,a,s,d,u,p)=>{x.compressedTexSubImage2D(e,r,t,n,a,s,d,p?q.subarray(p,p+u):null)},Vs=qs;function Hs(e,r,t,n,a,s,d,u){x.copyTexImage2D(e,r,t,n,a,s,d,u)}var Ws=Hs;function Xs(e,r,t,n,a,s,d,u){x.copyTexSubImage2D(e,r,t,n,a,s,d,u)}var Ks=Xs,Ys=()=>{var e=C.getNewId(C.programs),r=x.createProgram();return r.name=e,r.maxUniformLength=r.maxAttributeLength=r.maxUniformBlockNameLength=0,r.uniformIdCounter=1,C.programs[e]=r,e},Qs=Ys,Js=e=>{var r=C.getNewId(C.shaders);return C.shaders[r]=x.createShader(e),r},Zs=Js;function ei(e){x.cullFace(e)}var ri=ei,ti=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.buffers[n];a&&(x.deleteBuffer(a),a.name=0,C.buffers[n]=null)}},ni=ti,ai=(e,r)=>{for(var t=0;t<e;++t){var n=f[r+t*4>>2],a=C.framebuffers[n];a&&(x.deleteFramebuffer(a),a.name=0,C.framebuffers[n]=null)}},oi=ai,si=e=>{if(e){var r=C.programs[e];if(!r){C.recordError(1281);return}x.deleteProgram(r),r.name=0,C.programs[e]=null}},ii=si,li=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.queries[n];a&&(x.disjointTimerQueryExt.deleteQueryEXT(a),C.queries[n]=null)}},ci=li,di=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.renderbuffers[n];a&&(x.deleteRenderbuffer(a),a.name=0,C.renderbuffers[n]=null)}},ui=di,fi=e=>{if(e){var r=C.shaders[e];if(!r){C.recordError(1281);return}x.deleteShader(r),C.shaders[e]=null}},mi=fi,pi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.textures[n];a&&(x.deleteTexture(a),a.name=0,C.textures[n]=null)}},hi=pi,vi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2];x.deleteVertexArray(C.vaos[n]),C.vaos[n]=null}},gi=vi,xi=gi;function bi(e){x.depthFunc(e)}var _i=bi,yi=e=>{x.depthMask(!!e)},wi=yi;function Si(e,r){x.depthRange(e,r)}var Ei=Si,Ci=(e,r)=>{x.detachShader(C.programs[e],C.shaders[r])},ki=Ci;function ji(e){x.disable(e)}var Li=ji,Fi=e=>{x.disableVertexAttribArray(e)},Ri=Fi,Ti=(e,r,t)=>{x.drawArrays(e,r,t)},Pi=Ti,Mi=(e,r,t,n)=>{x.drawArraysInstanced(e,r,t,n)},Ai=Mi,Di=Ai,dn=[],Bi=(e,r)=>{for(var t=dn[e],n=0;n<e;n++)t[n]=f[r+n*4>>2];x.drawBuffers(t)},Ii=Bi,$i=Ii,Ni=(e,r,t,n)=>{x.drawElements(e,r,t,n)},Ui=Ni,Oi=(e,r,t,n,a)=>{x.drawElementsInstanced(e,r,t,n,a)},zi=Oi,Gi=zi;function qi(e){x.enable(e)}var Vi=qi,Hi=e=>{x.enableVertexAttribArray(e)},Wi=Hi,Xi=e=>{x.disjointTimerQueryExt.endQueryEXT(e)},Ki=Xi;function Yi(){x.finish()}var Qi=Yi;function Ji(){x.flush()}var Zi=Ji,el=(e,r,t,n)=>{x.framebufferRenderbuffer(e,r,t,C.renderbuffers[n])},rl=el,tl=(e,r,t,n,a)=>{x.framebufferTexture2D(e,r,t,C.textures[n],a)},nl=tl;function al(e){x.frontFace(e)}var ol=al,_r=(e,r,t,n)=>{for(var a=0;a<e;a++){var s=x[t](),d=s&&C.getNewId(n);s?(s.name=d,n[d]=s):C.recordError(1282),f[r+a*4>>2]=d}},sl=(e,r)=>{_r(e,r,"createBuffer",C.buffers)},il=sl,ll=(e,r)=>{_r(e,r,"createFramebuffer",C.framebuffers)},cl=ll,dl=(e,r)=>{for(var t=0;t<e;t++){var n=x.disjointTimerQueryExt.createQueryEXT();if(!n){for(C.recordError(1282);t<e;)f[r+t++*4>>2]=0;return}var a=C.getNewId(C.queries);n.name=a,C.queries[a]=n,f[r+t*4>>2]=a}},ul=dl,fl=(e,r)=>{_r(e,r,"createRenderbuffer",C.renderbuffers)},ml=fl,pl=(e,r)=>{_r(e,r,"createTexture",C.textures)},hl=pl;function vl(e,r){_r(e,r,"createVertexArray",C.vaos)}var gl=vl,xl=gl;function bl(e){x.generateMipmap(e)}var _l=bl,un=(e,r,t,n,a,s,d,u)=>{r=C.programs[r];var p=x[e](r,t);if(p){var v=u&&ve(p.name,u,n);a&&(f[a>>2]=v),s&&(f[s>>2]=p.size),d&&(f[d>>2]=p.type)}},yl=(e,r,t,n,a,s,d)=>{un("getActiveAttrib",e,r,t,n,a,s,d)},wl=yl,Sl=(e,r,t,n,a,s,d)=>{un("getActiveUniform",e,r,t,n,a,s,d)},El=Sl,Cl=(e,r,t,n)=>{var a=x.getAttachedShaders(C.programs[e]),s=a.length;s>r&&(s=r),f[t>>2]=s;for(var d=0;d<s;++d){var u=C.shaders.indexOf(a[d]);f[n+d*4>>2]=u}},kl=Cl,jl=(e,r)=>x.getAttribLocation(C.programs[e],je(r)),Ll=jl,fn=(e,r)=>{W[e>>2]=r;var t=W[e>>2];W[e+4>>2]=(r-t)/4294967296},ft=(e,r,t)=>{if(!r){C.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:t!=0&&t!=1&&C.recordError(1280);return;case 36345:n=0;break;case 34466:var a=x.getParameter(34467);n=a?a.length:0;break}if(n===void 0){var s=x.getParameter(e);switch(typeof s){case"number":n=s;break;case"boolean":n=s?1:0;break;case"string":C.recordError(1280);return;case"object":if(s===null)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:{n=0;break}default:{C.recordError(1280);return}}else if(s instanceof Float32Array||s instanceof Uint32Array||s instanceof Int32Array||s instanceof Array){for(var d=0;d<s.length;++d)switch(t){case 0:f[r+d*4>>2]=s[d];break;case 2:X[r+d*4>>2]=s[d];break;case 4:G[r+d>>0]=s[d]?1:0;break}return}else try{n=s.name|0}catch(u){C.recordError(1280),D(`GL_INVALID_ENUM in glGet${t}v: Unknown object returned from WebGL getParameter(${e})! (error: ${u})`);return}break;default:C.recordError(1280),D(`GL_INVALID_ENUM in glGet${t}v: Native code calling glGet${t}v(${e}) and it returns ${s} of type ${typeof s}!`);return}}switch(t){case 1:fn(r,n);break;case 0:f[r>>2]=n;break;case 2:X[r>>2]=n;break;case 4:G[r>>0]=n?1:0;break}},Fl=(e,r)=>ft(e,r,4),Rl=Fl,Tl=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=x.getBufferParameter(e,r)},Pl=Tl,Ml=()=>{var e=x.getError()||C.lastError;return C.lastError=0,e},Al=Ml,Dl=(e,r)=>ft(e,r,2),Bl=Dl,Il=(e,r,t,n)=>{var a=x.getFramebufferAttachmentParameter(e,r,t);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=a.name|0),f[n>>2]=a},$l=Il,Nl=(e,r)=>ft(e,r,0),Ul=Nl,Ol=(e,r,t,n)=>{var a=x.getProgramInfoLog(C.programs[e]);a===null&&(a="(unknown error)");var s=r>0&&n?ve(a,n,r):0;t&&(f[t>>2]=s)},zl=Ol,Gl=(e,r,t)=>{if(!t){C.recordError(1281);return}if(e>=C.counter){C.recordError(1281);return}if(e=C.programs[e],r==35716){var n=x.getProgramInfoLog(e);n===null&&(n="(unknown error)"),f[t>>2]=n.length+1}else if(r==35719){if(!e.maxUniformLength)for(var a=0;a<x.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,x.getActiveUniform(e,a).name.length+1);f[t>>2]=e.maxUniformLength}else if(r==35722){if(!e.maxAttributeLength)for(var a=0;a<x.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,x.getActiveAttrib(e,a).name.length+1);f[t>>2]=e.maxAttributeLength}else if(r==35381){if(!e.maxUniformBlockNameLength)for(var a=0;a<x.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,x.getActiveUniformBlockName(e,a).length+1);f[t>>2]=e.maxUniformBlockNameLength}else f[t>>2]=x.getProgramParameter(e,r)},ql=Gl,mn=(e,r,t)=>{if(!t){C.recordError(1281);return}var n=C.queries[e],a;a=x.disjointTimerQueryExt.getQueryObjectEXT(n,r);var s;typeof a=="boolean"?s=a?1:0:s=a,fn(t,s)},Vl=mn,pn=(e,r,t)=>{if(!t){C.recordError(1281);return}var n=C.queries[e],a=x.disjointTimerQueryExt.getQueryObjectEXT(n,r),s;typeof a=="boolean"?s=a?1:0:s=a,f[t>>2]=s},Hl=pn,Wl=mn,Xl=Wl,Kl=pn,Yl=Kl,Ql=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=x.disjointTimerQueryExt.getQueryEXT(e,r)},Jl=Ql,Zl=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=x.getRenderbufferParameter(e,r)},ec=Zl,rc=(e,r,t,n)=>{var a=x.getShaderInfoLog(C.shaders[e]);a===null&&(a="(unknown error)");var s=r>0&&n?ve(a,n,r):0;t&&(f[t>>2]=s)},tc=rc,nc=(e,r,t,n)=>{var a=x.getShaderPrecisionFormat(e,r);f[t>>2]=a.rangeMin,f[t+4>>2]=a.rangeMax,f[n>>2]=a.precision},ac=nc,oc=(e,r,t,n)=>{var a=x.getShaderSource(C.shaders[e]);if(a){var s=r>0&&n?ve(a,n,r):0;t&&(f[t>>2]=s)}},sc=oc,ic=(e,r,t)=>{if(!t){C.recordError(1281);return}if(r==35716){var n=x.getShaderInfoLog(C.shaders[e]);n===null&&(n="(unknown error)");var a=n?n.length+1:0;f[t>>2]=a}else if(r==35720){var s=x.getShaderSource(C.shaders[e]),d=s?s.length+1:0;f[t>>2]=d}else f[t>>2]=x.getShaderParameter(C.shaders[e],r)},lc=ic,cc=function(){var r=rn(x);return r=r.concat(r.map(t=>"GL_"+t)),r},dc=e=>{var r=C.stringCache[e];if(!r){switch(e){case 7939:r=We(cc().join(" "));break;case 7936:case 7937:case 37445:case 37446:var t=x.getParameter(e);t||C.recordError(1280),r=t?We(t):0;break;case 7938:var n=x.getParameter(7938);n=`OpenGL ES 2.0 (${n})`,r=We(n);break;case 35724:var a=x.getParameter(35724),s=/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/,d=a.match(s);d!==null&&(d[1].length==3&&(d[1]=d[1]+"0"),a=`OpenGL ES GLSL ES ${d[1]} (${a})`),r=We(a);break;default:C.recordError(1280)}C.stringCache[e]=r}return r},uc=dc,fc=(e,r,t)=>{if(!t){C.recordError(1281);return}X[t>>2]=x.getTexParameter(e,r)},mc=fc,pc=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=x.getTexParameter(e,r)},hc=pc,vc=e=>parseInt(e),hn=e=>e.slice(-1)=="]"&&e.lastIndexOf("["),vn=e=>{var r=e.uniformLocsById,t=e.uniformSizeAndIdsByName,n,a;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},n=0;n<x.getProgramParameter(e,35718);++n){var s=x.getActiveUniform(e,n),d=s.name,u=s.size,p=hn(d),v=p>0?d.slice(0,p):d,w=e.uniformIdCounter;for(e.uniformIdCounter+=u,t[v]=[u,w],a=0;a<u;++a)r[w]=a,e.uniformArrayNamesById[w++]=v}},gc=(e,r)=>{if(r=je(r),e=C.programs[e]){vn(e);var t=e.uniformLocsById,n=0,a=r,s=hn(r);s>0&&(n=vc(r.slice(s+1))>>>0,a=r.slice(0,s));var d=e.uniformSizeAndIdsByName[a];if(d&&n<d[0]&&(n+=d[1],t[n]=t[n]||x.getUniformLocation(e,r)))return n}else C.recordError(1281);return-1},xc=gc,we=e=>{var r=x.currentProgram;if(r){var t=r.uniformLocsById[e];return typeof t=="number"&&(r.uniformLocsById[e]=t=x.getUniformLocation(r,r.uniformArrayNamesById[e]+(t>0?`[${t}]`:""))),t}else C.recordError(1282)},gn=(e,r,t,n)=>{if(!t){C.recordError(1281);return}e=C.programs[e],vn(e);var a=x.getUniform(e,we(r));if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:X[t>>2]=a;break}else for(var s=0;s<a.length;s++)switch(n){case 0:f[t+s*4>>2]=a[s];break;case 2:X[t+s*4>>2]=a[s];break}},bc=(e,r,t)=>{gn(e,r,t,2)},_c=bc,yc=(e,r,t)=>{gn(e,r,t,0)},wc=yc,Sc=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=x.getVertexAttribOffset(e,r)},Ec=Sc,xn=(e,r,t,n)=>{if(!t){C.recordError(1281);return}var a=x.getVertexAttrib(e,r);if(r==34975)f[t>>2]=a&&a.name;else if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:X[t>>2]=a;break;case 5:f[t>>2]=Math.fround(a);break}else for(var s=0;s<a.length;s++)switch(n){case 0:f[t+s*4>>2]=a[s];break;case 2:X[t+s*4>>2]=a[s];break;case 5:f[t+s*4>>2]=Math.fround(a[s]);break}},Cc=(e,r,t)=>{xn(e,r,t,2)},kc=Cc,jc=(e,r,t)=>{xn(e,r,t,5)},Lc=jc;function Fc(e,r){x.hint(e,r)}var Rc=Fc,Tc=e=>{var r=C.buffers[e];return r?x.isBuffer(r):0},Pc=Tc;function Mc(e){return x.isEnabled(e)}var Ac=Mc,Dc=e=>{var r=C.framebuffers[e];return r?x.isFramebuffer(r):0},Bc=Dc,Ic=e=>(e=C.programs[e],e?x.isProgram(e):0),$c=Ic,Nc=e=>{var r=C.queries[e];return r?x.disjointTimerQueryExt.isQueryEXT(r):0},Uc=Nc,Oc=e=>{var r=C.renderbuffers[e];return r?x.isRenderbuffer(r):0},zc=Oc,Gc=e=>{var r=C.shaders[e];return r?x.isShader(r):0},qc=Gc,Vc=e=>{var r=C.textures[e];return r?x.isTexture(r):0},Hc=Vc,Wc=e=>{var r=C.vaos[e];return r?x.isVertexArray(r):0},Xc=Wc,Kc=Xc;function Yc(e){x.lineWidth(e)}var Qc=Yc,Jc=e=>{e=C.programs[e],x.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},Zc=Jc,ed=(e,r)=>{e==3317&&(C.unpackAlignment=r),x.pixelStorei(e,r)},rd=ed;function td(e,r){x.polygonOffset(e,r)}var nd=td,ad=(e,r)=>{x.disjointTimerQueryExt.queryCounterEXT(C.queries[e],r)},od=ad,sd=(e,r,t,n)=>{function a(u,p){return u+p-1&-p}var s=e*t,d=a(s,n);return r*d},id=e=>{var r={5:3,6:4,8:2,29502:3,29504:4};return r[e-6402]||1},ld=e=>(e-=5120,e==1?q:e==4?f:e==6?X:e==5||e==28922?W:O),cd=e=>31-Math.clz32(e.BYTES_PER_ELEMENT),mt=(e,r,t,n,a,s)=>{var d=ld(e),u=cd(d),p=1<<u,v=id(r)*p,w=sd(t,n,v,C.unpackAlignment);return d.subarray(a>>u,a+w>>u)},dd=(e,r,t,n,a,s,d)=>{var u=mt(s,a,t,n,d);if(!u){C.recordError(1280);return}x.readPixels(e,r,t,n,a,s,u)},ud=dd,fd=()=>{},md=fd;function pd(e,r,t,n){x.renderbufferStorage(e,r,t,n)}var hd=pd,vd=(e,r)=>{x.sampleCoverage(e,!!r)},gd=vd;function xd(e,r,t,n){x.scissor(e,r,t,n)}var bd=xd,_d=(e,r,t,n,a)=>{C.recordError(1280)},yd=_d,wd=(e,r,t,n)=>{var a=C.getSource(e,r,t,n);x.shaderSource(C.shaders[e],a)},Sd=wd;function Ed(e,r,t){x.stencilFunc(e,r,t)}var Cd=Ed;function kd(e,r,t,n){x.stencilFuncSeparate(e,r,t,n)}var jd=kd;function Ld(e){x.stencilMask(e)}var Fd=Ld;function Rd(e,r){x.stencilMaskSeparate(e,r)}var Td=Rd;function Pd(e,r,t){x.stencilOp(e,r,t)}var Md=Pd;function Ad(e,r,t,n){x.stencilOpSeparate(e,r,t,n)}var Dd=Ad,Bd=(e,r,t,n,a,s,d,u,p)=>{x.texImage2D(e,r,t,n,a,s,d,u,p?mt(u,d,n,a,p):null)},Id=Bd;function $d(e,r,t){x.texParameterf(e,r,t)}var Nd=$d,Ud=(e,r,t)=>{var n=X[t>>2];x.texParameterf(e,r,n)},Od=Ud;function zd(e,r,t){x.texParameteri(e,r,t)}var Gd=zd,qd=(e,r,t)=>{var n=f[t>>2];x.texParameteri(e,r,n)},Vd=qd,Hd=(e,r,t,n,a,s,d,u,p)=>{var v=null;p&&(v=mt(u,d,a,s,p)),x.texSubImage2D(e,r,t,n,a,s,d,u,v)},Wd=Hd,Xd=(e,r)=>{x.uniform1f(we(e),r)},Kd=Xd,Je=[],Yd=(e,r,t)=>{if(r<=288)for(var n=Je[r-1],a=0;a<r;++a)n[a]=X[t+4*a>>2];else var n=X.subarray(t>>2,t+r*4>>2);x.uniform1fv(we(e),n)},Qd=Yd,Jd=(e,r)=>{x.uniform1i(we(e),r)},Zd=Jd,yr=[],eu=(e,r,t)=>{if(r<=288)for(var n=yr[r-1],a=0;a<r;++a)n[a]=f[t+4*a>>2];else var n=f.subarray(t>>2,t+r*4>>2);x.uniform1iv(we(e),n)},ru=eu,tu=(e,r,t)=>{x.uniform2f(we(e),r,t)},nu=tu,au=(e,r,t)=>{if(r<=144)for(var n=Je[2*r-1],a=0;a<2*r;a+=2)n[a]=X[t+4*a>>2],n[a+1]=X[t+(4*a+4)>>2];else var n=X.subarray(t>>2,t+r*8>>2);x.uniform2fv(we(e),n)},ou=au,su=(e,r,t)=>{x.uniform2i(we(e),r,t)},iu=su,lu=(e,r,t)=>{if(r<=144)for(var n=yr[2*r-1],a=0;a<2*r;a+=2)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2];else var n=f.subarray(t>>2,t+r*8>>2);x.uniform2iv(we(e),n)},cu=lu,du=(e,r,t,n)=>{x.uniform3f(we(e),r,t,n)},uu=du,fu=(e,r,t)=>{if(r<=96)for(var n=Je[3*r-1],a=0;a<3*r;a+=3)n[a]=X[t+4*a>>2],n[a+1]=X[t+(4*a+4)>>2],n[a+2]=X[t+(4*a+8)>>2];else var n=X.subarray(t>>2,t+r*12>>2);x.uniform3fv(we(e),n)},mu=fu,pu=(e,r,t,n)=>{x.uniform3i(we(e),r,t,n)},hu=pu,vu=(e,r,t)=>{if(r<=96)for(var n=yr[3*r-1],a=0;a<3*r;a+=3)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2];else var n=f.subarray(t>>2,t+r*12>>2);x.uniform3iv(we(e),n)},gu=vu,xu=(e,r,t,n,a)=>{x.uniform4f(we(e),r,t,n,a)},bu=xu,_u=(e,r,t)=>{if(r<=72){var n=Je[4*r-1],a=X;t>>=2;for(var s=0;s<4*r;s+=4){var d=t+s;n[s]=a[d],n[s+1]=a[d+1],n[s+2]=a[d+2],n[s+3]=a[d+3]}}else var n=X.subarray(t>>2,t+r*16>>2);x.uniform4fv(we(e),n)},yu=_u,wu=(e,r,t,n,a)=>{x.uniform4i(we(e),r,t,n,a)},Su=wu,Eu=(e,r,t)=>{if(r<=72)for(var n=yr[4*r-1],a=0;a<4*r;a+=4)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2],n[a+3]=f[t+(4*a+12)>>2];else var n=f.subarray(t>>2,t+r*16>>2);x.uniform4iv(we(e),n)},Cu=Eu,ku=(e,r,t,n)=>{if(r<=72)for(var a=Je[4*r-1],s=0;s<4*r;s+=4)a[s]=X[n+4*s>>2],a[s+1]=X[n+(4*s+4)>>2],a[s+2]=X[n+(4*s+8)>>2],a[s+3]=X[n+(4*s+12)>>2];else var a=X.subarray(n>>2,n+r*16>>2);x.uniformMatrix2fv(we(e),!!t,a)},ju=ku,Lu=(e,r,t,n)=>{if(r<=32)for(var a=Je[9*r-1],s=0;s<9*r;s+=9)a[s]=X[n+4*s>>2],a[s+1]=X[n+(4*s+4)>>2],a[s+2]=X[n+(4*s+8)>>2],a[s+3]=X[n+(4*s+12)>>2],a[s+4]=X[n+(4*s+16)>>2],a[s+5]=X[n+(4*s+20)>>2],a[s+6]=X[n+(4*s+24)>>2],a[s+7]=X[n+(4*s+28)>>2],a[s+8]=X[n+(4*s+32)>>2];else var a=X.subarray(n>>2,n+r*36>>2);x.uniformMatrix3fv(we(e),!!t,a)},Fu=Lu,Ru=(e,r,t,n)=>{if(r<=18){var a=Je[16*r-1],s=X;n>>=2;for(var d=0;d<16*r;d+=16){var u=n+d;a[d]=s[u],a[d+1]=s[u+1],a[d+2]=s[u+2],a[d+3]=s[u+3],a[d+4]=s[u+4],a[d+5]=s[u+5],a[d+6]=s[u+6],a[d+7]=s[u+7],a[d+8]=s[u+8],a[d+9]=s[u+9],a[d+10]=s[u+10],a[d+11]=s[u+11],a[d+12]=s[u+12],a[d+13]=s[u+13],a[d+14]=s[u+14],a[d+15]=s[u+15]}}else var a=X.subarray(n>>2,n+r*64>>2);x.uniformMatrix4fv(we(e),!!t,a)},Tu=Ru,Pu=e=>{e=C.programs[e],x.useProgram(e),x.currentProgram=e},Mu=Pu,Au=e=>{x.validateProgram(C.programs[e])},Du=Au;function Bu(e,r){x.vertexAttrib1f(e,r)}var Iu=Bu,$u=(e,r)=>{x.vertexAttrib1f(e,X[r>>2])},Nu=$u;function Uu(e,r,t){x.vertexAttrib2f(e,r,t)}var Ou=Uu,zu=(e,r)=>{x.vertexAttrib2f(e,X[r>>2],X[r+4>>2])},Gu=zu;function qu(e,r,t,n){x.vertexAttrib3f(e,r,t,n)}var Vu=qu,Hu=(e,r)=>{x.vertexAttrib3f(e,X[r>>2],X[r+4>>2],X[r+8>>2])},Wu=Hu;function Xu(e,r,t,n,a){x.vertexAttrib4f(e,r,t,n,a)}var Ku=Xu,Yu=(e,r)=>{x.vertexAttrib4f(e,X[r>>2],X[r+4>>2],X[r+8>>2],X[r+12>>2])},Qu=Yu,Ju=(e,r)=>{x.vertexAttribDivisor(e,r)},Zu=Ju,ef=Zu,rf=(e,r,t,n,a,s)=>{x.vertexAttribPointer(e,r,t,!!n,a,s)},tf=rf;function nf(e,r,t,n){x.viewport(e,r,t,n)}var af=nf,of=()=>0,sf=(e,r,t)=>q.copyWithin(e,r,r+t),lf=()=>{S.mainLoop.pause()},cf=(e,r)=>{if(!M.fullscreenEnabled())return-1;if(e=Fe(e),!e)return-4;if(!e.requestFullscreen&&!e.webkitRequestFullscreen)return-3;var t=M.canPerformEventHandlerRequests();return t?dt(e,r):r.deferUntilInEventHandler?(M.deferCall(dt,1,[e,r]),1):-2},df=(e,r,t)=>{var n={scaleMode:f[t>>2],canvasResolutionScaleMode:f[t+4>>2],filteringMode:f[t+8>>2],deferUntilInEventHandler:r,canvasResizedCallback:f[t+12>>2],canvasResizedCallbackUserData:f[t+16>>2]};return cf(e,n)},uf=(e,r)=>{if(e=Fe(e),!e)return-4;if(!e.requestPointerLock)return-1;var t=M.canPerformEventHandlerRequests();return t?ut(e):r?(M.deferCall(ut,2,[e]),1):-2},ff=()=>2147483648,mf=e=>{var r=z.buffer,t=(e-r.byteLength+65535)/65536;try{return z.grow(t),Oe(),1}catch{}},pf=e=>{var r=q.length;e>>>=0;var t=ff();if(e>t)return!1;for(var n=(p,v)=>p+(v-p%v)%v,a=1;a<=4;a*=2){var s=r*(1+.2/a);s=Math.min(s,e+100663296);var d=Math.min(t,n(Math.max(e,s),65536)),u=mf(d);if(u)return!0}return!1},hf=()=>{S.mainLoop.resume()},pt=()=>{try{if(navigator.getGamepads)return(M.lastGamepadState=navigator.getGamepads())?0:-1}catch{navigator.getGamepads=null}return-1},vf=(e,r,t,n,a,s)=>{var d=(p=event)=>{var v=ce(n)(a,0,r);if(v&&(v=je(v)),v)return p.preventDefault(),p.returnValue=v,v},u={target:Fe(e),eventTypeString:s,callbackfunc:n,handlerFunc:d,useCapture:t};return M.registerOrRemoveHandler(u)},gf=(e,r,t)=>typeof onbeforeunload>"u"?-1:t!==1?-5:vf(2,e,!0,r,28,"beforeunload"),bn=(e,r,t,n,a,s,d)=>{M.focusEvent||(M.focusEvent=Ie(256));var u=(v=event)=>{var w=M.getNodeNameForTarget(v.target),F=v.target.id?v.target.id:"",B=M.focusEvent;ve(w,B+0,128),ve(F,B+128,128),ce(n)(a,B,r)&&v.preventDefault()},p={target:Fe(e),eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},xf=(e,r,t,n,a)=>bn(e,r,t,n,12,"blur"),bf=(e,r,t)=>(e=Fe(e),e?(e.style.width=r+"px",e.style.height=t+"px",0):-4),_f=(e,r,t,n,a)=>bn(e,r,t,n,13,"focus"),yf=e=>{var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=!!r;f[e>>2]=t,f[e+4>>2]=M.fullscreenEnabled();var n=t?r:M.previousFullscreenElement,a=M.getNodeNameForTarget(n),s=(n==null?void 0:n.id)||"";ve(a,e+8,128),ve(s,e+136,128),f[e+264>>2]=n?n.clientWidth:0,f[e+268>>2]=n?n.clientHeight:0,f[e+272>>2]=screen.width,f[e+276>>2]=screen.height,t&&(M.previousFullscreenElement=r)},_n=(e,r,t,n,a,s,d)=>{M.fullscreenChangeEvent||(M.fullscreenChangeEvent=Ie(280));var u=(v=event)=>{var w=M.fullscreenChangeEvent;yf(w),ce(n)(a,w,r)&&v.preventDefault()},p={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},wf=(e,r,t,n,a)=>M.fullscreenEnabled()?(e=Fe(e),e?(_n(e,r,t,n,19,"webkitfullscreenchange"),_n(e,r,t,n,19,"fullscreenchange")):-4):-1,yn=(e,r,t,n,a,s,d)=>{M.gamepadEvent||(M.gamepadEvent=Ie(1432));var u=(v=event)=>{var w=M.gamepadEvent;cn(w,v.gamepad),ce(n)(a,w,r)&&v.preventDefault()},p={target:Fe(e),allowsDeferredCalls:!0,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},Sf=(e,r,t,n)=>pt()?-1:yn(2,e,r,t,26,"gamepadconnected"),Ef=(e,r,t,n)=>pt()?-1:yn(2,e,r,t,27,"gamepaddisconnected"),ht=(e,r,t,n,a,s,d)=>{M.keyEvent||(M.keyEvent=Ie(176));var u=v=>{var w=M.keyEvent;oe[w>>3]=v.timeStamp;var F=w>>2;f[F+2]=v.location,f[F+3]=v.ctrlKey,f[F+4]=v.shiftKey,f[F+5]=v.altKey,f[F+6]=v.metaKey,f[F+7]=v.repeat,f[F+8]=v.charCode,f[F+9]=v.keyCode,f[F+10]=v.which,ve(v.key||"",w+44,32),ve(v.code||"",w+76,32),ve(v.char||"",w+108,32),ve(v.locale||"",w+140,32),ce(n)(a,w,r)&&v.preventDefault()},p={target:Fe(e),eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},Cf=(e,r,t,n,a)=>ht(e,r,t,n,2,"keydown"),kf=(e,r,t,n,a)=>ht(e,r,t,n,1,"keypress"),jf=(e,r,t,n,a)=>ht(e,r,t,n,3,"keyup"),Lf=(e,r,t)=>{var n=ce(e);Yt(n,r,t)},wn=(e,r,t)=>{oe[e>>3]=r.timeStamp;var n=e>>2;f[n+2]=r.screenX,f[n+3]=r.screenY,f[n+4]=r.clientX,f[n+5]=r.clientY,f[n+6]=r.ctrlKey,f[n+7]=r.shiftKey,f[n+8]=r.altKey,f[n+9]=r.metaKey,V[n*2+20]=r.button,V[n*2+21]=r.buttons,f[n+11]=r.movementX,f[n+12]=r.movementY;var a=Ar(t);f[n+13]=r.clientX-a.left,f[n+14]=r.clientY-a.top},wr=(e,r,t,n,a,s,d)=>{M.mouseEvent||(M.mouseEvent=Ie(72)),e=Fe(e);var u=(v=event)=>{wn(M.mouseEvent,v,e),ce(n)(a,M.mouseEvent,r)&&v.preventDefault()},p={target:e,allowsDeferredCalls:s!="mousemove"&&s!="mouseenter"&&s!="mouseleave",eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},Ff=(e,r,t,n,a)=>wr(e,r,t,n,5,"mousedown"),Rf=(e,r,t,n,a)=>wr(e,r,t,n,33,"mouseenter"),Tf=(e,r,t,n,a)=>wr(e,r,t,n,34,"mouseleave"),Pf=(e,r,t,n,a)=>wr(e,r,t,n,8,"mousemove"),Mf=(e,r,t,n,a)=>wr(e,r,t,n,6,"mouseup"),Af=e=>{var r=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement,t=!!r;f[e>>2]=t;var n=M.getNodeNameForTarget(r),a=(r==null?void 0:r.id)||"";ve(n,e+4,128),ve(a,e+132,128)},Dr=(e,r,t,n,a,s,d)=>{M.pointerlockChangeEvent||(M.pointerlockChangeEvent=Ie(260));var u=(v=event)=>{var w=M.pointerlockChangeEvent;Af(w),ce(n)(a,w,r)&&v.preventDefault()},p={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},Df=(e,r,t,n,a)=>!document||!document.body||!document.body.requestPointerLock&&!document.body.mozRequestPointerLock&&!document.body.webkitRequestPointerLock&&!document.body.msRequestPointerLock?-1:(e=Fe(e),e?(Dr(e,r,t,n,20,"mozpointerlockchange"),Dr(e,r,t,n,20,"webkitpointerlockchange"),Dr(e,r,t,n,20,"mspointerlockchange"),Dr(e,r,t,n,20,"pointerlockchange")):-4),Bf=(e,r,t,n,a,s,d)=>{M.uiEvent||(M.uiEvent=Ie(36)),e=Fe(e);var u=(v=event)=>{if(v.target==e){var w=document.body;if(w){var F=M.uiEvent;f[F>>2]=v.detail,f[F+4>>2]=w.clientWidth,f[F+8>>2]=w.clientHeight,f[F+12>>2]=innerWidth,f[F+16>>2]=innerHeight,f[F+20>>2]=outerWidth,f[F+24>>2]=outerHeight,f[F+28>>2]=pageXOffset,f[F+32>>2]=pageYOffset,ce(n)(a,F,r)&&v.preventDefault()}}},p={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},If=(e,r,t,n,a)=>Bf(e,r,t,n,10,"resize"),Br=(e,r,t,n,a,s,d)=>{M.touchEvent||(M.touchEvent=Ie(1696)),e=Fe(e);var u=v=>{for(var w,F={},B=v.touches,T=0;T<B.length;++T)w=B[T],w.isChanged=w.onTarget=0,F[w.identifier]=w;for(var T=0;T<v.changedTouches.length;++T)w=v.changedTouches[T],w.isChanged=1,F[w.identifier]=w;for(var T=0;T<v.targetTouches.length;++T)F[v.targetTouches[T].identifier].onTarget=1;var A=M.touchEvent;oe[A>>3]=v.timeStamp;var Q=A>>2;f[Q+3]=v.ctrlKey,f[Q+4]=v.shiftKey,f[Q+5]=v.altKey,f[Q+6]=v.metaKey,Q+=7;var xe=Ar(e),me=0;for(var T in F)if(w=F[T],f[Q+0]=w.identifier,f[Q+1]=w.screenX,f[Q+2]=w.screenY,f[Q+3]=w.clientX,f[Q+4]=w.clientY,f[Q+5]=w.pageX,f[Q+6]=w.pageY,f[Q+7]=w.isChanged,f[Q+8]=w.onTarget,f[Q+9]=w.clientX-xe.left,f[Q+10]=w.clientY-xe.top,Q+=13,++me>31)break;f[A+8>>2]=me,ce(n)(a,A,r)&&v.preventDefault()},p={target:e,allowsDeferredCalls:s=="touchstart"||s=="touchend",eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},$f=(e,r,t,n,a)=>Br(e,r,t,n,25,"touchcancel"),Nf=(e,r,t,n,a)=>Br(e,r,t,n,23,"touchend"),Uf=(e,r,t,n,a)=>Br(e,r,t,n,24,"touchmove"),Of=(e,r,t,n,a)=>Br(e,r,t,n,22,"touchstart"),zf=e=>{var r=["hidden","visible","prerender","unloaded"],t=r.indexOf(document.visibilityState);f[e>>2]=document.hidden,f[e+4>>2]=t},Gf=(e,r,t,n,a,s,d)=>{M.visibilityChangeEvent||(M.visibilityChangeEvent=Ie(8));var u=(v=event)=>{var w=M.visibilityChangeEvent;zf(w),ce(n)(a,w,r)&&v.preventDefault()},p={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},qf=(e,r,t,n)=>Gf(Mr[1],e,r,t,21,"visibilitychange"),Vf=(e,r,t,n,a,s,d)=>{M.wheelEvent||(M.wheelEvent=Ie(104));var u=(v=event)=>{var w=M.wheelEvent;wn(w,v,e),oe[w+72>>3]=v.deltaX,oe[w+80>>3]=v.deltaY,oe[w+88>>3]=v.deltaZ,f[w+96>>2]=v.deltaMode,ce(n)(a,w,r)&&v.preventDefault()},p={target:e,allowsDeferredCalls:!0,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(p)},Hf=(e,r,t,n,a)=>(e=Fe(e),e?typeof e.onwheel<"u"?Vf(e,r,t,n,9,"wheel"):-1:-4),Wf=e=>document.title=je(e),Xf=()=>{throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},vt={},Kf=()=>y||"./this.program",Sr=()=>{if(!Sr.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Kf()};for(var t in vt)vt[t]===void 0?delete r[t]:r[t]=vt[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);Sr.strings=n}return Sr.strings},Yf=(e,r)=>{for(var t=0;t<e.length;++t)G[r++>>0]=e.charCodeAt(t);G[r>>0]=0},Qf=(e,r)=>{var t=0;return Sr().forEach((n,a)=>{var s=r+t;W[e+a*4>>2]=s,Yf(n,s),t+=n.length+1}),0},Jf=(e,r)=>{var t=Sr();W[e>>2]=t.length;var n=0;return t.forEach(a=>n+=a.length+1),W[r>>2]=n,0};function Zf(e){try{var r=Z.getStreamFromFD(e);return c.close(r),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return t.errno}}var em=(e,r,t,n)=>{for(var a=0,s=0;s<t;s++){var d=W[r>>2],u=W[r+4>>2];r+=8;var p=c.read(e,G,d,u,n);if(p<0)return-1;if(a+=p,p<u)break}return a};function rm(e,r,t,n){try{var a=Z.getStreamFromFD(e),s=em(a,r,t);return W[n>>2]=s,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}function tm(e,r,t,n,a){var s=mr(r,t);try{if(isNaN(s))return 61;var d=Z.getStreamFromFD(e);return c.llseek(d,s,n),de=[d.position>>>0,(J=d.position,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[a>>2]=de[0],f[a+4>>2]=de[1],d.getdents&&s===0&&n===0&&(d.getdents=null),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function nm(e){var t;try{var r=Z.getStreamFromFD(e);return(t=r.stream_ops)!=null&&t.fsync?r.stream_ops.fsync(r):0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return n.errno}}var am=(e,r,t,n)=>{for(var a=0,s=0;s<t;s++){var d=W[r>>2],u=W[r+4>>2];r+=8;var p=c.write(e,G,d,u,n);if(p<0)return-1;a+=p}return a};function om(e,r,t,n){try{var a=Z.getStreamFromFD(e),s=am(a,r,t);return W[n>>2]=s,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var Sn=e=>{var r=i["_"+e];return r},sm=(e,r)=>{G.set(e,r)},im=(e,r,t,n,a)=>{var s={string:A=>{var Q=0;return A!=null&&A!==0&&(Q=lt(A)),Q},array:A=>{var Q=Nr(A.length);return sm(A,Q),Q}};function d(A){return r==="string"?je(A):r==="boolean"?!!A:A}var u=Sn(e),p=[],v=0;if(n)for(var w=0;w<n.length;w++){var F=s[t[w]];F?(v===0&&(v=$e()),p[w]=F(n[w])):p[w]=n[w]}var B=u.apply(null,p);function T(A){return v!==0&&Ne(v),d(A)}return B=T(B),B},fe=(e,r,t,n)=>{var a=!t||t.every(d=>d==="number"||d==="boolean"),s=r!=="string";return s&&a&&!n?Sn(e):function(){return im(e,r,t,arguments)}},En=function(e,r,t,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=c.nextInode++,this.name=r,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},Ir=365,$r=146;Object.defineProperties(En.prototype,{read:{get:function(){return(this.mode&Ir)===Ir},set:function(e){e?this.mode|=Ir:this.mode&=~Ir}},write:{get:function(){return(this.mode&$r)===$r},set:function(e){e?this.mode|=$r:this.mode&=~$r}},isFolder:{get:function(){return c.isDir(this.mode)}},isDevice:{get:function(){return c.isChrdev(this.mode)}}}),c.FSNode=En,c.createPreloadedFile=Ra,c.staticInit(),i.requestFullscreen=S.requestFullscreen,i.requestAnimationFrame=S.requestAnimationFrame,i.setCanvasSize=S.setCanvasSize,i.pauseMainLoop=S.mainLoop.pause,i.resumeMainLoop=S.mainLoop.resume,i.getUserMedia=S.getUserMedia,i.createContext=S.createContext;for(var x,Be=0;Be<32;++Be)dn.push(new Array(Be));for(var lm=new Float32Array(288),Be=0;Be<288;++Be)Je[Be]=lm.subarray(0,Be+1);for(var cm=new Int32Array(288),Be=0;Be<288;++Be)yr[Be]=cm.subarray(0,Be+1);var dm={Q:Pa,rb:Ma,ab:Aa,mb:Da,ib:Ba,sb:Ia,ob:$a,jb:Na,pb:Ua,S:Oa,hb:za,fb:Ga,qb:qa,gb:Va,db:Ha,tb:Xa,bb:Ka,Za,_a:eo,Wa:ro,Xa:to,Ya:no,eb:ao,a:oo,Qa:co,Ua:uo,Ga:vo,Ja:go,Ha:xo,Ka:bo,Va:_o,O:yo,Fa:wo,Ra:So,La:Eo,Ea:Co,Ma:ko,Na:jo,Ta:Lo,Pa:Ro,Oa:To,i:Mo,b:Do,T:Bo,ya:Oo,Ca:zo,h:Go,e:qo,V:Vo,X:Ho,l:Tr,Ub:Wo,Da:Xo,ea:Yo,da:Jo,ua:es,ca:ts,ba:as,aa:ss,$:ls,_:ds,ma:ms,Zd:hs,Yd:gs,Xd:bs,Wd:ys,Vd:Ss,Ud:Cs,Td:js,Sd:Fs,Rd:Ts,Qd:Ms,Pd:Ds,Od:Is,Nd:Ns,Md:Os,Ld:Gs,Kd:Vs,Jd:Ws,Id:Ks,Hd:Qs,Gd:Zs,Fd:ri,Ed:ni,Dd:oi,Cd:ii,wa:ci,Bd:ui,Ad:mi,zd:hi,la:xi,yd:_i,xd:wi,wd:Ei,vd:ki,ud:Li,td:Ri,sd:Pi,ha:Di,ia:$i,rd:Ui,ga:Gi,qd:Vi,pd:Wi,ta:Ki,od:Qi,nd:Zi,md:rl,kd:nl,jd:ol,id:il,gd:cl,xa:ul,fd:ml,ed:hl,ka:xl,hd:_l,dd:wl,cd:El,bd:kl,ad:Ll,$c:Rl,_c:Pl,Zc:Al,Yc:Bl,Xc:$l,Wc:Ul,Uc:zl,Vc:ql,oa:Vl,qa:Hl,na:Xl,pa:Yl,ra:Jl,Tc:ec,Rc:tc,Qc:ac,Pc:sc,Sc:lc,Oc:uc,Nc:mc,Mc:hc,Jc:xc,Lc:_c,Kc:wc,Fc:Ec,Hc:kc,Gc:Lc,Ec:Rc,Dc:Pc,Cc:Ac,Bc,Ac:$c,va:Uc,zc,yc:qc,wc:Hc,ja:Kc,vc:Qc,uc:Zc,tc:rd,sc:nd,sa:od,rc:ud,qc:md,pc:hd,oc:gd,nc:bd,mc:yd,lc:Sd,kc:Cd,jc:jd,ic:Fd,hc:Td,gc:Md,fc:Dd,ec:Id,dc:Nd,cc:Od,bc:Gd,ac:Vd,$b:Wd,_b:Kd,Zb:Qd,Yb:Zd,Xb:ru,Wb:nu,Vb:ou,Tb:iu,Sb:cu,Rb:uu,Qb:mu,Pb:hu,Ob:gu,Nb:bu,Mb:yu,Lb:Su,Kb:Cu,Jb:ju,Ib:Fu,Hb:Tu,Gb:Mu,Fb:Du,Eb:Iu,Db:Nu,Cb:Ou,Bb:Gu,Ab:Vu,zb:Wu,yb:Ku,xb:Qu,fa:ef,wb:tf,vb:af,o:of,ub:sf,q:lf,za:df,N:uf,cb:pf,M:hf,W:pt,s:gf,E:xf,g:sn,m:bf,F:_f,v:wf,U:Sf,R:Ef,y:Cf,w:kf,x:jf,Ba:Lf,Sa:pr,K:Ff,I:Rf,H:Tf,L:Pf,J:Mf,z:Df,u:If,A:$f,C:Nf,B:Uf,D:Of,t:qf,G:Hf,Aa:Wf,n:Xf,kb:Qf,lb:Jf,Ia:Zt,j:Zf,P:rm,$a:tm,nb:nm,p:om,Z:hm,Y:xm,c:fm,r:um,Ic:bm,d:mm,k:gm,f:pm,xc:_m,ld:vm},re=xa();i._screenshot=e=>(i._screenshot=re.ae)(e),i._buttonPress=e=>(i._buttonPress=re.be)(e),i._buttonUnpress=e=>(i._buttonUnpress=re.ce)(e),i._setVolume=e=>(i._setVolume=re.de)(e),i._getVolume=()=>(i._getVolume=re.ee)(),i._getMainLoopTimingMode=()=>(i._getMainLoopTimingMode=re.fe)(),i._getMainLoopTimingValue=()=>(i._getMainLoopTimingValue=re.ge)(),i._setMainLoopTiming=(e,r)=>(i._setMainLoopTiming=re.he)(e,r),i._setFastForwardMultiplier=e=>(i._setFastForwardMultiplier=re.ie)(e),i._getFastForwardMultiplier=()=>(i._getFastForwardMultiplier=re.je)(),i._quitGame=()=>(i._quitGame=re.ke)(),i._quitMgba=()=>(i._quitMgba=re.le)(),i._quickReload=()=>(i._quickReload=re.me)(),i._pauseGame=()=>(i._pauseGame=re.ne)(),i._resumeGame=()=>(i._resumeGame=re.oe)(),i._setEventEnable=e=>(i._setEventEnable=re.pe)(e),i._bindKey=(e,r)=>(i._bindKey=re.qe)(e,r),i._saveState=e=>(i._saveState=re.re)(e),i._loadState=e=>(i._loadState=re.se)(e),i._autoLoadCheats=()=>(i._autoLoadCheats=re.te)(),i._loadGame=e=>(i._loadGame=re.ue)(e),i._saveStateSlot=(e,r)=>(i._saveStateSlot=re.ve)(e,r),i._loadStateSlot=(e,r)=>(i._loadStateSlot=re.we)(e,r),i._setupConstants=()=>(i._setupConstants=re.xe)();var Cn=i._main=(e,r)=>(Cn=i._main=re.ye)(e,r),Ie=e=>(Ie=re.Ae)(e),kn=e=>(kn=re.Be)(e),jn=(e,r)=>(jn=re.Ce)(e,r),qe=(e,r)=>(qe=re.De)(e,r),$e=()=>($e=re.Ee)(),Ne=e=>(Ne=re.Fe)(e),Nr=e=>(Nr=re.Ge)(e);i.dynCall_ji=(e,r)=>(i.dynCall_ji=re.He)(e,r),i.dynCall_jiji=(e,r,t,n,a)=>(i.dynCall_jiji=re.Ie)(e,r,t,n,a),i.dynCall_iiiji=(e,r,t,n,a,s)=>(i.dynCall_iiiji=re.Je)(e,r,t,n,a,s),i.dynCall_jii=(e,r,t)=>(i.dynCall_jii=re.Ke)(e,r,t),i._GBAInputInfo=109920,i._binaryName=186992,i._projectName=186996,i._projectVersion=187e3,i._gitCommit=186976,i._gitCommitShort=186980,i._gitBranch=186984,i._gitRevision=186988,i._GBIORegisterNames=49376,i._GBSavestateMagic=64640,i._GBSavestateVersion=64644,i._GBA_LUX_LEVELS=93136,i._GBAVideoObjSizes=138416,i._GBASavestateMagic=138208,i._GBASavestateVersion=138212;function um(e,r,t,n,a){var s=$e();try{return ce(e)(r,t,n,a)}catch(d){if(Ne(s),d!==d+0)throw d;qe(1,0)}}function fm(e,r,t,n){var a=$e();try{return ce(e)(r,t,n)}catch(s){if(Ne(a),s!==s+0)throw s;qe(1,0)}}function mm(e,r,t){var n=$e();try{ce(e)(r,t)}catch(a){if(Ne(n),a!==a+0)throw a;qe(1,0)}}function pm(e,r,t,n,a){var s=$e();try{ce(e)(r,t,n,a)}catch(d){if(Ne(s),d!==d+0)throw d;qe(1,0)}}function hm(e,r){var t=$e();try{return ce(e)(r)}catch(n){if(Ne(t),n!==n+0)throw n;qe(1,0)}}function vm(e,r,t,n,a,s,d,u,p,v){var w=$e();try{ce(e)(r,t,n,a,s,d,u,p,v)}catch(F){if(Ne(w),F!==F+0)throw F;qe(1,0)}}function gm(e,r,t,n){var a=$e();try{ce(e)(r,t,n)}catch(s){if(Ne(a),s!==s+0)throw s;qe(1,0)}}function xm(e,r,t){var n=$e();try{return ce(e)(r,t)}catch(a){if(Ne(n),a!==a+0)throw a;qe(1,0)}}function bm(e,r){var t=$e();try{ce(e)(r)}catch(n){if(Ne(t),n!==n+0)throw n;qe(1,0)}}function _m(e,r,t,n,a,s){var d=$e();try{ce(e)(r,t,n,a,s)}catch(u){if(Ne(d),u!==u+0)throw u;qe(1,0)}}i.cwrap=fe,i.FS=c;var Ur;dr=function e(){Ur||Ln(),Ur||(dr=e)};function ym(){var e=Cn,r=0,t=0;try{var n=e(r,t);return Jt(n,!0),n}catch(a){return ot(a)}}function Ln(){if(Ee>0||(le(),Ee>0))return;function e(){Ur||(Ur=!0,i.calledRun=!0,!Y&&(Me(),Ae(),h(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),Fn&&ym(),Ye()))}i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),e()},1)):e()}if(i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();var Fn=!0;return i.noInitialRun&&(Fn=!1),Ln(),m.ready}})();const yp=l=>{const[m,i]=P.useState(null);return P.useEffect(()=>{(async()=>{if(l){const b=await _p({canvas:l}),_=b.version.projectName+" "+b.version.projectVersion;console.log(_),await b.FSInit();const g=bp(b);i(g)}})()},[l]),m},Rt=P.createContext(null);Rt.displayName="EmulatorContext";const wp=({children:l})=>{const[m,i]=P.useState(null),h=yp(m);return o.jsx(Rt.Provider,{value:{emulator:h,canvas:m,setCanvas:i},children:l})},Tt=P.createContext(null);Tt.displayName="ResizeContext";const Sp=({children:l})=>{const[m,i]=P.useState(!1);return o.jsx(Tt.Provider,{value:{areItemsResizable:m,setAreItemsResizable:i},children:l})},Pt=P.createContext(null);Pt.displayName="RunningContext";const Ep=({children:l})=>{const[m,i]=P.useState(!1);return o.jsx(Pt.Provider,{value:{isRunning:m,setIsRunning:i},children:l})},Cp="componentLayouts",kp=()=>{const[l,m]=Le(Cp,{}),i=P.useCallback(()=>m({}),[m]),h=P.useMemo(()=>!!Object.values(l).some(b=>!!(b!=null&&b.position)||!!(b!=null&&b.size)),[l]);return{layouts:l,setLayouts:m,hasSetLayout:h,clearLayouts:i}},Mt=P.createContext(null);Mt.displayName="LayoutContext";const jp=({children:l})=>{const{layouts:m,setLayouts:i,hasSetLayout:h,clearLayouts:b}=kp(),_=P.useCallback((g,y)=>i(j=>({...j,[g]:{...j==null?void 0:j[g],...y}})),[i]);return P.useEffect(()=>{h||b()},[]),o.jsx(Mt.Provider,{value:{layouts:m,hasSetLayout:h,clearLayouts:b,setLayout:_},children:l})},At=P.createContext(null);At.displayName="ModalContext";const Lp=({children:l})=>{const[m,i]=P.useState(null),[h,b]=P.useState(!1);return o.jsx(At.Provider,{value:{modalContent:m,setModalContent:i,isModalOpen:h,setIsModalOpen:b},children:l})},cr=l=>{const m=l.displayName,i=P.useContext(l);if(!i)throw new Error(`${m??"This context"} must be loaded under the matching ${m?`${m}.Provider`:"Provider"}`);return i},ra=()=>cr(Lt),xr=()=>cr(Mt),ke=()=>cr(At),ge=()=>cr(Rt),Kr=()=>cr(Ft),ta=()=>cr(Tt),rr=()=>cr(Pt),Fp=({isPaused:l})=>{const m=Em(),{emulator:i}=ge(),{isRunning:h}=rr(),[b,_]=P.useState(!1),g=h&&!l;P.useEffect(()=>{g&&(!m&&!b?(i==null||i.pause(),_(!0)):m&&b&&(i==null||i.resume(),_(!1)))},[i,m,g,b])},Rp=l=>{const m=l.getContext("webgl");m==null||m.clearColor(0,0,0,1),m==null||m.clear(m==null?void 0:m.COLOR_BUFFER_BIT)},Tp=l=>{const m=l.getContext("2d"),i=40,h=50;let b=0;if(!m)return;const _=l.width,g=l.height,y=_/2,j=g/2,k=m.getImageData(0,0,_,g),E=setInterval(()=>{b++;for(let L=0;L<g;++L)for(let R=0;R<_;++R){const $=Math.abs(R-y),U=Math.abs(L-j)*.8,D=(y-b-$)/y,H=(j-b-(L&1)*10-U+Math.pow($,1/2))/j;k.data[(R+L*_)*4+3]*=Math.pow(D,1/3)*Math.pow(H,1/2)}m.putImageData(k,0,0),b>i&&(clearInterval(E),l.remove())},h)},Pp=(l,m)=>{if(!l||!m)return;const i=document.createElement("canvas"),h=i.getContext("2d"),b=URL.createObjectURL(m);i.className=l.className,i.height=l.height,i.width=l.width,i.style.backgroundColor=l.style.backgroundColor,i.style.height=`${l.clientHeight}px`,i.style.imageRendering=l.style.imageRendering,i.style.margin=l.style.margin,i.style.objectFit=l.style.objectFit,i.style.width=`${l.clientWidth}px`,i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.right="0";const _=new Image;_.onload=()=>{var g;h==null||h.drawImage(_,0,0),(g=l.parentElement)==null||g.appendChild(i),Rp(l),Tp(i)},_.src=b},Mp=l=>{if(!l)return null;const m="fade-copy.png",i=(l==null?void 0:l.filePaths().screenshotsPath)+"/"+m;if(!l.screenshot(m))return null;const b=l.getFile(i);return l==null||l.deleteFile(i),new Blob([b],{type:"image/png"})},Ap=()=>{const{canvas:l,emulator:m}=ge(),{isRunning:i,setIsRunning:h}=rr();return P.useCallback(()=>{i&&(Pp(l,Mp(m)),m==null||m.quitGame()),h(!1)},[l,m,i,h])},Dt="completedProductTour",Dp={locale:{skip:o.jsx("strong",{"aria-label":"Skip",children:"Skip"})},placement:"auto",placementBeacon:"right-end",spotlightPadding:10},Ve=({completedProductTourStepName:l,steps:m,allowScrolling:i=!0,isNotInModal:h=!1,millisecondDelay:b=500,renderWithoutDelay:_=!1,skipIfIntroSkipped:g=!0,skipRenderCondition:y=!1,zIndex:j=500})=>{const[k,E]=Le(Dt),{isModalOpen:L}=ke(),[R,$]=P.useState(_);if(St(()=>{$(!0)},_?null:b),!R||k!=null&&k[l]||g&&(k==null?void 0:k.hasCompletedProductTourIntro)===gt.SKIPPED||!(k!=null&&k.hasCompletedProductTourIntro)||!h&&!L||y)return null;const U=m.map(D=>({...Dp,...D}));return o.jsx(sp,{continuous:!0,disableScrollParentFix:i,hideCloseButton:!0,showProgress:!0,showSkipButton:!0,steps:U,styles:{options:{zIndex:j}},callback:({status:D})=>{[gt.FINISHED,gt.SKIPPED].includes(D)&&E(H=>({...H,[l]:D}))}})},Bp=I.button`
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
  padding: inherit;
`,kr=Wr.forwardRef(({children:l,...m},i)=>o.jsx(Bp,{ref:i,...m,children:l})),vr=({variation:l})=>{const m=Pe(),i=function(){switch(l){case"topLeft":return"-45deg";case"topRight":return"45deg";case"bottomLeft":return"45deg";case"bottomRight":return"-45deg";default:return"0deg"}}();return o.jsx(Cm,{"data-testid":"gripper-handle",color:m.gbaThemeBlue,style:{transform:`rotate(${i})`}})},Ip=I.ul`
  background-color: ${({theme:l})=>l.panelBlueGray};
  list-style: none;
  padding: 10px;
  margin: 0;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-template-areas:
    '. . . .'
    'volume volume fastForward fastForward';

  ${({$controlled:l,$isLargerThanPhone:m})=>(l||m)&&`
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
  `}
`,$p=I.li`
  display: contents;
`,na=km`
  cursor: pointer;
  background-color: ${({theme:l})=>l.panelControlGray};
  border-radius: 0.25rem;
  min-width: 40px;
  min-height: 40px;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:l})=>l.pureBlack};
  width: ${({$controlled:l})=>l?"auto":"100%"};

  ${({$controlled:l,theme:m})=>!l&&`
    @media ${m.isLargerThanPhone} {
      width: auto;
    }
  `}
`,Np=I(kr).attrs({className:"noDrag"})`
  ${na}

  border: none;
  flex-grow: 1;
  margin: 0;
  padding: 0;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  &:active {
    color: ${({theme:l})=>l.gbaThemeBlue};
  }
`,Up=I.li`
  ${na}
  grid-area: ${({$gridArea:l})=>l};
  max-height: 40px;
`,Op=I(ip)`
  flex-grow: 1;

  > .MuiSlider-markActive {
    opacity: 1;
    background-color: currentColor;
  }
`,Or=({ariaLabel:l,children:m,controlled:i,id:h,onClick:b})=>o.jsx($p,{children:o.jsx(Np,{"aria-label":l,id:h,onClick:b,$controlled:i,children:m})}),zr=({icon:l,...m})=>{const i=Pe();return o.jsx(er,{size:"small",sx:{padding:0,color:i.pureBlack,"&:active":{color:i.gbaThemeBlue}},...m,children:l})},Bn=({controlled:l,gridArea:m,id:i,maxIcon:h,minIcon:b,..._})=>o.jsxs(Up,{id:i,$gridArea:m,$controlled:l,children:[b,o.jsx(Op,{marks:!0,sx:{width:"85px",margin:"0 10px",maxHeight:"40px"},valueLabelDisplay:"auto",..._}),h]}),zp=()=>{var Me,Ae,Ye,jr;const{emulator:l}=ge(),{isRunning:m}=rr(),{areItemsDraggable:i,setAreItemsDraggable:h}=Kr(),{areItemsResizable:b,setAreItemsResizable:_}=ta(),{layouts:g,setLayout:y}=xr(),j=Pe(),k=or(j.isLargerThanPhone),[E,L]=P.useState(!1),[R,$]=P.useState(!1),U=P.useId(),D=Ap(),[H,z]=Le(Qn,1),[Y,te]=Le(ea,1);Fp({isPaused:E});const K=P.useCallback(he=>{var De,Ee;!((De=g==null?void 0:g.controlPanel)!=null&&De.initialBounds)&&he&&y("controlPanel",{initialBounds:(Ee=he.resizableElement.current)==null?void 0:Ee.getBoundingClientRect()})},[y,g]),G=(Me=g==null?void 0:g.screen)==null?void 0:Me.initialBounds;if(!G)return null;const q=k?5:0,V=!!((Ae=g==null?void 0:g.controlPanel)!=null&&Ae.size)||R,O=()=>{m&&(E?l==null||l.resume():l==null||l.pause(),L(he=>!he))},f=he=>{l==null||l.setVolume(he),z(he)},W=he=>{var Ee;const De=Number((Ee=he.target)==null?void 0:Ee.value);f(De)},X=he=>{l==null||l.setFastForwardMultiplier(he),te(he)},oe=he=>{var Ee;const De=Number((Ee=he.target)==null?void 0:Ee.value);l==null||l.setFastForwardMultiplier(De),te(De)},Oe=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the control panel to quickly perform in game actions and reposition controls."}),o.jsx("p",{children:"Click next to take a tour of the controls!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(U)}`},{content:o.jsx("p",{children:"Use the this button to pause and resume your game if it is running."}),placementBeacon:"bottom",target:`#${CSS.escape(`${U}--play`)}`},{content:o.jsx("p",{children:"Use this button to quit your current game."}),placementBeacon:"bottom",target:`#${CSS.escape(`${U}--quit-game`)}`},{content:o.jsx("p",{children:"Use this button to enable dragging and repositioning of the screen, controls, and control panel."}),placement:k?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${U}--drag`)}`},{content:o.jsx("p",{children:"Use this button to resize the screen and control panel."}),placement:k?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${U}--resize`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the emulator volume."}),o.jsx("p",{children:"Your volume setting will be saved between refreshes!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(`${U}--volume-slider`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the fast forward speed."}),o.jsx("p",{children:"Your fast forward setting will be saved between refreshes!"})]}),placement:k?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${U}--fast-forward`)}`}],He={x:Math.floor(G.left),y:Math.floor(G.bottom+q)},ne={width:k?"auto":"100dvw",height:"auto"},se=((Ye=g==null?void 0:g.controlPanel)==null?void 0:Ye.position)??He,ie=((jr=g==null?void 0:g.controlPanel)==null?void 0:jr.size)??ne,le={onFocus:l==null?void 0:l.disableKeyboardInput,onBlur:l==null?void 0:l.enableKeyboardInput,onClick:l==null?void 0:l.enableKeyboardInput};return o.jsxs(o.Fragment,{children:[o.jsx(qn,{"data-testid":"control-panel-wrapper",id:U,disableDragging:!i,enableResizing:b,resizeHandleComponent:{bottomRight:o.jsx(vr,{variation:"bottomRight"}),bottomLeft:o.jsx(vr,{variation:"bottomLeft"})},resizeHandleStyles:{bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"}},ref:K,cancel:".noDrag",position:se,size:ie,onDragStop:(he,De)=>{y("controlPanel",{position:{x:De.x,y:De.y}})},onResizeStart:()=>$(!0),onResizeStop:(he,De,Ee,dr,It)=>{y("controlPanel",{size:{width:Ee.clientWidth,height:Ee.clientHeight},position:{...It}}),$(!1)},default:{...He,...ne},children:o.jsx(Ip,{$controlled:V,$isLargerThanPhone:k,children:o.jsxs(Vn.Provider,{value:{size:"2em"},children:[o.jsx(Or,{id:`${U}--play`,ariaLabel:E||!m?"Play":"Pause",onClick:O,controlled:V,children:E||!m?o.jsx(Hn,{}):o.jsx(jm,{})}),o.jsx(Or,{id:`${U}--quit-game`,ariaLabel:"Quit Game",onClick:()=>{D(),L(!1)},controlled:V,children:o.jsx(Lm,{})}),o.jsx(Or,{id:`${U}--drag`,ariaLabel:i?"Anchor Items":"Drag Items",onClick:()=>{h(he=>!he)},controlled:V,children:i?o.jsx(Rn,{color:j.gbaThemeBlue}):o.jsx(Rn,{})}),o.jsx(Or,{id:`${U}--resize`,ariaLabel:b?"Stop Resizing Items":"Resize Items",onClick:()=>{_(he=>!he)},controlled:V,children:b?o.jsx(Tn,{color:j.gbaThemeBlue}):o.jsx(Tn,{})}),o.jsx(Bn,{id:`${U}--volume-slider`,"aria-label":"Volume Slider",gridArea:"volume",controlled:V,value:H,step:.1,min:0,max:1,minIcon:o.jsx(zr,{"aria-label":"Mute Volume",icon:o.jsx(Fm,{style:{maxHeight:"100%"}}),onClick:()=>f(0)}),maxIcon:o.jsx(zr,{"aria-label":"Max Volume",icon:o.jsx(Rm,{style:{maxHeight:"100%"}}),onClick:()=>f(1)}),valueLabelFormat:`${H*100}`,onChange:W,...le}),o.jsx(Bn,{id:`${U}--fast-forward`,"aria-label":"Fast Forward Slider",gridArea:"fastForward",controlled:V,value:Y,step:1,min:1,max:5,minIcon:o.jsx(zr,{"aria-label":"Regular Speed",icon:o.jsx(Tm,{style:{maxHeight:"100%"}}),onClick:()=>X(1)}),maxIcon:o.jsx(zr,{"aria-label":"Max Fast Forward",icon:o.jsx(Pm,{style:{maxHeight:"100%"}}),onClick:()=>X(5)}),valueLabelFormat:`x${Y}`,onChange:oe,...le})]})})}),o.jsx(Ve,{steps:Oe,completedProductTourStepName:"hasCompletedControlPanelTour",zIndex:k?160:0,renderWithoutDelay:!0,isNotInModal:!0})]})},aa="currentSaveStateSlot",oa="areVirtualControlsEnabled",Gp=I.section`
  position: absolute;
  background-color: red;
  border-radius: 50%;
  width: 12rem;
  height: 12rem;
  background: ${({theme:l})=>l.pureBlack};
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};
  border-width: 2px;
  z-index: 12;

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `};
`,qp=I.div`
  position: absolute;
  height: 4rem;
  width: 4rem;
  border: 2px solid ${({theme:l})=>l.gbaThemeBlue};
  border-radius: 50%;
  background-color: ${({theme:l})=>l.pureBlack};
  transition: ${({$isControlled:l=!1})=>l?"transform 0.3s ease-in-out":"none"};

  &:before {
    position: absolute;
    content: '';
    top: -0.8rem;
    left: -0.8rem;
    right: -0.8rem;
    bottom: -0.8rem;
    border: 0.8rem solid ${({theme:l})=>l.gbaThemeBlue}50;
    border-radius: 50%;
  }
`,Yr=I.div`
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
`,Vp=I(Yr)`
  border-width: 0 15px 25px 15px;
  border-color: transparent transparent ${({theme:l})=>l.pureWhite}
    transparent;
  top: 10px;
`,Hp=I(Yr)`
  border-width: 25px 15px 0 15px;
  border-color: ${({theme:l})=>l.pureWhite} transparent transparent
    transparent;
  bottom: 10px;
`,Wp=I(Yr)`
  border-width: 15px 25px 15px 0;
  border-color: transparent ${({theme:l})=>l.pureWhite} transparent
    transparent;
  left: 10px;
`,Xp=I(Yr)`
  border-width: 15px 0 15px 25px;
  border-color: transparent transparent transparent
    ${({theme:l})=>l.pureWhite};
  right: 10px;
`,Kp=({initialPosition:l})=>{var K;const{emulator:m}=ge(),{areItemsDraggable:i}=Kr(),{layouts:h,setLayout:b}=xr(),[_,g]=P.useState({x:0,y:0}),[y,j]=P.useState(!0),k=P.useRef(null),E=P.useRef(null),[L,R]=P.useState({});P.useEffect(()=>{Object.keys(L).forEach(G=>{L[G]?m==null||m.simulateKeyDown(G):m==null||m.simulateKeyUp(G)})},[L,m]);const $=P.useCallback((G,q)=>R(V=>({...V,[G]:q})),[]),U=P.useCallback(G=>R(q=>Object.fromEntries(Object.entries(q).map(([V,O])=>[V,O===G?void 0:O]))),[]),D=({x:G,y:q})=>{const V=G*Math.cos(Math.PI/4)-q*Math.sin(Math.PI/4),O=G*Math.sin(Math.PI/4)+q*Math.cos(Math.PI/4);return V>=0&&O>=0?"RIGHT":V<0&&O>=0?"DOWN":V<0&&O<0?"LEFT":V>=0&&O<0?"UP":null},H=P.useCallback(G=>{if(!k.current||!E.current)return;const q=k.current.getBoundingClientRect(),V=E.current.getBoundingClientRect(),O=Math.max(-q.width/2+V.width/2,Math.min(G.clientX-q.left-q.width/2,q.width/2-V.width/2)),f=Math.max(-q.height/2+V.height/2,Math.min(G.clientY-q.top-q.height/2,q.height/2-V.height/2));i||g({x:O,y:f});const W=D({x:O,y:f});W&&!L[W]&&(U(G.pointerId),$(W,G.pointerId))},[i,L,$,U]),z=P.useCallback(G=>{if(j(!1),!k.current)return;const q=k.current.getBoundingClientRect(),V=G.clientX-q.left-q.width/2,O=G.clientY-q.top-q.width/2;i||g({x:V,y:O});const f=D({x:V,y:O});f&&$(f,G.pointerId)},[i,$]),Y=G=>{j(!0),g({x:0,y:0}),U(G.pointerId)},te=((K=h==null?void 0:h.oPad)==null?void 0:K.position)??{x:0,y:0};return o.jsx(_t,{nodeRef:k,disabled:!i,position:te,onStop:(G,q)=>b("oPad",{position:{x:q.x,y:q.y}}),children:o.jsxs(Gp,{"aria-label":"O-Pad",ref:k,$initialPosition:l,$areItemsDraggable:i,onPointerDown:z,onPointerMove:H,onPointerUp:Y,onPointerCancel:Y,onPointerOut:Y,onPointerLeave:Y,children:[o.jsx(_t,{disabled:!0,nodeRef:E,position:_,children:o.jsx(qp,{ref:E,$isControlled:y})}),o.jsx(Wp,{}),o.jsx(Xp,{}),o.jsx(Vp,{}),o.jsx(Hp,{})]})})},sa=I(kr)`
  background-color: ${({theme:l})=>l.darkGray};
  border-style: solid;
  border-color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  cursor: pointer;
  box-sizing: content-box;
  border-width: 2px;
`,Yp=I(sa)`
  width: ${({$diameter:l=60})=>l}px;
  height: ${({$diameter:l=60})=>l}px;
  border-radius: 100px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Qp=I(sa)`
  border-radius: 16px;
  width: fit-content;
  min-width: 85px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Jp=({isRectangular:l=!1,width:m=60,children:i,keyId:h,inputName:b,onClick:_,initialPosition:g,initialOffset:y,enabled:j=!1,ariaLabel:k})=>{var te;const{emulator:E}=ge(),{areItemsDraggable:L}=Kr(),{layouts:R,setLayout:$}=xr(),U=P.useRef(null);if(!j)return null;const D=_?{onClick:_}:{},H=h?{onPointerDown:()=>{E==null||E.simulateKeyDown(h)},onPointerUp:()=>{E==null||E.simulateKeyUp(h)},onPointerLeave:()=>{E==null||E.simulateKeyUp(h)},onPointerOut:()=>{E==null||E.simulateKeyUp(h)},onPointerCancel:()=>{E==null||E.simulateKeyUp(h)}}:{},z=h?{onKeyDown:K=>{(K.code=="Space"||K.key==" ")&&(E==null||E.simulateKeyDown(h))},onKeyUp:K=>{(K.code=="Space"||K.key==" ")&&(E==null||E.simulateKeyUp(h))}}:{},Y=((te=R==null?void 0:R[b])==null?void 0:te.position)??{x:0,y:0};return o.jsx(_t,{nodeRef:U,positionOffset:y,position:Y,disabled:!L,onStop:(K,G)=>$(b,{position:{x:G.x,y:G.y}}),children:l?o.jsx(Qp,{ref:U,$initialPosition:g,$areItemsDraggable:L,"aria-label":k,...H,...D,...z,children:i}):o.jsx(Yp,{ref:U,$initialPosition:g,$diameter:m,$areItemsDraggable:L,"aria-label":k,...H,...D,...z,children:i})})},Qr=()=>{const{emulator:l}=ge(),{setIsRunning:m}=rr(),[,i]=Le(Zn),[h]=Le(Jn),[b]=Le(Qn,1),[_]=Le(ea,1);return P.useCallback(y=>{const j=l==null?void 0:l.run(y);return m(!!j),i(y),l==null||l.setVolume(b),j&&(h&&(l==null||l.remapKeyBindings(h)),_>1&&!(l!=null&&l.isFastForwardEnabled())&&(l==null||l.setFastForwardMultiplier(_))),!!j},[b,h,l,_,m,i])},ia=()=>{const l=Qr(),{isRunning:m,setIsRunning:i}=rr(),{emulator:h}=ge(),[b]=Le(Zn);return P.useCallback(()=>{if(m)h==null||h.quickReload();else if(h!=null&&h.getCurrentGameName()){const g=l(h.filePaths().gamePath+"/"+h.getCurrentGameName());i(!!g)}else if(b){const g=l(b);i(!!g)}},[h,m,i,l,b])},la=I.div`
  text-align: center;
`,Er=I.p`
  text-align: center;
  margin: 0;
`,ca=I.h3`
  margin: 0;
`,da=I.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,ua=I.div`
  padding: 1rem;
  overflow-y: auto;
`,fa=I.div`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
  border-top: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,ze=({children:l})=>o.jsx(ua,{children:l}),Ge=({children:l})=>o.jsx(fa,{"data-testid":"modal-footer:wrapper",children:l}),Zp=I.button`
  width: 1em;
  height: 1em;
  padding: 1rem;
  margin: 0 0 0 auto;
  cursor: pointer;
  color: ${({theme:l})=>l.pureBlack};
  border: 0;
  border-radius: 0.25rem;
  opacity: 0.5;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    opacity: 1;
  }

  &:hover {
    opacity: 0.75;
  }

  background: transparent
    url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e")
    center/1em auto no-repeat;
`,Te=({title:l,showExitIndicator:m=!0})=>{const{setIsModalOpen:i}=ke();return o.jsxs(da,{children:[o.jsx(ca,{id:"modalHeader",children:l}),m&&o.jsx(Zp,{"aria-label":"Close",onClick:()=>i(!1)})]})},eh=()=>{const{accessToken:m}=ra(),i=P.useCallback(async y=>{const j="undefined/api/save/upload",k=new FormData;k.append("save",(y==null?void 0:y.saveFile)??"");const E={method:"POST",headers:{Authorization:`Bearer ${m}`},body:k},L=await fetch(j,E);if(!L.ok)throw new Error(`Received unexpected status code: ${L.status}`);return L},[void 0,m]),{data:h,isLoading:b,error:_,execute:g}=Cr({fetchFn:i,clearDataOnLoad:!0});return{data:h,isLoading:b,error:_,execute:g}},rh=I.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,th=I.p`
  margin: 0;
  color: ${({theme:l})=>l.errorRed};
`,sr=({icon:l,text:m,className:i})=>o.jsxs(rh,{"data-testid":"error-with-icon",className:i,children:[l,o.jsx(th,{children:m})]}),nh=({errorColor:l,loadingColor:m,respStatus:i,isLoading:h,hasError:b})=>{const _=()=>o.jsx(Et,{"data-testid":"upload-save-spinner",color:m,cssOverride:{margin:"0 auto"}});let g=null;return h?g=_:b?g=()=>o.jsx(sr,{icon:o.jsx(ar,{style:{color:l}}),text:"Save file upload has failed"}):i===200?g=()=>o.jsx(Er,{children:"Save file upload was successful!"}):g=()=>o.jsx(Er,{children:"Are you sure you want to upload your current save file to the server?"}),o.jsx(ze,{children:o.jsx(g,{})})},ah=()=>{const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:i}=ge(),h=P.useId(),{data:b,isLoading:_,error:g,execute:y}=eh(),j=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to upload your current save file to the server."}),o.jsx("p",{children:"Remember to save in game before uploading!"})]}),placement:"right",target:`#${CSS.escape(h)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Send Save to Server"}),o.jsx(nh,{errorColor:l.errorRed,loadingColor:l.gbaThemeBlue,isLoading:_,hasError:!!g,respStatus:b==null?void 0:b.status}),o.jsxs(Ge,{children:[o.jsx(pe,{id:h,variant:"contained",onClick:()=>{const k=i==null?void 0:i.getCurrentSave(),E=i==null?void 0:i.getCurrentSaveName();if(k&&E){const L=new Blob([k]),R=new File([L],E);y({saveFile:R})}},children:"Upload"}),o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(Ve,{steps:j,completedProductTourStepName:"hasCompletedUploadSaveToServerTour"})]})},In=I.p`
  text-align: center;
  vertical-align: middle;
  line-height: 54px;
  color: ${({theme:l})=>l.pureWhite};
  margin: 0;
  font-size: 1.5em;
`,Gr=I.p`
  color: ${({theme:l})=>l.pureWhite};
  margin: 4px 5px;
`,oh=l=>l.replace("-"," ").replace(/\w\S*/g,m=>m.charAt(0).toUpperCase()+m.substring(1).toLowerCase()),sh=()=>{var V;const l=Pe(),m=or(l.isLargerThanPhone),i=or(l.isMobileWithUrlBar),{emulator:h}=ge(),{isRunning:b}=rr(),{isAuthenticated:_}=ra(),{setModalContent:g,setIsModalOpen:y}=ke(),{layouts:j}=xr(),k=P.useId(),E=ia(),[L]=Le(aa,0),[R]=Le(oa),$=(V=j==null?void 0:j.controlPanel)==null?void 0:V.initialBounds;if(!$)return null;const U=O=>O===void 0&&!m||!!O,D=U(R==null?void 0:R.OpadAndButtons),H=(R==null?void 0:R.NotificationsEnabled)??!0,z=$.bottom,Y=$.left,te={"a-button":{defaultMobile:{top:`calc(${z}px + 12%)`,left:"calc(100dvw - 25px)"},mobileWithUrlBar:{top:`calc(${z}px + 10%)`},largerThanPhone:{top:`calc(${z}px + 35px - 3%)`,left:`calc(${Y}px + 450px)`}},"b-button":{defaultMobile:{top:`calc(${z}px + 15%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${z}px + 13%)`},largerThanPhone:{top:`calc(${z}px + 35px)`,left:`calc(${Y}px + 375px)`}},"start-button":{defaultMobile:{top:"88dvh",left:"25dvw"},mobileWithUrlBar:{top:"92dvh",left:"50dvw"},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`${Y}px`}},"select-button":{defaultMobile:{top:"88dvh",left:"55dvw"},mobileWithUrlBar:{top:"92dvh",left:"75dvw"},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`calc(${Y}px + 103px)`}},"l-button":{defaultMobile:{top:`${z+15}px`,left:"15px"},largerThanPhone:{top:`calc(${z}px + 15px)`,left:`${Y}px`}},"r-button":{defaultMobile:{top:`${z+15}px`,left:"calc(100dvw - 15px)"},largerThanPhone:{top:`calc(${z}px + 15px)`,left:`calc(${Y}px + 190px)`}},"quickreload-button":{defaultMobile:{top:`${z+10}px`,left:"135px"},largerThanPhone:{top:`calc(${z}px + 10px)`,left:`calc(${Y}px + 205px)`}},"uploadsave-button":{defaultMobile:{top:`${z+10}px`,left:"calc(100dvw - 135px)"},largerThanPhone:{top:`calc(${z}px + 10px)`,left:`calc(${Y}px + 300px)`}},"loadstate-button":{defaultMobile:{top:`calc(${z}px + 25%)`,left:"calc(100dvw - 40px)"},mobileWithUrlBar:{top:`calc(${z}px + 23%)`},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`calc(${Y}px + 248px)`}},"savestate-button":{defaultMobile:{top:`calc(${z}px + 27%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${z}px + 25%)`},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`calc(${Y}px + 300px)`}},"o-pad":{defaultMobile:{top:`calc(${z}px + 11%)`,left:"10px"},largerThanPhone:{top:`calc(${z}px + 10px)`,left:`calc(${Y}px + 450px)`}}},K=O=>{var W,X,oe,Oe;let f;return i&&((W=te[O])!=null&&W.mobileWithUrlBar)?f=(X=te[O])==null?void 0:X.mobileWithUrlBar:m&&((oe=te[O])!=null&&oe.largerThanPhone)&&(f=(Oe=te[O])==null?void 0:Oe.largerThanPhone),{...te[O].defaultMobile,...f}},G=(O,f,W)=>{H&&Ze[O?"success":"error"](O?f:W,{id:k})},q=[{keyId:"A",children:o.jsx(In,{children:"A"}),initialPosition:K("a-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"a-button",enabled:D},{keyId:"B",children:o.jsx(In,{children:"B"}),initialPosition:K("b-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"b-button",enabled:D},{keyId:"START",isRectangular:!0,children:o.jsx(Gr,{children:"Start"}),initialPosition:K("start-button"),keyName:"start-button",enabled:D},{keyId:"SELECT",isRectangular:!0,children:o.jsx(Gr,{children:"Select"}),initialPosition:K("select-button"),keyName:"select-button",enabled:D},{keyId:"L",isRectangular:!0,children:o.jsx(Gr,{children:"L"}),initialPosition:K("l-button"),keyName:"l-button",enabled:D},{keyId:"R",isRectangular:!0,children:o.jsx(Gr,{children:"R"}),initialPosition:K("r-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"r-button",enabled:D},{children:o.jsx(Mm,{}),onClick:()=>{E(),!(h!=null&&h.getCurrentGameName())&&H&&Ze.error("Load a game to quick reload",{id:k})},width:40,initialPosition:K("quickreload-button"),keyName:"quickreload-button",enabled:U(R==null?void 0:R.QuickReload)},{children:o.jsx(Am,{}),onClick:()=>{_()&&b?(g(o.jsx(ah,{})),y(!0)):H&&Ze.error("Please log in and load a game",{id:k})},width:40,initialPosition:K("uploadsave-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"uploadsave-button",enabled:U(R==null?void 0:R.SendSaveToServer)},{children:o.jsx(Dm,{}),onClick:()=>{const O=h==null?void 0:h.loadSaveState(L);G(!!O,`Loaded slot: ${L}`,`Failed to load slot: ${L}`)},width:40,initialPosition:K("loadstate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"loadstate-button",enabled:U(R==null?void 0:R.LoadState)},{children:o.jsx(Bm,{}),onClick:()=>{const O=h==null?void 0:h.createSaveState(L);G(!!O,`Saved slot: ${L}`,`Failed to save slot: ${L}`)},width:40,initialPosition:K("savestate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"savestate-button",enabled:U(R==null?void 0:R.SaveState)}];return o.jsxs(Vn.Provider,{value:{color:l.pureWhite,size:"2em"},children:[D&&o.jsx(Kp,{initialPosition:K("o-pad")}),q.map(O=>o.jsx(Jp,{ariaLabel:oh(O.keyName),inputName:O.keyName,...O},O.keyName))]})},ih={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:400},content:{width:"calc(100dvw - 20px)",height:"fit-content",margin:"25px auto auto auto",backgroundColor:"#fff",inset:"10px",maxWidth:"500px",padding:"0",maxHeight:"90dvh",display:"flex",touchAction:"none",flexDirection:"column",userSelect:"text"}},lh=()=>{const{modalContent:l,isModalOpen:m,setIsModalOpen:i}=ke(),{emulator:h}=ge();return o.jsx(Im,{appElement:document.getElementById("root")||void 0,closeTimeoutMS:400,isOpen:m,style:ih,onRequestClose:()=>i(!1),onAfterOpen:h==null?void 0:h.disableKeyboardInput,onAfterClose:h==null?void 0:h.enableKeyboardInput,aria:{labelledby:"modalHeader"},children:l})},ir=250,ch=I.li`
  color: ${({theme:l})=>l.gbaThemeBlue};
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}
`,dh=I(kr)`
  background-color: unset;
  border: none;
  color: inherit;
  cursor: pointer;
  height: 100%;
  padding: 0.5rem 1rem;
  text-align: inherit;
  width: 100%;

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,uh=I.span`
  margin-left: 0.5rem;
`,fh=I.ul`
  padding-left: 2rem;
`,$n=({title:l,icon:m,children:i,$isExpanded:h=!1,$disabled:b=!1})=>{const[_,g]=P.useState(h?"auto":0);return P.useEffect(()=>{g(h?"auto":0)},[h]),o.jsxs(ch,{$disabled:b,children:[o.jsxs(dh,{disabled:b,onClick:()=>{g(_===0?"auto":0)},children:[m,o.jsx(uh,{children:l})]}),o.jsx($m,{duration:350,easing:"ease-in-out",height:_,children:o.jsx(fh,{children:i})})]})},mh=I.li`
  cursor: pointer;
  color: ${({theme:l})=>l.gbaThemeBlue};
  list-style-type: none;
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,ph=I(kr)`
  background-color: unset;
  border: none;
  color: inherit;
  height: 100%;
  margin: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};

  text-align: inherit;
  width: 100%;
  cursor: pointer;
`,hh=I.span`
  margin-left: 0.5rem;
`,vh=I.a`
  display: block;
  text-decoration: none;
  color: unset;
  outline-offset: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};
`,Re=({title:l,icon:m,onClick:i=void 0,$link:h=void 0,$disabled:b=!1,$withPadding:_=!1})=>{const g=o.jsxs(o.Fragment,{children:[m,o.jsx(hh,{children:l})]});return o.jsx(mh,{$disabled:b,children:h?o.jsx(vh,{href:h,$withPadding:_,target:"_blank",children:g}):o.jsx(ph,{disabled:b,onClick:i,$withPadding:_,children:g})})},gh=()=>{const{setIsModalOpen:l}=ke(),[,m]=Le(Dt);return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"About"}),o.jsxs(ze,{children:[o.jsx("p",{children:"Gbajs3 is a full featured Game Boy Advance emulator meant to operate online and offline in the browser."}),o.jsx("p",{children:"We currently support the mGBA core through the use of webassembly."}),o.jsx("p",{children:"Getting Started:"}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Using the ",o.jsx("i",{children:"Pre Game Actions"})," menu, upload a sav file if you have one available"]}),o.jsxs("li",{children:["Then, load a rom of your choice through the ",o.jsx("i",{children:"Upload Rom"})," or"," ",o.jsx("i",{children:"Load Local Rom"})," menu items"]}),o.jsx("li",{children:"Enjoy, your game will boot!"})]})]}),o.jsxs(Ge,{children:[o.jsx(pe,{variant:"contained",onClick:()=>{m({}),l(!1)},children:"Take a tour"}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},ma=Ct`
  100% {
    stroke-dashoffset: 0;
  }
`,xh=Ct`
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
`,bh=Ct`
  100% {
    box-shadow: inset 0 0 0 100vh var(--checkmark-fill-color);
  }
`,_h=I.svg`
  position: absolute;
  width: 24px;
  height: 24px;

  display: block;
  margin-left: auto;
  margin-right: auto;
  border-radius: 50%;
  stroke: ${({theme:l})=>l.pureWhite};
  stroke-width: 5;
  stroke-miterlimit: 10;
  animation: ${bh} 0.2s ease-in-out 0.2s forwards,
    ${xh} 0.12s ease-in-out 0.45s both;
`,yh=I.circle`
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 5;
  stroke-miterlimit: 10;
  stroke: ${({theme:l})=>l.checkMarkGreen};
  fill: none;
  animation: ${ma} 0.3s cubic-bezier(0.65, 0, 0.45, 1) forwards;
`,wh=I.path`
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: ${ma} 0.15s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
`,Sh=I.span`
  ${({$isSuccessCheckVisible:l=!1})=>l&&"visibility: hidden;"}
`,br=({copy:l,msDuration:m=1100,onClick:i,showSuccess:h=!0,...b})=>{const _=P.useId(),[g,y]=P.useState(!1),j=!!h&&g;return St(()=>y(!1),j?m:null),o.jsxs(pe,{onClick:k=>{y(!0),i==null||i(k)},variant:"contained",...b,children:[j&&o.jsxs(_h,{role:"graphics-symbol","aria-labelledby":_,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52",children:[o.jsx("title",{id:_,children:"Circle Check"}),o.jsx(yh,{cx:"26",cy:"26",r:"25",fill:"none"}),o.jsx(wh,{fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),o.jsx(Sh,{$isSuccessCheckVisible:j,children:l})]})},hr=Wr.forwardRef(({id:l,label:m,watcher:i,...h},b)=>o.jsx(Kn,{"data-testid":"managed-checkbox:label",id:l,control:o.jsx(lp,{ref:b,checked:!!i,...h}),label:m,style:{margin:0}})),Eh=I.ul`
  list-style: none;
  display: ${({$shouldHide:l=!1})=>l?"none":"flex"};
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  margin: 0;
  max-width: 100%;
`,Ch=I.li`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding-bottom: 10px;
  width: 100%;
`,kh=I(Nm)`
  min-height: 40px;
  min-width: 40px;
`,jh=I(Wn)`
  width: 25px;
  height: 25px;
`,Nn=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: ${({$fullWidth:l=!1})=>l?"100%":"auto"};

  @media ${({theme:l})=>l.isLargerThanPhone} {
    flex-direction: row;
  }
`,Lh=I.div`
  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: space-between;
`,Fh=I.p`
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
  margin-top: ${({$withMargin:l=!1})=>l?"5px":"0"};
`,Rh=()=>{var q;const l=Pe(),m=or(l.isLargerThanPhone),{setIsModalOpen:i}=ke(),{emulator:h}=ge(),[b,_]=P.useState(!1),g=P.useId(),y={desc:"",code:"",enable:!1},[j,k]=P.useMemo(()=>{const V=h==null?void 0:h.getCurrentCheatsFile(),O=new TextDecoder().decode(V);return[O,h==null?void 0:h.parseCheatsString(O)]},[h]),{register:E,control:L,handleSubmit:R,watch:$,setValue:U,formState:{errors:D,isSubmitSuccessful:H}}=lr({defaultValues:{rawCheats:j,cheats:k!=null&&k.length?k:[y]}}),{fields:z,append:Y,remove:te}=Um({control:L,name:"cheats"}),K=P.useCallback(()=>{const V=h==null?void 0:h.getCurrentCheatsFile(),O=new TextDecoder().decode(V),f=(h==null?void 0:h.parseCheatsString(O))??[];b?U("cheats",f):U("rawCheats",O)},[h,U,b]),G=[{content:o.jsx("p",{children:"Use this form to enter, add, and delete cheats."}),target:`#${CSS.escape(`${g}--cheats-form`)}`},{content:o.jsx("p",{children:"This form field is for the name of the cheat."}),target:`#${CSS.escape(`${g}--name`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Put your cheat code into this field."}),o.jsx("p",{children:"Remember to separate multi-line cheats with the '+' character!"})]}),target:`#${CSS.escape(`${g}--cheat-code`)}`},{content:o.jsx("p",{children:"Use the checkbox to enable/disable a cheat."}),placement:"right",target:`#${CSS.escape(`${g}--enabled`)}`},{content:o.jsx("p",{children:"Use the trash button to remove a cheat entirely."}),placement:"right",target:`#${CSS.escape(`${g}--remove`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new cheat."]}),target:`#${CSS.escape(`${g}--add-cheat`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Submit"})," button to save your cheats, and convert them to libretro format."]}),target:`#${CSS.escape(`${g}--submit-button`)}`},{content:o.jsx("p",{children:"Use this button to toggle between viewing parsed cheats or raw cheats in libretro file format."}),placement:"right",target:`#${CSS.escape(`${g}--toggle-raw-cheats`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Manage Cheats"}),o.jsx(ze,{children:o.jsxs("form",{"aria-label":"Cheats Form",id:`${g}--cheats-form`,onSubmit:R(V=>{const O=b?new File([new Blob([V.rawCheats],{type:"text/plain"})],(h==null?void 0:h.getCurrentCheatsFileName())??"unknown.cheats"):h==null?void 0:h.parsedCheatsToFile(V.cheats);O&&(h==null||h.uploadCheats(O,()=>{h.autoLoadCheats(),K()}))}),children:[o.jsx(gr,{error:!!(D!=null&&D.rawCheats),label:"Raw Libretro Cheats",InputLabelProps:{shrink:!0},multiline:!0,fullWidth:!0,minRows:6,variant:"outlined",InputProps:{sx:{textarea:{whiteSpace:"pre",overflowX:"auto !important"}}},helperText:(q=D==null?void 0:D.rawCheats)==null?void 0:q.message,style:{display:b?"block":"none"},...E("rawCheats")}),o.jsx(Eh,{$shouldHide:b,children:z.map((V,O)=>{var W,X,oe,Oe,He,ne,se,ie,le,Me;const f=Ae=>O===0?Ae:void 0;return o.jsxs(Ch,{children:[o.jsxs(Nn,{$fullWidth:!0,children:[o.jsx(gr,{id:f(`${g}--name`),label:"Name",error:!!((X=(W=D==null?void 0:D.cheats)==null?void 0:W[O])!=null&&X.desc),size:"small",autoComplete:"Name",style:m?{maxWidth:100}:void 0,helperText:(He=(Oe=(oe=D==null?void 0:D.cheats)==null?void 0:oe[O])==null?void 0:Oe.desc)==null?void 0:He.message,...E(`cheats.${O}.desc`,{required:{value:!0,message:"required"}})}),o.jsx(gr,{id:f(`${g}--cheat-code`),label:"Cheat Code",error:!!((se=(ne=D==null?void 0:D.cheats)==null?void 0:ne[O])!=null&&se.code),size:"small",autoComplete:"Code",helperText:(Me=(le=(ie=D==null?void 0:D.cheats)==null?void 0:ie[O])==null?void 0:le.code)==null?void 0:Me.message,...E(`cheats.${O}.code`,{required:{value:!0,message:"required"}})})]}),o.jsxs(Nn,{children:[o.jsx(hr,{id:f(`${g}--enabled`),label:"Enabled",watcher:$(`cheats.${O}.enable`),...E(`cheats.${O}.enable`)}),o.jsx(er,{"aria-label":"Delete",id:f(`${g}--remove`),sx:{padding:0,marginRight:"auto","&:hover":{borderRadius:"10px"},"&:focus":{borderRadius:"10px"},"& .MuiTouchRipple-root .MuiTouchRipple-child":{borderRadius:"10px"}},onClick:()=>te(O),children:o.jsx(kh,{})})]})]},V.id)})}),o.jsxs(Lh,{children:[o.jsx(er,{"aria-label":"Create new cheat",id:`${g}--add-cheat`,sx:{padding:0,display:b?"none":"flex"},onClick:()=>Y(y),children:o.jsx(jh,{})}),o.jsx(Fh,{$withMargin:b,children:"Join multi-line codes with '+'"})]})]})}),o.jsxs(Ge,{children:[o.jsx(br,{copy:"Submit",form:`${g}--cheats-form`,id:`${g}--submit-button`,showSuccess:H,type:"submit"}),o.jsx(pe,{id:`${g}--toggle-raw-cheats`,color:"info",variant:"contained",onClick:()=>_(V=>!V),children:b?"Parsed":"Raw"}),o.jsx(pe,{variant:"outlined",onClick:()=>i(!1),children:"Close"})]}),o.jsx(Ve,{steps:G,completedProductTourStepName:"hasCompletedCheatsTour"})]})},Th=I.form`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,Ph=({id:l,onAfterSubmit:m})=>{const{emulator:i}=ge(),{isRunning:h}=rr(),{handleSubmit:b,setValue:_,control:g,formState:{errors:y}}=lr(),j=i==null?void 0:i.defaultKeyBindings(),[k,E]=Le(Jn),L=$=>{const U=Object.entries($).filter(([,D])=>!!D).map(([,D])=>D);h&&(i==null||i.remapKeyBindings(U)),E(U),m()},R=k??j;return o.jsx(Th,{"aria-label":"Key Bindings Form",id:l,onSubmit:b(L),children:R==null?void 0:R.map($=>o.jsx(Xr,{control:g,name:$.gbaInput,defaultValue:$,rules:{validate:{noSpace:U=>U.key!==" "||"Space is reserved for accessibility requirements",noTab:U=>{var D;return((D=U.key)==null?void 0:D.toLowerCase())!=="tab"||"Tab is reserved for accessibility requirements"}}},render:({field:{value:U}})=>{var D;return o.jsx(gr,{variant:"outlined",label:U.gbaInput,value:U.key,onKeyDown:H=>{H.key.toLowerCase()!=="tab"&&(_(U.gbaInput,{gbaInput:U.gbaInput,key:H.key,location:H.location}),H.preventDefault())},error:!!y[$.gbaInput],helperText:(D=y==null?void 0:y[$.gbaInput])==null?void 0:D.message})}},`gba_input_${$.gbaInput.toLowerCase()}`))})},Mh=Wr.forwardRef(({id:l,label:m,watcher:i,...h},b)=>o.jsx(Kn,{"data-testid":"managed-switch:label",id:l,control:o.jsx(cp,{ref:b,checked:!!i,...h}),label:m,style:{margin:0}})),Ah=I.form`
  display: flex;
  flex-direction: column;
`,Dh=({id:l,onAfterSubmit:m})=>{const[i,h]=Le(oa),b=Pe(),_=or(b.isLargerThanPhone),g=L=>L===void 0&&!_||!!L,{register:y,handleSubmit:j,watch:k}=lr({values:i??{OpadAndButtons:g(void 0),SaveState:g(void 0),LoadState:g(void 0),QuickReload:g(void 0),SendSaveToServer:g(void 0),NotificationsEnabled:!0},resetOptions:{keepDirtyValues:!0}}),E=async L=>{h(R=>({...R,...L})),m()};return o.jsxs(Ah,{"aria-label":"Virtual Controls Form",id:l,onSubmit:j(E),children:[o.jsx(hr,{label:"Virtual D-pad/Buttons",watcher:k("OpadAndButtons"),...y("OpadAndButtons")}),o.jsx(hr,{label:"Save State",watcher:k("SaveState"),...y("SaveState")}),o.jsx(hr,{label:"Load State",watcher:k("LoadState"),...y("LoadState")}),o.jsx(hr,{label:"Quick Reload",watcher:k("QuickReload"),...y("QuickReload")}),o.jsx(hr,{label:"Send save to server",watcher:k("SendSaveToServer"),...y("SendSaveToServer")}),o.jsx(Mh,{label:"Enable Notifications",watcher:k("NotificationsEnabled"),...y("NotificationsEnabled")})]})},Bh=I(dp)`
  border-bottom: 1px solid;
  border-color: rgba(0, 0, 0, 0.12);
`,Ih=I.div`
  padding: 24px;
`,wt=l=>({id:`control-tab-${l}`,"aria-controls":`tabpanel-${l}`}),Un=({children:l,index:m,value:i})=>o.jsx("div",{role:"tabpanel",hidden:i!==m,id:`tabpanel-${m}`,"aria-labelledby":`tab-${m}`,children:i===m&&o.jsx(Ih,{children:l})}),$h=({setFormId:l,virtualControlsFormId:m,keyBindingsFormId:i,resetPositionsButtonId:h,setIsSuccessfulSubmit:b})=>{const{clearLayouts:_}=xr(),[g,y]=P.useState(0),j=(E,L)=>{y(L),l(L===0?m:i),b(!1)},k=()=>b(!0);return o.jsxs(o.Fragment,{children:[o.jsxs(Bh,{value:g,onChange:j,"aria-label":"Control tabs",children:[o.jsx(Dn,{label:"Virtual Controls",...wt(0)}),o.jsx(Dn,{label:"Key Bindings",...wt(1)})]}),o.jsxs(Un,{value:g,index:0,children:[o.jsx(Dh,{id:m,onAfterSubmit:k}),o.jsx(pe,{id:h,sx:{marginTop:"10px"},onClick:_,children:"Reset All Positions"})]}),o.jsx(Un,{value:g,index:1,children:o.jsx(Ph,{id:i,onAfterSubmit:k})})]})},Nh=()=>{const{setIsModalOpen:l}=ke(),m=P.useId(),[i,h]=P.useState(`${m}--virtual-controls-form`),[b,_]=P.useState(!1),g=[{content:o.jsx("p",{children:"Select which virtual controls you wish to enable in this form tab."}),target:`#${CSS.escape(`${m}--virtual-controls-form`)}`},{content:o.jsx("p",{children:"Use this button to reset the positions of the screen, control panel, and all virtual controls."}),target:`#${CSS.escape(`${m}--reset-positions-button`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the tab panel to change which form you are seeing."}),o.jsxs("p",{children:["Select the ",o.jsx("i",{children:"KEY BINDINGS"})," tab above, then click next!"]})]}),placement:"right",target:`#${CSS.escape(wt(1).id)}`,disableBeacon:!0,disableOverlayClose:!0,hideCloseButton:!1,spotlightClicks:!0},{content:o.jsx("p",{children:"Remap keybindings by selecting a form field and typing your desired input."}),placement:"top-end",target:`#${CSS.escape(`${m}--key-bindings-form`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Save Changes"})," button to persist changes from the current form tab."]}),target:`#${CSS.escape(`${m}--save-changes-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Controls"}),o.jsx(ze,{children:o.jsx($h,{setFormId:h,virtualControlsFormId:`${m}--virtual-controls-form`,keyBindingsFormId:`${m}--key-bindings-form`,resetPositionsButtonId:`${m}--reset-positions-button`,setIsSuccessfulSubmit:_})}),o.jsxs(Ge,{children:[o.jsx(br,{copy:"Save Changes",form:i,id:`${m}--save-changes-button`,type:"submit",showSuccess:b}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:g,completedProductTourStepName:"hasCompletedControlsTour"})]})},Uh=()=>{const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:i}=ge(),h=P.useId(),[b,_]=P.useState(!1),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to download your current save file."}),o.jsx("p",{children:"Remember to save in game before downloading!"})]}),placement:"right",target:`#${CSS.escape(h)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Download Save"}),o.jsx(ze,{children:b?o.jsx(sr,{icon:o.jsx(ar,{style:{color:l.errorRed}}),text:"Load a rom to download its save file"}):o.jsx(Er,{children:"Remember to save in game before downloading your save file!"})}),o.jsxs(Ge,{children:[o.jsx(pe,{id:h,variant:"contained",onClick:()=>{const y=i==null?void 0:i.getCurrentSave(),j=i==null?void 0:i.getCurrentSaveName();if(y&&j){const k=new Blob([y],{type:"data:application/octet-stream"}),E=document.createElement("a");E.download=j,E.href=URL.createObjectURL(k),E.click(),E.remove()}else _(!0)},children:"Download"}),o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(Ve,{steps:g,completedProductTourStepName:"hasCompletedDownloadSaveTour"})]})},Oh=l=>o.jsx(jt,{"data-testid":"action-box:minus",className:"minus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})}),zh=l=>o.jsx(jt,{"data-testid":"action-box:plus",className:"plus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})}),Gh=l=>o.jsx(jt,{"data-testid":"action-box:close",className:"close",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})}),qh=up(l=>o.jsx(fp,{...l}))(({theme:l})=>({marginTop:5,[`& .${xt.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${xt.groupTransition}`]:{marginLeft:15,paddingLeft:10,borderLeft:`1px dashed ${mp(l.palette.text.primary,.4)}`},[`& .${xt.content}`]:{width:"auto",alignItems:"baseline"}})),Vh=I.div`
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: space-between;

  > p {
    margin: 0;
    word-wrap: break-word;
    max-width: 100%;
  }
`,Hh=I.div`
  display: flex;
  gap: 15px;
`,Wh=({id:l,allFiles:m,deleteFile:i,downloadFile:h})=>{if(!m)return null;const b=_=>{const g=_.path.split("/").pop(),y=o.jsxs(Vh,{children:[o.jsx("p",{children:g}),o.jsxs(Hh,{children:[o.jsx(er,{"aria-label":`Download ${g}`,sx:{padding:0,margin:0},onClick:()=>h(_.path),children:o.jsx(Xn,{})}),o.jsx(er,{"aria-label":`Delete ${g}`,sx:{padding:0},onClick:()=>i(_.path),children:o.jsx(kt,{})})]})]});return o.jsx(qh,{itemId:_.path,label:_.isDir?g:y,children:_.isDir&&_.children?_.children.map(j=>b(j)):null},_.path)};return o.jsx(pp,{id:l,"aria-label":"File System",defaultExpandedItems:[m.path],slots:{collapseIcon:Oh,endIcon:Gh,expandIcon:zh},sx:{minHeight:264},children:b(m)})},Xh=()=>{const{setIsModalOpen:l}=ke(),{emulator:m}=ge(),[i,h]=P.useState(),b=P.useId(),_=P.useCallback(k=>{m==null||m.deleteFile(k),h(m==null?void 0:m.listAllFiles())},[m]),g=k=>{const E=k.split("/").pop(),L=m==null?void 0:m.getFile(k);if(L&&E){const R=new Blob([L],{type:"data:application/octet-stream"}),$=document.createElement("a");$.download=E,$.href=URL.createObjectURL(R),$.click(),$.remove()}},y=i??(m==null?void 0:m.listAllFiles()),j=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to view your current file tree, download files, and delete files from the tree."}),o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," and ",o.jsx("i",{children:"minus"})," icons to open and close file tree branches!"]})]}),target:`#${CSS.escape(`${b}--emulator-fs`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"SAVE FILE SYSTEM"})," button to persist all of your files to your device!"]}),target:`#${CSS.escape(`${b}--save-file-system-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"File System"}),o.jsx(ze,{children:o.jsx(Wh,{id:`${b}--emulator-fs`,allFiles:y,deleteFile:_,downloadFile:g})}),o.jsxs(Ge,{children:[o.jsx(br,{copy:"Save File System",id:`${b}--save-file-system-button`,onClick:m==null?void 0:m.fsSync}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:j,completedProductTourStepName:"hasCompletedFileSystemTour"})]})},qr=I.button`
  padding: 0.5rem 1rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  text-decoration: none;
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Vr=I.li`
  cursor: pointer;
`,Kh=I.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Vr}:first-child > ${qr} {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Vr}:last-child > ${qr} {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Vr}:not(:first-child) > ${qr} {
    border-top-width: 0;
  }
`,Yh=()=>{var y,j,k;const{setIsModalOpen:l}=ke(),{emulator:m}=ge(),i=P.useId(),h=Qr(),b=[".",".."],_=(j=(y=m==null?void 0:m.listRoms)==null?void 0:y.call(m))==null?void 0:j.filter(E=>!b.includes(E)),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to load local roms that have been saved to your device."}),o.jsx("p",{children:"Tap the name of your rom file and your game will boot!"}),o.jsxs("p",{children:["To persist roms and other files, use the ",o.jsx("i",{children:"File System"})," menu item."]})]}),target:`#${CSS.escape(i)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Load Local Rom"}),o.jsx(ze,{children:o.jsxs(Kh,{id:i,children:[(k=_==null?void 0:_.map)==null?void 0:k.call(_,(E,L)=>o.jsx(Vr,{children:o.jsx(qr,{onClick:()=>{h((m==null?void 0:m.filePaths().gamePath)+"/"+E),l(!1)},children:E})},`${E}_${L}`)),!(_!=null&&_.length)&&o.jsx("li",{children:o.jsx(Er,{children:"No local roms, load a game and save your file system"})})]})}),o.jsx(Ge,{children:o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})}),o.jsx(Ve,{steps:g,completedProductTourStepName:"hasCompletedLoadLocalRomTour"})]})},Qh=I.button`
  padding: 0.5rem 0.5rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: none;
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Hr=I.li`
  cursor: pointer;
  display: grid;
  grid-template-columns: auto 32px;
  gap: 10px;

  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
`,Jh=I.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Hr}:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Hr}:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Hr}:not(:first-child) {
    border-top-width: 0;
  }
`,Zh=I(Wn)`
  width: 25px;
  height: 25px;
`,ev=I(kt)`
  height: 100%;
  width: 20px;
`,rv=I.form`
  display: flex;
  justify-content: space-between;
  gap: 16px;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  margin-bottom: 16px;
  padding-bottom: 16px;
`,tv=()=>{var te,K,G;const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:i}=ge(),[h,b]=P.useState(),[_,g]=P.useState(null),[y,j]=Le(aa,0),k=P.useId(),{register:E,handleSubmit:L,setValue:R,formState:{errors:$,isSubmitSuccessful:U}}=lr({defaultValues:{saveStateSlot:y}}),D=P.useCallback(()=>{var V;const q=(V=i==null?void 0:i.listSaveStates())==null?void 0:V.filter(O=>O!=="."&&O!=="..");b(q)},[i]);P.useEffect(()=>{R("saveStateSlot",y)},[y,R]);const H=async q=>{j(q.saveStateSlot)},z=h??((te=i==null?void 0:i.listSaveStates())==null?void 0:te.filter(q=>q!=="."&&q!=="..")),Y=[{content:o.jsx("p",{children:"Use this input and button to manually update the current save state slot in use."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${k}--save-state-slot-form`)}`},{content:o.jsx("p",{children:"Tap a row to load a save state, or use the trash can icon to delete a save state."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${k}--save-state-list`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new save state. This will automatically increase the current save state number!"]}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${k}--add-state-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Manage Save States"}),o.jsxs(ze,{children:[o.jsxs(rv,{id:`${k}--save-state-slot-form`,onSubmit:L(H),children:[o.jsx(gr,{label:"Current Save State Slot",type:"number",InputLabelProps:{shrink:!0},size:"small",error:!!($!=null&&$.saveStateSlot),helperText:(K=$==null?void 0:$.saveStateSlot)==null?void 0:K.message,...E("saveStateSlot",{required:{value:!0,message:"Slot is required"},min:{value:0,message:"Slot must be >= 0"},valueAsNumber:!0})}),o.jsx(br,{copy:"Update Slot",showSuccess:U,size:"small",type:"submit",sx:{maxHeight:"40px"}})]}),o.jsxs(Jh,{id:`${k}--save-state-list`,children:[(G=z==null?void 0:z.map)==null?void 0:G.call(z,(q,V)=>o.jsxs(Hr,{children:[o.jsx(Qh,{onClick:()=>{const O=q.split(".").pop(),f=O==null?void 0:O.replace("ss","");if(f){const W=parseInt(f);(i==null?void 0:i.loadSaveState(W))?(j(W),g(null)):g("Failed to load save state")}},children:q}),o.jsx(er,{"aria-label":`Delete ${q}`,sx:{padding:0},onClick:()=>{const O=q.split(".").pop(),f=O==null?void 0:O.replace("ss","");if(f){const W=parseInt(f);i==null||i.deleteSaveState(W),D()}},children:o.jsx(ev,{})})]},`${q}_${V}`)),!(z!=null&&z.length)&&o.jsx("li",{children:o.jsx(Er,{children:"No save states"})})]}),o.jsx(er,{id:`${k}--add-state-button`,"aria-label":"Create new save state",sx:{padding:0},onClick:()=>{(i==null?void 0:i.createSaveState(y+1))?(D(),j(V=>V+1),g(null)):g("Failed to create save state")},children:o.jsx(Zh,{})}),_&&o.jsx(sr,{icon:o.jsx(ar,{style:{color:l.errorRed}}),text:_})]}),o.jsx(Ge,{children:o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})}),o.jsx(Ve,{steps:Y,completedProductTourStepName:"hasCompletedSaveStatesTour"})]})},nv=I.div`
  cursor: pointer;
  border-color: ${({theme:l})=>l.blackRussian};
  background-color: ${({$isDragActive:l=!1,theme:m})=>l?m.arcticAirBlue:m.aliceBlue2};
  border-width: 1px;
  border-style: dashed;
  padding: 0.5rem;
  text-align: center;
`,av=I(yt)`
  height: 60px;
  width: auto;
`,ov=I.div`
  padding-top: 3px;
`,sv=I.ul`
  display: flex;
  flex-direction: column;
  gap: 10px;
  list-style: none;
  margin: 0;
  max-width: 100%;
  padding: 10px 5px 5px 5px;

  > p {
    margin: 0;
  }
`,iv=I.li`
  align-items: center;
  display: flex;
  gap: 10px;
  justify-content: space-between;

  > p {
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
`,lv=I.div`
  display: flex;
  gap: 15px;
`,cv=({fileNames:l,onDeleteFile:m})=>o.jsxs(sv,{children:[o.jsxs("p",{children:["File",l.length>1&&"s"," to upload:"]}),l.map((i,h)=>o.jsxs(iv,{children:[o.jsx("p",{children:i}),o.jsx(lv,{children:o.jsx(er,{"aria-label":`Delete ${i}`,sx:{padding:0},onClick:()=>m(i),children:o.jsx(kt,{})})})]},`${i}_${h}`))]}),dv=(l,m)=>{const i=`.${l.name.split(".").pop()}`;return m.some(h=>typeof h=="string"?h===i:!!h.regex.exec(i))},bt=l=>typeof l=="string"?l:l.displayText,uv=(l,m)=>{if(!l.length)return;const i=m?"At least one":"One";let h=`${i} `+l.slice(0,-1).map(bt).join(", ")+`, or ${bt(l.slice(-1)[0])} file is required`;return l.length==1&&(h=`${i} ${bt(l[0])} file is required`),b=>!(b instanceof File)||b&&dv(b,l)?null:{message:h,code:zm.FileInvalidType}},Bt=({ariaLabel:l,children:m,error:i,hideAcceptedFiles:h,hideErrors:b,id:_,multiple:g=!1,name:y,onDrop:j,validFileExtensions:k})=>{const E=Pe(),[L,R]=P.useState([]),{getRootProps:$,getInputProps:U,isDragActive:D,fileRejections:H}=Om({multiple:g,onDrop:K=>{R(K),j(K)},validator:uv(k,g)}),z=i?[i]:H.length&&L.length?["Some files were rejected"]:[...new Set(H.flatMap(K=>K.errors).map(K=>K.message))],Y=K=>{const G=L.filter(q=>q.name!==K);R(G),j(G)},te=L.map(K=>K.name);return o.jsxs(o.Fragment,{children:[o.jsxs(nv,{...$({id:_,$isDragActive:D,"aria-label":l}),children:[o.jsx("input",{"data-testid":"hidden-file-input",...U({name:y})}),o.jsx(av,{}),m]}),!!te.length&&!h&&o.jsx(cv,{fileNames:te,onDeleteFile:Y}),!!z.length&&!b&&o.jsx(ov,{children:z.map(K=>o.jsx(sr,{icon:o.jsx(ar,{style:{color:E.errorRed}}),text:K},K))})]})},fv=[".cheats"],mv=()=>{const{setIsModalOpen:l}=ke(),{emulator:m}=ge(),{reset:i,handleSubmit:h,setValue:b,formState:{isSubmitSuccessful:_},control:g}=lr(),y=P.useId(),j=P.useCallback(L=>{i(),b("cheatFiles",L,{shouldValidate:!0})},[i,b]),k=({cheatFiles:L})=>{L.forEach(R=>m==null?void 0:m.uploadCheats(R)),i()},E=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your cheat files, or click to select files."}),o.jsx("p",{children:"Cheat files should be in libretro format and have the extension '.cheats'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${y}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Upload Cheats"}),o.jsx(ze,{children:o.jsxs("form",{id:y,"aria-label":"Upload Cheats Form",onSubmit:h(k),children:[o.jsx(Xr,{control:g,name:"cheatFiles",rules:{validate:L=>(L==null?void 0:L.length)>0||"At least one .cheats file is required"},render:({field:{name:L,value:R},fieldState:{error:$}})=>o.jsx(Bt,{ariaLabel:"Upload Cheats",id:`${y}--drag-and-drop`,onDrop:j,name:L,validFileExtensions:fv,error:$==null?void 0:$.message,hideAcceptedFiles:!(R!=null&&R.length),hideErrors:_,multiple:!0,children:o.jsxs("p",{children:["Drag and drop cheat files here,",o.jsx("br",{}),"or click to upload files"]})})}),_&&o.jsx(la,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Ge,{children:[o.jsx(br,{copy:"Upload",form:y,showSuccess:_,type:"submit"}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:E,completedProductTourStepName:"hasCompletedUploadCheatsTour"})]})},pv=()=>{const l=P.useCallback(async _=>{var R,$,U;const g={method:"GET"};if(!_)return;const y=await fetch(_.url,g),j=(U=($=(R=y.headers.get("Content-Disposition"))==null?void 0:R.split(";").pop())==null?void 0:$.split("=").pop())==null?void 0:U.replace(/"/g,""),k=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.gba");if(!y.ok)throw new Error(`Received unexpected status code: ${y.status}`);const E=await y.blob();return new File([E],j??k)},[]),{data:m,isLoading:i,error:h,execute:b}=Cr({fetchFn:l,clearDataOnLoad:!0});return{data:m,isLoading:i,error:h,execute:b}},hv=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,vv=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,On=[".gba",".gbc",".gb",".zip",".7z"],gv=({isLoading:l,currentRomURL:m,children:i,indicator:h})=>l?o.jsxs(hv,{children:[o.jsxs(vv,{children:["Loading rom from url:",o.jsx("br",{}),m]}),h]}):i,xv=()=>{var V,O;const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:i}=ge(),{register:h,handleSubmit:b,setValue:_,reset:g,formState:{errors:y},watch:j,control:k}=lr(),[E,L]=P.useState(null),{data:R,isLoading:$,error:U,execute:D}=pv(),H=P.useId(),z=Qr(),Y=!$&&!!R&&!!E;P.useEffect(()=>{if(Y){const f=()=>{z((i==null?void 0:i.filePaths().gamePath)+"/"+R.name)&&m(!1)};i==null||i.uploadRom(R,f),L(null)}},[Y,R,i,m,z]);const te=P.useCallback(f=>{g(),_("romFile",f[0],{shouldValidate:!0})},[g,_]),K=async({romFile:f,romURL:W})=>{if(W){L(W),await D({url:new URL(W)});return}const X=()=>{z((i==null?void 0:i.filePaths().gamePath)+"/"+f.name)&&m(!1)};i==null||i.uploadRom(f,X)},G=!!j("romFile"),q=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your rom or zipped rom file, or click to select a file."}),o.jsxs("p",{children:["Rom files should have an extension of:"," ",On.map(f=>`'${f}'`).join(", "),"."]}),o.jsx("p",{children:"You may drop or select one rom at a time, once uploaded your game will boot!"})]}),target:`#${CSS.escape(`${H}--drag-and-drop`)}`},{content:o.jsx("p",{children:"Alternatively, you may load a rom file from an external URL."}),target:`#${CSS.escape(`${H}--rom-url`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Upload Rom"}),o.jsx(ze,{children:o.jsx(gv,{isLoading:$,currentRomURL:E,indicator:o.jsx(Et,{color:l.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),children:o.jsxs("form",{id:H,"aria-label":"Upload Rom Form",onSubmit:b(K),children:[o.jsx(Xr,{control:k,name:"romFile",rules:{validate:(f,W)=>!!W.romURL||!!f||"A rom file or URL is required"},render:({field:{name:f},fieldState:{error:W}})=>o.jsx(Bt,{ariaLabel:"Upload Rom",id:`${H}--drag-and-drop`,onDrop:te,name:f,validFileExtensions:On,hideErrors:!!W,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})}),!G&&o.jsxs(o.Fragment,{children:[o.jsx(Yn,{sx:{padding:"10px 0"},children:"or"}),o.jsx(gr,{id:`${H}--rom-url`,error:!!(y!=null&&y.romURL),label:"Upload from a URL",size:"small",autoComplete:"romURL",variant:"filled",helperText:(V=y==null?void 0:y.romURL)==null?void 0:V.message,"aria-label":"Upload Rom From URL",fullWidth:!0,...h("romURL",{validate:(f,W)=>{if(!f)return!0;if(W.romFile)return"Cannot specify both a file and a URL";try{return new URL(f),!0}catch{return"Invalid URL"}}})}),!!U&&o.jsx(sr,{icon:o.jsx(ar,{style:{color:l.errorRed}}),text:"Loading rom from URL has failed"})]}),((O=y.romFile)==null?void 0:O.message)&&o.jsx(sr,{icon:o.jsx(ar,{style:{color:l.errorRed}}),text:y.romFile.message})]})})}),o.jsxs(Ge,{children:[o.jsx(pe,{form:H,type:"submit",variant:"contained",children:"Upload"}),o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(Ve,{steps:q,completedProductTourStepName:"hasCompletedUploadRomTour"})]})},bv=[".sav",{regex:/\.ss[0-9]+/,displayText:".ss"}],_v=()=>{const{setIsModalOpen:l}=ke(),{emulator:m}=ge(),{reset:i,handleSubmit:h,setValue:b,formState:{isSubmitSuccessful:_},control:g}=lr(),y=P.useId(),j=P.useCallback(L=>{i(),b("saveFiles",L,{shouldValidate:!0})},[i,b]),k=({saveFiles:L})=>{L.forEach(R=>m==null?void 0:m.uploadSaveOrSaveState(R)),i()},E=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your save or save state files, or click to select files."}),o.jsx("p",{children:"The name of your files must match the name of your rom."}),o.jsx("p",{children:"Save and save state files should have an extension '.sav' or start with '.ss'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${y}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Upload Saves"}),o.jsx(ze,{children:o.jsxs("form",{id:y,"aria-label":"Upload Saves Form",onSubmit:h(k),children:[o.jsx(Xr,{control:g,name:"saveFiles",rules:{validate:L=>(L==null?void 0:L.length)>0||"At least one .sav, or .ss file is required"},render:({field:{name:L,value:R},fieldState:{error:$}})=>o.jsx(Bt,{ariaLabel:"Upload Saves",id:`${y}--drag-and-drop`,onDrop:j,name:L,validFileExtensions:bv,error:$==null?void 0:$.message,hideAcceptedFiles:!(R!=null&&R.length),hideErrors:_,multiple:!0,children:o.jsx("p",{children:"Drag and drop save or save state files here, or click to upload files"})})}),_&&o.jsx(la,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Ge,{children:[o.jsx(br,{copy:"Upload",form:y,showSuccess:_,type:"submit"}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:E,completedProductTourStepName:"hasCompletedUploadSavesTour"})]})},yv=()=>{const[l,m]=P.useState(0),i=P.useCallback(y=>y?new Promise((j,k)=>{const E=new XMLHttpRequest;E.open("GET",y.url,!0),E.responseType="arraybuffer",E.overrideMimeType("text/plain; charset=x-user-defined"),E.onprogress=function(L){if(L.lengthComputable){const R=L.loaded/L.total*100;m(R)}},E.onload=()=>{var L,R;if(E.status>=200&&E.status<300){const $=E.getResponseHeader("Content-Disposition"),U=(R=(L=$==null?void 0:$.split(";").pop())==null?void 0:L.split("=").pop())==null?void 0:R.replace(/"/g,""),D=decodeURIComponent(y.url.pathname.split("/").pop()??"unknown_external.gba"),H=new File([E.response],y.fullName??U??D);if(y.patchFile!=null&&y.patchFile!=""){console.log("applying bps patch to file: "+y.patchFile);const z=new XMLHttpRequest;z.open("GET",y.patchFile,!0),z.responseType="arraybuffer",z.overrideMimeType("text/plain; charset=x-user-defined"),z.onload=()=>{const Y=new Uint8Array(z.response),{instructions:te,checksum:K}=Gm(Y);console.log(K);const G=new Uint8Array(E.response),q=qm(te,G),V=new File([q],y.fullName??U??D);j(V)},z.onerror=()=>{console.error("Request for patch file failed"),k(new Error("Network error occurred: Patch File"))},z.send(null)}else console.log("resolved file"),j(H)}else console.error("Request failed2"),k(new Error(`Received unexpected status code: ${E.status}`))},E.onerror=()=>{console.error("Request failed"),k(new Error("Network error occurred"))},E.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:h,isLoading:b,error:_,execute:g}=Cr({fetchFn:i,clearDataOnLoad:!0});return{data:h,isLoading:b,error:_,execute:g,progress:l}},wv=()=>{const[l,m]=P.useState(0),i=P.useCallback(y=>y?new Promise((j,k)=>{console.log(y.fullName);const E=new XMLHttpRequest;E.open("GET",y.url,!0),E.responseType="arraybuffer",E.overrideMimeType("text/plain; charset=x-user-defined"),E.onprogress=function(L){if(L.lengthComputable){const R=L.loaded/L.total*100;m(R)}},E.onload=()=>{var L,R;if(E.status>=200&&E.status<300){const $=E.getResponseHeader("Content-Disposition"),U=(R=(L=$==null?void 0:$.split(";").pop())==null?void 0:L.split("=").pop())==null?void 0:R.replace(/"/g,""),D=decodeURIComponent(y.url.pathname.split("/").pop()??"unknown_external.sav"),H=new File([E.response],y.fullName??U??D);j(H)}else k(new Error(`Received unexpected status code: ${E.status}`))},E.onerror=()=>{console.error("Request failed"),k(new Error("Network error occurred"))},E.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:h,isLoading:b,error:_,execute:g}=Cr({fetchFn:i,clearDataOnLoad:!0});return{data:h,isLoading:b,error:_,execute:g,progress:l}};function pa(l){return console.log(l),l[0]=="N"?0:l[0]=="E"?1:l[0]=="S"?3:l[0]=="F"&&l[5]=="1"?5:l[0]=="F"?4:l[0]=="R"&&l[11]=="1"?55:(console.log("Invalid Save Type"),-1)}const Sv=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,Ev=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,Cv=I.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,kv=({isLoading:l,children:m,indicator:i,progress:h})=>l?o.jsxs(Sv,{children:[o.jsx(Ev,{children:"Dumping Rom from cartridge..."}),i,o.jsx(Cv,{progress:h,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(h),"%"]})})]}):m,zn=({additionalData:l,setAdditionalData:m,gameData:i,setGameData:h,esp32IP:b,setEsp32IP:_})=>{const g=Pe(),{setIsModalOpen:y}=ke(),{emulator:j}=ge(),{data:k,isLoading:E,error:L,execute:R,progress:$}=yv(),{data:U,execute:D}=wv(),H=Qr(),[z,Y]=P.useState(!1),te=!E&&!!k,[K,G]=P.useState(null),q=ne=>{const{name:se,value:ie}=ne.target;m(le=>({...le,[se]:ie}))};P.useEffect(()=>{if(te){const ne=()=>{H((j==null?void 0:j.filePaths().gamePath)+"/"+k.name)&&y(!1)};j==null||j.uploadRom(k,ne)}},[te,k,j,y,H]),P.useEffect(()=>{U!=null&&(j==null||j.uploadSaveOrSaveState(U))},[U,j]),P.useEffect(()=>{z||Oe()},[]);function V(ne){return new Promise(se=>setTimeout(se,ne))}const O=(ne,se)=>{let ie=Number(se.cartSize/1024/1024),le="";return ie==1?le=ne.checksum_1MB:ie==2?le=ne.checksum_2MB:ie==4?le=ne.checksum_4MB:ie==8?le=ne.checksum_8MB:ie==16&&(le=ne.checksum_16MB),le.toUpperCase()},f=()=>l.fullName+"_"+i.cartID+"_"+K,W=async()=>{let ne=f()+".sav";await He(l.saveType,ne),await V(300),console.log("save loaded"),await oe()},X=async ne=>{var ie;let se=(ie=j==null?void 0:j.listRoms)==null?void 0:ie.call(j);return console.log(se),se&&se.includes(ne)?(console.log("rom exists locally"),H((j==null?void 0:j.filePaths().gamePath)+"/"+ne),y(!1),!0):!1},oe=async()=>{let ne=f()+".gba";if(!await X(ne)){let ie=l.cartSize,le=`${b}/get_current_game.gba?cartSize=${ie}&saveType=4`;await R({url:new URL(le),fullName:ne,patchFile:l.patchFile})}},Oe=async()=>{try{Y(!0);const se=await(await fetch(`${b}/get_game_info`,{method:"GET",headers:{Origin:window.location.origin,"Access-Control-Request-Private-Network":"true"}})).json();h(se);let le=await(await fetch(`/information_rom/${se.cartID}.json`)).json();console.log(32332);let Me=O(se,le);if(G(Me),Me!=le.checksum1000){console.log("Checksums do not match. Trying to get a different one...");try{const Ae=await fetch(`/information_rom/${Me}-${se.cartID}.json`);if(!Ae.ok||Ae.status!=200)throw new Error(`HTTP error! Status: ${Ae.status}`);let Ye=await Ae.json();Ye&&Object.keys(Ye).length>0?(console.log("Data exists"),le=Ye):console.log("Data does not exist or is empty")}catch(Ae){console.error("An error occurred while fetching other additional data:",Ae)}}m(le)}catch(ne){console.error("Error fetching game information:",ne)}finally{Y(!1)}},He=async(ne,se)=>{try{console.log(ne);var ie=pa(ne);if(ie==-1){console.log("Invalid Save Type");return}console.log(ie);var le=`${b}/get_current_save?saveType=${ie}`;await D({url:new URL(le),fullName:se})}catch(Me){console.error("Error fetching save:",Me)}finally{}};return o.jsxs(o.Fragment,{children:[i&&l?o.jsx(Te,{title:l.fullName}):i&&!l?o.jsx(Te,{title:i.romName}):!i&&l?o.jsx(Te,{title:l.fullName}):o.jsx(Te,{title:"No Response from Cart Reader"}),o.jsx(ze,{children:o.jsxs(kv,{isLoading:E,indicator:o.jsx(Et,{color:g.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:$,children:[o.jsx("form",{id:"upload-rom-form","aria-label":"Upload Rom Form",children:!!L&&o.jsx(sr,{icon:o.jsx(ar,{style:{color:g.errorRed}}),text:"Loading rom from URL has failed"})}),i&&l&&o.jsxs("div",{id:"game-info",style:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",margin:"0px auto",padding:"0px",maxWidth:"600px"},children:[o.jsx("img",{id:"cover-image",src:l.coverImage,alt:`${l.fullName} Cover`,style:{maxWidth:"75%",height:"auto",marginBottom:"15px",borderRadius:"12px",border:"1px solid black"}}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"Full Name:"})," ",l.fullName]}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"ROM Name:"})," ",i.romName]}),o.jsxs("label",{children:[o.jsx("strong",{children:"Cart Size (MB):"}),o.jsxs("select",{name:"cartSize",value:l.cartSize/1024/1024,onChange:q,children:[o.jsxs("option",{value:l.cartSize,hidden:!0,children:[(l.cartSize/1024/1024).toFixed(2),"MB"]}),o.jsx("option",{value:1*1024*1024,children:"1MB"}),o.jsx("option",{value:2*1024*1024,children:"2MB"}),o.jsx("option",{value:4*1024*1024,children:"4MB"}),o.jsx("option",{value:8*1024*1024,children:"8MB"}),o.jsx("option",{value:16*1024*1024,children:"16MB"}),o.jsx("option",{value:32*1024*1024,children:"32MB"}),o.jsx("option",{value:64*1024*1024,children:"64MB"})]})]}),o.jsxs("label",{children:[o.jsx("strong",{children:"Save Type:"}),o.jsxs("select",{name:"saveType",value:l.saveType,onChange:q,children:[o.jsx("option",{value:"FLASH1M_V102",children:"FLASH1M_V102"}),o.jsx("option",{value:"FLASH1M_V103",children:"FLASH1M_V103"}),o.jsx("option",{value:"FLASH_V124",children:"FLASH_V124"}),o.jsx("option",{value:"FLASH_V126",children:"FLASH_V126"}),o.jsx("option",{value:"FLASH_ECLA",children:"FLASH_ECLA"}),o.jsx("option",{value:"EEPROM_V122",children:"EEPROM_V122"}),o.jsx("option",{value:"EEPROM_V124",children:"EEPROM_V124"}),o.jsx("option",{value:"SRAM_V112",children:"SRAM_V112"}),o.jsx("option",{value:"SRAM_V113",children:"SRAM_V113"}),o.jsx("option",{value:"REPRO_FLASH1M",children:"REPRO_FLASH1M"}),o.jsx("option",{value:"NONE",children:"NONE"})]})]}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"Cart ID:"})," ",i.cartID]}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"ROM Version:"})," ",i.romVersion]}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"Checksum:"})," ",i.checksumStr]}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"Publisher:"})," ",l.publisher]}),o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"Release Date:"})," ",l.releaseDate]}),l.patchFile!=null&&l.patchFile.length>0&&o.jsxs("p",{style:{margin:"3px 0",fontSize:"16px"},children:[o.jsx("strong",{children:"BPS Patch File:"})," ",l.patchFile]})]}),i&&l&&o.jsx(Yn,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"esp32-ip",children:"ESP32 IP Address:"}),o.jsx("input",{type:"text",id:"esp32-ip",value:b,onChange:ne=>_(ne.target.value),placeholder:"Enter ESP32 IP address"})]})]})}),o.jsx(Ge,{children:o.jsxs("div",{style:{display:"flex",gap:"10px",width:"100%"},children:[o.jsxs(pe,{variant:"contained",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>W(),children:[o.jsx(Vm,{style:{fontSize:"30px",marginRight:"10px"}})," ","Start Game",o.jsx("br",{}),"With Save"]}),o.jsxs(pe,{variant:"outlined",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>oe(),children:[o.jsx(Hn,{style:{fontSize:"40px"}})," ","Start Game"]}),o.jsx(pe,{variant:"outlined",style:{padding:"10px 20px 10px 20px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>y(!1),children:"Close"})]})})]})},jv=I.div`
  width: ${ir}px;
  height: 100dvh;
  position: fixed;
  background-color: ${({theme:l})=>l.mediumBlack};
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  z-index: 150;
  overflow-y: auto;
  text-align: left;
  left: 0;
  top: 0;
  touch-action: none;

  ${({$isExpanded:l=!1})=>!l&&`left: -${ir+5}px;
    `}

  &::-webkit-scrollbar {
    display: none;
  }
`,Lv=I.h2`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0.5rem 1rem;
  font-size: calc(1.3rem + 0.6vw);
  font-weight: 500;
  line-height: 1.2;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;

  &:hover {
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Fv=I.ul`
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
  margin-top: 0;
  list-style: none;
  padding: 0;
`,Rv=I(kr)`
  background-color: ${({theme:l})=>l.mediumBlack};
  color: ${({theme:l})=>l.pureWhite};
  z-index: 200;
  position: fixed;
  left: ${ir-6}px;
  top: 12px;
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  cursor: pointer;
  padding: 0.375rem 0.75rem;
  border-radius: 0.25rem;
  border: none;
  min-height: 36px;
  min-width: 40px;

  ${({$isExpanded:l=!1})=>!l&&`left: -8px;
    `}

  &:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
`,Tv=I.button`
  position: absolute;
  width: calc(100dvw - ${ir}px);
  left: ${ir}px;
  height: 99%;
  background: 0 0;
  z-index: 140;
  border: none;
`,Pv=()=>{const[l,m]=P.useState(!0),{setModalContent:i,setIsModalOpen:h}=ke(),{canvas:b,emulator:_}=ge(),{isRunning:g}=rr(),y=Pe(),j=or(y.isLargerThanPhone),k=P.useId(),E=ia(),[L,R]=P.useState(null),[$,U]=P.useState(null),D="https://192.168.1.3",[H,z]=P.useState(D);return P.useEffect(()=>{console.log("run0"),i(o.jsx(zn,{additionalData:L,setAdditionalData:R,gameData:$,setGameData:U,esp32IP:H,setEsp32IP:z})),h(!0)},[L,$,H]),o.jsxs(o.Fragment,{children:[o.jsx(Rv,{id:"menu-btn",$isExpanded:l,onClick:()=>m(Y=>!Y),"aria-label":"Menu Toggle",children:o.jsx(Hm,{})}),o.jsxs(jv,{"data-testid":"menu-wrapper",id:"menu-wrapper",$isExpanded:l,children:[o.jsx(Lv,{id:k,children:"Menu"}),o.jsxs(Fv,{"aria-labelledby":k,children:[o.jsx(Re,{title:"My Cartridge",icon:o.jsx(Pn,{}),$withPadding:!0,onClick:()=>{i(o.jsx(zn,{additionalData:L,setAdditionalData:R,gameData:$,setGameData:U,esp32IP:H,setEsp32IP:z})),h(!0)}}),o.jsx(Re,{title:"About",icon:o.jsx(Wm,{}),$withPadding:!0,onClick:()=>{i(o.jsx(gh,{})),h(!0)}}),o.jsxs($n,{title:"Pre Game Actions",$disabled:g,$isExpanded:!g,icon:o.jsx(Xm,{}),children:[o.jsx(Re,{title:"Upload Saves",$disabled:g,icon:o.jsx(yt,{}),onClick:()=>{i(o.jsx(_v,{})),h(!0)}}),o.jsx(Re,{title:"Upload Cheats",$disabled:g,icon:o.jsx(yt,{}),onClick:()=>{i(o.jsx(mv,{})),h(!0)}}),o.jsx(Re,{title:"Upload Rom",$disabled:g,icon:o.jsx(Mn,{}),onClick:()=>{i(o.jsx(xv,{})),h(!0)}}),o.jsx(Re,{title:"Load Local Rom",$disabled:g,icon:o.jsx(Mn,{}),onClick:()=>{i(o.jsx(Yh,{})),h(!0)}})]}),o.jsxs($n,{title:"In Game Actions",$disabled:!g,$isExpanded:g,icon:o.jsx(Km,{}),children:[o.jsx(Re,{title:"Save to Cartridge",$disabled:!g,icon:o.jsx(An,{}),onClick:()=>{const Y=_==null?void 0:_.getCurrentSave(),te=_==null?void 0:_.getCurrentSaveName();if(Y&&te){const G=new XMLHttpRequest;if(!L){console.log("No save type information.");return}var K=pa(L.saveType);if(K==-1){console.log("Invalid Save Type");return}console.log(K);const q=new Promise((V,O)=>{G.open("POST",`${H}/upload_save_file?saveType=${K}`,!0),G.onload=()=>{G.status>=200&&G.status<300?V("Uploaded save to cartridge"):O("Failed to upload save to cartridge")},G.onerror=()=>O("Failed to upload save to cartridge"),G.send(Y)});Ze.promise(q,{loading:"Uploading save to cartridge...",success:V=>`${V}`,error:V=>`${V}`})}else Ze.error("Current save not available")}}),o.jsx(Re,{title:"Screenshot",$disabled:!g,icon:o.jsx(An,{}),onClick:()=>{_!=null&&_.screenshot()?Ze.success("Screenshot saved successfully"):Ze.error("Screenshot has failed")}}),o.jsx(Re,{title:"Full Screen",$disabled:!g,icon:o.jsx(Ym,{}),onClick:()=>{b==null||b.requestFullscreen().catch(()=>{Ze.error("Full screen request has failed")})}}),o.jsx(Re,{title:"Download Save",$disabled:!g,icon:o.jsx(Xn,{}),onClick:()=>{i(o.jsx(Uh,{})),h(!0)}}),o.jsx(Re,{title:"Quick Reload",$disabled:!g,icon:o.jsx(Qm,{}),onClick:E}),o.jsx(Re,{title:"Manage Save States",$disabled:!g,icon:o.jsx(Jm,{}),onClick:()=>{i(o.jsx(tv,{})),h(!0)}}),o.jsx(Re,{title:"Manage Cheats",$disabled:!g,icon:o.jsx(Zm,{}),onClick:()=>{i(o.jsx(Rh,{})),h(!0)}})]}),o.jsx(Re,{title:"Controls",icon:o.jsx(Pn,{}),$withPadding:!0,onClick:()=>{i(o.jsx(Nh,{})),h(!0)}}),o.jsx(Re,{title:"File System",icon:o.jsx(ep,{}),$withPadding:!0,onClick:()=>{i(o.jsx(Xh,{})),h(!0)}})]})]}),l&&!j&&o.jsx(Tv,{"aria-label":"Menu Dismiss",onClick:()=>{m(!1)}})]})};I.ul`
  text-align: left;
`;const Mv=()=>!0,Av=()=>{const[l]=Le(Dt);return l!=null&&l.hasCompletedProductTourIntro?o.jsx(rp,{}):null},Dv=240,Bv=160,Iv=I.canvas`
  background-color: ${({theme:l})=>l.pureBlack};
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -moz-crisp-edges;
  image-rendering: -o-crisp-edges;
  width: 100%;
  height: 100%;
  display: block;
  margin: 0 auto;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`,$v=I(qn)`
  background-color: ${({theme:l})=>l.pureBlack};
  border: solid 1px ${({theme:l})=>l.pureBlack};
  overflow: visible;
  width: 100dvw;
  height: calc(100dvw * 2 / 3);

  @media ${({theme:l})=>l.isLargerThanPhone} {
    width: min(
      calc(100dvw - ${ir+35}px),
      calc(85dvh * 3 / 2)
    );
    height: 85dvh;
  }
`,Nv={width:"",height:""},Uv=()=>{var U,D;const l=Pe(),m=or(l.isLargerThanPhone),{setCanvas:i}=ge(),{areItemsDraggable:h}=Kr(),{areItemsResizable:b}=ta(),{layouts:_,setLayout:g,hasSetLayout:y}=xr(),j=m?ir+10:0,k=m?15:0,E=P.useCallback(H=>{var z,Y,te,K,G,q,V,O;y||((te=(Y=(z=H==null?void 0:H.resizableElement)==null?void 0:z.current)==null?void 0:Y.style)==null||te.removeProperty("width"),(q=(G=(K=H==null?void 0:H.resizableElement)==null?void 0:K.current)==null?void 0:G.style)==null||q.removeProperty("height")),!((V=_==null?void 0:_.screen)!=null&&V.initialBounds)&&H&&g("screen",{initialBounds:(O=H.resizableElement.current)==null?void 0:O.getBoundingClientRect()})},[y,_,g]),L=P.useCallback(H=>i(H),[i]),R=((U=_==null?void 0:_.screen)==null?void 0:U.position)??{x:j,y:k},$=((D=_==null?void 0:_.screen)==null?void 0:D.size)??Nv;return o.jsx($v,{"data-testid":"screen-wrapper",disableDragging:!h,ref:E,enableResizing:b,resizeHandleComponent:{topRight:o.jsx(vr,{variation:"topRight"}),bottomRight:o.jsx(vr,{variation:"bottomRight"}),bottomLeft:o.jsx(vr,{variation:"bottomLeft"}),topLeft:o.jsx(vr,{variation:"topLeft"})},resizeHandleStyles:{topRight:{marginTop:"15px",marginRight:"15px"},bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"},topLeft:{marginTop:"15px",marginLeft:"15px"}},position:R,size:$,onDragStop:(H,z)=>{g("screen",{position:{x:z.x,y:z.y}})},onResizeStop:(H,z,Y,te,K)=>{g("screen",{size:{width:Y.clientWidth,height:Y.clientHeight},position:{...K}})},children:o.jsx(Iv,{"data-testid":"screen-wrapper:render-canvas",ref:L,width:Dv,height:Bv})})},Ov=I.div`
  background-color: #fff;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  height: fit-content;
  inset: 10px;
  margin: 25px auto auto;
  padding-top: 25px;
  max-height: 80%;
  max-width: calc(100dvw - 20px);
  padding: 0;
  touch-action: none;
  user-select: text;
  width: fit-content;

  @media ${({theme:l})=>l.isLargerThanPhone} {
    max-width: 600px;
  }
`,zv=I.div`
  background-color: rgba(0, 0, 0, 0.5);
  width: 100dvw;
  height: 100dvh;
  position: absolute;
`,Gv=I(da)`
  justify-content: center;
`,qv=I(ua)`
  padding: 1em 1em 0 1em;
`,Vv=I.img`
  object-fit: contain;
  max-width: 100%;
`,Hv=I(fa)`
  justify-content: center;
  flex-wrap: wrap;
`,Wv=I.div`
  position: relative;
`,Xv=I.a`
  font-size: 5px;
  position: absolute;
  right: 15%;
  bottom: 6%;
`,Gn=()=>o.jsx("span",{children:"→"}),Kv=({error:l,resetErrorBoundary:m})=>o.jsx(zv,{children:o.jsxs(Ov,{role:"alert",children:[o.jsx(Gv,{children:o.jsx(ca,{children:"An irrecoverable error occurred"})}),o.jsxs(qv,{children:[o.jsxs(Wv,{children:[o.jsx(Vv,{src:"/img/error-512x512.png",alt:"GameBoy Advance with error icon"}),o.jsx(Xv,{target:"_blank",href:"https://www.freepik.com/free-vector/editable-text-effect-error-3d-hack-virus-font-style_21408324.htm",children:"Font by NACreative"})]}),o.jsx("pre",{style:{color:"red"},children:l.message}),o.jsx("p",{children:"Please use the buttons below to copy the stack trace and create an issue, this helps a lot with error reporting!"})]}),o.jsxs(Hv,{children:[o.jsx(pe,{color:"info",variant:"contained",onClick:()=>{navigator.clipboard.writeText(l.stack??"No stack available")},children:"Copy trace"}),o.jsx(Gn,{}),o.jsx(pe,{color:"success",variant:"contained",href:"https://github.com/thenick775/gbajs3/issues",target:"_blank",children:"Create issue"}),o.jsx(Gn,{}),o.jsx(pe,{color:"secondary",variant:"contained",onClick:m,children:"Dismiss and reset"})]})]})}),Yv=({children:l})=>o.jsx(tp,{fallbackRender:Kv,children:l}),Qv=()=>{const l=Pe();return o.jsx(np,{toastOptions:{success:{duration:1e3},error:{duration:1500},style:{background:l.darkCharcoal,color:l.pureWhite}}})},Jv=({children:l})=>o.jsx(wp,{children:o.jsx(Ep,{children:o.jsx(gp,{children:o.jsx(Sp,{children:l})})})}),Zv={isLargerThanPhone:"only screen and (min-width: 600px)",isMobileLandscape:"only screen and (max-height: 1000px) and (max-width: 1000px) and (orientation: landscape)",isMobilePortrait:"only screen and (max-width: 1000px) and (orientation: portrait)",isMobileWithUrlBar:"only screen and (max-height: 700px) and (orientation: portrait)",aliceBlue1:"#f8f9fa",aliceBlue2:"#edf2f7",arcticAirBlue:"#cad8e5",blackRussian:"#1a202c",blueCharcoal:"#212529",checkMarkGreen:"#7ac142",darkCharcoal:"#333",darkGrayBlue:"#495057",disabledGray:"#6c757d",errorRed:"#d32f2f",gbaThemeBlue:"#0d6efd",mediumBlack:"#100901",menuHighlight:"#ffffff26",menuHover:"#0a58ca",pattensBlue:"#dee2e6",pureBlack:"#000",pureWhite:"#fff",darkGray:"#111",panelControlGray:"#a9a9a9",panelBlueGray:"#4f555a"},eg=()=>o.jsx(ap,{theme:Zv,children:o.jsxs(Yv,{children:[o.jsx(Mv,{}),o.jsx(Qv,{}),o.jsx(Av,{}),o.jsx(vp,{children:o.jsx(Jv,{children:o.jsx(jp,{children:o.jsxs(Lp,{children:[o.jsx(Pv,{}),o.jsx(Uv,{}),o.jsx(zp,{}),o.jsx(sh,{}),o.jsx(lh,{})]})})})})]})});op.createRoot(document.getElementById("root")).render(o.jsx(Wr.StrictMode,{children:o.jsx(eg,{})}));
