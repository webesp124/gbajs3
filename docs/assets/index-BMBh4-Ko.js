import{r as R,z as tp,A as zt,j as o,B as ke,D as np,E as I,q as at,F as Me,H as ap,I as ua,J as fa,K as ma,L as op,M as sp,N as ip,O as Jn,Q as Zn,S as lp,U as cp,V as dp,W as up,X as It,Y as Ve,Z as lr,$ as ot,a0 as fp,a1 as mp,a2 as pp,a3 as hp,a4 as gp,a5 as vp,a6 as Gt,a7 as xp,a8 as pa,a9 as er,aa as bp,ab as Br,ac as ha,ad as qt,ae as Bt,af as _p,ag as yp,ah as wp,ai as Sp,aj as Cp,ak as Ep,al as kp,am as jp,an as Fp,ao as Lp,ap as Tt,aq as ea,ar as Pt,as as Rp,at as Tp,au as Pp,av as Mp,aw as Ap,ax as Dp,ay as Ip,az as Bp,aA as $p,aB as Np,aC as Up,aD as Op,aE as zp,aF as Gp,aG as qp,aH as Vp}from"./vendor-D4aslcEV.js";import{S as Mt,c as Hp}from"./vendor_react-joyride-BJHucF7z.js";import{u as xr,S as Wp,I as cr,B as ie,F as ga,C as Dr,T as ir,a as Xp,b as Kp,c as ra,d as Vt,s as Yp,e as Qp,t as At,f as Jp,g as Zp,h as eh,D as vr,i as Ht,j as Wt,k as va,l as Ce,m as ne,n as Xt,o as $t,M as et,p as rh,q as th,r as nh}from"./vendor_@mui-CQqMkmd2.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))p(v);new MutationObserver(v=>{for(const h of v)if(h.type==="childList")for(const g of h.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&p(g)}).observe(document,{childList:!0,subtree:!0});function s(v){const h={};return v.integrity&&(h.integrity=v.integrity),v.referrerPolicy&&(h.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?h.credentials="include":v.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function p(v){if(v.ep)return;v.ep=!0;const h=s(v);fetch(v.href,h)}})();const xa="currentEmulatorVolume",ba="currentEmulatorKeyBindings",_a="currentGameName",ya="currentFastForward",Kt="currentCoreCallbacks",jr=({fetchFn:l,loadOnMount:f=!1,clearDataOnLoad:s=!1})=>{const[p,v]=R.useState(null),[h,g]=R.useState(null),[b,k]=R.useState(!1),S=()=>g(null),w=R.useCallback(async C=>{k(!0),g(null),s&&v(null);try{const L=await l(C);v(L),k(!1)}catch(L){g(L),k(!1)}},[s,l]);return R.useEffect(()=>{f&&l&&w()},[]),{data:p,isLoading:b,error:h,clearError:S,execute:w}},ah=({loadOnMount:l=!1}={})=>{const s=R.useCallback(async()=>(await fetch("undefined/api/tokens/refresh",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json(),[void 0]),{data:p,isLoading:v,error:h,clearError:g,execute:b}=jr({fetchFn:s,clearDataOnLoad:!0,loadOnMount:l});return{data:p,isLoading:v,error:h,clearError:g,execute:b}},Yt=R.createContext(null);Yt.displayName="AuthContext";const oh=({children:l})=>{const[p,v]=R.useState(null),[h,g]=R.useState(null),{data:b,isLoading:k,execute:S,error:w,clearError:C}=ah({loadOnMount:!1}),L=!k&&!!b;R.useEffect(()=>{L&&(v(b),g("refresh"))},[L,b]);const $=R.useCallback(()=>{if(p){const{exp:D}=tp(p);if(D&&Date.now()<=D*1e3)return!0}return!1},[p]),G=$()&&!b&&h!=="refresh";return R.useEffect(()=>{G&&C()},[G,C]),zt(async()=>{await S()},$()&&!w?24e4:null),o.jsx(Yt.Provider,{value:{accessToken:p,setAccessToken:v,setAccessTokenSource:g,isAuthenticated:$},children:l})},Qt=R.createContext(null);Qt.displayName="DragContext";const sh=({children:l})=>{const[f,s]=R.useState(!1);return o.jsx(Qt.Provider,{value:{areItemsDraggable:f,setAreItemsDraggable:s},children:l})},Ye=0,ih=3,lh=l=>{const f=l.filePaths(),s=(b,k)=>{var w,C;let S=(w=b==null?void 0:b.split("/"))==null?void 0:w.pop();if(k){const L="."+((C=S==null?void 0:S.split("."))==null?void 0:C.pop());S=S==null?void 0:S.replace(L,k)}return S},p=()=>{const b={path:f.root,isDir:!0,children:[]},k=[".",".."],S=({path:w,children:C})=>{for(const L of l.FS.readdir(w)){if(k.includes(L))continue;const $=`${w}/${L}`,{mode:G}=l.FS.lookupPath($,{}).node,D={path:$,isDir:l.FS.isDir(G),children:[]};C==null||C.push(D),D.isDir&&S(D)}};return S(b),b},v=b=>{var L;const k=b.split(`
`),S=["cheats = ",""];if(!((L=k==null?void 0:k[0])!=null&&L.match("^cheats = [0-9]+$")))return[];const w={},C={desc:"desc",code:"code",enable:"enable"};for(const $ of k){if(S.includes($))continue;const G=$.match(/^cheat([0-9]+)_([a-zA-Z]+)\s*=\s*"?([a-zA-Z0-9\s+:_]+)"?$/);if(G){const[,D,N,V]=G,Y=C[N];w[D]=w[D]||{desc:"",code:"",enable:!1},Y&&(w[D][Y]=Y===C.enable?V.toLowerCase()==="true":V)}}return Object.values(w)},h=b=>{const k=b.map((C,L)=>`cheat${L}_desc = "${C.desc}"
cheat${L}_enable = ${C.enable}
cheat${L}_code = "${C.code}"
`),S=`cheats = ${k==null?void 0:k.length}

`,w=s(l.gameName,".cheats");if(k!=null&&k.length&&w){const C=S+k.join(`
`),L=new Blob([C],{type:"text/plain"});return new File([L],w)}return null},g=({key:b,location:k})=>{let S=k===ih?`Keypad ${b}`:b;return S.toLowerCase().includes("enter")&&(S=S.replace(/enter/gi,"Return")),S.toLowerCase().includes("arrow")&&(S=S.replace(/arrow/gi,"")),S};return{addCoreCallbacks:l.addCoreCallbacks,autoLoadCheats:l.autoLoadCheats,createSaveState:l.saveState,defaultKeyBindings:()=>[{gbaInput:"A",key:"X",location:Ye},{gbaInput:"B",key:"Z",location:Ye},{gbaInput:"L",key:"A",location:Ye},{gbaInput:"R",key:"S",location:Ye},{gbaInput:"Start",key:"Enter",location:Ye},{gbaInput:"Select",key:"Backspace",location:Ye},{gbaInput:"Up",key:"ArrowUp",location:Ye},{gbaInput:"Down",key:"ArrowDown",location:Ye},{gbaInput:"Left",key:"ArrowLeft",location:Ye},{gbaInput:"Right",key:"ArrowRight",location:Ye}],loadSaveState:l.loadState,listSaveStates:()=>l.FS.readdir(f.saveStatePath),listRoms:()=>l.FS.readdir(f.gamePath),listSaves:()=>l.FS.readdir(f.savePath),getStatSaves:b=>l.FS.stat("/data/saves/"+b),getStatRoms:b=>l.FS.stat("/data/games/"+b),setVolume:async b=>{(l.SDL2.audioContext.state==="suspended"||l.SDL2.audioContext.state==="interrupted")&&await l.SDL2.audioContext.resume(),l.setVolume(b)},getVolume:l.getVolume,enableKeyboardInput:()=>l.toggleInput(!0),disableKeyboardInput:()=>l.toggleInput(!1),simulateKeyDown:l.buttonPress,simulateKeyUp:l.buttonUnpress,setFastForwardMultiplier:l.setFastForwardMultiplier,isFastForwardEnabled:()=>l.getFastForwardMultiplier()>1,run:l.loadGame,getCurrentRom:()=>l.gameName?l.FS.readFile(l.gameName):null,getCurrentGameName:()=>s(l.gameName),setCurrentGameName:b=>{b&&!l.gameName&&(l.gameName=b)},getCurrentSave:()=>l.saveName?l.getSave():null,getCurrentSaveName:()=>s(l.saveName),getFile:b=>l.FS.readFile(b),uploadCheats:l.uploadCheats,uploadRom:l.uploadRom,uploadSaveOrSaveState:l.uploadSaveOrSaveState,deleteSaveState:b=>{const k=s(l.saveName,".ss"+b),S=`${f.saveStatePath}/${k}`;l.FS.unlink(S)},deleteFile:l.FS.unlink,pause:l.pauseGame,resume:l.resumeGame,quitGame:l.quitGame,quitEmulator:l.quitMgba,quickReload:l.quickReload,getCurrentCheatsFile:()=>{const b=s(l.gameName,".cheats"),k=`${f.cheatsPath}/${b}`;return l.FS.analyzePath(k).exists?l.FS.readFile(k):new Uint8Array},getCurrentCheatsFileName:()=>s(l.gameName,".cheats"),screenshot:l.screenshot,remapKeyBindings:b=>b.forEach(k=>l.bindKey(g(k),k.gbaInput)),filePaths:l.filePaths,fsSync:l.FSSync,listAllFiles:p,parseCheatsString:v,parsedCheatsToFile:h}};var ch=(()=>{var l=import.meta.url;return function(f={}){var s=f,p,v;s.ready=new Promise((e,r)=>{p=e,v=r}),s.loadGame=e=>{if(fe("loadGame","number",["string"])(e)){const t=e.split(".");t.pop();const n=t.join(".")+".sav";return s.gameName=e,s.saveName=n.replace("/data/games/","/data/saves/"),!0}return!1},s.getSave=()=>c.readFile(s.saveName),s.listRoms=()=>c.readdir("/data/games/"),s.listSaves=()=>c.readdir("/data/saves/"),s.FSInit=()=>new Promise((e,r)=>{c.mkdir("/data"),c.mount(c.filesystems.IDBFS,{},"/data"),c.syncfs(!0,t=>{t&&r(new Error(`Error syncing app data from IndexedDB: ${t}`));try{c.mkdir("/data/saves")}catch{}try{c.mkdir("/data/states")}catch{}try{c.mkdir("/data/games")}catch{}try{c.mkdir("/data/cheats")}catch{}try{c.mkdir("/data/screenshots")}catch{}e()})}),s.FSSync=()=>new Promise((e,r)=>{c.syncfs(t=>{t&&r(new Error(`Error syncing app data to IndexedDB: ${t}`)),e()})}),s.filePaths=()=>({root:"/data",cheatsPath:"/data/cheats",gamePath:"/data/games",savePath:"/data/saves",saveStatePath:"/data/states",screenshotsPath:"/data/screenshots"}),s.uploadSaveOrSaveState=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="sav")a="/data/saves/";else if(n.startsWith("ss"))a="/data/states/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadRom=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(["gba","gbc","gb","zip","7z"].includes(n))a="/data/games/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadCheats=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="cheats")a="/data/cheats/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)};const h=new Map([["a",0],["b",1],["select",2],["start",3],["right",4],["left",5],["up",6],["down",7],["r",8],["l",9]]);s.buttonPress=e=>{fe("buttonPress",null,["number"])(h.get(e.toLowerCase()))},s.buttonUnpress=e=>{fe("buttonUnpress",null,["number"])(h.get(e.toLowerCase()))},s.bindKey=(e,r)=>{fe("bindKey",null,["string","number"])(e,h.get(r.toLowerCase()))},s.pauseGame=()=>{fe("pauseGame",null,[])()},s.resumeGame=()=>{fe("resumeGame",null,[])()},s.getVolume=()=>fe("getVolume","number",[])(),s.setVolume=e=>{fe("setVolume",null,["number"])(e)},s.getMainLoopTimingMode=()=>fe("getMainLoopTimingMode","number",[])(),s.getMainLoopTimingValue=()=>fe("getMainLoopTimingValue","number",[])(),s.setMainLoopTiming=(e,r)=>{fe("setMainLoopTiming","number",["number","number"])(e,r)},s.quitGame=()=>{fe("quitGame",null,[])()},s.quitMgba=()=>{fe("quitMgba",null,[])()},s.quickReload=()=>{fe("quickReload",null,[])()},s.toggleInput=e=>{fe("setEventEnable",null,["boolean"])(e)},s.screenshot=e=>fe("screenshot","boolean",["string"])(e),s.saveState=e=>fe("saveState","boolean",["number"])(e),s.loadState=e=>fe("loadState","boolean",["number"])(e),s.saveStateSlot=(e,r)=>{var t=fe("saveStateSlot","number",["number","number"]);return s.saveStateSlot=(n,a)=>(a===void 0&&(a=63),t(n,a)),s.saveStateSlot(e,r)},s.loadStateSlot=(e,r)=>{var t=fe("loadStateSlot","number",["number","number"]);return s.loadStateSlot=(n,a)=>(a===void 0&&(a=61),t(n,a)),s.loadStateSlot(e,r)},s.autoLoadCheats=()=>fe("autoLoadCheats","bool",[])(),s.setFastForwardMultiplier=e=>{fe("setFastForwardMultiplier",null,["number"])(e)},s.getFastForwardMultiplier=()=>fe("getFastForwardMultiplier","number",[])();const g={alarmCallbackPtr:null,coreCrashedCallbackPtr:null,keysReadCallbackPtr:null,saveDataUpdatedCallbackPtr:null,videoFrameEndedCallbackPtr:null,videoFrameStartedCallbackPtr:null};s.addCoreCallbacks=e=>{const r=fe("addCoreCallbacks",null,["number"]);Object.keys(g).forEach(t=>{const n=t.replace("CallbackPtr","Callback"),a=e[n];a!==void 0&&g[t]&&(Vn(g[t]),g[t]=null),a&&(g[t]=qn(a,"vi"))}),r(g.alarmCallbackPtr,g.coreCrashedCallbackPtr,g.keysReadCallbackPtr,g.saveDataUpdatedCallbackPtr,g.videoFrameEndedCallbackPtr,g.videoFrameStartedCallbackPtr)};var b=Object.assign({},s),k="./this.program",S=(e,r)=>{throw r},w=!0,C="";function L(e){return s.locateFile?s.locateFile(e,C):C+e}var $,G;typeof document<"u"&&document.currentScript&&(C=document.currentScript.src),l&&(C=l),C.startsWith("blob:")?C="":C=C.substr(0,C.replace(/[?#].*/,"").lastIndexOf("/")+1),$=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},G=(e,r,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){r(n.response);return}t()},n.onerror=t,n.send(null)};var D=s.print||console.log.bind(console),N=s.printErr||console.error.bind(console);Object.assign(s,b),b=null,s.arguments&&s.arguments,s.thisProgram&&(k=s.thisProgram),s.quit&&(S=s.quit);var V;s.wasmBinary&&(V=s.wasmBinary),typeof WebAssembly!="object"&&ar("no native wasm support detected");var Y,X=!1,U;function H(e,r){e||ar(r)}var P,O,A,K,m,ee,Q,ce;function Te(){var e=Y.buffer;s.HEAP8=P=new Int8Array(e),s.HEAP16=A=new Int16Array(e),s.HEAPU8=O=new Uint8Array(e),s.HEAPU16=K=new Uint16Array(e),s.HEAP32=m=new Int32Array(e),s.HEAPU32=ee=new Uint32Array(e),s.HEAPF32=Q=new Float32Array(e),s.HEAPF64=ce=new Float64Array(e)}var We=[],Qe=[],tr=[],Xe=[];function Je(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)de(s.preRun.shift());Nr(We)}function oe(){!s.noFSInit&&!c.init.initialized&&c.init(),c.ignorePermissions=!1,Nr(Qe)}function ve(){Nr(tr)}function Ee(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)$e(s.postRun.shift());Nr(Xe)}function de(e){We.unshift(e)}function Ae(e){Qe.unshift(e)}function $e(e){Xe.unshift(e)}var nr=0,ur=null;function sx(e){return e}function dt(e){var r;nr++,(r=s.monitorRunDependencies)==null||r.call(s,nr)}function $r(e){var t;if(nr--,(t=s.monitorRunDependencies)==null||t.call(s,nr),nr==0&&ur){var r=ur;ur=null,r()}}function ar(e){var t;(t=s.onAbort)==null||t.call(s,e),e="Aborted("+e+")",N(e),X=!0,U=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw v(r),r}var za="data:application/octet-stream;base64,",an=e=>e.startsWith(za),fr;s.locateFile?(fr="mgba.wasm",an(fr)||(fr=L(fr))):fr=new URL(""+new URL("mgba-C3uUnxP8.wasm",import.meta.url).href,import.meta.url).href;function on(e){if(e==fr&&V)return new Uint8Array(V);throw"both async and sync fetching of the wasm failed"}function Ga(e){return!V&&w&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at '${e}'`;return r.arrayBuffer()}).catch(()=>on(e)):Promise.resolve().then(()=>on(e))}function sn(e,r,t){return Ga(e).then(n=>WebAssembly.instantiate(n,r)).then(n=>n).then(t,n=>{N(`failed to asynchronously prepare wasm: ${n}`),ar(n)})}function qa(e,r,t,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!an(r)&&typeof fetch=="function"?fetch(r,{credentials:"same-origin"}).then(a=>{var i=WebAssembly.instantiateStreaming(a,t);return i.then(n,function(d){return N(`wasm streaming compile failed: ${d}`),N("falling back to ArrayBuffer instantiation"),sn(r,t,n)})}):sn(r,t,n)}function Va(){var e={a:Gm};function r(n,a){return ae=n.exports,Y=ae._d,Te(),mr=ae.Ae,Ae(ae.$d),$r(),ae}dt();function t(n){r(n.instance)}if(s.instantiateWasm)try{return s.instantiateWasm(e,r)}catch(n){N(`Module.instantiateWasm callback failed with error: ${n}`),v(n)}return qa(V,fr,e,t).catch(v),{}}var Z,me,ln={272368:(e,r)=>{s.canvas.width=e,s.canvas.height=r},272425:(e,r,t,n,a,i,d)=>{s.version={gitCommit:Pe(e),gitShort:Pe(r),gitBranch:Pe(t),gitRevision:n,binaryName:Pe(a),projectName:Pe(i),projectVersion:Pe(d)}},272657:()=>{c.syncfs(function(e){H(!e)})},272701:()=>typeof AudioContext<"u"?!0:typeof webkitAudioContext<"u",272848:()=>typeof navigator.mediaDevices<"u"&&typeof navigator.mediaDevices.getUserMedia<"u"?!0:typeof navigator.webkitGetUserMedia<"u",273082:e=>{typeof s.SDL2>"u"&&(s.SDL2={});var r=s.SDL2;return e?r.capture={}:r.audio={},r.audioContext||(typeof AudioContext<"u"?r.audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(r.audioContext=new webkitAudioContext),r.audioContext&&Wa(r.audioContext)),r.audioContext===void 0?-1:0},273575:()=>{var e=s.SDL2;return e.audioContext.sampleRate},273643:(e,r,t,n)=>{var a=s.SDL2,i=function(x){a.capture.silenceTimer!==void 0&&(clearTimeout(a.capture.silenceTimer),a.capture.silenceTimer=void 0),a.capture.mediaStreamNode=a.audioContext.createMediaStreamSource(x),a.capture.scriptProcessorNode=a.audioContext.createScriptProcessor(r,e,1),a.capture.scriptProcessorNode.onaudioprocess=function(_){a===void 0||a.capture===void 0||(_.outputBuffer.getChannelData(0).fill(0),a.capture.currentCaptureBuffer=_.inputBuffer,ut("vi",t,[n]))},a.capture.mediaStreamNode.connect(a.capture.scriptProcessorNode),a.capture.scriptProcessorNode.connect(a.audioContext.destination),a.capture.stream=x},d=function(x){};a.capture.silenceBuffer=a.audioContext.createBuffer(e,r,a.audioContext.sampleRate),a.capture.silenceBuffer.getChannelData(0).fill(0);var u=function(){a.capture.currentCaptureBuffer=a.capture.silenceBuffer,ut("vi",t,[n])};a.capture.silenceTimer=setTimeout(u,r/a.audioContext.sampleRate*1e3),navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(i).catch(d):navigator.webkitGetUserMedia!==void 0&&navigator.webkitGetUserMedia({audio:!0,video:!1},i,d)},275295:(e,r,t,n)=>{var a=s.SDL2;a.audio.scriptProcessorNode=a.audioContext.createScriptProcessor(r,0,e),a.audio.scriptProcessorNode.onaudioprocess=function(i){a===void 0||a.audio===void 0||(a.audio.currentOutputBuffer=i.outputBuffer,ut("vi",t,[n]))},a.audio.scriptProcessorNode.connect(a.audioContext.destination)},275705:(e,r)=>{for(var t=s.SDL2,n=t.capture.currentCaptureBuffer.numberOfChannels,a=0;a<n;++a){var i=t.capture.currentCaptureBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio capture buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";if(n==1)for(var d=0;d<r;++d)dn(e+d*4,i[d],"float");else for(var d=0;d<r;++d)dn(e+(d*n+a)*4,i[d],"float")}},276310:(e,r)=>{for(var t=s.SDL2,n=t.audio.currentOutputBuffer.numberOfChannels,a=0;a<n;++a){var i=t.audio.currentOutputBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio output buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";for(var d=0;d<r;++d)i[d]=Q[e+(d*n+a<<2)>>2]}},276790:e=>{var r=s.SDL2;if(e){if(r.capture.silenceTimer!==void 0&&clearTimeout(r.capture.silenceTimer),r.capture.stream!==void 0){for(var t=r.capture.stream.getAudioTracks(),n=0;n<t.length;n++)r.capture.stream.removeTrack(t[n]);r.capture.stream=void 0}r.capture.scriptProcessorNode!==void 0&&(r.capture.scriptProcessorNode.onaudioprocess=function(a){},r.capture.scriptProcessorNode.disconnect(),r.capture.scriptProcessorNode=void 0),r.capture.mediaStreamNode!==void 0&&(r.capture.mediaStreamNode.disconnect(),r.capture.mediaStreamNode=void 0),r.capture.silenceBuffer!==void 0&&(r.capture.silenceBuffer=void 0),r.capture=void 0}else r.audio.scriptProcessorNode!=null&&(r.audio.scriptProcessorNode.disconnect(),r.audio.scriptProcessorNode=void 0),r.audio=void 0;r.audioContext!==void 0&&r.audio===void 0&&r.capture===void 0&&(r.audioContext.close(),r.audioContext=void 0)},277962:(e,r,t)=>{var n=e,a=r,i=t;s.SDL2||(s.SDL2={});var d=s.SDL2;d.ctxCanvas!==s.canvas&&(d.ctx=s.createContext(s.canvas,!1,!0),d.ctxCanvas=s.canvas),(d.w!==n||d.h!==a||d.imageCtx!==d.ctx)&&(d.image=d.ctx.createImageData(n,a),d.w=n,d.h=a,d.imageCtx=d.ctx);var u=d.image.data,x=i>>2,_=0,E;if(typeof CanvasPixelArray<"u"&&u instanceof CanvasPixelArray)for(E=u.length;_<E;){var T=m[x];u[_]=T&255,u[_+1]=T>>8&255,u[_+2]=T>>16&255,u[_+3]=255,x++,_+=4}else{d.data32Data!==u&&(d.data32=new Int32Array(u.buffer),d.data8=new Uint8Array(u.buffer),d.data32Data=u);var q=d.data32;E=q.length,q.set(m.subarray(x,x+E));var M=d.data8,z=3,J=z+4*E;if(E%8==0)for(;z<J;)M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0;else for(;z<J;)M[z]=255,z=z+4|0}d.ctx.putImageData(d.image,0,0)},279431:(e,r,t,n,a)=>{var i=e,d=r,u=t,x=n,_=a,E=document.createElement("canvas");E.width=i,E.height=d;var T=E.getContext("2d"),q=T.createImageData(i,d),M=q.data,z=_>>2,J=0,xe;if(typeof CanvasPixelArray<"u"&&M instanceof CanvasPixelArray)for(xe=M.length;J<xe;){var he=m[z];M[J]=he&255,M[J+1]=he>>8&255,M[J+2]=he>>16&255,M[J+3]=he>>24&255,z++,J+=4}else{var Se=new Int32Array(M.buffer);xe=Se.length,Se.set(m.subarray(z,z+xe))}T.putImageData(q,0,0);var be=u===0&&x===0?"url("+E.toDataURL()+"), auto":"url("+E.toDataURL()+") "+u+" "+x+", auto",_e=Ue(be.length+1);return ge(be,_e,be.length+1),_e},280420:e=>{s.canvas&&(s.canvas.style.cursor=Pe(e))},280503:()=>{s.canvas&&(s.canvas.style.cursor="none")},280572:()=>window.innerWidth,280602:()=>window.innerHeight};function cn(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Ha=(e,r,t)=>{e.addEventListener(r,t,{once:!0})},Wa=(e,r)=>{r||(r=[document,document.getElementById("canvas")]),["keydown","mousedown","touchstart"].forEach(t=>{r.forEach(n=>{n&&Ha(n,t,()=>{e.state==="suspended"&&e.resume()})})})},Nr=e=>{for(;e.length>0;)e.shift()(s)},Xa=(e,r,t)=>{var n=s["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)},Rr=[],mr,le=e=>{var r=Rr[e];return r||(e>=Rr.length&&(Rr.length=e+1),Rr[e]=r=mr.get(e)),r},ut=(e,r,t)=>{if(e.includes("j"))return Xa(e,r,t);var n=le(r).apply(null,t);return n},Ka=s.noExitRuntime||!0;function dn(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":P[e>>0]=r;break;case"i8":P[e>>0]=r;break;case"i16":A[e>>1]=r;break;case"i32":m[e>>2]=r;break;case"i64":ar("to do setValue(i64) use WASM_BIGINT");case"float":Q[e>>2]=r;break;case"double":ce[e>>3]=r;break;case"*":ee[e>>2]=r;break;default:ar(`invalid type for setValue: ${t}`)}}var se={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var t=0,n=e.length-1;n>=0;n--){var a=e[n];a==="."?e.splice(n,1):a===".."?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t;t--)e.unshift("..");return e},normalize:e=>{var r=se.isAbs(e),t=e.substr(-1)==="/";return e=se.normalizeArray(e.split("/").filter(n=>!!n),!r).join("/"),!e&&!r&&(e="."),e&&t&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=se.splitPath(e),t=r[0],n=r[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)},basename:e=>{if(e==="/")return"/";e=se.normalize(e),e=e.replace(/\/$/,"");var r=e.lastIndexOf("/");return r===-1?e:e.substr(r+1)},join:function(){var e=Array.prototype.slice.call(arguments);return se.normalize(e.join("/"))},join2:(e,r)=>se.normalize(e+"/"+r)},Ya=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);ar("initRandomDevice")},un=e=>(un=Ya())(e),Ze={resolve:function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var n=t>=0?arguments[t]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,r=se.isAbs(n)}return e=se.normalizeArray(e.split("/").filter(a=>!!a),!r).join("/"),(r?"/":"")+e||"."},relative:(e,r)=>{e=Ze.resolve(e).substr(1),r=Ze.resolve(r).substr(1);function t(_){for(var E=0;E<_.length&&_[E]==="";E++);for(var T=_.length-1;T>=0&&_[T]==="";T--);return E>T?[]:_.slice(E,T-E+1)}for(var n=t(e.split("/")),a=t(r.split("/")),i=Math.min(n.length,a.length),d=i,u=0;u<i;u++)if(n[u]!==a[u]){d=u;break}for(var x=[],u=d;u<n.length;u++)x.push("..");return x=x.concat(a.slice(d)),x.join("/")}},fn=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,wr=(e,r,t)=>{for(var n=r+t,a=r;e[a]&&!(a>=n);)++a;if(a-r>16&&e.buffer&&fn)return fn.decode(e.subarray(r,a));for(var i="";r<a;){var d=e[r++];if(!(d&128)){i+=String.fromCharCode(d);continue}var u=e[r++]&63;if((d&224)==192){i+=String.fromCharCode((d&31)<<6|u);continue}var x=e[r++]&63;if((d&240)==224?d=(d&15)<<12|u<<6|x:d=(d&7)<<18|u<<12|x<<6|e[r++]&63,d<65536)i+=String.fromCharCode(d);else{var _=d-65536;i+=String.fromCharCode(55296|_>>10,56320|_&1023)}}return i},ft=[],Sr=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},mt=(e,r,t,n)=>{if(!(n>0))return 0;for(var a=t,i=t+n-1,d=0;d<e.length;++d){var u=e.charCodeAt(d);if(u>=55296&&u<=57343){var x=e.charCodeAt(++d);u=65536+((u&1023)<<10)|x&1023}if(u<=127){if(t>=i)break;r[t++]=u}else if(u<=2047){if(t+1>=i)break;r[t++]=192|u>>6,r[t++]=128|u&63}else if(u<=65535){if(t+2>=i)break;r[t++]=224|u>>12,r[t++]=128|u>>6&63,r[t++]=128|u&63}else{if(t+3>=i)break;r[t++]=240|u>>18,r[t++]=128|u>>12&63,r[t++]=128|u>>6&63,r[t++]=128|u&63}}return r[t]=0,t-a};function pt(e,r,t){var n=Sr(e)+1,a=new Array(n),i=mt(e,a,0,a.length);return a.length=i,a}var Qa=()=>{if(!ft.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"?(e=window.prompt("Input: "),e!==null&&(e+=`
`)):typeof readline=="function"&&(e=readline(),e!==null&&(e+=`
`)),!e)return null;ft=pt(e)}return ft.shift()},pr={ttys:[],init(){},shutdown(){},register(e,r){pr.ttys[e]={input:[],output:[],ops:r},c.registerDevice(e,pr.stream_ops)},stream_ops:{open(e){var r=pr.ttys[e.node.rdev];if(!r)throw new c.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,t,n,a){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var i=0,d=0;d<n;d++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&i===0)throw new c.ErrnoError(6);if(u==null)break;i++,r[t+d]=u}return i&&(e.node.timestamp=Date.now()),i},write(e,r,t,n,a){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,r[t+i])}catch{throw new c.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char(e){return Qa()},put_char(e,r){r===null||r===10?(D(wr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(D(wr(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,t){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(N(wr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(N(wr(e.output,0)),e.output=[])}}},Ja=(e,r)=>(O.fill(0,e,e+r),e),Za=(e,r)=>Math.ceil(e/r)*r,mn=e=>{e=Za(e,65536);var r=Kn(65536,e);return r?Ja(r,e):0},te={ops_table:null,mount(e){return te.createNode(null,"/",16895,0)},createNode(e,r,t,n){if(c.isBlkdev(t)||c.isFIFO(t))throw new c.ErrnoError(63);te.ops_table||(te.ops_table={dir:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,lookup:te.node_ops.lookup,mknod:te.node_ops.mknod,rename:te.node_ops.rename,unlink:te.node_ops.unlink,rmdir:te.node_ops.rmdir,readdir:te.node_ops.readdir,symlink:te.node_ops.symlink},stream:{llseek:te.stream_ops.llseek}},file:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:{llseek:te.stream_ops.llseek,read:te.stream_ops.read,write:te.stream_ops.write,allocate:te.stream_ops.allocate,mmap:te.stream_ops.mmap,msync:te.stream_ops.msync}},link:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,readlink:te.node_ops.readlink},stream:{}},chrdev:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:c.chrdev_stream_ops}});var a=c.createNode(e,r,t,n);return c.isDir(a.mode)?(a.node_ops=te.ops_table.dir.node,a.stream_ops=te.ops_table.dir.stream,a.contents={}):c.isFile(a.mode)?(a.node_ops=te.ops_table.file.node,a.stream_ops=te.ops_table.file.stream,a.usedBytes=0,a.contents=null):c.isLink(a.mode)?(a.node_ops=te.ops_table.link.node,a.stream_ops=te.ops_table.link.stream):c.isChrdev(a.mode)&&(a.node_ops=te.ops_table.chrdev.node,a.stream_ops=te.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[r]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var t=e.contents?e.contents.length:0;if(!(t>=r)){var n=1024*1024;r=Math.max(r,t*(t<n?2:1.125)>>>0),t!=0&&(r=Math.max(r,256));var a=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var t=e.contents;e.contents=new Uint8Array(r),t&&e.contents.set(t.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=c.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,c.isDir(e.mode)?r.size=4096:c.isFile(e.mode)?r.size=e.usedBytes:c.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.timestamp),r.mtime=new Date(e.timestamp),r.ctime=new Date(e.timestamp),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){r.mode!==void 0&&(e.mode=r.mode),r.timestamp!==void 0&&(e.timestamp=r.timestamp),r.size!==void 0&&te.resizeFileStorage(e,r.size)},lookup(e,r){throw c.genericErrors[44]},mknod(e,r,t,n){return te.createNode(e,r,t,n)},rename(e,r,t){if(c.isDir(e.mode)){var n;try{n=c.lookupNode(r,t)}catch{}if(n)for(var a in n.contents)throw new c.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=t,r.contents[t]=e,r.timestamp=e.parent.timestamp,e.parent=r},unlink(e,r){delete e.contents[r],e.timestamp=Date.now()},rmdir(e,r){var t=c.lookupNode(e,r);for(var n in t.contents)throw new c.ErrnoError(55);delete e.contents[r],e.timestamp=Date.now()},readdir(e){var r=[".",".."];for(var t of Object.keys(e.contents))r.push(t);return r},symlink(e,r,t){var n=te.createNode(e,r,41471,0);return n.link=t,n},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,r,t,n,a){var i=e.node.contents;if(a>=e.node.usedBytes)return 0;var d=Math.min(e.node.usedBytes-a,n);if(d>8&&i.subarray)r.set(i.subarray(a,a+d),t);else for(var u=0;u<d;u++)r[t+u]=i[a+u];return d},write(e,r,t,n,a,i){if(r.buffer===P.buffer&&(i=!1),!n)return 0;var d=e.node;if(d.timestamp=Date.now(),r.subarray&&(!d.contents||d.contents.subarray)){if(i)return d.contents=r.subarray(t,t+n),d.usedBytes=n,n;if(d.usedBytes===0&&a===0)return d.contents=r.slice(t,t+n),d.usedBytes=n,n;if(a+n<=d.usedBytes)return d.contents.set(r.subarray(t,t+n),a),n}if(te.expandFileStorage(d,a+n),d.contents.subarray&&r.subarray)d.contents.set(r.subarray(t,t+n),a);else for(var u=0;u<n;u++)d.contents[a+u]=r[t+u];return d.usedBytes=Math.max(d.usedBytes,a+n),n},llseek(e,r,t){var n=r;if(t===1?n+=e.position:t===2&&c.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new c.ErrnoError(28);return n},allocate(e,r,t){te.expandFileStorage(e.node,r+t),e.node.usedBytes=Math.max(e.node.usedBytes,r+t)},mmap(e,r,t,n,a){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var i,d,u=e.node.contents;if(!(a&2)&&u.buffer===P.buffer)d=!1,i=u.byteOffset;else{if((t>0||t+r<u.length)&&(u.subarray?u=u.subarray(t,t+r):u=Array.prototype.slice.call(u,t,t+r)),d=!0,i=mn(r),!i)throw new c.ErrnoError(48);P.set(u,i)}return{ptr:i,allocated:d}},msync(e,r,t,n,a){return te.stream_ops.write(e,r,0,n,t,!1),0}}},eo=(e,r,t,n)=>{var a=`al ${e}`;G(e,i=>{r(new Uint8Array(i)),a&&$r()},i=>{if(t)t();else throw`Loading data file "${e}" failed.`}),a&&dt()},ro=(e,r,t,n,a,i)=>{c.createDataFile(e,r,t,n,a,i)},ht=s.preloadPlugins||[],to=(e,r,t,n)=>{typeof j<"u"&&j.init();var a=!1;return ht.forEach(i=>{a||i.canHandle(r)&&(i.handle(e,r,t,n),a=!0)}),a},no=(e,r,t,n,a,i,d,u,x,_)=>{var E=r?Ze.resolve(se.join2(e,r)):e;function T(q){function M(z){_==null||_(),u||ro(e,r,z,n,a,x),i==null||i(),$r()}to(q,E,M,()=>{d==null||d(),$r()})||M(q)}dt(),typeof t=="string"?eo(t,T,d):T(t)},ao=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},t=r[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},gt=(e,r)=>{var t=0;return e&&(t|=365),r&&(t|=146),t},pe={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var e=null;return typeof window=="object"&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),H(e,"IDBFS used, but indexedDB not supported"),e},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:function(e){return te.mount.apply(null,arguments)},syncfs:(e,r,t)=>{pe.getLocalSet(e,(n,a)=>{if(n)return t(n);pe.getRemoteSet(e,(i,d)=>{if(i)return t(i);var u=r?d:a,x=r?a:d;pe.reconcile(u,x,t)})})},quit:()=>{Object.values(pe.dbs).forEach(e=>e.close()),pe.dbs={}},getDB:(e,r)=>{var t=pe.dbs[e];if(t)return r(null,t);var n;try{n=pe.indexedDB().open(e,pe.DB_VERSION)}catch(a){return r(a)}if(!n)return r("Unable to connect to IndexedDB");n.onupgradeneeded=a=>{var i=a.target.result,d=a.target.transaction,u;i.objectStoreNames.contains(pe.DB_STORE_NAME)?u=d.objectStore(pe.DB_STORE_NAME):u=i.createObjectStore(pe.DB_STORE_NAME),u.indexNames.contains("timestamp")||u.createIndex("timestamp","timestamp",{unique:!1})},n.onsuccess=()=>{t=n.result,pe.dbs[e]=t,r(null,t)},n.onerror=a=>{r(a.target.error),a.preventDefault()}},getLocalSet:(e,r)=>{var t={};function n(x){return x!=="."&&x!==".."}function a(x){return _=>se.join2(x,_)}for(var i=c.readdir(e.mountpoint).filter(n).map(a(e.mountpoint));i.length;){var d=i.pop(),u;try{u=c.stat(d)}catch(x){return r(x)}c.isDir(u.mode)&&i.push.apply(i,c.readdir(d).filter(n).map(a(d))),t[d]={timestamp:u.mtime}}return r(null,{type:"local",entries:t})},getRemoteSet:(e,r)=>{var t={};pe.getDB(e.mountpoint,(n,a)=>{if(n)return r(n);try{var i=a.transaction([pe.DB_STORE_NAME],"readonly");i.onerror=x=>{r(x.target.error),x.preventDefault()};var d=i.objectStore(pe.DB_STORE_NAME),u=d.index("timestamp");u.openKeyCursor().onsuccess=x=>{var _=x.target.result;if(!_)return r(null,{type:"remote",db:a,entries:t});t[_.primaryKey]={timestamp:_.key},_.continue()}}catch(x){return r(x)}})},loadLocalEntry:(e,r)=>{var t,n;try{var a=c.lookupPath(e);n=a.node,t=c.stat(e)}catch(i){return r(i)}return c.isDir(t.mode)?r(null,{timestamp:t.mtime,mode:t.mode}):c.isFile(t.mode)?(n.contents=te.getFileDataAsTypedArray(n),r(null,{timestamp:t.mtime,mode:t.mode,contents:n.contents})):r(new Error("node type not supported"))},storeLocalEntry:(e,r,t)=>{try{if(c.isDir(r.mode))c.mkdirTree(e,r.mode);else if(c.isFile(r.mode))c.writeFile(e,r.contents,{canOwn:!0});else return t(new Error("node type not supported"));c.chmod(e,r.mode),c.utime(e,r.timestamp,r.timestamp)}catch(n){return t(n)}t(null)},removeLocalEntry:(e,r)=>{try{var t=c.stat(e);c.isDir(t.mode)?c.rmdir(e):c.isFile(t.mode)&&c.unlink(e)}catch(n){return r(n)}r(null)},loadRemoteEntry:(e,r,t)=>{var n=e.get(r);n.onsuccess=a=>t(null,a.target.result),n.onerror=a=>{t(a.target.error),a.preventDefault()}},storeRemoteEntry:(e,r,t,n)=>{try{var a=e.put(t,r)}catch(i){n(i);return}a.onsuccess=i=>n(),a.onerror=i=>{n(i.target.error),i.preventDefault()}},removeRemoteEntry:(e,r,t)=>{var n=e.delete(r);n.onsuccess=a=>t(),n.onerror=a=>{t(a.target.error),a.preventDefault()}},reconcile:(e,r,t)=>{var n=0,a=[];Object.keys(e.entries).forEach(function(T){var q=e.entries[T],M=r.entries[T];(!M||q.timestamp.getTime()!=M.timestamp.getTime())&&(a.push(T),n++)});var i=[];if(Object.keys(r.entries).forEach(function(T){e.entries[T]||(i.push(T),n++)}),!n)return t(null);var d=!1,u=e.type==="remote"?e.db:r.db,x=u.transaction([pe.DB_STORE_NAME],"readwrite"),_=x.objectStore(pe.DB_STORE_NAME);function E(T){if(T&&!d)return d=!0,t(T)}x.onerror=T=>{E(this.error),T.preventDefault()},x.oncomplete=T=>{d||t(null)},a.sort().forEach(T=>{r.type==="local"?pe.loadRemoteEntry(_,T,(q,M)=>{if(q)return E(q);pe.storeLocalEntry(T,M,E)}):pe.loadLocalEntry(T,(q,M)=>{if(q)return E(q);pe.storeRemoteEntry(_,T,M,E)})}),i.sort().reverse().forEach(T=>{r.type==="local"?pe.removeLocalEntry(T,E):pe.removeRemoteEntry(_,T,E)})}},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){this.name="ErrnoError",this.errno=e}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(e,r={}){if(e=Ze.resolve(e),!e)return{path:"",node:null};var t={follow_mount:!0,recurse_count:0};if(r=Object.assign(t,r),r.recurse_count>8)throw new c.ErrnoError(32);for(var n=e.split("/").filter(T=>!!T),a=c.root,i="/",d=0;d<n.length;d++){var u=d===n.length-1;if(u&&r.parent)break;if(a=c.lookupNode(a,n[d]),i=se.join2(i,n[d]),c.isMountpoint(a)&&(!u||u&&r.follow_mount)&&(a=a.mounted.root),!u||r.follow)for(var x=0;c.isLink(a.mode);){var _=c.readlink(i);i=Ze.resolve(se.dirname(i),_);var E=c.lookupPath(i,{recurse_count:r.recurse_count+1});if(a=E.node,x++>40)throw new c.ErrnoError(32)}}return{path:i,node:a}},getPath(e){for(var r;;){if(c.isRoot(e)){var t=e.mount.mountpoint;return r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var t=0,n=0;n<r.length;n++)t=(t<<5)-t+r.charCodeAt(n)|0;return(e+t>>>0)%c.nameTable.length},hashAddNode(e){var r=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[r],c.nameTable[r]=e},hashRemoveNode(e){var r=c.hashName(e.parent.id,e.name);if(c.nameTable[r]===e)c.nameTable[r]=e.name_next;else for(var t=c.nameTable[r];t;){if(t.name_next===e){t.name_next=e.name_next;break}t=t.name_next}},lookupNode(e,r){var t=c.mayLookup(e);if(t)throw new c.ErrnoError(t);for(var n=c.hashName(e.id,r),a=c.nameTable[n];a;a=a.name_next){var i=a.name;if(a.parent.id===e.id&&i===r)return a}return c.lookup(e,r)},createNode(e,r,t,n){var a=new c.FSNode(e,r,t,n);return c.hashAddNode(a),a},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return c.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var r=c.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){try{var t=c.lookupNode(e,r);return 20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,r,t){var n;try{n=c.lookupNode(e,r)}catch(i){return i.errno}var a=c.nodePermissions(e,"wx");if(a)return a;if(t){if(!c.isDir(n.mode))return 54;if(c.isRoot(n)||c.getPath(n)===c.cwd())return 10}else if(c.isDir(n.mode))return 31;return 0},mayOpen(e,r){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(r)!=="r"||r&512)?31:c.nodePermissions(e,c.flagsToPermissionString(r)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var r=c.getStream(e);if(!r)throw new c.ErrnoError(8);return r},getStream:e=>c.streams[e],createStream(e,r=-1){return c.FSStream||(c.FSStream=function(){this.shared={}},c.FSStream.prototype={},Object.defineProperties(c.FSStream.prototype,{object:{get(){return this.node},set(t){this.node=t}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(t){this.shared.flags=t}},position:{get(){return this.shared.position},set(t){this.shared.position=t}}})),e=Object.assign(new c.FSStream,e),r==-1&&(r=c.nextfd()),e.fd=r,c.streams[r]=e,e},closeStream(e){c.streams[e]=null},chrdev_stream_ops:{open(e){var t,n;var r=c.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,(n=(t=e.stream_ops).open)==null||n.call(t,e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){c.devices[e]={stream_ops:r}},getDevice:e=>c.devices[e],getMounts(e){for(var r=[],t=[e];t.length;){var n=t.pop();r.push(n),t.push.apply(t,n.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&N(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var t=c.getMounts(c.root.mount),n=0;function a(d){return c.syncFSRequests--,r(d)}function i(d){if(d)return i.errored?void 0:(i.errored=!0,a(d));++n>=t.length&&a(null)}t.forEach(d=>{if(!d.type.syncfs)return i(null);d.type.syncfs(d,e,i)})},mount(e,r,t){var n=t==="/",a=!t,i;if(n&&c.root)throw new c.ErrnoError(10);if(!n&&!a){var d=c.lookupPath(t,{follow_mount:!1});if(t=d.path,i=d.node,c.isMountpoint(i))throw new c.ErrnoError(10);if(!c.isDir(i.mode))throw new c.ErrnoError(54)}var u={type:e,opts:r,mountpoint:t,mounts:[]},x=e.mount(u);return x.mount=u,u.root=x,n?c.root=x:i&&(i.mounted=u,i.mount&&i.mount.mounts.push(u)),x},unmount(e){var r=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(r.node))throw new c.ErrnoError(28);var t=r.node,n=t.mounted,a=c.getMounts(n);Object.keys(c.nameTable).forEach(d=>{for(var u=c.nameTable[d];u;){var x=u.name_next;a.includes(u.mount)&&c.destroyNode(u),u=x}}),t.mounted=null;var i=t.mount.mounts.indexOf(n);t.mount.mounts.splice(i,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,t){var n=c.lookupPath(e,{parent:!0}),a=n.node,i=se.basename(e);if(!i||i==="."||i==="..")throw new c.ErrnoError(28);var d=c.mayCreate(a,i);if(d)throw new c.ErrnoError(d);if(!a.node_ops.mknod)throw new c.ErrnoError(63);return a.node_ops.mknod(a,i,r,t)},create(e,r){return r=r!==void 0?r:438,r&=4095,r|=32768,c.mknod(e,r,0)},mkdir(e,r){return r=r!==void 0?r:511,r&=1023,r|=16384,c.mknod(e,r,0)},mkdirTree(e,r){for(var t=e.split("/"),n="",a=0;a<t.length;++a)if(t[a]){n+="/"+t[a];try{c.mkdir(n,r)}catch(i){if(i.errno!=20)throw i}}},mkdev(e,r,t){return typeof t>"u"&&(t=r,r=438),r|=8192,c.mknod(e,r,t)},symlink(e,r){if(!Ze.resolve(e))throw new c.ErrnoError(44);var t=c.lookupPath(r,{parent:!0}),n=t.node;if(!n)throw new c.ErrnoError(44);var a=se.basename(r),i=c.mayCreate(n,a);if(i)throw new c.ErrnoError(i);if(!n.node_ops.symlink)throw new c.ErrnoError(63);return n.node_ops.symlink(n,a,e)},rename(e,r){var t=se.dirname(e),n=se.dirname(r),a=se.basename(e),i=se.basename(r),d,u,x;if(d=c.lookupPath(e,{parent:!0}),u=d.node,d=c.lookupPath(r,{parent:!0}),x=d.node,!u||!x)throw new c.ErrnoError(44);if(u.mount!==x.mount)throw new c.ErrnoError(75);var _=c.lookupNode(u,a),E=Ze.relative(e,n);if(E.charAt(0)!==".")throw new c.ErrnoError(28);if(E=Ze.relative(r,t),E.charAt(0)!==".")throw new c.ErrnoError(55);var T;try{T=c.lookupNode(x,i)}catch{}if(_!==T){var q=c.isDir(_.mode),M=c.mayDelete(u,a,q);if(M)throw new c.ErrnoError(M);if(M=T?c.mayDelete(x,i,q):c.mayCreate(x,i),M)throw new c.ErrnoError(M);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(_)||T&&c.isMountpoint(T))throw new c.ErrnoError(10);if(x!==u&&(M=c.nodePermissions(u,"w"),M))throw new c.ErrnoError(M);c.hashRemoveNode(_);try{u.node_ops.rename(_,x,i)}catch(z){throw z}finally{c.hashAddNode(_)}}},rmdir(e){var r=c.lookupPath(e,{parent:!0}),t=r.node,n=se.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!0);if(i)throw new c.ErrnoError(i);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.rmdir(t,n),c.destroyNode(a)},readdir(e){var r=c.lookupPath(e,{follow:!0}),t=r.node;if(!t.node_ops.readdir)throw new c.ErrnoError(54);return t.node_ops.readdir(t)},unlink(e){var r=c.lookupPath(e,{parent:!0}),t=r.node;if(!t)throw new c.ErrnoError(44);var n=se.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!1);if(i)throw new c.ErrnoError(i);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.unlink(t,n),c.destroyNode(a)},readlink(e){var r=c.lookupPath(e),t=r.node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return Ze.resolve(c.getPath(t.parent),t.node_ops.readlink(t))},stat(e,r){var t=c.lookupPath(e,{follow:!r}),n=t.node;if(!n)throw new c.ErrnoError(44);if(!n.node_ops.getattr)throw new c.ErrnoError(63);return n.node_ops.getattr(n)},lstat(e){return c.stat(e,!0)},chmod(e,r,t){var n;if(typeof e=="string"){var a=c.lookupPath(e,{follow:!t});n=a.node}else n=e;if(!n.node_ops.setattr)throw new c.ErrnoError(63);n.node_ops.setattr(n,{mode:r&4095|n.mode&-4096,timestamp:Date.now()})},lchmod(e,r){c.chmod(e,r,!0)},fchmod(e,r){var t=c.getStreamChecked(e);c.chmod(t.node,r)},chown(e,r,t,n){var a;if(typeof e=="string"){var i=c.lookupPath(e,{follow:!n});a=i.node}else a=e;if(!a.node_ops.setattr)throw new c.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown(e,r,t){c.chown(e,r,t,!0)},fchown(e,r,t){var n=c.getStreamChecked(e);c.chown(n.node,r,t)},truncate(e,r){if(r<0)throw new c.ErrnoError(28);var t;if(typeof e=="string"){var n=c.lookupPath(e,{follow:!0});t=n.node}else t=e;if(!t.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var a=c.nodePermissions(t,"w");if(a)throw new c.ErrnoError(a);t.node_ops.setattr(t,{size:r,timestamp:Date.now()})},ftruncate(e,r){var t=c.getStreamChecked(e);if(!(t.flags&2097155))throw new c.ErrnoError(28);c.truncate(t.node,r)},utime(e,r,t){var n=c.lookupPath(e,{follow:!0}),a=n.node;a.node_ops.setattr(a,{timestamp:Math.max(r,t)})},open(e,r,t){if(e==="")throw new c.ErrnoError(44);r=typeof r=="string"?ao(r):r,t=typeof t>"u"?438:t,r&64?t=t&4095|32768:t=0;var n;if(typeof e=="object")n=e;else{e=se.normalize(e);try{var a=c.lookupPath(e,{follow:!(r&131072)});n=a.node}catch{}}var i=!1;if(r&64)if(n){if(r&128)throw new c.ErrnoError(20)}else n=c.mknod(e,t,0),i=!0;if(!n)throw new c.ErrnoError(44);if(c.isChrdev(n.mode)&&(r&=-513),r&65536&&!c.isDir(n.mode))throw new c.ErrnoError(54);if(!i){var d=c.mayOpen(n,r);if(d)throw new c.ErrnoError(d)}r&512&&!i&&c.truncate(n,0),r&=-131713;var u=c.createStream({node:n,path:c.getPath(n),flags:r,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),s.logReadFiles&&!(r&1)&&(c.readFiles||(c.readFiles={}),e in c.readFiles||(c.readFiles[e]=1)),u},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(t!=0&&t!=1&&t!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,t),e.ungotten=[],e.position},read(e,r,t,n,a){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var i=typeof a<"u";if(!i)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var d=e.stream_ops.read(e,r,t,n,a);return i||(e.position+=d),d},write(e,r,t,n,a,i){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,r,t,n,a,i);return d||(e.position+=u),u},allocate(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(r<0||t<=0)throw new c.ErrnoError(28);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(!c.isFile(e.node.mode)&&!c.isDir(e.node.mode))throw new c.ErrnoError(43);if(!e.stream_ops.allocate)throw new c.ErrnoError(138);e.stream_ops.allocate(e,r,t)},mmap(e,r,t,n,a){if(n&2&&!(a&2)&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);return e.stream_ops.mmap(e,r,t,n,a)},msync(e,r,t,n,a){return e.stream_ops.msync?e.stream_ops.msync(e,r,t,n,a):0},munmap:e=>0,ioctl(e,r,t){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,r,t)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var t,n=c.open(e,r.flags),a=c.stat(e),i=a.size,d=new Uint8Array(i);return c.read(n,d,0,i,0),r.encoding==="utf8"?t=wr(d,0):r.encoding==="binary"&&(t=d),c.close(n),t},writeFile(e,r,t={}){t.flags=t.flags||577;var n=c.open(e,t.flags,t.mode);if(typeof r=="string"){var a=new Uint8Array(Sr(r)+1),i=mt(r,a,0,a.length);c.write(n,a,0,i,void 0,t.canOwn)}else if(ArrayBuffer.isView(r))c.write(n,r,0,r.byteLength,void 0,t.canOwn);else throw new Error("Unsupported data type");c.close(n)},cwd:()=>c.currentPath,chdir(e){var r=c.lookupPath(e,{follow:!0});if(r.node===null)throw new c.ErrnoError(44);if(!c.isDir(r.node.mode))throw new c.ErrnoError(54);var t=c.nodePermissions(r.node,"x");if(t)throw new c.ErrnoError(t);c.currentPath=r.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(n,a,i,d,u)=>d}),c.mkdev("/dev/null",c.makedev(1,3)),pr.register(c.makedev(5,0),pr.default_tty_ops),pr.register(c.makedev(6,0),pr.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),r=0,t=()=>(r===0&&(r=un(e).byteLength),e[--r]);c.createDevice("/dev","random",t),c.createDevice("/dev","urandom",t),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var r=c.createNode(e,"fd",16895,73);return r.node_ops={lookup(t,n){var a=+n,i=c.getStreamChecked(a),d={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>i.path}};return d.parent=d,d}},r}},{},"/proc/self/fd")},createStandardStreams(){s.stdin?c.createDevice("/dev","stdin",s.stdin):c.symlink("/dev/tty","/dev/stdin"),s.stdout?c.createDevice("/dev","stdout",null,s.stdout):c.symlink("/dev/tty","/dev/stdout"),s.stderr?c.createDevice("/dev","stderr",null,s.stderr):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){[44].forEach(e=>{c.genericErrors[e]=new c.ErrnoError(e),c.genericErrors[e].stack="<generic error, no stack>"}),c.nameTable=new Array(4096),c.mount(te,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:te,IDBFS:pe}},init(e,r,t){c.init.initialized=!0,s.stdin=e||s.stdin,s.stdout=r||s.stdout,s.stderr=t||s.stderr,c.createStandardStreams()},quit(){c.init.initialized=!1;for(var e=0;e<c.streams.length;e++){var r=c.streams[e];r&&c.close(r)}},findObject(e,r){var t=c.analyzePath(e,r);return t.exists?t.object:null},analyzePath(e,r){try{var t=c.lookupPath(e,{follow:!r});e=t.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=c.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=se.basename(e),t=c.lookupPath(e,{follow:!r}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot=t.path==="/"}catch(a){n.error=a.errno}return n},createPath(e,r,t,n){e=typeof e=="string"?e:c.getPath(e);for(var a=r.split("/").reverse();a.length;){var i=a.pop();if(i){var d=se.join2(e,i);try{c.mkdir(d)}catch{}e=d}}return d},createFile(e,r,t,n,a){var i=se.join2(typeof e=="string"?e:c.getPath(e),r),d=gt(n,a);return c.create(i,d)},createDataFile(e,r,t,n,a,i){var d=r;e&&(e=typeof e=="string"?e:c.getPath(e),d=r?se.join2(e,r):e);var u=gt(n,a),x=c.create(d,u);if(t){if(typeof t=="string"){for(var _=new Array(t.length),E=0,T=t.length;E<T;++E)_[E]=t.charCodeAt(E);t=_}c.chmod(x,u|146);var q=c.open(x,577);c.write(q,t,0,t.length,0,i),c.close(q),c.chmod(x,u)}},createDevice(e,r,t,n){var a=se.join2(typeof e=="string"?e:c.getPath(e),r),i=gt(!!t,!!n);c.createDevice.major||(c.createDevice.major=64);var d=c.makedev(c.createDevice.major++,0);return c.registerDevice(d,{open(u){u.seekable=!1},close(u){var x;(x=n==null?void 0:n.buffer)!=null&&x.length&&n(10)},read(u,x,_,E,T){for(var q=0,M=0;M<E;M++){var z;try{z=t()}catch{throw new c.ErrnoError(29)}if(z===void 0&&q===0)throw new c.ErrnoError(6);if(z==null)break;q++,x[_+M]=z}return q&&(u.node.timestamp=Date.now()),q},write(u,x,_,E,T){for(var q=0;q<E;q++)try{n(x[_+q])}catch{throw new c.ErrnoError(29)}return E&&(u.node.timestamp=Date.now()),q}}),c.mkdev(a,i,d)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if($)try{e.contents=pt($(e.url),!0),e.usedBytes=e.contents.length}catch{throw new c.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,r,t,n,a){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(M){if(!(M>this.length-1||M<0)){var z=M%this.chunkSize,J=M/this.chunkSize|0;return this.getter(J)[z]}},i.prototype.setDataGetter=function(M){this.getter=M},i.prototype.cacheLength=function(){var M=new XMLHttpRequest;if(M.open("HEAD",t,!1),M.send(null),!(M.status>=200&&M.status<300||M.status===304))throw new Error("Couldn't load "+t+". Status: "+M.status);var z=Number(M.getResponseHeader("Content-length")),J,xe=(J=M.getResponseHeader("Accept-Ranges"))&&J==="bytes",he=(J=M.getResponseHeader("Content-Encoding"))&&J==="gzip",Se=1024*1024;xe||(Se=z);var be=(Fe,Ge)=>{if(Fe>Ge)throw new Error("invalid range ("+Fe+", "+Ge+") or no bytes requested!");if(Ge>z-1)throw new Error("only "+z+" bytes available! programmer error!");var ye=new XMLHttpRequest;if(ye.open("GET",t,!1),z!==Se&&ye.setRequestHeader("Range","bytes="+Fe+"-"+Ge),ye.responseType="arraybuffer",ye.overrideMimeType&&ye.overrideMimeType("text/plain; charset=x-user-defined"),ye.send(null),!(ye.status>=200&&ye.status<300||ye.status===304))throw new Error("Couldn't load "+t+". Status: "+ye.status);return ye.response!==void 0?new Uint8Array(ye.response||[]):pt(ye.responseText||"")},_e=this;_e.setDataGetter(Fe=>{var Ge=Fe*Se,ye=(Fe+1)*Se-1;if(ye=Math.min(ye,z-1),typeof _e.chunks[Fe]>"u"&&(_e.chunks[Fe]=be(Ge,ye)),typeof _e.chunks[Fe]>"u")throw new Error("doXHR failed!");return _e.chunks[Fe]}),(he||!z)&&(Se=z=1,z=this.getter(0).length,Se=z,D("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=z,this._chunkSize=Se,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var d,u}else var u={isDevice:!1,url:t};var x=c.createFile(e,r,u,n,a);u.contents?x.contents=u.contents:u.url&&(x.contents=null,x.url=u.url),Object.defineProperties(x,{usedBytes:{get:function(){return this.contents.length}}});var _={},E=Object.keys(x.stream_ops);E.forEach(q=>{var M=x.stream_ops[q];_[q]=function(){return c.forceLoadFile(x),M.apply(null,arguments)}});function T(q,M,z,J,xe){var he=q.node.contents;if(xe>=he.length)return 0;var Se=Math.min(he.length-xe,J);if(he.slice)for(var be=0;be<Se;be++)M[z+be]=he[xe+be];else for(var be=0;be<Se;be++)M[z+be]=he.get(xe+be);return Se}return _.read=(q,M,z,J,xe)=>(c.forceLoadFile(x),T(q,M,z,J,xe)),_.mmap=(q,M,z,J,xe)=>{c.forceLoadFile(x);var he=mn(M);if(!he)throw new c.ErrnoError(48);return T(q,P,he,M,z),{ptr:he,allocated:!0}},x.stream_ops=_,x}},Pe=(e,r)=>e?wr(O,e,r):"",re={DEFAULT_POLLMASK:5,calculateAt(e,r,t){if(se.isAbs(r))return r;var n;if(e===-100)n=c.cwd();else{var a=re.getStreamFromFD(e);n=a.path}if(r.length==0){if(!t)throw new c.ErrnoError(44);return n}return se.join2(n,r)},doStat(e,r,t){var n=e(r);m[t>>2]=n.dev,m[t+4>>2]=n.mode,ee[t+8>>2]=n.nlink,m[t+12>>2]=n.uid,m[t+16>>2]=n.gid,m[t+20>>2]=n.rdev,me=[n.size>>>0,(Z=n.size,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+24>>2]=me[0],m[t+28>>2]=me[1],m[t+32>>2]=4096,m[t+36>>2]=n.blocks;var a=n.atime.getTime(),i=n.mtime.getTime(),d=n.ctime.getTime();return me=[Math.floor(a/1e3)>>>0,(Z=Math.floor(a/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+40>>2]=me[0],m[t+44>>2]=me[1],ee[t+48>>2]=a%1e3*1e3,me=[Math.floor(i/1e3)>>>0,(Z=Math.floor(i/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+56>>2]=me[0],m[t+60>>2]=me[1],ee[t+64>>2]=i%1e3*1e3,me=[Math.floor(d/1e3)>>>0,(Z=Math.floor(d/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+72>>2]=me[0],m[t+76>>2]=me[1],ee[t+80>>2]=d%1e3*1e3,me=[n.ino>>>0,(Z=n.ino,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+88>>2]=me[0],m[t+92>>2]=me[1],0},doMsync(e,r,t,n,a){if(!c.isFile(r.node.mode))throw new c.ErrnoError(43);if(n&2)return 0;var i=O.slice(e,e+t);c.msync(r,i,a,t,n)},varargs:void 0,get(){var e=m[+re.varargs>>2];return re.varargs+=4,e},getp(){return re.get()},getStr(e){var r=Pe(e);return r},getStreamFromFD(e){var r=c.getStreamChecked(e);return r}};function oo(e,r,t){re.varargs=t;try{var n=re.getStreamFromFD(e);switch(r){case 0:{var a=re.get();if(a<0)return-28;for(;c.streams[a];)a++;var i;return i=c.createStream(n,a),i.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var a=re.get();return n.flags|=a,0}case 12:{var a=re.getp(),d=0;return A[a+d>>1]=2,0}case 13:case 14:return 0}return-28}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function so(e,r){try{var t=re.getStreamFromFD(e);return re.doStat(c.stat,t.path,r)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var Cr=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function io(e,r,t){var n=Cr(r,t);try{return isNaN(n)?61:(c.ftruncate(e,n),0)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var ge=(e,r,t)=>mt(e,O,r,t);function lo(e,r){try{if(r===0)return-28;var t=c.cwd(),n=Sr(t)+1;return r<n?-68:(ge(t,e,r),n)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function co(e,r,t){try{var n=re.getStreamFromFD(e);n.getdents||(n.getdents=c.readdir(n.path));for(var a=280,i=0,d=c.llseek(n,0,1),u=Math.floor(d/a);u<n.getdents.length&&i+a<=t;){var x,_,E=n.getdents[u];if(E===".")x=n.node.id,_=4;else if(E===".."){var T=c.lookupPath(n.path,{parent:!0});x=T.node.id,_=4}else{var q=c.lookupNode(n.node,E);x=q.id,_=c.isChrdev(q.mode)?2:c.isDir(q.mode)?4:c.isLink(q.mode)?10:8}me=[x>>>0,(Z=x,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[r+i>>2]=me[0],m[r+i+4>>2]=me[1],me=[(u+1)*a>>>0,(Z=(u+1)*a,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[r+i+8>>2]=me[0],m[r+i+12>>2]=me[1],A[r+i+16>>1]=280,P[r+i+18>>0]=_,ge(E,r+i+19,256),i+=a,u+=1}return c.llseek(n,u*a,0),i}catch(M){if(typeof c>"u"||M.name!=="ErrnoError")throw M;return-M.errno}}function uo(e,r,t){re.varargs=t;try{var n=re.getStreamFromFD(e);switch(r){case 21509:return n.tty?0:-59;case 21505:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var a=n.tty.ops.ioctl_tcgets(n),i=re.getp();m[i>>2]=a.c_iflag||0,m[i+4>>2]=a.c_oflag||0,m[i+8>>2]=a.c_cflag||0,m[i+12>>2]=a.c_lflag||0;for(var d=0;d<32;d++)P[i+d+17>>0]=a.c_cc[d]||0;return 0}return 0}case 21510:case 21511:case 21512:return n.tty?0:-59;case 21506:case 21507:case 21508:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){for(var i=re.getp(),u=m[i>>2],x=m[i+4>>2],_=m[i+8>>2],E=m[i+12>>2],T=[],d=0;d<32;d++)T.push(P[i+d+17>>0]);return n.tty.ops.ioctl_tcsets(n.tty,r,{c_iflag:u,c_oflag:x,c_cflag:_,c_lflag:E,c_cc:T})}return 0}case 21519:{if(!n.tty)return-59;var i=re.getp();return m[i>>2]=0,0}case 21520:return n.tty?-28:-59;case 21531:{var i=re.getp();return c.ioctl(n,r,i)}case 21523:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var q=n.tty.ops.ioctl_tiocgwinsz(n.tty),i=re.getp();A[i>>1]=q[0],A[i+2>>1]=q[1]}return 0}case 21524:return n.tty?0:-59;case 21515:return n.tty?0:-59;default:return-28}}catch(M){if(typeof c>"u"||M.name!=="ErrnoError")throw M;return-M.errno}}function fo(e,r){try{return e=re.getStr(e),re.doStat(c.lstat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function mo(e,r,t){try{return r=re.getStr(r),r=re.calculateAt(e,r),r=se.normalize(r),r[r.length-1]==="/"&&(r=r.substr(0,r.length-1)),c.mkdir(r,t,0),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function po(e,r,t,n){try{r=re.getStr(r);var a=n&256,i=n&4096;return n=n&-6401,r=re.calculateAt(e,r,i),re.doStat(a?c.lstat:c.stat,r,t)}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function ho(e,r,t,n){re.varargs=n;try{r=re.getStr(r),r=re.calculateAt(e,r);var a=n?re.get():0;return c.open(r,t,a).fd}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function go(e,r,t,n){try{if(r=re.getStr(r),r=re.calculateAt(e,r),n<=0)return-28;var a=c.readlink(r),i=Math.min(n,Sr(a)),d=P[t+i];return ge(a,t,n+1),P[t+i]=d,i}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function vo(e){try{return e=re.getStr(e),c.rmdir(e),0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function xo(e,r){try{return e=re.getStr(e),re.doStat(c.stat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function bo(e,r,t){try{return r=re.getStr(r),r=re.calculateAt(e,r),t===0?c.unlink(r):t===512?c.rmdir(r):ar("Invalid flags passed to unlinkat"),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var pn=e=>ee[e>>2]+m[e+4>>2]*4294967296;function _o(e,r,t,n){try{if(r=re.getStr(r),r=re.calculateAt(e,r,!0),t){var d=pn(t),u=m[t+8>>2];a=d*1e3+u/(1e3*1e3),t+=16,d=pn(t),u=m[t+8>>2],i=d*1e3+u/(1e3*1e3)}else var a=Date.now(),i=a;return c.utime(r,a,i),0}catch(x){if(typeof c>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}var yo=1,wo=()=>yo,So=()=>{throw 1/0},Co=e=>e%4===0&&(e%100!==0||e%400===0),Eo=[0,31,60,91,121,152,182,213,244,274,305,335],ko=[0,31,59,90,120,151,181,212,243,273,304,334],hn=e=>{var r=Co(e.getFullYear()),t=r?Eo:ko,n=t[e.getMonth()]+e.getDate()-1;return n};function jo(e,r,t){var n=Cr(e,r),a=new Date(n*1e3);m[t>>2]=a.getSeconds(),m[t+4>>2]=a.getMinutes(),m[t+8>>2]=a.getHours(),m[t+12>>2]=a.getDate(),m[t+16>>2]=a.getMonth(),m[t+20>>2]=a.getFullYear()-1900,m[t+24>>2]=a.getDay();var i=hn(a)|0;m[t+28>>2]=i,m[t+36>>2]=-(a.getTimezoneOffset()*60);var d=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),x=d.getTimezoneOffset(),_=(u!=x&&a.getTimezoneOffset()==Math.min(x,u))|0;m[t+32>>2]=_}var Fo=function(e){var r=(()=>{var t=new Date(m[e+20>>2]+1900,m[e+16>>2],m[e+12>>2],m[e+8>>2],m[e+4>>2],m[e>>2],0),n=m[e+32>>2],a=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),d=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),x=Math.min(u,d);if(n<0)m[e+32>>2]=+(d!=u&&x==a);else if(n>0!=(x==a)){var _=Math.max(u,d),E=n>0?x:_;t.setTime(t.getTime()+(E-a)*6e4)}m[e+24>>2]=t.getDay();var T=hn(t)|0;m[e+28>>2]=T,m[e>>2]=t.getSeconds(),m[e+4>>2]=t.getMinutes(),m[e+8>>2]=t.getHours(),m[e+12>>2]=t.getDate(),m[e+16>>2]=t.getMonth(),m[e+20>>2]=t.getYear();var q=t.getTime();return isNaN(q)?-1:q/1e3})();return Xn((Z=r,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)),r>>>0};function Lo(e,r,t,n,a,i,d,u){var x=Cr(a,i);try{if(isNaN(x))return 61;var _=re.getStreamFromFD(n),E=c.mmap(_,e,x,r,t),T=E.ptr;return m[d>>2]=E.allocated,ee[u>>2]=T,0}catch(q){if(typeof c>"u"||q.name!=="ErrnoError")throw q;return-q.errno}}function Ro(e,r,t,n,a,i,d){var u=Cr(i,d);try{return isNaN(u)?61:(re.doMsync(e,re.getStreamFromFD(a),r,n,u),0)}catch(x){if(typeof c>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function To(e,r,t,n,a,i,d){var u=Cr(i,d);try{if(isNaN(u))return 61;var x=re.getStreamFromFD(a);t&2&&re.doMsync(e,x,r,n,u),c.munmap(x)}catch(_){if(typeof c>"u"||_.name!=="ErrnoError")throw _;return-_.errno}}var Ke=e=>{var r=Sr(e)+1,t=Ue(r);return t&&ge(e,t,r),t},Po=(e,r,t)=>{var n=new Date().getFullYear(),a=new Date(n,0,1),i=new Date(n,6,1),d=a.getTimezoneOffset(),u=i.getTimezoneOffset(),x=Math.max(d,u);ee[e>>2]=x*60,m[r>>2]=+(d!=u);function _(z){var J=z.toTimeString().match(/\(([A-Za-z ]+)\)$/);return J?J[1]:"GMT"}var E=_(a),T=_(i),q=Ke(E),M=Ke(T);u<d?(ee[t>>2]=q,ee[t+4>>2]=M):(ee[t>>2]=M,ee[t+4>>2]=q)},Mo=()=>{ar("")},Er=(e,r)=>{if(j.mainLoop.timingMode=e,j.mainLoop.timingValue=r,!j.mainLoop.func)return 1;if(j.mainLoop.running||(j.mainLoop.running=!0),e==0)j.mainLoop.scheduler=function(){var d=Math.max(0,j.mainLoop.tickStartTime+r-Ur())|0;setTimeout(j.mainLoop.runner,d)},j.mainLoop.method="timeout";else if(e==1)j.mainLoop.scheduler=function(){j.requestAnimationFrame(j.mainLoop.runner)},j.mainLoop.method="rAF";else if(e==2){if(typeof j.setImmediate>"u")if(typeof setImmediate>"u"){var t=[],n="setimmediate",a=i=>{(i.data===n||i.data.target===n)&&(i.stopPropagation(),t.shift()())};addEventListener("message",a,!0),j.setImmediate=function(d){t.push(d),postMessage(n,"*")}}else j.setImmediate=setImmediate;j.mainLoop.scheduler=function(){j.setImmediate(j.mainLoop.runner)},j.mainLoop.method="immediate"}return 0},Ur;Ur=()=>performance.now();var gn=(e,r,t,n,a)=>{H(!j.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),j.mainLoop.func=e,j.mainLoop.arg=n;var i=j.mainLoop.currentlyRunningMainloop;function d(){return!(i<j.mainLoop.currentlyRunningMainloop)}if(j.mainLoop.running=!1,j.mainLoop.runner=function(){var T,q;if(!X){if(j.mainLoop.queue.length>0){var x=j.mainLoop.queue.shift();if(x.func(x.arg),j.mainLoop.remainingBlockers){var _=j.mainLoop.remainingBlockers,E=_%1==0?_-1:Math.floor(_);x.counted?j.mainLoop.remainingBlockers=E:(E=E+.5,j.mainLoop.remainingBlockers=(8*_+E)/9)}if(j.mainLoop.updateStatus(),!d())return;setTimeout(j.mainLoop.runner,0);return}if(d()){if(j.mainLoop.currentFrameNumber=j.mainLoop.currentFrameNumber+1|0,j.mainLoop.timingMode==1&&j.mainLoop.timingValue>1&&j.mainLoop.currentFrameNumber%j.mainLoop.timingValue!=0){j.mainLoop.scheduler();return}else j.mainLoop.timingMode==0&&(j.mainLoop.tickStartTime=Ur());j.mainLoop.runIter(e),d()&&(typeof SDL=="object"&&((q=(T=SDL.audio)==null?void 0:T.queueNewAudioData)==null||q.call(T)),j.mainLoop.scheduler())}}},a||(r&&r>0?Er(0,1e3/r):Er(1,1),j.mainLoop.scheduler()),t)throw"unwind"},vt=e=>{if(e instanceof cn||e=="unwind")return U;S(1,e)},Ao=0,vn=()=>Ka||Ao>0,Do=e=>{var r;U=e,vn()||((r=s.onExit)==null||r.call(s,e),X=!0),S(e,new cn(e))},xn=(e,r)=>{U=e,Do(e)},bn=xn,Io=()=>{if(!vn())try{bn(U)}catch(e){vt(e)}},xt=e=>{if(!X)try{e(),Io()}catch(r){vt(r)}},_n=(e,r)=>setTimeout(()=>{xt(e)},r),j={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){j.mainLoop.scheduler=null,j.mainLoop.currentlyRunningMainloop++},resume(){j.mainLoop.currentlyRunningMainloop++;var e=j.mainLoop.timingMode,r=j.mainLoop.timingValue,t=j.mainLoop.func;j.mainLoop.func=null,gn(t,0,!1,j.mainLoop.arg,!0),Er(e,r),j.mainLoop.scheduler()},updateStatus(){if(s.setStatus){var e=s.statusMessage||"Please wait...",r=j.mainLoop.remainingBlockers,t=j.mainLoop.expectedBlockers;r?r<t?s.setStatus(e+" ("+(t-r)+"/"+t+")"):s.setStatus(e):s.setStatus("")}},runIter(e){var t;if(!X){if(s.preMainLoop){var r=s.preMainLoop();if(r===!1)return}xt(e),(t=s.postMainLoop)==null||t.call(s)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(j.initted)return;j.initted=!0;var e={};e.canHandle=function(i){return!s.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(i)},e.handle=function(i,d,u,x){var _=new Blob([i],{type:j.getMimetype(d)});_.size!==i.length&&(_=new Blob([new Uint8Array(i).buffer],{type:j.getMimetype(d)}));var E=URL.createObjectURL(_),T=new Image;T.onload=()=>{H(T.complete,`Image ${d} could not be decoded`);var q=document.createElement("canvas");q.width=T.width,q.height=T.height;var M=q.getContext("2d");M.drawImage(T,0,0),URL.revokeObjectURL(E),u==null||u(i)},T.onerror=q=>{N(`Image ${E} could not be decoded`),x==null||x()},T.src=E},ht.push(e);var r={};r.canHandle=function(i){return!s.noAudioDecoding&&i.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(i,d,u,x){var _=!1;function E(z){_||(_=!0,u==null||u(i))}var T=new Blob([i],{type:j.getMimetype(d)}),q=URL.createObjectURL(T),M=new Audio;M.addEventListener("canplaythrough",()=>E(),!1),M.onerror=function(J){if(_)return;N(`warning: browser could not fully decode audio ${d}, trying slower base64 approach`);function xe(he){for(var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",be="=",_e="",Fe=0,Ge=0,ye=0;ye<he.length;ye++)for(Fe=Fe<<8|he[ye],Ge+=8;Ge>=6;){var rp=Fe>>Ge-6&63;Ge-=6,_e+=Se[rp]}return Ge==2?(_e+=Se[(Fe&3)<<4],_e+=be+be):Ge==4&&(_e+=Se[(Fe&15)<<2],_e+=be),_e}M.src="data:audio/x-"+d.substr(-3)+";base64,"+xe(i),E()},M.src=q,_n(()=>{E()},1e4)},ht.push(r);function t(){j.pointerLock=document.pointerLockElement===s.canvas||document.mozPointerLockElement===s.canvas||document.webkitPointerLockElement===s.canvas||document.msPointerLockElement===s.canvas}var n=s.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),s.elementPointerLock&&n.addEventListener("click",a=>{!j.pointerLock&&s.canvas.requestPointerLock&&(s.canvas.requestPointerLock(),a.preventDefault())},!1))},createContext(e,r,t,n){if(r&&s.ctx&&e==s.canvas)return s.ctx;var a,i;if(r){var d={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var u in n)d[u]=n[u];typeof F<"u"&&(i=F.createContext(e,d),i&&(a=F.getContext(i).GLctx))}else a=e.getContext("2d");return a?(t&&(r||H(typeof y>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),s.ctx=a,r&&F.makeContextCurrent(i),s.useWebGL=r,j.moduleContextCreatedCallbacks.forEach(x=>x()),j.init()),a):null},destroyContext(e,r,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(e,r){j.lockPointer=e,j.resizeCanvas=r,typeof j.lockPointer>"u"&&(j.lockPointer=!0),typeof j.resizeCanvas>"u"&&(j.resizeCanvas=!1);var t=s.canvas;function n(){var d,u;j.isFullscreen=!1;var i=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===i?(t.exitFullscreen=j.exitFullscreen,j.lockPointer&&t.requestPointerLock(),j.isFullscreen=!0,j.resizeCanvas?j.setFullscreenCanvasSize():j.updateCanvasDimensions(t)):(i.parentNode.insertBefore(t,i),i.parentNode.removeChild(i),j.resizeCanvas?j.setWindowedCanvasSize():j.updateCanvasDimensions(t)),(d=s.onFullScreen)==null||d.call(s,j.isFullscreen),(u=s.onFullscreen)==null||u.call(s,j.isFullscreen)}j.fullscreenHandlersInstalled||(j.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?()=>a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(a.webkitRequestFullScreen?()=>a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),a.requestFullscreen()},exitFullscreen(){if(!j.isFullscreen)return!1;var e=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return e.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(e){var r=Date.now();if(j.nextRAF===0)j.nextRAF=r+1e3/60;else for(;r+2>=j.nextRAF;)j.nextRAF+=1e3/60;var t=Math.max(j.nextRAF-r,0);setTimeout(e,t)},requestAnimationFrame(e){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(e);return}var r=j.fakeRequestAnimationFrame;r(e)},safeSetTimeout(e,r){return _n(e,r)},safeRequestAnimationFrame(e){return j.requestAnimationFrame(()=>{xt(e)})},getMimetype(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta(e){var r=0;switch(e.type){case"DOMMouseScroll":r=e.detail/3;break;case"mousewheel":r=e.wheelDelta/120;break;case"wheel":switch(r=e.deltaY,e.deltaMode){case 0:r/=100;break;case 1:r/=3;break;case 2:r*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return r},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(e,r){var t=s.canvas.getBoundingClientRect(),n=s.canvas.width,a=s.canvas.height,i=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,d=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset,u=e-(i+t.left),x=r-(d+t.top);return u=u*(n/t.width),x=x*(a/t.height),{x:u,y:x}},setMouseCoords(e,r){const{x:t,y:n}=j.calculateMouseCoords(e,r);j.mouseMovementX=t-j.mouseX,j.mouseMovementY=n-j.mouseY,j.mouseX=t,j.mouseY=n},calculateMouseEvent(e){if(j.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?j.mouseMovementX=j.mouseMovementY=0:(j.mouseMovementX=j.getMovementX(e),j.mouseMovementY=j.getMovementY(e)),typeof SDL<"u"?(j.mouseX=SDL.mouseX+j.mouseMovementX,j.mouseY=SDL.mouseY+j.mouseMovementY):(j.mouseX+=j.mouseMovementX,j.mouseY+=j.mouseMovementY);else{if(e.type==="touchstart"||e.type==="touchend"||e.type==="touchmove"){var r=e.touch;if(r===void 0)return;var t=j.calculateMouseCoords(r.pageX,r.pageY);if(e.type==="touchstart")j.lastTouches[r.identifier]=t,j.touches[r.identifier]=t;else if(e.type==="touchend"||e.type==="touchmove"){var n=j.touches[r.identifier];n||(n=t),j.lastTouches[r.identifier]=n,j.touches[r.identifier]=t}return}j.setMouseCoords(e.pageX,e.pageY)}},resizeListeners:[],updateResizeListeners(){var e=s.canvas;j.resizeListeners.forEach(r=>r(e.width,e.height))},setCanvasSize(e,r,t){var n=s.canvas;j.updateCanvasDimensions(n,e,r),t||j.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var e=ee[SDL.screen>>2];e=e|8388608,m[SDL.screen>>2]=e}j.updateCanvasDimensions(s.canvas),j.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var e=ee[SDL.screen>>2];e=e&-8388609,m[SDL.screen>>2]=e}j.updateCanvasDimensions(s.canvas),j.updateResizeListeners()},updateCanvasDimensions(e,r,t){r&&t?(e.widthNative=r,e.heightNative=t):(r=e.widthNative,t=e.heightNative);var n=r,a=t;if(s.forcedAspectRatio&&s.forcedAspectRatio>0&&(n/a<s.forcedAspectRatio?n=Math.round(a*s.forcedAspectRatio):a=Math.round(n/s.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&typeof screen<"u"){var i=Math.min(screen.width/n,screen.height/a);n=Math.round(n*i),a=Math.round(a*i)}j.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=a&&(e.height=a),typeof e.style<"u"&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=r&&(e.width=r),e.height!=t&&(e.height=t),typeof e.style<"u"&&(n!=r||a!=t?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}},W={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode(e){W.errorCode=e},chooseConfig(e,r,t,n,a){if(e!=62e3)return W.setErrorCode(12296),0;if(r)for(;;){var i=m[r>>2];if(i==12321){var d=m[r+4>>2];W.contextAttributes.alpha=d>0}else if(i==12325){var u=m[r+4>>2];W.contextAttributes.depth=u>0}else if(i==12326){var x=m[r+4>>2];W.contextAttributes.stencil=x>0}else if(i==12337){var _=m[r+4>>2];W.contextAttributes.antialias=_>0}else if(i==12338){var _=m[r+4>>2];W.contextAttributes.antialias=_==1}else if(i==12544){var E=m[r+4>>2];W.contextAttributes.lowLatency=E!=12547}else if(i==12344)break;r+=8}return(!t||!n)&&!a?(W.setErrorCode(12300),0):(a&&(m[a>>2]=1),t&&n>0&&(ee[t>>2]=62002),W.setErrorCode(12288),1)}},Bo=e=>e==12448?(W.setErrorCode(12288),1):(W.setErrorCode(12300),0),$o=(e,r,t,n,a)=>W.chooseConfig(e,r,t,n,a),No=e=>{var r=e.getExtension("ANGLE_instanced_arrays");if(r)return e.vertexAttribDivisor=(t,n)=>r.vertexAttribDivisorANGLE(t,n),e.drawArraysInstanced=(t,n,a,i)=>r.drawArraysInstancedANGLE(t,n,a,i),e.drawElementsInstanced=(t,n,a,i,d)=>r.drawElementsInstancedANGLE(t,n,a,i,d),1},Uo=e=>{var r=e.getExtension("OES_vertex_array_object");if(r)return e.createVertexArray=()=>r.createVertexArrayOES(),e.deleteVertexArray=t=>r.deleteVertexArrayOES(t),e.bindVertexArray=t=>r.bindVertexArrayOES(t),e.isVertexArray=t=>r.isVertexArrayOES(t),1},Oo=e=>{var r=e.getExtension("WEBGL_draw_buffers");if(r)return e.drawBuffers=(t,n)=>r.drawBuffersWEBGL(t,n),1},zo=e=>!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")),yn=function(e){var r=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_half_float","EXT_float_blend","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw"];return(e.getSupportedExtensions()||[]).filter(t=>r.includes(t))},F={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(r){F.lastError||(F.lastError=r)},getNewId:e=>{for(var r=F.counter++,t=e.length;t<r;t++)e[t]=null;return r},getSource:(e,r,t,n)=>{for(var a="",i=0;i<r;++i){var d=n?ee[n+i*4>>2]:void 0;a+=Pe(ee[t+i*4>>2],d)}return a},createContext:(e,r)=>{if(!e.getContextSafariWebGL2Fixed){let a=function(i,d){var u=e.getContextSafariWebGL2Fixed(i,d);return i=="webgl"==u instanceof WebGLRenderingContext?u:null};e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=a}var t=e.getContext("webgl",r);if(!t)return 0;var n=F.registerContext(t,r);return n},registerContext:(e,r)=>{var t=F.getNewId(F.contexts),n={handle:t,attributes:r,version:r.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),F.contexts[t]=n,(typeof r.enableExtensionsByDefault>"u"||r.enableExtensionsByDefault)&&F.initExtensions(n),t},makeContextCurrent:e=>{var r;return F.currentContext=F.contexts[e],s.ctx=y=(r=F.currentContext)==null?void 0:r.GLctx,!(e&&!y)},getContext:e=>F.contexts[e],deleteContext:e=>{F.currentContext===F.contexts[e]&&(F.currentContext=null),typeof B=="object"&&B.removeAllHandlersOnTarget(F.contexts[e].GLctx.canvas),F.contexts[e]&&F.contexts[e].GLctx.canvas&&(F.contexts[e].GLctx.canvas.GLctxObject=void 0),F.contexts[e]=null},initExtensions:e=>{if(e||(e=F.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var r=e.GLctx;No(r),Uo(r),Oo(r),r.disjointTimerQueryExt=r.getExtension("EXT_disjoint_timer_query"),zo(r),yn(r).forEach(t=>{!t.includes("lose_context")&&!t.includes("debug")&&r.getExtension(t)})}}},Go=(e,r,t,n)=>{if(e!=62e3)return W.setErrorCode(12296),0;for(var a=1;;){var i=m[n>>2];if(i==12440)a=m[n+4>>2];else{if(i==12344)break;return W.setErrorCode(12292),0}n+=8}return a!=2?(W.setErrorCode(12293),0):(W.contextAttributes.majorVersion=a-1,W.contextAttributes.minorVersion=0,W.context=F.createContext(s.canvas,W.contextAttributes),W.context!=0?(W.setErrorCode(12288),F.makeContextCurrent(W.context),s.useWebGL=!0,j.moduleContextCreatedCallbacks.forEach(function(d){d()}),F.makeContextCurrent(null),62004):(W.setErrorCode(12297),0))},qo=(e,r,t,n)=>e!=62e3?(W.setErrorCode(12296),0):r!=62002?(W.setErrorCode(12293),0):(W.setErrorCode(12288),62006),Vo=(e,r)=>e!=62e3?(W.setErrorCode(12296),0):r!=62004?(W.setErrorCode(12294),0):(F.deleteContext(W.context),W.setErrorCode(12288),W.currentContext==r&&(W.currentContext=0),1),Ho=(e,r)=>e!=62e3?(W.setErrorCode(12296),0):r!=62006?(W.setErrorCode(12301),1):(W.currentReadSurface==r&&(W.currentReadSurface=0),W.currentDrawSurface==r&&(W.currentDrawSurface=0),W.setErrorCode(12288),1),Wo=(e,r,t,n)=>{if(e!=62e3)return W.setErrorCode(12296),0;if(r!=62002)return W.setErrorCode(12293),0;if(!n)return W.setErrorCode(12300),0;switch(W.setErrorCode(12288),t){case 12320:return m[n>>2]=W.contextAttributes.alpha?32:24,1;case 12321:return m[n>>2]=W.contextAttributes.alpha?8:0,1;case 12322:return m[n>>2]=8,1;case 12323:return m[n>>2]=8,1;case 12324:return m[n>>2]=8,1;case 12325:return m[n>>2]=W.contextAttributes.depth?24:0,1;case 12326:return m[n>>2]=W.contextAttributes.stencil?8:0,1;case 12327:return m[n>>2]=12344,1;case 12328:return m[n>>2]=62002,1;case 12329:return m[n>>2]=0,1;case 12330:return m[n>>2]=4096,1;case 12331:return m[n>>2]=16777216,1;case 12332:return m[n>>2]=4096,1;case 12333:return m[n>>2]=0,1;case 12334:return m[n>>2]=0,1;case 12335:return m[n>>2]=12344,1;case 12337:return m[n>>2]=W.contextAttributes.antialias?4:0,1;case 12338:return m[n>>2]=W.contextAttributes.antialias?1:0,1;case 12339:return m[n>>2]=4,1;case 12340:return m[n>>2]=12344,1;case 12341:case 12342:case 12343:return m[n>>2]=-1,1;case 12345:case 12346:return m[n>>2]=0,1;case 12347:return m[n>>2]=0,1;case 12348:return m[n>>2]=1,1;case 12349:case 12350:return m[n>>2]=0,1;case 12351:return m[n>>2]=12430,1;case 12352:return m[n>>2]=4,1;case 12354:return m[n>>2]=0,1;default:return W.setErrorCode(12292),0}},Xo=e=>(W.setErrorCode(12288),e!=0&&e!=1?0:62e3),Ko=()=>W.errorCode,Yo=(e,r,t)=>e!=62e3?(W.setErrorCode(12296),0):(r&&(m[r>>2]=1),t&&(m[t>>2]=4),W.defaultDisplayInitialized=!0,W.setErrorCode(12288),1),Qo=(e,r,t,n)=>e!=62e3?(W.setErrorCode(12296),0):n!=0&&n!=62004?(W.setErrorCode(12294),0):t!=0&&t!=62006||r!=0&&r!=62006?(W.setErrorCode(12301),0):(F.makeContextCurrent(n?W.context:null),W.currentContext=n,W.currentDrawSurface=r,W.currentReadSurface=t,W.setErrorCode(12288),1),Jo=(e,r)=>{if(e!=62e3)return W.setErrorCode(12296),0;if(W.setErrorCode(12288),W.stringCache[r])return W.stringCache[r];var t;switch(r){case 12371:t=Ke("Emscripten");break;case 12372:t=Ke("1.4 Emscripten EGL");break;case 12373:t=Ke("");break;case 12429:t=Ke("OpenGL_ES");break;default:return W.setErrorCode(12300),0}return W.stringCache[r]=t,t},Zo=(e,r)=>{if(!W.defaultDisplayInitialized)W.setErrorCode(12289);else if(!s.ctx)W.setErrorCode(12290);else if(s.ctx.isContextLost())W.setErrorCode(12302);else return W.setErrorCode(12288),1;return 0},es=(e,r)=>e!=62e3?(W.setErrorCode(12296),0):(r==0?Er(0,0):Er(1,r),W.setErrorCode(12288),1),rs=e=>e!=62e3?(W.setErrorCode(12296),0):(W.currentContext=0,W.currentReadSurface=0,W.currentDrawSurface=0,W.defaultDisplayInitialized=!1,W.setErrorCode(12288),1),ts=()=>(W.setErrorCode(12288),1),ns=ts,as=e=>(W.setErrorCode(12288),1),bt=[],wn=(e,r)=>{bt.length=0;for(var t;t=O[e++];){var n=t!=105;n&=t!=112,r+=n&&r%8?4:0,bt.push(t==112?ee[r>>2]:t==105?m[r>>2]:ce[r>>3]),r+=n?8:4}return bt},os=(e,r,t)=>{var n=wn(r,t);return ln[e].apply(null,n)},ss=(e,r,t)=>os(e,r,t),is=(e,r,t,n)=>{var a=wn(r,t);return ln[e].apply(null,a)},ls=(e,r,t)=>is(e,r,t),cs=()=>Date.now(),Sn=e=>{var r=Oe(),t=e();return ze(r),t},B={removeAllEventListeners(){for(;B.eventHandlers.length;)B._removeHandler(B.eventHandlers.length-1);B.deferredCalls=[]},inEventHandler:0,deferredCalls:[],deferCall(e,r,t){function n(d,u){if(d.length!=u.length)return!1;for(var x in d)if(d[x]!=u[x])return!1;return!0}for(var a in B.deferredCalls){var i=B.deferredCalls[a];if(i.targetFunction==e&&n(i.argsList,t))return}B.deferredCalls.push({targetFunction:e,precedence:r,argsList:t}),B.deferredCalls.sort((d,u)=>d.precedence<u.precedence)},removeDeferredCalls(e){for(var r=0;r<B.deferredCalls.length;++r)B.deferredCalls[r].targetFunction==e&&(B.deferredCalls.splice(r,1),--r)},canPerformEventHandlerRequests(){return navigator.userActivation?navigator.userActivation.isActive:B.inEventHandler&&B.currentEventHandler.allowsDeferredCalls},runDeferredCalls(){if(B.canPerformEventHandlerRequests())for(var e=0;e<B.deferredCalls.length;++e){var r=B.deferredCalls[e];B.deferredCalls.splice(e,1),--e,r.targetFunction.apply(null,r.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(e,r)=>{for(var t=0;t<B.eventHandlers.length;++t)B.eventHandlers[t].target==e&&(!r||r==B.eventHandlers[t].eventTypeString)&&B._removeHandler(t--)},_removeHandler(e){var r=B.eventHandlers[e];r.target.removeEventListener(r.eventTypeString,r.eventListenerFunc,r.useCapture),B.eventHandlers.splice(e,1)},registerOrRemoveHandler(e){if(!e.target)return-4;if(e.callbackfunc)e.eventListenerFunc=function(t){++B.inEventHandler,B.currentEventHandler=e,B.runDeferredCalls(),e.handlerFunc(t),B.runDeferredCalls(),--B.inEventHandler},e.target.addEventListener(e.eventTypeString,e.eventListenerFunc,e.useCapture),B.eventHandlers.push(e);else for(var r=0;r<B.eventHandlers.length;++r)B.eventHandlers[r].target==e.target&&B.eventHandlers[r].eventTypeString==e.eventTypeString&&B._removeHandler(r--);return 0},getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":(e==null?void 0:e.nodeName)||"":""},fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},Or={},ds=e=>e>2?Pe(e):e,zr=[0,document,window],De=e=>{e=ds(e);var r=zr[e]||document.querySelector(e);return r},Cn=De,us=(e,r,t)=>{var n=Cn(e);if(!n)return-4;m[r>>2]=n.width,m[t>>2]=n.height},_t=e=>{var r=Sr(e)+1,t=Xr(r);return ge(e,t,r),t},En=e=>Sn(()=>{var r=Xr(8),t=r+4,n=_t(e.id);us(n,r,t);var a=[m[r>>2],m[t>>2]];return a}),kn=(e,r,t)=>{var n=Cn(e);return n?(n.width=r,n.height=t,0):-4},jn=(e,r,t)=>{e.controlTransferredOffscreen?Sn(()=>{var n=_t(e.id);kn(n,r,t)}):(e.width=r,e.height=t)},fs=e=>{var r=En(e),t=r[0],n=r[1],a=e.style.width,i=e.style.height,d=e.style.backgroundColor,u=document.body.style.backgroundColor,x=e.style.paddingLeft,_=e.style.paddingRight,E=e.style.paddingTop,T=e.style.paddingBottom,q=e.style.marginLeft,M=e.style.marginRight,z=e.style.marginTop,J=e.style.marginBottom,xe=document.body.style.margin,he=document.documentElement.style.overflow,Se=document.body.scroll,be=e.style.imageRendering;function _e(){var Fe=document.fullscreenElement||document.webkitFullscreenElement;Fe||(document.removeEventListener("fullscreenchange",_e),document.removeEventListener("webkitfullscreenchange",_e),jn(e,t,n),e.style.width=a,e.style.height=i,e.style.backgroundColor=d,u||(document.body.style.backgroundColor="white"),document.body.style.backgroundColor=u,e.style.paddingLeft=x,e.style.paddingRight=_,e.style.paddingTop=E,e.style.paddingBottom=T,e.style.marginLeft=q,e.style.marginRight=M,e.style.marginTop=z,e.style.marginBottom=J,document.body.style.margin=xe,document.documentElement.style.overflow=he,document.body.scroll=Se,e.style.imageRendering=be,e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,t,n),Or.canvasResizedCallback&&le(Or.canvasResizedCallback)(37,0,Or.canvasResizedCallbackUserData))}return document.addEventListener("fullscreenchange",_e),document.addEventListener("webkitfullscreenchange",_e),_e},yt=(e,r,t)=>{e.style.paddingLeft=e.style.paddingRight=t+"px",e.style.paddingTop=e.style.paddingBottom=r+"px"},Gr=e=>zr.indexOf(e)<0?e.getBoundingClientRect():{left:0,top:0},ms=(e,r)=>{var t=fs(e),n=r.softFullscreen?innerWidth:screen.width,a=r.softFullscreen?innerHeight:screen.height,i=Gr(e),d=i.width,u=i.height,x=En(e),_=x[0],E=x[1];if(r.scaleMode==3)yt(e,(a-u)/2,(n-d)/2),n=d,a=u;else if(r.scaleMode==2)if(n*E<_*a){var T=E*n/_;yt(e,(a-T)/2,0),a=T}else{var q=_*a/E;yt(e,0,(n-q)/2),n=q}e.style.backgroundColor||(e.style.backgroundColor="black"),document.body.style.backgroundColor||(document.body.style.backgroundColor="black"),e.style.width=n+"px",e.style.height=a+"px",r.filteringMode==1&&(e.style.imageRendering="optimizeSpeed",e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated");var M=r.canvasResolutionScaleMode==2?devicePixelRatio:1;if(r.canvasResolutionScaleMode!=0){var z=n*M|0,J=a*M|0;jn(e,z,J),e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,z,J)}return t},wt=(e,r)=>{if((r.scaleMode!=0||r.canvasResolutionScaleMode!=0)&&ms(e,r),e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else return B.fullscreenEnabled()?-3:-1;return Or=r,r.canvasResizedCallback&&le(r.canvasResizedCallback)(37,0,r.canvasResizedCallbackUserData),0},ps=()=>{if(!B.fullscreenEnabled())return-1;B.removeDeferredCalls(wt);var e=zr[1];if(e.exitFullscreen)e.fullscreenElement&&e.exitFullscreen();else if(e.webkitExitFullscreen)e.webkitFullscreenElement&&e.webkitExitFullscreen();else return-1;return 0},St=e=>{if(e.requestPointerLock)e.requestPointerLock();else return document.body.requestPointerLock?-3:-1;return 0},hs=()=>{if(B.removeDeferredCalls(St),document.exitPointerLock)document.exitPointerLock();else return-1;return 0},gs=()=>devicePixelRatio,vs=(e,r,t)=>{if(e=De(e),!e)return-4;var n=Gr(e);return ce[r>>3]=n.width,ce[t>>3]=n.height,0},Fn=(e,r)=>{ce[e>>3]=r.timestamp;for(var t=0;t<r.axes.length;++t)ce[e+t*8+16>>3]=r.axes[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?ce[e+t*8+528>>3]=r.buttons[t].value:ce[e+t*8+528>>3]=r.buttons[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?m[e+t*4+1040>>2]=r.buttons[t].pressed:m[e+t*4+1040>>2]=r.buttons[t]==1;m[e+1296>>2]=r.connected,m[e+1300>>2]=r.index,m[e+8>>2]=r.axes.length,m[e+12>>2]=r.buttons.length,ge(r.id,e+1304,64),ge(r.mapping,e+1368,64)},xs=(e,r)=>e<0||e>=B.lastGamepadState.length?-5:B.lastGamepadState[e]?(Fn(r,B.lastGamepadState[e]),0):-7,bs=(e,r)=>{e&&(m[e>>2]=j.mainLoop.timingMode),r&&(m[r>>2]=j.mainLoop.timingValue)},_s=()=>B.lastGamepadState.length,ys=(e,r)=>{m[e>>2]=screen.width,m[r>>2]=screen.height};function ws(e){y.activeTexture(e)}var Ss=ws,Cs=(e,r)=>{y.attachShader(F.programs[e],F.shaders[r])},Es=Cs,ks=(e,r)=>{y.disjointTimerQueryExt.beginQueryEXT(e,F.queries[r])},js=ks,Fs=(e,r,t)=>{y.bindAttribLocation(F.programs[e],r,Pe(t))},Ls=Fs,Rs=(e,r)=>{y.bindBuffer(e,F.buffers[r])},Ts=Rs,Ps=(e,r)=>{y.bindFramebuffer(e,F.framebuffers[r])},Ms=Ps,As=(e,r)=>{y.bindRenderbuffer(e,F.renderbuffers[r])},Ds=As,Is=(e,r)=>{y.bindTexture(e,F.textures[r])},Bs=Is,$s=e=>{y.bindVertexArray(F.vaos[e])},Ns=$s,Us=Ns;function Os(e,r,t,n){y.blendColor(e,r,t,n)}var zs=Os;function Gs(e){y.blendEquation(e)}var qs=Gs;function Vs(e,r){y.blendEquationSeparate(e,r)}var Hs=Vs;function Ws(e,r){y.blendFunc(e,r)}var Xs=Ws;function Ks(e,r,t,n){y.blendFuncSeparate(e,r,t,n)}var Ys=Ks,Qs=(e,r,t,n)=>{y.bufferData(e,t?O.subarray(t,t+r):r,n)},Js=Qs,Zs=(e,r,t,n)=>{y.bufferSubData(e,r,O.subarray(n,n+t))},ei=Zs;function ri(e){return y.checkFramebufferStatus(e)}var ti=ri;function ni(e){y.clear(e)}var ai=ni;function oi(e,r,t,n){y.clearColor(e,r,t,n)}var si=oi;function ii(e){y.clearDepth(e)}var li=ii;function ci(e){y.clearStencil(e)}var di=ci,ui=(e,r,t,n)=>{y.colorMask(!!e,!!r,!!t,!!n)},fi=ui,mi=e=>{y.compileShader(F.shaders[e])},pi=mi,hi=(e,r,t,n,a,i,d,u)=>{y.compressedTexImage2D(e,r,t,n,a,i,u?O.subarray(u,u+d):null)},gi=hi,vi=(e,r,t,n,a,i,d,u,x)=>{y.compressedTexSubImage2D(e,r,t,n,a,i,d,x?O.subarray(x,x+u):null)},xi=vi;function bi(e,r,t,n,a,i,d,u){y.copyTexImage2D(e,r,t,n,a,i,d,u)}var _i=bi;function yi(e,r,t,n,a,i,d,u){y.copyTexSubImage2D(e,r,t,n,a,i,d,u)}var wi=yi,Si=()=>{var e=F.getNewId(F.programs),r=y.createProgram();return r.name=e,r.maxUniformLength=r.maxAttributeLength=r.maxUniformBlockNameLength=0,r.uniformIdCounter=1,F.programs[e]=r,e},Ci=Si,Ei=e=>{var r=F.getNewId(F.shaders);return F.shaders[r]=y.createShader(e),r},ki=Ei;function ji(e){y.cullFace(e)}var Fi=ji,Li=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.buffers[n];a&&(y.deleteBuffer(a),a.name=0,F.buffers[n]=null)}},Ri=Li,Ti=(e,r)=>{for(var t=0;t<e;++t){var n=m[r+t*4>>2],a=F.framebuffers[n];a&&(y.deleteFramebuffer(a),a.name=0,F.framebuffers[n]=null)}},Pi=Ti,Mi=e=>{if(e){var r=F.programs[e];if(!r){F.recordError(1281);return}y.deleteProgram(r),r.name=0,F.programs[e]=null}},Ai=Mi,Di=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.queries[n];a&&(y.disjointTimerQueryExt.deleteQueryEXT(a),F.queries[n]=null)}},Ii=Di,Bi=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.renderbuffers[n];a&&(y.deleteRenderbuffer(a),a.name=0,F.renderbuffers[n]=null)}},$i=Bi,Ni=e=>{if(e){var r=F.shaders[e];if(!r){F.recordError(1281);return}y.deleteShader(r),F.shaders[e]=null}},Ui=Ni,Oi=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.textures[n];a&&(y.deleteTexture(a),a.name=0,F.textures[n]=null)}},zi=Oi,Gi=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2];y.deleteVertexArray(F.vaos[n]),F.vaos[n]=null}},qi=Gi,Vi=qi;function Hi(e){y.depthFunc(e)}var Wi=Hi,Xi=e=>{y.depthMask(!!e)},Ki=Xi;function Yi(e,r){y.depthRange(e,r)}var Qi=Yi,Ji=(e,r)=>{y.detachShader(F.programs[e],F.shaders[r])},Zi=Ji;function el(e){y.disable(e)}var rl=el,tl=e=>{y.disableVertexAttribArray(e)},nl=tl,al=(e,r,t)=>{y.drawArrays(e,r,t)},ol=al,sl=(e,r,t,n)=>{y.drawArraysInstanced(e,r,t,n)},il=sl,ll=il,Ln=[],cl=(e,r)=>{for(var t=Ln[e],n=0;n<e;n++)t[n]=m[r+n*4>>2];y.drawBuffers(t)},dl=cl,ul=dl,fl=(e,r,t,n)=>{y.drawElements(e,r,t,n)},ml=fl,pl=(e,r,t,n,a)=>{y.drawElementsInstanced(e,r,t,n,a)},hl=pl,gl=hl;function vl(e){y.enable(e)}var xl=vl,bl=e=>{y.enableVertexAttribArray(e)},_l=bl,yl=e=>{y.disjointTimerQueryExt.endQueryEXT(e)},wl=yl;function Sl(){y.finish()}var Cl=Sl;function El(){y.flush()}var kl=El,jl=(e,r,t,n)=>{y.framebufferRenderbuffer(e,r,t,F.renderbuffers[n])},Fl=jl,Ll=(e,r,t,n,a)=>{y.framebufferTexture2D(e,r,t,F.textures[n],a)},Rl=Ll;function Tl(e){y.frontFace(e)}var Pl=Tl,Tr=(e,r,t,n)=>{for(var a=0;a<e;a++){var i=y[t](),d=i&&F.getNewId(n);i?(i.name=d,n[d]=i):F.recordError(1282),m[r+a*4>>2]=d}},Ml=(e,r)=>{Tr(e,r,"createBuffer",F.buffers)},Al=Ml,Dl=(e,r)=>{Tr(e,r,"createFramebuffer",F.framebuffers)},Il=Dl,Bl=(e,r)=>{for(var t=0;t<e;t++){var n=y.disjointTimerQueryExt.createQueryEXT();if(!n){for(F.recordError(1282);t<e;)m[r+t++*4>>2]=0;return}var a=F.getNewId(F.queries);n.name=a,F.queries[a]=n,m[r+t*4>>2]=a}},$l=Bl,Nl=(e,r)=>{Tr(e,r,"createRenderbuffer",F.renderbuffers)},Ul=Nl,Ol=(e,r)=>{Tr(e,r,"createTexture",F.textures)},zl=Ol;function Gl(e,r){Tr(e,r,"createVertexArray",F.vaos)}var ql=Gl,Vl=ql;function Hl(e){y.generateMipmap(e)}var Wl=Hl,Rn=(e,r,t,n,a,i,d,u)=>{r=F.programs[r];var x=y[e](r,t);if(x){var _=u&&ge(x.name,u,n);a&&(m[a>>2]=_),i&&(m[i>>2]=x.size),d&&(m[d>>2]=x.type)}},Xl=(e,r,t,n,a,i,d)=>{Rn("getActiveAttrib",e,r,t,n,a,i,d)},Kl=Xl,Yl=(e,r,t,n,a,i,d)=>{Rn("getActiveUniform",e,r,t,n,a,i,d)},Ql=Yl,Jl=(e,r,t,n)=>{var a=y.getAttachedShaders(F.programs[e]),i=a.length;i>r&&(i=r),m[t>>2]=i;for(var d=0;d<i;++d){var u=F.shaders.indexOf(a[d]);m[n+d*4>>2]=u}},Zl=Jl,ec=(e,r)=>y.getAttribLocation(F.programs[e],Pe(r)),rc=ec,Tn=(e,r)=>{ee[e>>2]=r;var t=ee[e>>2];ee[e+4>>2]=(r-t)/4294967296},Ct=(e,r,t)=>{if(!r){F.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:t!=0&&t!=1&&F.recordError(1280);return;case 36345:n=0;break;case 34466:var a=y.getParameter(34467);n=a?a.length:0;break}if(n===void 0){var i=y.getParameter(e);switch(typeof i){case"number":n=i;break;case"boolean":n=i?1:0;break;case"string":F.recordError(1280);return;case"object":if(i===null)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:{n=0;break}default:{F.recordError(1280);return}}else if(i instanceof Float32Array||i instanceof Uint32Array||i instanceof Int32Array||i instanceof Array){for(var d=0;d<i.length;++d)switch(t){case 0:m[r+d*4>>2]=i[d];break;case 2:Q[r+d*4>>2]=i[d];break;case 4:P[r+d>>0]=i[d]?1:0;break}return}else try{n=i.name|0}catch(u){F.recordError(1280),N(`GL_INVALID_ENUM in glGet${t}v: Unknown object returned from WebGL getParameter(${e})! (error: ${u})`);return}break;default:F.recordError(1280),N(`GL_INVALID_ENUM in glGet${t}v: Native code calling glGet${t}v(${e}) and it returns ${i} of type ${typeof i}!`);return}}switch(t){case 1:Tn(r,n);break;case 0:m[r>>2]=n;break;case 2:Q[r>>2]=n;break;case 4:P[r>>0]=n?1:0;break}},tc=(e,r)=>Ct(e,r,4),nc=tc,ac=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getBufferParameter(e,r)},oc=ac,sc=()=>{var e=y.getError()||F.lastError;return F.lastError=0,e},ic=sc,lc=(e,r)=>Ct(e,r,2),cc=lc,dc=(e,r,t,n)=>{var a=y.getFramebufferAttachmentParameter(e,r,t);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=a.name|0),m[n>>2]=a},uc=dc,fc=(e,r)=>Ct(e,r,0),mc=fc,pc=(e,r,t,n)=>{var a=y.getProgramInfoLog(F.programs[e]);a===null&&(a="(unknown error)");var i=r>0&&n?ge(a,n,r):0;t&&(m[t>>2]=i)},hc=pc,gc=(e,r,t)=>{if(!t){F.recordError(1281);return}if(e>=F.counter){F.recordError(1281);return}if(e=F.programs[e],r==35716){var n=y.getProgramInfoLog(e);n===null&&(n="(unknown error)"),m[t>>2]=n.length+1}else if(r==35719){if(!e.maxUniformLength)for(var a=0;a<y.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,y.getActiveUniform(e,a).name.length+1);m[t>>2]=e.maxUniformLength}else if(r==35722){if(!e.maxAttributeLength)for(var a=0;a<y.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,y.getActiveAttrib(e,a).name.length+1);m[t>>2]=e.maxAttributeLength}else if(r==35381){if(!e.maxUniformBlockNameLength)for(var a=0;a<y.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,y.getActiveUniformBlockName(e,a).length+1);m[t>>2]=e.maxUniformBlockNameLength}else m[t>>2]=y.getProgramParameter(e,r)},vc=gc,Pn=(e,r,t)=>{if(!t){F.recordError(1281);return}var n=F.queries[e],a;a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r);var i;typeof a=="boolean"?i=a?1:0:i=a,Tn(t,i)},xc=Pn,Mn=(e,r,t)=>{if(!t){F.recordError(1281);return}var n=F.queries[e],a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r),i;typeof a=="boolean"?i=a?1:0:i=a,m[t>>2]=i},bc=Mn,_c=Pn,yc=_c,wc=Mn,Sc=wc,Cc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.disjointTimerQueryExt.getQueryEXT(e,r)},Ec=Cc,kc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getRenderbufferParameter(e,r)},jc=kc,Fc=(e,r,t,n)=>{var a=y.getShaderInfoLog(F.shaders[e]);a===null&&(a="(unknown error)");var i=r>0&&n?ge(a,n,r):0;t&&(m[t>>2]=i)},Lc=Fc,Rc=(e,r,t,n)=>{var a=y.getShaderPrecisionFormat(e,r);m[t>>2]=a.rangeMin,m[t+4>>2]=a.rangeMax,m[n>>2]=a.precision},Tc=Rc,Pc=(e,r,t,n)=>{var a=y.getShaderSource(F.shaders[e]);if(a){var i=r>0&&n?ge(a,n,r):0;t&&(m[t>>2]=i)}},Mc=Pc,Ac=(e,r,t)=>{if(!t){F.recordError(1281);return}if(r==35716){var n=y.getShaderInfoLog(F.shaders[e]);n===null&&(n="(unknown error)");var a=n?n.length+1:0;m[t>>2]=a}else if(r==35720){var i=y.getShaderSource(F.shaders[e]),d=i?i.length+1:0;m[t>>2]=d}else m[t>>2]=y.getShaderParameter(F.shaders[e],r)},Dc=Ac,Ic=function(){var r=yn(y);return r=r.concat(r.map(t=>"GL_"+t)),r},Bc=e=>{var r=F.stringCache[e];if(!r){switch(e){case 7939:r=Ke(Ic().join(" "));break;case 7936:case 7937:case 37445:case 37446:var t=y.getParameter(e);t||F.recordError(1280),r=t?Ke(t):0;break;case 7938:var n=y.getParameter(7938);n=`OpenGL ES 2.0 (${n})`,r=Ke(n);break;case 35724:var a=y.getParameter(35724),i=/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/,d=a.match(i);d!==null&&(d[1].length==3&&(d[1]=d[1]+"0"),a=`OpenGL ES GLSL ES ${d[1]} (${a})`),r=Ke(a);break;default:F.recordError(1280)}F.stringCache[e]=r}return r},$c=Bc,Nc=(e,r,t)=>{if(!t){F.recordError(1281);return}Q[t>>2]=y.getTexParameter(e,r)},Uc=Nc,Oc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getTexParameter(e,r)},zc=Oc,Gc=e=>parseInt(e),An=e=>e.slice(-1)=="]"&&e.lastIndexOf("["),Dn=e=>{var r=e.uniformLocsById,t=e.uniformSizeAndIdsByName,n,a;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},n=0;n<y.getProgramParameter(e,35718);++n){var i=y.getActiveUniform(e,n),d=i.name,u=i.size,x=An(d),_=x>0?d.slice(0,x):d,E=e.uniformIdCounter;for(e.uniformIdCounter+=u,t[_]=[u,E],a=0;a<u;++a)r[E]=a,e.uniformArrayNamesById[E++]=_}},qc=(e,r)=>{if(r=Pe(r),e=F.programs[e]){Dn(e);var t=e.uniformLocsById,n=0,a=r,i=An(r);i>0&&(n=Gc(r.slice(i+1))>>>0,a=r.slice(0,i));var d=e.uniformSizeAndIdsByName[a];if(d&&n<d[0]&&(n+=d[1],t[n]=t[n]||y.getUniformLocation(e,r)))return n}else F.recordError(1281);return-1},Vc=qc,we=e=>{var r=y.currentProgram;if(r){var t=r.uniformLocsById[e];return typeof t=="number"&&(r.uniformLocsById[e]=t=y.getUniformLocation(r,r.uniformArrayNamesById[e]+(t>0?`[${t}]`:""))),t}else F.recordError(1282)},In=(e,r,t,n)=>{if(!t){F.recordError(1281);return}e=F.programs[e],Dn(e);var a=y.getUniform(e,we(r));if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:m[t>>2]=a;break;case 2:Q[t>>2]=a;break}else for(var i=0;i<a.length;i++)switch(n){case 0:m[t+i*4>>2]=a[i];break;case 2:Q[t+i*4>>2]=a[i];break}},Hc=(e,r,t)=>{In(e,r,t,2)},Wc=Hc,Xc=(e,r,t)=>{In(e,r,t,0)},Kc=Xc,Yc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getVertexAttribOffset(e,r)},Qc=Yc,Bn=(e,r,t,n)=>{if(!t){F.recordError(1281);return}var a=y.getVertexAttrib(e,r);if(r==34975)m[t>>2]=a&&a.name;else if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:m[t>>2]=a;break;case 2:Q[t>>2]=a;break;case 5:m[t>>2]=Math.fround(a);break}else for(var i=0;i<a.length;i++)switch(n){case 0:m[t+i*4>>2]=a[i];break;case 2:Q[t+i*4>>2]=a[i];break;case 5:m[t+i*4>>2]=Math.fround(a[i]);break}},Jc=(e,r,t)=>{Bn(e,r,t,2)},Zc=Jc,ed=(e,r,t)=>{Bn(e,r,t,5)},rd=ed;function td(e,r){y.hint(e,r)}var nd=td,ad=e=>{var r=F.buffers[e];return r?y.isBuffer(r):0},od=ad;function sd(e){return y.isEnabled(e)}var id=sd,ld=e=>{var r=F.framebuffers[e];return r?y.isFramebuffer(r):0},cd=ld,dd=e=>(e=F.programs[e],e?y.isProgram(e):0),ud=dd,fd=e=>{var r=F.queries[e];return r?y.disjointTimerQueryExt.isQueryEXT(r):0},md=fd,pd=e=>{var r=F.renderbuffers[e];return r?y.isRenderbuffer(r):0},hd=pd,gd=e=>{var r=F.shaders[e];return r?y.isShader(r):0},vd=gd,xd=e=>{var r=F.textures[e];return r?y.isTexture(r):0},bd=xd,_d=e=>{var r=F.vaos[e];return r?y.isVertexArray(r):0},yd=_d,wd=yd;function Sd(e){y.lineWidth(e)}var Cd=Sd,Ed=e=>{e=F.programs[e],y.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},kd=Ed,jd=(e,r)=>{e==3317&&(F.unpackAlignment=r),y.pixelStorei(e,r)},Fd=jd;function Ld(e,r){y.polygonOffset(e,r)}var Rd=Ld,Td=(e,r)=>{y.disjointTimerQueryExt.queryCounterEXT(F.queries[e],r)},Pd=Td,Md=(e,r,t,n)=>{function a(u,x){return u+x-1&-x}var i=e*t,d=a(i,n);return r*d},Ad=e=>{var r={5:3,6:4,8:2,29502:3,29504:4};return r[e-6402]||1},Dd=e=>(e-=5120,e==1?O:e==4?m:e==6?Q:e==5||e==28922?ee:K),Id=e=>31-Math.clz32(e.BYTES_PER_ELEMENT),Et=(e,r,t,n,a,i)=>{var d=Dd(e),u=Id(d),x=1<<u,_=Ad(r)*x,E=Md(t,n,_,F.unpackAlignment);return d.subarray(a>>u,a+E>>u)},Bd=(e,r,t,n,a,i,d)=>{var u=Et(i,a,t,n,d);if(!u){F.recordError(1280);return}y.readPixels(e,r,t,n,a,i,u)},$d=Bd,Nd=()=>{},Ud=Nd;function Od(e,r,t,n){y.renderbufferStorage(e,r,t,n)}var zd=Od,Gd=(e,r)=>{y.sampleCoverage(e,!!r)},qd=Gd;function Vd(e,r,t,n){y.scissor(e,r,t,n)}var Hd=Vd,Wd=(e,r,t,n,a)=>{F.recordError(1280)},Xd=Wd,Kd=(e,r,t,n)=>{var a=F.getSource(e,r,t,n);y.shaderSource(F.shaders[e],a)},Yd=Kd;function Qd(e,r,t){y.stencilFunc(e,r,t)}var Jd=Qd;function Zd(e,r,t,n){y.stencilFuncSeparate(e,r,t,n)}var eu=Zd;function ru(e){y.stencilMask(e)}var tu=ru;function nu(e,r){y.stencilMaskSeparate(e,r)}var au=nu;function ou(e,r,t){y.stencilOp(e,r,t)}var su=ou;function iu(e,r,t,n){y.stencilOpSeparate(e,r,t,n)}var lu=iu,cu=(e,r,t,n,a,i,d,u,x)=>{y.texImage2D(e,r,t,n,a,i,d,u,x?Et(u,d,n,a,x):null)},du=cu;function uu(e,r,t){y.texParameterf(e,r,t)}var fu=uu,mu=(e,r,t)=>{var n=Q[t>>2];y.texParameterf(e,r,n)},pu=mu;function hu(e,r,t){y.texParameteri(e,r,t)}var gu=hu,vu=(e,r,t)=>{var n=m[t>>2];y.texParameteri(e,r,n)},xu=vu,bu=(e,r,t,n,a,i,d,u,x)=>{var _=null;x&&(_=Et(u,d,a,i,x)),y.texSubImage2D(e,r,t,n,a,i,d,u,_)},_u=bu,yu=(e,r)=>{y.uniform1f(we(e),r)},wu=yu,or=[],Su=(e,r,t)=>{if(r<=288)for(var n=or[r-1],a=0;a<r;++a)n[a]=Q[t+4*a>>2];else var n=Q.subarray(t>>2,t+r*4>>2);y.uniform1fv(we(e),n)},Cu=Su,Eu=(e,r)=>{y.uniform1i(we(e),r)},ku=Eu,Pr=[],ju=(e,r,t)=>{if(r<=288)for(var n=Pr[r-1],a=0;a<r;++a)n[a]=m[t+4*a>>2];else var n=m.subarray(t>>2,t+r*4>>2);y.uniform1iv(we(e),n)},Fu=ju,Lu=(e,r,t)=>{y.uniform2f(we(e),r,t)},Ru=Lu,Tu=(e,r,t)=>{if(r<=144)for(var n=or[2*r-1],a=0;a<2*r;a+=2)n[a]=Q[t+4*a>>2],n[a+1]=Q[t+(4*a+4)>>2];else var n=Q.subarray(t>>2,t+r*8>>2);y.uniform2fv(we(e),n)},Pu=Tu,Mu=(e,r,t)=>{y.uniform2i(we(e),r,t)},Au=Mu,Du=(e,r,t)=>{if(r<=144)for(var n=Pr[2*r-1],a=0;a<2*r;a+=2)n[a]=m[t+4*a>>2],n[a+1]=m[t+(4*a+4)>>2];else var n=m.subarray(t>>2,t+r*8>>2);y.uniform2iv(we(e),n)},Iu=Du,Bu=(e,r,t,n)=>{y.uniform3f(we(e),r,t,n)},$u=Bu,Nu=(e,r,t)=>{if(r<=96)for(var n=or[3*r-1],a=0;a<3*r;a+=3)n[a]=Q[t+4*a>>2],n[a+1]=Q[t+(4*a+4)>>2],n[a+2]=Q[t+(4*a+8)>>2];else var n=Q.subarray(t>>2,t+r*12>>2);y.uniform3fv(we(e),n)},Uu=Nu,Ou=(e,r,t,n)=>{y.uniform3i(we(e),r,t,n)},zu=Ou,Gu=(e,r,t)=>{if(r<=96)for(var n=Pr[3*r-1],a=0;a<3*r;a+=3)n[a]=m[t+4*a>>2],n[a+1]=m[t+(4*a+4)>>2],n[a+2]=m[t+(4*a+8)>>2];else var n=m.subarray(t>>2,t+r*12>>2);y.uniform3iv(we(e),n)},qu=Gu,Vu=(e,r,t,n,a)=>{y.uniform4f(we(e),r,t,n,a)},Hu=Vu,Wu=(e,r,t)=>{if(r<=72){var n=or[4*r-1],a=Q;t>>=2;for(var i=0;i<4*r;i+=4){var d=t+i;n[i]=a[d],n[i+1]=a[d+1],n[i+2]=a[d+2],n[i+3]=a[d+3]}}else var n=Q.subarray(t>>2,t+r*16>>2);y.uniform4fv(we(e),n)},Xu=Wu,Ku=(e,r,t,n,a)=>{y.uniform4i(we(e),r,t,n,a)},Yu=Ku,Qu=(e,r,t)=>{if(r<=72)for(var n=Pr[4*r-1],a=0;a<4*r;a+=4)n[a]=m[t+4*a>>2],n[a+1]=m[t+(4*a+4)>>2],n[a+2]=m[t+(4*a+8)>>2],n[a+3]=m[t+(4*a+12)>>2];else var n=m.subarray(t>>2,t+r*16>>2);y.uniform4iv(we(e),n)},Ju=Qu,Zu=(e,r,t,n)=>{if(r<=72)for(var a=or[4*r-1],i=0;i<4*r;i+=4)a[i]=Q[n+4*i>>2],a[i+1]=Q[n+(4*i+4)>>2],a[i+2]=Q[n+(4*i+8)>>2],a[i+3]=Q[n+(4*i+12)>>2];else var a=Q.subarray(n>>2,n+r*16>>2);y.uniformMatrix2fv(we(e),!!t,a)},ef=Zu,rf=(e,r,t,n)=>{if(r<=32)for(var a=or[9*r-1],i=0;i<9*r;i+=9)a[i]=Q[n+4*i>>2],a[i+1]=Q[n+(4*i+4)>>2],a[i+2]=Q[n+(4*i+8)>>2],a[i+3]=Q[n+(4*i+12)>>2],a[i+4]=Q[n+(4*i+16)>>2],a[i+5]=Q[n+(4*i+20)>>2],a[i+6]=Q[n+(4*i+24)>>2],a[i+7]=Q[n+(4*i+28)>>2],a[i+8]=Q[n+(4*i+32)>>2];else var a=Q.subarray(n>>2,n+r*36>>2);y.uniformMatrix3fv(we(e),!!t,a)},tf=rf,nf=(e,r,t,n)=>{if(r<=18){var a=or[16*r-1],i=Q;n>>=2;for(var d=0;d<16*r;d+=16){var u=n+d;a[d]=i[u],a[d+1]=i[u+1],a[d+2]=i[u+2],a[d+3]=i[u+3],a[d+4]=i[u+4],a[d+5]=i[u+5],a[d+6]=i[u+6],a[d+7]=i[u+7],a[d+8]=i[u+8],a[d+9]=i[u+9],a[d+10]=i[u+10],a[d+11]=i[u+11],a[d+12]=i[u+12],a[d+13]=i[u+13],a[d+14]=i[u+14],a[d+15]=i[u+15]}}else var a=Q.subarray(n>>2,n+r*64>>2);y.uniformMatrix4fv(we(e),!!t,a)},af=nf,of=e=>{e=F.programs[e],y.useProgram(e),y.currentProgram=e},sf=of,lf=e=>{y.validateProgram(F.programs[e])},cf=lf;function df(e,r){y.vertexAttrib1f(e,r)}var uf=df,ff=(e,r)=>{y.vertexAttrib1f(e,Q[r>>2])},mf=ff;function pf(e,r,t){y.vertexAttrib2f(e,r,t)}var hf=pf,gf=(e,r)=>{y.vertexAttrib2f(e,Q[r>>2],Q[r+4>>2])},vf=gf;function xf(e,r,t,n){y.vertexAttrib3f(e,r,t,n)}var bf=xf,_f=(e,r)=>{y.vertexAttrib3f(e,Q[r>>2],Q[r+4>>2],Q[r+8>>2])},yf=_f;function wf(e,r,t,n,a){y.vertexAttrib4f(e,r,t,n,a)}var Sf=wf,Cf=(e,r)=>{y.vertexAttrib4f(e,Q[r>>2],Q[r+4>>2],Q[r+8>>2],Q[r+12>>2])},Ef=Cf,kf=(e,r)=>{y.vertexAttribDivisor(e,r)},jf=kf,Ff=jf,Lf=(e,r,t,n,a,i)=>{y.vertexAttribPointer(e,r,t,!!n,a,i)},Rf=Lf;function Tf(e,r,t,n){y.viewport(e,r,t,n)}var Pf=Tf,Mf=()=>0,Af=(e,r,t)=>O.copyWithin(e,r,r+t),Df=()=>{j.mainLoop.pause()},If=(e,r)=>{if(!B.fullscreenEnabled())return-1;if(e=De(e),!e)return-4;if(!e.requestFullscreen&&!e.webkitRequestFullscreen)return-3;var t=B.canPerformEventHandlerRequests();return t?wt(e,r):r.deferUntilInEventHandler?(B.deferCall(wt,1,[e,r]),1):-2},Bf=(e,r,t)=>{var n={scaleMode:m[t>>2],canvasResolutionScaleMode:m[t+4>>2],filteringMode:m[t+8>>2],deferUntilInEventHandler:r,canvasResizedCallback:m[t+12>>2],canvasResizedCallbackUserData:m[t+16>>2]};return If(e,n)},$f=(e,r)=>{if(e=De(e),!e)return-4;if(!e.requestPointerLock)return-1;var t=B.canPerformEventHandlerRequests();return t?St(e):r?(B.deferCall(St,2,[e]),1):-2},Nf=()=>2147483648,Uf=e=>{var r=Y.buffer,t=(e-r.byteLength+65535)/65536;try{return Y.grow(t),Te(),1}catch{}},Of=e=>{var r=O.length;e>>>=0;var t=Nf();if(e>t)return!1;for(var n=(x,_)=>x+(_-x%_)%_,a=1;a<=4;a*=2){var i=r*(1+.2/a);i=Math.min(i,e+100663296);var d=Math.min(t,n(Math.max(e,i),65536)),u=Uf(d);if(u)return!0}return!1},zf=()=>{j.mainLoop.resume()},kt=()=>{try{if(navigator.getGamepads)return(B.lastGamepadState=navigator.getGamepads())?0:-1}catch{navigator.getGamepads=null}return-1},Gf=(e,r,t,n,a,i)=>{var d=(x=event)=>{var _=le(n)(a,0,r);if(_&&(_=Pe(_)),_)return x.preventDefault(),x.returnValue=_,_},u={target:De(e),eventTypeString:i,callbackfunc:n,handlerFunc:d,useCapture:t};return B.registerOrRemoveHandler(u)},qf=(e,r,t)=>typeof onbeforeunload>"u"?-1:t!==1?-5:Gf(2,e,!0,r,28,"beforeunload"),$n=(e,r,t,n,a,i,d)=>{B.focusEvent||(B.focusEvent=Ue(256));var u=(_=event)=>{var E=B.getNodeNameForTarget(_.target),T=_.target.id?_.target.id:"",q=B.focusEvent;ge(E,q+0,128),ge(T,q+128,128),le(n)(a,q,r)&&_.preventDefault()},x={target:De(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},Vf=(e,r,t,n,a)=>$n(e,r,t,n,12,"blur"),Hf=(e,r,t)=>(e=De(e),e?(e.style.width=r+"px",e.style.height=t+"px",0):-4),Wf=(e,r,t,n,a)=>$n(e,r,t,n,13,"focus"),Xf=e=>{var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=!!r;m[e>>2]=t,m[e+4>>2]=B.fullscreenEnabled();var n=t?r:B.previousFullscreenElement,a=B.getNodeNameForTarget(n),i=(n==null?void 0:n.id)||"";ge(a,e+8,128),ge(i,e+136,128),m[e+264>>2]=n?n.clientWidth:0,m[e+268>>2]=n?n.clientHeight:0,m[e+272>>2]=screen.width,m[e+276>>2]=screen.height,t&&(B.previousFullscreenElement=r)},Nn=(e,r,t,n,a,i,d)=>{B.fullscreenChangeEvent||(B.fullscreenChangeEvent=Ue(280));var u=(_=event)=>{var E=B.fullscreenChangeEvent;Xf(E),le(n)(a,E,r)&&_.preventDefault()},x={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},Kf=(e,r,t,n,a)=>B.fullscreenEnabled()?(e=De(e),e?(Nn(e,r,t,n,19,"webkitfullscreenchange"),Nn(e,r,t,n,19,"fullscreenchange")):-4):-1,Un=(e,r,t,n,a,i,d)=>{B.gamepadEvent||(B.gamepadEvent=Ue(1432));var u=(_=event)=>{var E=B.gamepadEvent;Fn(E,_.gamepad),le(n)(a,E,r)&&_.preventDefault()},x={target:De(e),allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},Yf=(e,r,t,n)=>kt()?-1:Un(2,e,r,t,26,"gamepadconnected"),Qf=(e,r,t,n)=>kt()?-1:Un(2,e,r,t,27,"gamepaddisconnected"),jt=(e,r,t,n,a,i,d)=>{B.keyEvent||(B.keyEvent=Ue(176));var u=_=>{var E=B.keyEvent;ce[E>>3]=_.timeStamp;var T=E>>2;m[T+2]=_.location,m[T+3]=_.ctrlKey,m[T+4]=_.shiftKey,m[T+5]=_.altKey,m[T+6]=_.metaKey,m[T+7]=_.repeat,m[T+8]=_.charCode,m[T+9]=_.keyCode,m[T+10]=_.which,ge(_.key||"",E+44,32),ge(_.code||"",E+76,32),ge(_.char||"",E+108,32),ge(_.locale||"",E+140,32),le(n)(a,E,r)&&_.preventDefault()},x={target:De(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},Jf=(e,r,t,n,a)=>jt(e,r,t,n,2,"keydown"),Zf=(e,r,t,n,a)=>jt(e,r,t,n,1,"keypress"),em=(e,r,t,n,a)=>jt(e,r,t,n,3,"keyup"),rm=(e,r,t)=>{var n=le(e);gn(n,r,t)},On=(e,r,t)=>{ce[e>>3]=r.timeStamp;var n=e>>2;m[n+2]=r.screenX,m[n+3]=r.screenY,m[n+4]=r.clientX,m[n+5]=r.clientY,m[n+6]=r.ctrlKey,m[n+7]=r.shiftKey,m[n+8]=r.altKey,m[n+9]=r.metaKey,A[n*2+20]=r.button,A[n*2+21]=r.buttons,m[n+11]=r.movementX,m[n+12]=r.movementY;var a=Gr(t);m[n+13]=r.clientX-a.left,m[n+14]=r.clientY-a.top},Mr=(e,r,t,n,a,i,d)=>{B.mouseEvent||(B.mouseEvent=Ue(72)),e=De(e);var u=(_=event)=>{On(B.mouseEvent,_,e),le(n)(a,B.mouseEvent,r)&&_.preventDefault()},x={target:e,allowsDeferredCalls:i!="mousemove"&&i!="mouseenter"&&i!="mouseleave",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},tm=(e,r,t,n,a)=>Mr(e,r,t,n,5,"mousedown"),nm=(e,r,t,n,a)=>Mr(e,r,t,n,33,"mouseenter"),am=(e,r,t,n,a)=>Mr(e,r,t,n,34,"mouseleave"),om=(e,r,t,n,a)=>Mr(e,r,t,n,8,"mousemove"),sm=(e,r,t,n,a)=>Mr(e,r,t,n,6,"mouseup"),im=e=>{var r=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement,t=!!r;m[e>>2]=t;var n=B.getNodeNameForTarget(r),a=(r==null?void 0:r.id)||"";ge(n,e+4,128),ge(a,e+132,128)},qr=(e,r,t,n,a,i,d)=>{B.pointerlockChangeEvent||(B.pointerlockChangeEvent=Ue(260));var u=(_=event)=>{var E=B.pointerlockChangeEvent;im(E),le(n)(a,E,r)&&_.preventDefault()},x={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},lm=(e,r,t,n,a)=>!document||!document.body||!document.body.requestPointerLock&&!document.body.mozRequestPointerLock&&!document.body.webkitRequestPointerLock&&!document.body.msRequestPointerLock?-1:(e=De(e),e?(qr(e,r,t,n,20,"mozpointerlockchange"),qr(e,r,t,n,20,"webkitpointerlockchange"),qr(e,r,t,n,20,"mspointerlockchange"),qr(e,r,t,n,20,"pointerlockchange")):-4),cm=(e,r,t,n,a,i,d)=>{B.uiEvent||(B.uiEvent=Ue(36)),e=De(e);var u=(_=event)=>{if(_.target==e){var E=document.body;if(E){var T=B.uiEvent;m[T>>2]=_.detail,m[T+4>>2]=E.clientWidth,m[T+8>>2]=E.clientHeight,m[T+12>>2]=innerWidth,m[T+16>>2]=innerHeight,m[T+20>>2]=outerWidth,m[T+24>>2]=outerHeight,m[T+28>>2]=pageXOffset,m[T+32>>2]=pageYOffset,le(n)(a,T,r)&&_.preventDefault()}}},x={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},dm=(e,r,t,n,a)=>cm(e,r,t,n,10,"resize"),Vr=(e,r,t,n,a,i,d)=>{B.touchEvent||(B.touchEvent=Ue(1696)),e=De(e);var u=_=>{for(var E,T={},q=_.touches,M=0;M<q.length;++M)E=q[M],E.isChanged=E.onTarget=0,T[E.identifier]=E;for(var M=0;M<_.changedTouches.length;++M)E=_.changedTouches[M],E.isChanged=1,T[E.identifier]=E;for(var M=0;M<_.targetTouches.length;++M)T[_.targetTouches[M].identifier].onTarget=1;var z=B.touchEvent;ce[z>>3]=_.timeStamp;var J=z>>2;m[J+3]=_.ctrlKey,m[J+4]=_.shiftKey,m[J+5]=_.altKey,m[J+6]=_.metaKey,J+=7;var xe=Gr(e),he=0;for(var M in T)if(E=T[M],m[J+0]=E.identifier,m[J+1]=E.screenX,m[J+2]=E.screenY,m[J+3]=E.clientX,m[J+4]=E.clientY,m[J+5]=E.pageX,m[J+6]=E.pageY,m[J+7]=E.isChanged,m[J+8]=E.onTarget,m[J+9]=E.clientX-xe.left,m[J+10]=E.clientY-xe.top,J+=13,++he>31)break;m[z+8>>2]=he,le(n)(a,z,r)&&_.preventDefault()},x={target:e,allowsDeferredCalls:i=="touchstart"||i=="touchend",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},um=(e,r,t,n,a)=>Vr(e,r,t,n,25,"touchcancel"),fm=(e,r,t,n,a)=>Vr(e,r,t,n,23,"touchend"),mm=(e,r,t,n,a)=>Vr(e,r,t,n,24,"touchmove"),pm=(e,r,t,n,a)=>Vr(e,r,t,n,22,"touchstart"),hm=e=>{var r=["hidden","visible","prerender","unloaded"],t=r.indexOf(document.visibilityState);m[e>>2]=document.hidden,m[e+4>>2]=t},gm=(e,r,t,n,a,i,d)=>{B.visibilityChangeEvent||(B.visibilityChangeEvent=Ue(8));var u=(_=event)=>{var E=B.visibilityChangeEvent;hm(E),le(n)(a,E,r)&&_.preventDefault()},x={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},vm=(e,r,t,n)=>gm(zr[1],e,r,t,21,"visibilitychange"),xm=(e,r,t,n,a,i,d)=>{B.wheelEvent||(B.wheelEvent=Ue(104));var u=(_=event)=>{var E=B.wheelEvent;On(E,_,e),ce[E+72>>3]=_.deltaX,ce[E+80>>3]=_.deltaY,ce[E+88>>3]=_.deltaZ,m[E+96>>2]=_.deltaMode,le(n)(a,E,r)&&_.preventDefault()},x={target:e,allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(x)},bm=(e,r,t,n,a)=>(e=De(e),e?typeof e.onwheel<"u"?xm(e,r,t,n,9,"wheel"):-1:-4),_m=e=>document.title=Pe(e),ym=()=>{throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},Ft={},wm=()=>k||"./this.program",Ar=()=>{if(!Ar.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:wm()};for(var t in Ft)Ft[t]===void 0?delete r[t]:r[t]=Ft[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);Ar.strings=n}return Ar.strings},Sm=(e,r)=>{for(var t=0;t<e.length;++t)P[r++>>0]=e.charCodeAt(t);P[r>>0]=0},Cm=(e,r)=>{var t=0;return Ar().forEach((n,a)=>{var i=r+t;ee[e+a*4>>2]=i,Sm(n,i),t+=n.length+1}),0},Em=(e,r)=>{var t=Ar();ee[e>>2]=t.length;var n=0;return t.forEach(a=>n+=a.length+1),ee[r>>2]=n,0};function km(e){try{var r=re.getStreamFromFD(e);return c.close(r),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return t.errno}}var jm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=ee[r>>2],u=ee[r+4>>2];r+=8;var x=c.read(e,P,d,u,n);if(x<0)return-1;if(a+=x,x<u)break}return a};function Fm(e,r,t,n){try{var a=re.getStreamFromFD(e),i=jm(a,r,t);return ee[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}function Lm(e,r,t,n,a){var i=Cr(r,t);try{if(isNaN(i))return 61;var d=re.getStreamFromFD(e);return c.llseek(d,i,n),me=[d.position>>>0,(Z=d.position,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[a>>2]=me[0],m[a+4>>2]=me[1],d.getdents&&i===0&&n===0&&(d.getdents=null),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function Rm(e){var t;try{var r=re.getStreamFromFD(e);return(t=r.stream_ops)!=null&&t.fsync?r.stream_ops.fsync(r):0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return n.errno}}var Tm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=ee[r>>2],u=ee[r+4>>2];r+=8;var x=c.write(e,P,d,u,n);if(x<0)return-1;a+=x}return a};function Pm(e,r,t,n){try{var a=re.getStreamFromFD(e),i=Tm(a,r,t);return ee[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var zn=e=>{var r=s["_"+e];return r},Mm=(e,r)=>{P.set(e,r)},Am=(e,r,t,n,a)=>{var i={string:z=>{var J=0;return z!=null&&z!==0&&(J=_t(z)),J},array:z=>{var J=Xr(z.length);return Mm(z,J),J}};function d(z){return r==="string"?Pe(z):r==="boolean"?!!z:z}var u=zn(e),x=[],_=0;if(n)for(var E=0;E<n.length;E++){var T=i[t[E]];T?(_===0&&(_=Oe()),x[E]=T(n[E])):x[E]=n[E]}var q=u.apply(null,x);function M(z){return _!==0&&ze(_),d(z)}return q=M(q),q},fe=(e,r,t,n)=>{var a=!t||t.every(d=>d==="number"||d==="boolean"),i=r!=="string";return i&&a&&!n?zn(e):function(){return Am(e,r,t,arguments)}},Gn=(e,r)=>{e<128?r.push(e):r.push(e%128|128,e>>7)},Dm=e=>{for(var r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},t={parameters:[],results:e[0]=="v"?[]:[r[e[0]]]},n=1;n<e.length;++n)t.parameters.push(r[e[n]]);return t},Im=(e,r)=>{var t=e.slice(0,1),n=e.slice(1),a={i:127,p:127,j:126,f:125,d:124,e:111};r.push(96),Gn(n.length,r);for(var i=0;i<n.length;++i)r.push(a[n[i]]);t=="v"?r.push(0):r.push(1,a[t])},Bm=(e,r)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Dm(r),e);var t=[1];Im(r,t);var n=[0,97,115,109,1,0,0,0,1];Gn(t.length,n),n.push.apply(n,t),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var a=new WebAssembly.Module(new Uint8Array(n)),i=new WebAssembly.Instance(a,{e:{f:e}}),d=i.exports.f;return d},$m=(e,r)=>{if(hr)for(var t=e;t<e+r;t++){var n=le(t);n&&hr.set(n,t)}},hr,Nm=e=>(hr||(hr=new WeakMap,$m(0,mr.length)),hr.get(e)||0),Lt=[],Um=()=>{if(Lt.length)return Lt.pop();try{mr.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return mr.length-1},Rt=(e,r)=>{mr.set(e,r),Rr[e]=mr.get(e)},qn=(e,r)=>{var t=Nm(e);if(t)return t;var n=Um();try{Rt(n,e)}catch(i){if(!(i instanceof TypeError))throw i;var a=Bm(e,r);Rt(n,a)}return hr.set(e,n),n},Vn=e=>{hr.delete(le(e)),Rt(e,null),Lt.push(e)},Hn=function(e,r,t,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=c.nextInode++,this.name=r,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},Hr=365,Wr=146;Object.defineProperties(Hn.prototype,{read:{get:function(){return(this.mode&Hr)===Hr},set:function(e){e?this.mode|=Hr:this.mode&=~Hr}},write:{get:function(){return(this.mode&Wr)===Wr},set:function(e){e?this.mode|=Wr:this.mode&=~Wr}},isFolder:{get:function(){return c.isDir(this.mode)}},isDevice:{get:function(){return c.isChrdev(this.mode)}}}),c.FSNode=Hn,c.createPreloadedFile=no,c.staticInit(),s.requestFullscreen=j.requestFullscreen,s.requestAnimationFrame=j.requestAnimationFrame,s.setCanvasSize=j.setCanvasSize,s.pauseMainLoop=j.mainLoop.pause,s.resumeMainLoop=j.mainLoop.resume,s.getUserMedia=j.getUserMedia,s.createContext=j.createContext;for(var y,Ne=0;Ne<32;++Ne)Ln.push(new Array(Ne));for(var Om=new Float32Array(288),Ne=0;Ne<288;++Ne)or[Ne]=Om.subarray(0,Ne+1);for(var zm=new Int32Array(288),Ne=0;Ne<288;++Ne)Pr[Ne]=zm.subarray(0,Ne+1);var Gm={Q:oo,rb:so,ab:io,mb:lo,ib:co,sb:uo,ob:fo,jb:mo,pb:po,S:ho,hb:go,fb:vo,qb:xo,gb:bo,db:_o,tb:wo,bb:So,Za:jo,_a:Fo,Wa:Lo,Xa:Ro,Ya:To,eb:Po,a:Mo,Qa:Bo,Ua:$o,Ga:Go,Ja:qo,Ha:Vo,Ka:Ho,Va:Wo,O:Xo,Fa:Ko,Ra:Yo,La:Qo,Ea:Jo,Ma:Zo,Na:es,Ta:rs,Pa:ns,Oa:as,i:ss,b:ls,T:cs,ya:ps,Ca:hs,h:gs,e:vs,V:xs,X:bs,l:Ur,Ub:_s,Da:ys,ea:Ss,da:Es,ua:js,ca:Ls,ba:Ts,aa:Ms,$:Ds,_:Bs,ma:Us,Zd:zs,Yd:qs,Xd:Hs,Wd:Xs,Vd:Ys,Ud:Js,Td:ei,Sd:ti,Rd:ai,Qd:si,Pd:li,Od:di,Nd:fi,Md:pi,Ld:gi,Kd:xi,Jd:_i,Id:wi,Hd:Ci,Gd:ki,Fd:Fi,Ed:Ri,Dd:Pi,Cd:Ai,wa:Ii,Bd:$i,Ad:Ui,zd:zi,la:Vi,yd:Wi,xd:Ki,wd:Qi,vd:Zi,ud:rl,td:nl,sd:ol,ha:ll,ia:ul,rd:ml,ga:gl,qd:xl,pd:_l,ta:wl,od:Cl,nd:kl,md:Fl,kd:Rl,jd:Pl,id:Al,gd:Il,xa:$l,fd:Ul,ed:zl,ka:Vl,hd:Wl,dd:Kl,cd:Ql,bd:Zl,ad:rc,$c:nc,_c:oc,Zc:ic,Yc:cc,Xc:uc,Wc:mc,Uc:hc,Vc:vc,oa:xc,qa:bc,na:yc,pa:Sc,ra:Ec,Tc:jc,Rc:Lc,Qc:Tc,Pc:Mc,Sc:Dc,Oc:$c,Nc:Uc,Mc:zc,Jc:Vc,Lc:Wc,Kc,Fc:Qc,Hc:Zc,Gc:rd,Ec:nd,Dc:od,Cc:id,Bc:cd,Ac:ud,va:md,zc:hd,yc:vd,wc:bd,ja:wd,vc:Cd,uc:kd,tc:Fd,sc:Rd,sa:Pd,rc:$d,qc:Ud,pc:zd,oc:qd,nc:Hd,mc:Xd,lc:Yd,kc:Jd,jc:eu,ic:tu,hc:au,gc:su,fc:lu,ec:du,dc:fu,cc:pu,bc:gu,ac:xu,$b:_u,_b:wu,Zb:Cu,Yb:ku,Xb:Fu,Wb:Ru,Vb:Pu,Tb:Au,Sb:Iu,Rb:$u,Qb:Uu,Pb:zu,Ob:qu,Nb:Hu,Mb:Xu,Lb:Yu,Kb:Ju,Jb:ef,Ib:tf,Hb:af,Gb:sf,Fb:cf,Eb:uf,Db:mf,Cb:hf,Bb:vf,Ab:bf,zb:yf,yb:Sf,xb:Ef,fa:Ff,wb:Rf,vb:Pf,o:Mf,ub:Af,q:Df,za:Bf,N:$f,cb:Of,M:zf,W:kt,s:qf,E:Vf,g:kn,m:Hf,F:Wf,v:Kf,U:Yf,R:Qf,y:Jf,w:Zf,x:em,Ba:rm,Sa:Er,K:tm,I:nm,H:am,L:om,J:sm,z:lm,u:dm,A:um,C:fm,B:mm,D:pm,t:vm,G:bm,Aa:_m,n:ym,kb:Cm,lb:Em,Ia:bn,j:km,P:Fm,$a:Lm,nb:Rm,p:Pm,Z:Xm,Y:Qm,c:Vm,r:qm,Ic:Jm,d:Hm,k:Ym,f:Wm,xc:Zm,ld:Km},ae=Va();s._screenshot=e=>(s._screenshot=ae.ae)(e),s._buttonPress=e=>(s._buttonPress=ae.be)(e),s._buttonUnpress=e=>(s._buttonUnpress=ae.ce)(e),s._setVolume=e=>(s._setVolume=ae.de)(e),s._getVolume=()=>(s._getVolume=ae.ee)(),s._getMainLoopTimingMode=()=>(s._getMainLoopTimingMode=ae.fe)(),s._getMainLoopTimingValue=()=>(s._getMainLoopTimingValue=ae.ge)(),s._setMainLoopTiming=(e,r)=>(s._setMainLoopTiming=ae.he)(e,r),s._setFastForwardMultiplier=e=>(s._setFastForwardMultiplier=ae.ie)(e),s._getFastForwardMultiplier=()=>(s._getFastForwardMultiplier=ae.je)(),s._quitGame=()=>(s._quitGame=ae.ke)(),s._quitMgba=()=>(s._quitMgba=ae.le)(),s._quickReload=()=>(s._quickReload=ae.me)(),s._pauseGame=()=>(s._pauseGame=ae.ne)(),s._resumeGame=()=>(s._resumeGame=ae.oe)(),s._setEventEnable=e=>(s._setEventEnable=ae.pe)(e),s._bindKey=(e,r)=>(s._bindKey=ae.qe)(e,r),s._saveState=e=>(s._saveState=ae.re)(e),s._loadState=e=>(s._loadState=ae.se)(e),s._autoLoadCheats=()=>(s._autoLoadCheats=ae.te)(),s._loadGame=e=>(s._loadGame=ae.ue)(e),s._saveStateSlot=(e,r)=>(s._saveStateSlot=ae.ve)(e,r),s._loadStateSlot=(e,r)=>(s._loadStateSlot=ae.we)(e,r),s._addCoreCallbacks=(e,r,t,n,a,i)=>(s._addCoreCallbacks=ae.xe)(e,r,t,n,a,i),s._setupConstants=()=>(s._setupConstants=ae.ye)();var Wn=s._main=(e,r)=>(Wn=s._main=ae.ze)(e,r),Ue=e=>(Ue=ae.Be)(e),Xn=e=>(Xn=ae.Ce)(e),Kn=(e,r)=>(Kn=ae.De)(e,r),qe=(e,r)=>(qe=ae.Ee)(e,r),Oe=()=>(Oe=ae.Fe)(),ze=e=>(ze=ae.Ge)(e),Xr=e=>(Xr=ae.He)(e);s.dynCall_ji=(e,r)=>(s.dynCall_ji=ae.Ie)(e,r),s.dynCall_jiji=(e,r,t,n,a)=>(s.dynCall_jiji=ae.Je)(e,r,t,n,a),s.dynCall_iiiji=(e,r,t,n,a,i)=>(s.dynCall_iiiji=ae.Ke)(e,r,t,n,a,i),s.dynCall_jii=(e,r,t)=>(s.dynCall_jii=ae.Le)(e,r,t),s._GBAInputInfo=109920,s._binaryName=186992,s._projectName=186996,s._projectVersion=187e3,s._gitCommit=186976,s._gitCommitShort=186980,s._gitBranch=186984,s._gitRevision=186988,s._GBIORegisterNames=49376,s._GBSavestateMagic=64640,s._GBSavestateVersion=64644,s._GBA_LUX_LEVELS=93136,s._GBAVideoObjSizes=138416,s._GBASavestateMagic=138208,s._GBASavestateVersion=138212;function qm(e,r,t,n,a){var i=Oe();try{return le(e)(r,t,n,a)}catch(d){if(ze(i),d!==d+0)throw d;qe(1,0)}}function Vm(e,r,t,n){var a=Oe();try{return le(e)(r,t,n)}catch(i){if(ze(a),i!==i+0)throw i;qe(1,0)}}function Hm(e,r,t){var n=Oe();try{le(e)(r,t)}catch(a){if(ze(n),a!==a+0)throw a;qe(1,0)}}function Wm(e,r,t,n,a){var i=Oe();try{le(e)(r,t,n,a)}catch(d){if(ze(i),d!==d+0)throw d;qe(1,0)}}function Xm(e,r){var t=Oe();try{return le(e)(r)}catch(n){if(ze(t),n!==n+0)throw n;qe(1,0)}}function Km(e,r,t,n,a,i,d,u,x,_){var E=Oe();try{le(e)(r,t,n,a,i,d,u,x,_)}catch(T){if(ze(E),T!==T+0)throw T;qe(1,0)}}function Ym(e,r,t,n){var a=Oe();try{le(e)(r,t,n)}catch(i){if(ze(a),i!==i+0)throw i;qe(1,0)}}function Qm(e,r,t){var n=Oe();try{return le(e)(r,t)}catch(a){if(ze(n),a!==a+0)throw a;qe(1,0)}}function Jm(e,r){var t=Oe();try{le(e)(r)}catch(n){if(ze(t),n!==n+0)throw n;qe(1,0)}}function Zm(e,r,t,n,a,i){var d=Oe();try{le(e)(r,t,n,a,i)}catch(u){if(ze(d),u!==u+0)throw u;qe(1,0)}}s.cwrap=fe,s.addFunction=qn,s.removeFunction=Vn,s.FS=c;var Kr;ur=function e(){Kr||Yn(),Kr||(ur=e)};function ep(){var e=Wn,r=0,t=0;try{var n=e(r,t);return xn(n,!0),n}catch(a){return vt(a)}}function Yn(){if(nr>0||(Je(),nr>0))return;function e(){Kr||(Kr=!0,s.calledRun=!0,!X&&(oe(),ve(),p(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),Qn&&ep(),Ee()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),e()},1)):e()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();var Qn=!0;return s.noInitialRun&&(Qn=!1),Yn(),f.ready}})();const dh=l=>{const[f,s]=R.useState(null);return R.useEffect(()=>{(async()=>{if(l){const v=await ch({canvas:l}),h=v.version.projectName+" "+v.version.projectVersion;console.log(h),await v.FSInit();const g=lh(v);s(g)}})()},[l]),f},Jt=R.createContext(null);Jt.displayName="EmulatorContext";const uh=({children:l})=>{const[f,s]=R.useState(null),p=dh(f);return o.jsx(Jt.Provider,{value:{emulator:p,canvas:f,setCanvas:s},children:l})},Zt=R.createContext(null);Zt.displayName="ResizeContext";const fh=({children:l})=>{const[f,s]=R.useState(!1);return o.jsx(Zt.Provider,{value:{areItemsResizable:f,setAreItemsResizable:s},children:l})},en=R.createContext(null);en.displayName="RunningContext";const mh=({children:l})=>{const[f,s]=R.useState(!1);return o.jsx(en.Provider,{value:{isRunning:f,setIsRunning:s},children:l})},ph="componentLayouts",hh=()=>{const[l,f]=ke(ph,{}),s=R.useCallback(()=>f({}),[f]),p=R.useMemo(()=>!!Object.values(l).some(v=>!!(v!=null&&v.position)||!!(v!=null&&v.size)),[l]);return{layouts:l,setLayouts:f,hasSetLayout:p,clearLayouts:s}},rn=R.createContext(null);rn.displayName="LayoutContext";const gh=({children:l})=>{const{layouts:f,setLayouts:s,hasSetLayout:p,clearLayouts:v}=hh(),h=R.useCallback((g,b)=>s(k=>({...k,[g]:{...k==null?void 0:k[g],...b}})),[s]);return R.useEffect(()=>{p||v()},[]),o.jsx(rn.Provider,{value:{layouts:f,hasSetLayout:p,clearLayouts:v,setLayout:h},children:l})},tn=R.createContext(null);tn.displayName="ModalContext";const vh=({children:l})=>{const[f,s]=R.useState(null),[p,v]=R.useState(!1);return o.jsx(tn.Provider,{value:{modalContent:f,setModalContent:s,isModalOpen:p,setIsModalOpen:v},children:l})},_r=l=>{const f=l.displayName,s=R.useContext(l);if(!s)throw new Error(`${f??"This context"} must be loaded under the matching ${f?`${f}.Provider`:"Provider"}`);return s},wa=()=>_r(Yt),Fr=()=>_r(rn),je=()=>_r(tn),ue=()=>_r(Jt),st=()=>_r(Qt),Sa=()=>_r(Zt),rr=()=>_r(en),xh=({isPaused:l})=>{const f=np(),{emulator:s}=ue(),{isRunning:p}=rr(),[v,h]=R.useState(!1),g=p&&!l;R.useEffect(()=>{g&&(!f&&!v?(s==null||s.pause(),h(!0)):f&&v&&(s==null||s.resume(),h(!1)))},[s,f,g,v])},bh=l=>{const f=l.getContext("webgl");f==null||f.clearColor(0,0,0,1),f==null||f.clear(f==null?void 0:f.COLOR_BUFFER_BIT)},_h=l=>{const f=l.getContext("2d"),s=40,p=50;let v=0;if(!f)return;const h=l.width,g=l.height,b=h/2,k=g/2,S=f.getImageData(0,0,h,g),w=setInterval(()=>{v++;for(let C=0;C<g;++C)for(let L=0;L<h;++L){const $=Math.abs(L-b),G=Math.abs(C-k)*.8,D=(b-v-$)/b,N=(k-v-(C&1)*10-G+Math.pow($,1/2))/k;S.data[(L+C*h)*4+3]*=Math.pow(D,1/3)*Math.pow(N,1/2)}f.putImageData(S,0,0),v>s&&(clearInterval(w),l.remove())},p)},yh=(l,f)=>{if(!l||!f)return;const s=document.createElement("canvas"),p=s.getContext("2d"),v=URL.createObjectURL(f);s.className=l.className,s.height=l.height,s.width=l.width,s.style.backgroundColor=l.style.backgroundColor,s.style.height=`${l.clientHeight}px`,s.style.imageRendering=l.style.imageRendering,s.style.margin=l.style.margin,s.style.objectFit=l.style.objectFit,s.style.width=`${l.clientWidth}px`,s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.right="0";const h=new Image;h.onload=()=>{var g;p==null||p.drawImage(h,0,0),(g=l.parentElement)==null||g.appendChild(s),bh(l),_h(s)},h.src=v},wh=l=>{if(!l)return null;const f="fade-copy.png",s=(l==null?void 0:l.filePaths().screenshotsPath)+"/"+f;if(!l.screenshot(f))return null;const v=l.getFile(s);return l==null||l.deleteFile(s),new Blob([v],{type:"image/png"})},Sh=()=>{const{canvas:l,emulator:f}=ue(),{isRunning:s,setIsRunning:p}=rr();return R.useCallback(()=>{s&&(yh(l,wh(f)),f==null||f.quitGame()),p(!1)},[l,f,s,p])},nn="completedProductTour",Ch={locale:{skip:o.jsx("strong",{"aria-label":"Skip",children:"Skip"})},placement:"auto",placementBeacon:"right-end",spotlightPadding:10},He=({completedProductTourStepName:l,steps:f,allowScrolling:s=!0,isNotInModal:p=!1,millisecondDelay:v=500,renderWithoutDelay:h=!1,skipIfIntroSkipped:g=!0,skipRenderCondition:b=!1,zIndex:k=500})=>{const[S,w]=ke(nn),{isModalOpen:C}=je(),[L,$]=R.useState(h);if(zt(()=>{$(!0)},h?null:v),!L||S!=null&&S[l]||g&&(S==null?void 0:S.hasCompletedProductTourIntro)===Mt.SKIPPED||!(S!=null&&S.hasCompletedProductTourIntro)||!p&&!C||b)return null;const G=f.map(D=>({...Ch,...D}));return o.jsx(Hp,{continuous:!0,disableScrollParentFix:s,hideCloseButton:!0,showProgress:!0,showSkipButton:!0,steps:G,styles:{options:{zIndex:k}},callback:({status:D})=>{[Mt.FINISHED,Mt.SKIPPED].includes(D)&&w(N=>({...N,[l]:D}))}})},Eh=I.button`
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
  padding: inherit;
`,Lr=at.forwardRef(({children:l,...f},s)=>o.jsx(Eh,{ref:s,...f,children:l})),kr=({variation:l})=>{const f=Me(),s=function(){switch(l){case"topLeft":return"-45deg";case"topRight":return"45deg";case"bottomLeft":return"45deg";case"bottomRight":return"-45deg";default:return"0deg"}}();return o.jsx(ap,{"data-testid":"gripper-handle",color:f.gbaThemeBlue,style:{transform:`rotate(${s})`}})},kh=I.ul`
  background-color: ${({theme:l})=>l.panelBlueGray};
  list-style: none;
  padding: 10px;
  margin: 0;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-template-areas:
    '. . . .'
    'volume volume fastForward fastForward';

  ${({$controlled:l,$isLargerThanPhone:f})=>(l||f)&&`
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
  `}
`,jh=I.li`
  display: contents;
`,Ca=ua`
  cursor: pointer;
  background-color: ${({theme:l})=>l.panelControlGray};
  border-radius: 0.25rem;
  min-width: 40px;
  min-height: 40px;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:l})=>l.pureBlack};
  width: ${({$controlled:l})=>l?"auto":"100%"};

  ${({$controlled:l,theme:f})=>!l&&`
    @media ${f.isLargerThanPhone} {
      width: auto;
    }
  `}
`,Fh=I(Lr).attrs({className:"noDrag"})`
  ${Ca}

  border: none;
  flex-grow: 1;
  margin: 0;
  padding: 0;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  &:active {
    color: ${({theme:l})=>l.gbaThemeBlue};
  }
`,Lh=I.li`
  ${Ca}
  grid-area: ${({$gridArea:l})=>l};
  max-height: 40px;
`,Rh=I(Wp)`
  flex-grow: 1;

  > .MuiSlider-markActive {
    opacity: 1;
    background-color: currentColor;
  }
`,Yr=({ariaLabel:l,children:f,controlled:s,id:p,onClick:v})=>o.jsx(jh,{children:o.jsx(Fh,{"aria-label":l,id:p,onClick:v,$controlled:s,children:f})}),Qr=({icon:l,...f})=>{const s=Me();return o.jsx(cr,{size:"small",sx:{padding:0,color:s.pureBlack,"&:active":{color:s.gbaThemeBlue}},...f,children:l})},ta=({controlled:l,gridArea:f,id:s,maxIcon:p,minIcon:v,...h})=>o.jsxs(Lh,{id:s,$gridArea:f,$controlled:l,children:[v,o.jsx(Rh,{marks:!0,sx:{width:"85px",margin:"0 10px",maxHeight:"40px"},valueLabelDisplay:"auto",...h}),p]}),Th=()=>{var Je,oe,ve,Ee;const{emulator:l}=ue(),{isRunning:f}=rr(),{areItemsDraggable:s,setAreItemsDraggable:p}=st(),{areItemsResizable:v,setAreItemsResizable:h}=Sa(),{layouts:g,setLayout:b}=Fr(),k=Me(),S=xr(k.isLargerThanPhone),[w,C]=R.useState(!1),[L,$]=R.useState(!1),G=R.useId(),D=Sh(),[N,V]=ke(xa,1),[Y,X]=ke(ya,1);xh({isPaused:w});const U=R.useCallback(de=>{var Ae,$e;!((Ae=g==null?void 0:g.controlPanel)!=null&&Ae.initialBounds)&&de&&b("controlPanel",{initialBounds:($e=de.resizableElement.current)==null?void 0:$e.getBoundingClientRect()})},[b,g]),H=(Je=g==null?void 0:g.screen)==null?void 0:Je.initialBounds;if(!H)return null;const P=S?5:0,O=!!((oe=g==null?void 0:g.controlPanel)!=null&&oe.size)||L,A=()=>{f&&(w?l==null||l.resume():l==null||l.pause(),C(de=>!de))},K=de=>{l==null||l.setVolume(de),V(de)},m=de=>{var $e;const Ae=Number(($e=de.target)==null?void 0:$e.value);K(Ae)},ee=de=>{l==null||l.setFastForwardMultiplier(de),X(de)},Q=de=>{var $e;const Ae=Number(($e=de.target)==null?void 0:$e.value);l==null||l.setFastForwardMultiplier(Ae),X(Ae)},ce=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the control panel to quickly perform in game actions and reposition controls."}),o.jsx("p",{children:"Click next to take a tour of the controls!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(G)}`},{content:o.jsx("p",{children:"Use the this button to pause and resume your game if it is running."}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--play`)}`},{content:o.jsx("p",{children:"Use this button to quit your current game."}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--quit-game`)}`},{content:o.jsx("p",{children:"Use this button to enable dragging and repositioning of the screen, controls, and control panel."}),placement:S?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--drag`)}`},{content:o.jsx("p",{children:"Use this button to resize the screen and control panel."}),placement:S?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--resize`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the emulator volume."}),o.jsx("p",{children:"Your volume setting will be saved between refreshes!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--volume-slider`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the fast forward speed."}),o.jsx("p",{children:"Your fast forward setting will be saved between refreshes!"})]}),placement:S?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--fast-forward`)}`}],Te={x:Math.floor(H.left),y:Math.floor(H.bottom+P)},We={width:S?"auto":"100dvw",height:"auto"},Qe=((ve=g==null?void 0:g.controlPanel)==null?void 0:ve.position)??Te,tr=((Ee=g==null?void 0:g.controlPanel)==null?void 0:Ee.size)??We,Xe={onFocus:l==null?void 0:l.disableKeyboardInput,onBlur:l==null?void 0:l.enableKeyboardInput,onClick:l==null?void 0:l.enableKeyboardInput};return o.jsxs(o.Fragment,{children:[o.jsx(fa,{"data-testid":"control-panel-wrapper",id:G,disableDragging:!s,enableResizing:v,resizeHandleComponent:{bottomRight:o.jsx(kr,{variation:"bottomRight"}),bottomLeft:o.jsx(kr,{variation:"bottomLeft"})},resizeHandleStyles:{bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"}},ref:U,cancel:".noDrag",position:Qe,size:tr,onDragStop:(de,Ae)=>{b("controlPanel",{position:{x:Ae.x,y:Ae.y}})},onResizeStart:()=>$(!0),onResizeStop:(de,Ae,$e,nr,ur)=>{b("controlPanel",{size:{width:$e.clientWidth,height:$e.clientHeight},position:{...ur}}),$(!1)},default:{...Te,...We},children:o.jsx(kh,{$controlled:O,$isLargerThanPhone:S,children:o.jsxs(ma.Provider,{value:{size:"2em"},children:[o.jsx(Yr,{id:`${G}--play`,ariaLabel:w||!f?"Play":"Pause",onClick:A,controlled:O,children:w||!f?o.jsx(op,{}):o.jsx(sp,{})}),o.jsx(Yr,{id:`${G}--quit-game`,ariaLabel:"Quit Game",onClick:()=>{D(),C(!1)},controlled:O,children:o.jsx(ip,{})}),o.jsx(Yr,{id:`${G}--drag`,ariaLabel:s?"Anchor Items":"Drag Items",onClick:()=>{p(de=>!de)},controlled:O,children:s?o.jsx(Jn,{color:k.gbaThemeBlue}):o.jsx(Jn,{})}),o.jsx(Yr,{id:`${G}--resize`,ariaLabel:v?"Stop Resizing Items":"Resize Items",onClick:()=>{h(de=>!de)},controlled:O,children:v?o.jsx(Zn,{color:k.gbaThemeBlue}):o.jsx(Zn,{})}),o.jsx(ta,{id:`${G}--volume-slider`,"aria-label":"Volume Slider",gridArea:"volume",controlled:O,value:N,step:.1,min:0,max:1,minIcon:o.jsx(Qr,{"aria-label":"Mute Volume",icon:o.jsx(lp,{style:{maxHeight:"100%"}}),onClick:()=>K(0)}),maxIcon:o.jsx(Qr,{"aria-label":"Max Volume",icon:o.jsx(cp,{style:{maxHeight:"100%"}}),onClick:()=>K(1)}),valueLabelFormat:`${N*100}`,onChange:m,...Xe}),o.jsx(ta,{id:`${G}--fast-forward`,"aria-label":"Fast Forward Slider",gridArea:"fastForward",controlled:O,value:Y,step:1,min:1,max:5,minIcon:o.jsx(Qr,{"aria-label":"Regular Speed",icon:o.jsx(dp,{style:{maxHeight:"100%"}}),onClick:()=>ee(1)}),maxIcon:o.jsx(Qr,{"aria-label":"Max Fast Forward",icon:o.jsx(up,{style:{maxHeight:"100%"}}),onClick:()=>ee(5)}),valueLabelFormat:`x${Y}`,onChange:Q,...Xe})]})})}),o.jsx(He,{steps:ce,completedProductTourStepName:"hasCompletedControlPanelTour",zIndex:S?160:0,renderWithoutDelay:!0,isNotInModal:!0})]})},Ea="currentSaveStateSlot",ka="areVirtualControlsEnabled",Ph=I.section`
  position: absolute;
  background-color: red;
  border-radius: 50%;
  width: 12rem;
  height: 12rem;
  background: ${({theme:l})=>l.pureBlack};
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-color: ${({$areItemsDraggable:l=!1,theme:f})=>l?f.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};
  border-width: 2px;
  z-index: 12;

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `};
`,Mh=I.div`
  position: absolute;
  height: 4rem;
  width: 4rem;
  border: 2px solid ${({theme:l})=>l.gbaThemeBlue};
  border-radius: 50%;
  background-color: ${({theme:l})=>l.pureBlack};
  transition: ${({$isControlled:l=!1})=>l?"transform 0.3s ease-in-out":"none"};

  &:before {
    position: absolute;
    content: '';
    top: -0.8rem;
    left: -0.8rem;
    right: -0.8rem;
    bottom: -0.8rem;
    border: 0.8rem solid ${({theme:l})=>l.gbaThemeBlue}50;
    border-radius: 50%;
  }
`,it=I.div`
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
`,Ah=I(it)`
  border-width: 0 15px 25px 15px;
  border-color: transparent transparent ${({theme:l})=>l.pureWhite}
    transparent;
  top: 10px;
`,Dh=I(it)`
  border-width: 25px 15px 0 15px;
  border-color: ${({theme:l})=>l.pureWhite} transparent transparent
    transparent;
  bottom: 10px;
`,Ih=I(it)`
  border-width: 15px 25px 15px 0;
  border-color: transparent ${({theme:l})=>l.pureWhite} transparent
    transparent;
  left: 10px;
`,Bh=I(it)`
  border-width: 15px 0 15px 25px;
  border-color: transparent transparent transparent
    ${({theme:l})=>l.pureWhite};
  right: 10px;
`,$h=({initialPosition:l})=>{var U;const{emulator:f}=ue(),{areItemsDraggable:s}=st(),{layouts:p,setLayout:v}=Fr(),[h,g]=R.useState({x:0,y:0}),[b,k]=R.useState(!0),S=R.useRef(null),w=R.useRef(null),[C,L]=R.useState({});R.useEffect(()=>{Object.keys(C).forEach(H=>{C[H]?f==null||f.simulateKeyDown(H):f==null||f.simulateKeyUp(H)})},[C,f]);const $=R.useCallback((H,P)=>L(O=>({...O,[H]:P})),[]),G=R.useCallback(H=>L(P=>Object.fromEntries(Object.entries(P).map(([O,A])=>[O,A===H?void 0:A]))),[]),D=({x:H,y:P})=>{const O=H*Math.cos(Math.PI/4)-P*Math.sin(Math.PI/4),A=H*Math.sin(Math.PI/4)+P*Math.cos(Math.PI/4);return O>=0&&A>=0?"RIGHT":O<0&&A>=0?"DOWN":O<0&&A<0?"LEFT":O>=0&&A<0?"UP":null},N=R.useCallback(H=>{if(!S.current||!w.current)return;const P=S.current.getBoundingClientRect(),O=w.current.getBoundingClientRect(),A=Math.max(-P.width/2+O.width/2,Math.min(H.clientX-P.left-P.width/2,P.width/2-O.width/2)),K=Math.max(-P.height/2+O.height/2,Math.min(H.clientY-P.top-P.height/2,P.height/2-O.height/2));s||g({x:A,y:K});const m=D({x:A,y:K});m&&!C[m]&&(G(H.pointerId),$(m,H.pointerId))},[s,C,$,G]),V=R.useCallback(H=>{if(k(!1),!S.current)return;const P=S.current.getBoundingClientRect(),O=H.clientX-P.left-P.width/2,A=H.clientY-P.top-P.width/2;s||g({x:O,y:A});const K=D({x:O,y:A});K&&$(K,H.pointerId)},[s,$]),Y=H=>{k(!0),g({x:0,y:0}),G(H.pointerId)},X=((U=p==null?void 0:p.oPad)==null?void 0:U.position)??{x:0,y:0};return o.jsx(It,{nodeRef:S,disabled:!s,position:X,onStop:(H,P)=>v("oPad",{position:{x:P.x,y:P.y}}),children:o.jsxs(Ph,{"aria-label":"O-Pad",ref:S,$initialPosition:l,$areItemsDraggable:s,onPointerDown:V,onPointerMove:N,onPointerUp:Y,onPointerCancel:Y,onPointerOut:Y,onPointerLeave:Y,children:[o.jsx(It,{disabled:!0,nodeRef:w,position:h,children:o.jsx(Mh,{ref:w,$isControlled:b})}),o.jsx(Ih,{}),o.jsx(Bh,{}),o.jsx(Ah,{}),o.jsx(Dh,{})]})})},ja=I(Lr)`
  background-color: ${({theme:l})=>l.darkGray};
  border-style: solid;
  border-color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  cursor: pointer;
  box-sizing: content-box;
  border-width: 2px;
`,Nh=I(ja)`
  width: ${({$diameter:l=60})=>l}px;
  height: ${({$diameter:l=60})=>l}px;
  border-radius: 100px;
  border-color: ${({$areItemsDraggable:l=!1,theme:f})=>l?f.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Uh=I(ja)`
  border-radius: 16px;
  width: fit-content;
  min-width: 85px;
  border-color: ${({$areItemsDraggable:l=!1,theme:f})=>l?f.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Oh=({isRectangular:l=!1,width:f=60,children:s,keyId:p,inputName:v,onClick:h,initialPosition:g,initialOffset:b,enabled:k=!1,ariaLabel:S})=>{var X;const{emulator:w}=ue(),{areItemsDraggable:C}=st(),{layouts:L,setLayout:$}=Fr(),G=R.useRef(null);if(!k)return null;const D=h?{onClick:h}:{},N=p?{onPointerDown:()=>{w==null||w.simulateKeyDown(p)},onPointerUp:()=>{w==null||w.simulateKeyUp(p)},onPointerLeave:()=>{w==null||w.simulateKeyUp(p)},onPointerOut:()=>{w==null||w.simulateKeyUp(p)},onPointerCancel:()=>{w==null||w.simulateKeyUp(p)}}:{},V=p?{onKeyDown:U=>{(U.code=="Space"||U.key==" ")&&(w==null||w.simulateKeyDown(p))},onKeyUp:U=>{(U.code=="Space"||U.key==" ")&&(w==null||w.simulateKeyUp(p))}}:{},Y=((X=L==null?void 0:L[v])==null?void 0:X.position)??{x:0,y:0};return o.jsx(It,{nodeRef:G,positionOffset:b,position:Y,disabled:!C,onStop:(U,H)=>$(v,{position:{x:H.x,y:H.y}}),children:l?o.jsx(Uh,{ref:G,$initialPosition:g,$areItemsDraggable:C,"aria-label":S,...N,...D,...V,children:s}):o.jsx(Nh,{ref:G,$initialPosition:g,$diameter:f,$areItemsDraggable:C,"aria-label":S,...N,...D,...V,children:s})})},zh=(l,f)=>l?f:null,Fa=()=>{const{isRunning:l}=rr(),{emulator:f}=ue(),[,s]=ke(Kt),p=R.useCallback(h=>f==null?void 0:f.addCoreCallbacks({saveDataUpdatedCallback:zh(h.saveFileSystemOnInGameSave,()=>{f.fsSync(),h.notificationsEnabled&&Ve.success("Saved File System ")})}),[f]),v=R.useCallback(h=>{s(g=>({...g,...h})),l&&p(h)},[p,l,s]);return{addCallbacks:p,addCallbacksAndSaveSettings:v}},lt=()=>{const{emulator:l}=ue(),{setIsRunning:f}=rr(),[,s]=ke(_a),[p]=ke(ba),[v]=ke(xa,1),[h]=ke(ya,1),[g]=ke(Kt,{saveFileSystemOnInGameSave:!1,notificationsEnabled:!0}),{addCallbacks:b}=Fa();return R.useCallback(S=>{const w=l==null?void 0:l.run(S);return f(!!w),s(S),l==null||l.setVolume(v),w&&(p&&(l==null||l.remapKeyBindings(p)),h>1&&!(l!=null&&l.isFastForwardEnabled())&&(l==null||l.setFastForwardMultiplier(h)),b(g)),!!w},[b,g,v,p,l,h,f,s])},La=()=>{const l=lt(),{isRunning:f,setIsRunning:s}=rr(),{emulator:p}=ue(),[v]=ke(_a);return R.useCallback(()=>{if(f)p==null||p.quickReload();else if(p!=null&&p.getCurrentGameName()){const g=l(p.filePaths().gamePath+"/"+p.getCurrentGameName());s(!!g)}else if(v){const g=l(v);s(!!g)}},[p,f,s,l,v])},Ra=I.div`
  text-align: center;
`,Ir=I.p`
  text-align: center;
  margin: 0;
`,Ta=I.h3`
  margin: 0;
`,Pa=I.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,Ma=I.div`
  padding: 1rem;
  overflow-y: auto;
`,Aa=I.div`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
  border-top: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,Ie=({children:l,className:f})=>o.jsx(Ma,{className:f,children:l}),Be=({children:l})=>o.jsx(Aa,{"data-testid":"modal-footer:wrapper",children:l}),Gh=I.button`
  width: 1em;
  height: 1em;
  padding: 1rem;
  margin: 0 0 0 auto;
  cursor: pointer;
  color: ${({theme:l})=>l.pureBlack};
  border: 0;
  border-radius: 0.25rem;
  opacity: 0.5;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    opacity: 1;
  }

  &:hover {
    opacity: 0.75;
  }

  background: transparent
    url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e")
    center/1em auto no-repeat;
`,Re=({title:l,showExitIndicator:f=!0})=>{const{setIsModalOpen:s}=je();return o.jsxs(Pa,{children:[o.jsx(Ta,{id:"modalHeader",children:l}),f&&o.jsx(Gh,{"aria-label":"Close",onClick:()=>s(!1)})]})},qh=()=>{const{accessToken:f}=wa(),s=R.useCallback(async b=>{const k="undefined/api/save/upload",S=new FormData;S.append("save",(b==null?void 0:b.saveFile)??"");const w={method:"POST",headers:{Authorization:`Bearer ${f}`},body:S},C=await fetch(k,w);if(!C.ok)throw new Error(`Received unexpected status code: ${C.status}`);return C},[void 0,f]),{data:p,isLoading:v,error:h,execute:g}=jr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:h,execute:g}},Vh=I.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,Hh=I.p`
  margin: 0;
  color: ${({theme:l})=>l.errorRed};
`,dr=({icon:l,text:f,className:s})=>o.jsxs(Vh,{"data-testid":"error-with-icon",className:s,children:[l,o.jsx(Hh,{children:f})]}),Wh=({errorColor:l,loadingColor:f,respStatus:s,isLoading:p,hasError:v})=>{const h=()=>o.jsx(ot,{"data-testid":"upload-save-spinner",color:f,cssOverride:{margin:"0 auto"}});let g=null;return p?g=h:v?g=()=>o.jsx(dr,{icon:o.jsx(lr,{style:{color:l}}),text:"Save file upload has failed"}):s===200?g=()=>o.jsx(Ir,{children:"Save file upload was successful!"}):g=()=>o.jsx(Ir,{children:"Are you sure you want to upload your current save file to the server?"}),o.jsx(Ie,{children:o.jsx(g,{})})},Xh=()=>{const l=Me(),{setIsModalOpen:f}=je(),{emulator:s}=ue(),p=R.useId(),{data:v,isLoading:h,error:g,execute:b}=qh(),k=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to upload your current save file to the server."}),o.jsx("p",{children:"Remember to save in game before uploading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Send Save to Server"}),o.jsx(Wh,{errorColor:l.errorRed,loadingColor:l.gbaThemeBlue,isLoading:h,hasError:!!g,respStatus:v==null?void 0:v.status}),o.jsxs(Be,{children:[o.jsx(ie,{id:p,variant:"contained",onClick:()=>{const S=s==null?void 0:s.getCurrentSave(),w=s==null?void 0:s.getCurrentSaveName();if(S&&w){const C=new Blob([S]),L=new File([C],w);b({saveFile:L})}},children:"Upload"}),o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})]}),o.jsx(He,{steps:k,completedProductTourStepName:"hasCompletedUploadSaveToServerTour"})]})},na=I.p`
  text-align: center;
  vertical-align: middle;
  line-height: 54px;
  color: ${({theme:l})=>l.pureWhite};
  margin: 0;
  font-size: 1.5em;
`,Jr=I.p`
  color: ${({theme:l})=>l.pureWhite};
  margin: 4px 5px;
`,Kh=l=>l.replace("-"," ").replace(/\w\S*/g,f=>f.charAt(0).toUpperCase()+f.substring(1).toLowerCase()),Yh=()=>{var O;const l=Me(),f=xr(l.isLargerThanPhone),s=xr(l.isMobileWithUrlBar),{emulator:p}=ue(),{isRunning:v}=rr(),{isAuthenticated:h}=wa(),{setModalContent:g,setIsModalOpen:b}=je(),{layouts:k}=Fr(),S=R.useId(),w=La(),[C]=ke(Ea,0),[L]=ke(ka),$=(O=k==null?void 0:k.controlPanel)==null?void 0:O.initialBounds;if(!$)return null;const G=A=>A===void 0&&!f||!!A,D=G(L==null?void 0:L.OpadAndButtons),N=(L==null?void 0:L.NotificationsEnabled)??!0,V=$.bottom,Y=$.left,X={"a-button":{defaultMobile:{top:`calc(${V}px + 12%)`,left:"calc(100dvw - 25px)"},mobileWithUrlBar:{top:`calc(${V}px + 10%)`},largerThanPhone:{top:`calc(${V}px + 35px - 3%)`,left:`calc(${Y}px + 450px)`}},"b-button":{defaultMobile:{top:`calc(${V}px + 15%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${V}px + 13%)`},largerThanPhone:{top:`calc(${V}px + 35px)`,left:`calc(${Y}px + 375px)`}},"start-button":{defaultMobile:{top:"88dvh",left:"25dvw"},mobileWithUrlBar:{top:"92dvh",left:"50dvw"},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`${Y}px`}},"select-button":{defaultMobile:{top:"88dvh",left:"55dvw"},mobileWithUrlBar:{top:"92dvh",left:"75dvw"},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${Y}px + 103px)`}},"l-button":{defaultMobile:{top:`${V+15}px`,left:"15px"},largerThanPhone:{top:`calc(${V}px + 15px)`,left:`${Y}px`}},"r-button":{defaultMobile:{top:`${V+15}px`,left:"calc(100dvw - 15px)"},largerThanPhone:{top:`calc(${V}px + 15px)`,left:`calc(${Y}px + 190px)`}},"quickreload-button":{defaultMobile:{top:`${V+10}px`,left:"135px"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${Y}px + 205px)`}},"uploadsave-button":{defaultMobile:{top:`${V+10}px`,left:"calc(100dvw - 135px)"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${Y}px + 300px)`}},"loadstate-button":{defaultMobile:{top:`calc(${V}px + 25%)`,left:"calc(100dvw - 40px)"},mobileWithUrlBar:{top:`calc(${V}px + 23%)`},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${Y}px + 248px)`}},"savestate-button":{defaultMobile:{top:`calc(${V}px + 27%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${V}px + 25%)`},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${Y}px + 300px)`}},"o-pad":{defaultMobile:{top:`calc(${V}px + 11%)`,left:"10px"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${Y}px + 450px)`}}},U=A=>{var m,ee,Q,ce;let K;return s&&((m=X[A])!=null&&m.mobileWithUrlBar)?K=(ee=X[A])==null?void 0:ee.mobileWithUrlBar:f&&((Q=X[A])!=null&&Q.largerThanPhone)&&(K=(ce=X[A])==null?void 0:ce.largerThanPhone),{...X[A].defaultMobile,...K}},H=(A,K,m)=>{N&&Ve[A?"success":"error"](A?K:m,{id:S})},P=[{keyId:"A",children:o.jsx(na,{children:"A"}),initialPosition:U("a-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"a-button",enabled:D},{keyId:"B",children:o.jsx(na,{children:"B"}),initialPosition:U("b-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"b-button",enabled:D},{keyId:"START",isRectangular:!0,children:o.jsx(Jr,{children:"Start"}),initialPosition:U("start-button"),keyName:"start-button",enabled:D},{keyId:"SELECT",isRectangular:!0,children:o.jsx(Jr,{children:"Select"}),initialPosition:U("select-button"),keyName:"select-button",enabled:D},{keyId:"L",isRectangular:!0,children:o.jsx(Jr,{children:"L"}),initialPosition:U("l-button"),keyName:"l-button",enabled:D},{keyId:"R",isRectangular:!0,children:o.jsx(Jr,{children:"R"}),initialPosition:U("r-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"r-button",enabled:D},{children:o.jsx(fp,{}),onClick:()=>{w(),!(p!=null&&p.getCurrentGameName())&&N&&Ve.error("Load a game to quick reload",{id:S})},width:40,initialPosition:U("quickreload-button"),keyName:"quickreload-button",enabled:G(L==null?void 0:L.QuickReload)},{children:o.jsx(mp,{}),onClick:()=>{h()&&v?(g(o.jsx(Xh,{})),b(!0)):N&&Ve.error("Please log in and load a game",{id:S})},width:40,initialPosition:U("uploadsave-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"uploadsave-button",enabled:G(L==null?void 0:L.SendSaveToServer)},{children:o.jsx(pp,{}),onClick:()=>{const A=p==null?void 0:p.loadSaveState(C);H(!!A,`Loaded slot: ${C}`,`Failed to load slot: ${C}`)},width:40,initialPosition:U("loadstate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"loadstate-button",enabled:G(L==null?void 0:L.LoadState)},{children:o.jsx(hp,{}),onClick:()=>{const A=p==null?void 0:p.createSaveState(C);H(!!A,`Saved slot: ${C}`,`Failed to save slot: ${C}`)},width:40,initialPosition:U("savestate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"savestate-button",enabled:G(L==null?void 0:L.SaveState)}];return o.jsxs(ma.Provider,{value:{color:l.pureWhite,size:"2em"},children:[D&&o.jsx($h,{initialPosition:U("o-pad")}),P.map(A=>o.jsx(Oh,{ariaLabel:Kh(A.keyName),inputName:A.keyName,...A},A.keyName))]})},Qh={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:400},content:{width:"calc(100dvw - 20px)",height:"fit-content",margin:"25px auto auto auto",backgroundColor:"#fff",inset:"10px",maxWidth:"500px",padding:"0",maxHeight:"90dvh",display:"flex",touchAction:"none",flexDirection:"column",userSelect:"text"}},Jh=()=>{const{modalContent:l,isModalOpen:f,setIsModalOpen:s}=je(),{emulator:p}=ue();return o.jsx(gp,{appElement:document.getElementById("root")||void 0,closeTimeoutMS:400,isOpen:f,style:Qh,onRequestClose:()=>s(!1),onAfterOpen:p==null?void 0:p.disableKeyboardInput,onAfterClose:p==null?void 0:p.enableKeyboardInput,aria:{labelledby:"modalHeader"},children:l})},br=250,Zh=I.li`
  color: ${({theme:l})=>l.gbaThemeBlue};
  padding: 0 2px;

  ${({$disabled:l=!1,theme:f})=>l&&`color: ${f.disabledGray};
     pointer-events: none;
     cursor: default;
    `}
`,eg=I(Lr)`
  background-color: unset;
  border: none;
  color: inherit;
  cursor: pointer;
  height: 100%;
  padding: 0.5rem 1rem;
  text-align: inherit;
  width: 100%;

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,rg=I.span`
  margin-left: 0.5rem;
`,tg=I.ul`
  padding-left: 2rem;
`,Zr=({title:l,icon:f,children:s,$isExpanded:p=!1,$disabled:v=!1})=>{const[h,g]=R.useState(p?"auto":0);return R.useEffect(()=>{g(p?"auto":0)},[p]),o.jsxs(Zh,{$disabled:v,children:[o.jsxs(eg,{disabled:v,onClick:()=>{g(h===0?"auto":0)},children:[f,o.jsx(rg,{children:l})]}),o.jsx(vp,{duration:350,easing:"ease-in-out",height:h,children:o.jsx(tg,{children:s})})]})},ng=I.li`
  cursor: pointer;
  color: ${({theme:l})=>l.gbaThemeBlue};
  list-style-type: none;
  padding: 0 2px;

  ${({$disabled:l=!1,theme:f})=>l&&`color: ${f.disabledGray};
     pointer-events: none;
     cursor: default;
    `}

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,ag=I(Lr)`
  background-color: unset;
  border: none;
  color: inherit;
  height: 100%;
  margin: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};

  text-align: inherit;
  width: 100%;
  cursor: pointer;
`,og=I.span`
  margin-left: 0.5rem;
`,sg=I.a`
  display: block;
  text-decoration: none;
  color: unset;
  outline-offset: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};
`,Le=({title:l,icon:f,onClick:s=void 0,$link:p=void 0,$disabled:v=!1,$withPadding:h=!1})=>{const g=o.jsxs(o.Fragment,{children:[f,o.jsx(og,{children:l})]});return o.jsx(ng,{$disabled:v,children:p?o.jsx(sg,{href:p,$withPadding:h,target:"_blank",children:g}):o.jsx(ag,{disabled:v,onClick:s,$withPadding:h,children:g})})},ig=()=>{const{setIsModalOpen:l}=je(),[,f]=ke(nn);return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"About"}),o.jsxs(Ie,{children:[o.jsx("p",{children:"Gbajs3 is a full featured Game Boy Advance emulator meant to operate online and offline in the browser."}),o.jsx("p",{children:"We currently support the mGBA core through the use of webassembly."}),o.jsx("p",{children:"Getting Started:"}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Using the ",o.jsx("i",{children:"Pre Game Actions"})," menu, upload a sav file if you have one available"]}),o.jsxs("li",{children:["Then, load a rom of your choice through the ",o.jsx("i",{children:"Upload Rom"})," or"," ",o.jsx("i",{children:"Load Local Rom"})," menu items"]}),o.jsx("li",{children:"Enjoy, your game will boot!"})]})]}),o.jsxs(Be,{children:[o.jsx(ie,{variant:"contained",onClick:()=>{f({}),l(!1)},children:"Take a tour"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},Da=Gt`
  100% {
    stroke-dashoffset: 0;
  }
`,lg=Gt`
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
`,cg=Gt`
  100% {
    box-shadow: inset 0 0 0 100vh var(--checkmark-fill-color);
  }
`,dg=I.svg`
  position: absolute;
  width: 24px;
  height: 24px;

  display: block;
  margin-left: auto;
  margin-right: auto;
  border-radius: 50%;
  stroke: ${({theme:l})=>l.pureWhite};
  stroke-width: 5;
  stroke-miterlimit: 10;
  animation: ${cg} 0.2s ease-in-out 0.2s forwards,
    ${lg} 0.12s ease-in-out 0.45s both;
`,ug=I.circle`
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 5;
  stroke-miterlimit: 10;
  stroke: ${({theme:l})=>l.checkMarkGreen};
  fill: none;
  animation: ${Da} 0.3s cubic-bezier(0.65, 0, 0.45, 1) forwards;
`,fg=I.path`
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: ${Da} 0.15s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
`,mg=I.span`
  ${({$isSuccessCheckVisible:l=!1})=>l&&"visibility: hidden;"}
`,yr=({copy:l,msDuration:f=1100,onClick:s,showSuccess:p=!0,...v})=>{const h=R.useId(),[g,b]=R.useState(!1),k=!!p&&g;return zt(()=>b(!1),k?f:null),o.jsxs(ie,{onClick:S=>{b(!0),s==null||s(S)},variant:"contained",...v,children:[k&&o.jsxs(dg,{role:"graphics-symbol","aria-labelledby":h,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52",children:[o.jsx("title",{id:h,children:"Circle Check"}),o.jsx(ug,{cx:"26",cy:"26",r:"25",fill:"none"}),o.jsx(fg,{fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),o.jsx(mg,{$isSuccessCheckVisible:k,children:l})]})},gr=at.forwardRef(({id:l,label:f,watcher:s,...p},v)=>o.jsx(ga,{"data-testid":"managed-checkbox:label",id:l,control:o.jsx(Dr,{ref:v,checked:!!s,...p}),label:f,style:{margin:0}})),pg=I.ul`
  list-style: none;
  display: ${({$shouldHide:l=!1})=>l?"none":"flex"};
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  margin: 0;
  max-width: 100%;
`,hg=I.li`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding-bottom: 10px;
  width: 100%;
`,gg=I(xp)`
  min-height: 40px;
  min-width: 40px;
`,vg=I(pa)`
  width: 25px;
  height: 25px;
`,aa=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: ${({$fullWidth:l=!1})=>l?"100%":"auto"};

  @media ${({theme:l})=>l.isLargerThanPhone} {
    flex-direction: row;
  }
`,xg=I.div`
  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: space-between;
`,bg=I.p`
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
  margin-top: ${({$withMargin:l=!1})=>l?"5px":"0"};
`,_g=()=>{var P;const l=Me(),f=xr(l.isLargerThanPhone),{setIsModalOpen:s}=je(),{emulator:p}=ue(),[v,h]=R.useState(!1),g=R.useId(),b={desc:"",code:"",enable:!1},[k,S]=R.useMemo(()=>{const O=p==null?void 0:p.getCurrentCheatsFile(),A=new TextDecoder().decode(O);return[A,p==null?void 0:p.parseCheatsString(A)]},[p]),{register:w,control:C,handleSubmit:L,watch:$,setValue:G,formState:{errors:D,isSubmitSuccessful:N}}=er({defaultValues:{rawCheats:k,cheats:S!=null&&S.length?S:[b]}}),{fields:V,append:Y,remove:X}=bp({control:C,name:"cheats"}),U=R.useCallback(()=>{const O=p==null?void 0:p.getCurrentCheatsFile(),A=new TextDecoder().decode(O),K=(p==null?void 0:p.parseCheatsString(A))??[];v?G("cheats",K):G("rawCheats",A)},[p,G,v]),H=[{content:o.jsx("p",{children:"Use this form to enter, add, and delete cheats."}),target:`#${CSS.escape(`${g}--cheats-form`)}`},{content:o.jsx("p",{children:"This form field is for the name of the cheat."}),target:`#${CSS.escape(`${g}--name`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Put your cheat code into this field."}),o.jsx("p",{children:"Remember to separate multi-line cheats with the '+' character!"})]}),target:`#${CSS.escape(`${g}--cheat-code`)}`},{content:o.jsx("p",{children:"Use the checkbox to enable/disable a cheat."}),placement:"right",target:`#${CSS.escape(`${g}--enabled`)}`},{content:o.jsx("p",{children:"Use the trash button to remove a cheat entirely."}),placement:"right",target:`#${CSS.escape(`${g}--remove`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new cheat."]}),target:`#${CSS.escape(`${g}--add-cheat`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Submit"})," button to save your cheats, and convert them to libretro format."]}),target:`#${CSS.escape(`${g}--submit-button`)}`},{content:o.jsx("p",{children:"Use this button to toggle between viewing parsed cheats or raw cheats in libretro file format."}),placement:"right",target:`#${CSS.escape(`${g}--toggle-raw-cheats`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Manage Cheats"}),o.jsx(Ie,{children:o.jsxs("form",{"aria-label":"Cheats Form",id:`${g}--cheats-form`,onSubmit:L(O=>{const A=v?new File([new Blob([O.rawCheats],{type:"text/plain"})],(p==null?void 0:p.getCurrentCheatsFileName())??"unknown.cheats"):p==null?void 0:p.parsedCheatsToFile(O.cheats);A&&(p==null||p.uploadCheats(A,()=>{p.autoLoadCheats(),U()}))}),children:[o.jsx(ir,{error:!!(D!=null&&D.rawCheats),label:"Raw Libretro Cheats",InputLabelProps:{shrink:!0},multiline:!0,fullWidth:!0,minRows:6,variant:"outlined",InputProps:{sx:{textarea:{whiteSpace:"pre",overflowX:"auto !important"}}},helperText:(P=D==null?void 0:D.rawCheats)==null?void 0:P.message,style:{display:v?"block":"none"},...w("rawCheats")}),o.jsx(pg,{$shouldHide:v,children:V.map((O,A)=>{var m,ee,Q,ce,Te,We,Qe,tr,Xe,Je;const K=oe=>A===0?oe:void 0;return o.jsxs(hg,{children:[o.jsxs(aa,{$fullWidth:!0,children:[o.jsx(ir,{id:K(`${g}--name`),label:"Name",error:!!((ee=(m=D==null?void 0:D.cheats)==null?void 0:m[A])!=null&&ee.desc),size:"small",autoComplete:"Name",style:f?{maxWidth:100}:void 0,helperText:(Te=(ce=(Q=D==null?void 0:D.cheats)==null?void 0:Q[A])==null?void 0:ce.desc)==null?void 0:Te.message,...w(`cheats.${A}.desc`,{required:{value:!0,message:"required"}})}),o.jsx(ir,{id:K(`${g}--cheat-code`),label:"Cheat Code",error:!!((Qe=(We=D==null?void 0:D.cheats)==null?void 0:We[A])!=null&&Qe.code),size:"small",autoComplete:"Code",helperText:(Je=(Xe=(tr=D==null?void 0:D.cheats)==null?void 0:tr[A])==null?void 0:Xe.code)==null?void 0:Je.message,...w(`cheats.${A}.code`,{required:{value:!0,message:"required"}})})]}),o.jsxs(aa,{children:[o.jsx(gr,{id:K(`${g}--enabled`),label:"Enabled",watcher:$(`cheats.${A}.enable`),...w(`cheats.${A}.enable`)}),o.jsx(cr,{"aria-label":"Delete",id:K(`${g}--remove`),sx:{padding:0,marginRight:"auto","&:hover":{borderRadius:"10px"},"&:focus":{borderRadius:"10px"},"& .MuiTouchRipple-root .MuiTouchRipple-child":{borderRadius:"10px"}},onClick:()=>X(A),children:o.jsx(gg,{})})]})]},O.id)})}),o.jsxs(xg,{children:[o.jsx(cr,{"aria-label":"Create new cheat",id:`${g}--add-cheat`,sx:{padding:0,display:v?"none":"flex"},onClick:()=>Y(b),children:o.jsx(vg,{})}),o.jsx(bg,{$withMargin:v,children:"Join multi-line codes with '+'"})]})]})}),o.jsxs(Be,{children:[o.jsx(yr,{copy:"Submit",form:`${g}--cheats-form`,id:`${g}--submit-button`,showSuccess:N,type:"submit"}),o.jsx(ie,{id:`${g}--toggle-raw-cheats`,color:"info",variant:"contained",onClick:()=>h(O=>!O),children:v?"Parsed":"Raw"}),o.jsx(ie,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]}),o.jsx(He,{steps:H,completedProductTourStepName:"hasCompletedCheatsTour"})]})},yg=I.form`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,wg=({id:l,onAfterSubmit:f})=>{const{emulator:s}=ue(),{isRunning:p}=rr(),{handleSubmit:v,setValue:h,control:g,formState:{errors:b}}=er(),k=s==null?void 0:s.defaultKeyBindings(),[S,w]=ke(ba),C=$=>{const G=Object.entries($).filter(([,D])=>!!D).map(([,D])=>D);p&&(s==null||s.remapKeyBindings(G)),w(G),f()},L=S??k;return o.jsx(yg,{"aria-label":"Key Bindings Form",id:l,onSubmit:v(C),children:L==null?void 0:L.map($=>o.jsx(Br,{control:g,name:$.gbaInput,defaultValue:$,rules:{validate:{noSpace:G=>G.key!==" "||"Space is reserved for accessibility requirements",noTab:G=>{var D;return((D=G.key)==null?void 0:D.toLowerCase())!=="tab"||"Tab is reserved for accessibility requirements"}}},render:({field:{value:G}})=>{var D;return o.jsx(ir,{variant:"outlined",label:G.gbaInput,value:G.key,onKeyDown:N=>{N.key.toLowerCase()!=="tab"&&(h(G.gbaInput,{gbaInput:G.gbaInput,key:N.key,location:N.location}),N.preventDefault())},error:!!b[$.gbaInput],helperText:(D=b==null?void 0:b[$.gbaInput])==null?void 0:D.message})}},`gba_input_${$.gbaInput.toLowerCase()}`))})},Ia=at.forwardRef(({id:l,label:f,watcher:s,...p},v)=>o.jsx(ga,{"data-testid":"managed-switch:label",id:l,control:o.jsx(Xp,{ref:v,checked:!!s,...p}),label:f,style:{margin:0}})),Sg=I.form`
  display: flex;
  flex-direction: column;
`,Cg=({id:l,onAfterSubmit:f})=>{const[s,p]=ke(ka),v=Me(),h=xr(v.isLargerThanPhone),g=C=>C===void 0&&!h||!!C,{register:b,handleSubmit:k,watch:S}=er({values:s??{OpadAndButtons:g(void 0),SaveState:g(void 0),LoadState:g(void 0),QuickReload:g(void 0),SendSaveToServer:g(void 0),NotificationsEnabled:!0},resetOptions:{keepDirtyValues:!0}}),w=async C=>{p(L=>({...L,...C})),f()};return o.jsxs(Sg,{"aria-label":"Virtual Controls Form",id:l,onSubmit:k(w),children:[o.jsx(gr,{label:"Virtual D-pad/Buttons",watcher:S("OpadAndButtons"),...b("OpadAndButtons")}),o.jsx(gr,{label:"Save State",watcher:S("SaveState"),...b("SaveState")}),o.jsx(gr,{label:"Load State",watcher:S("LoadState"),...b("LoadState")}),o.jsx(gr,{label:"Quick Reload",watcher:S("QuickReload"),...b("QuickReload")}),o.jsx(gr,{label:"Send save to server",watcher:S("SendSaveToServer"),...b("SendSaveToServer")}),o.jsx(Ia,{label:"Enable Notifications",watcher:S("NotificationsEnabled"),...b("NotificationsEnabled")})]})},Eg=I(Kp)`
  border-bottom: 1px solid;
  border-color: rgba(0, 0, 0, 0.12);
`,kg=I.div`
  padding: 24px;
`,Nt=l=>({id:`control-tab-${l}`,"aria-controls":`tabpanel-${l}`}),oa=({children:l,index:f,value:s})=>o.jsx("div",{role:"tabpanel",hidden:s!==f,id:`tabpanel-${f}`,"aria-labelledby":`tab-${f}`,children:s===f&&o.jsx(kg,{children:l})}),jg=({setFormId:l,virtualControlsFormId:f,keyBindingsFormId:s,resetPositionsButtonId:p,setIsSuccessfulSubmit:v})=>{const{clearLayouts:h}=Fr(),[g,b]=R.useState(0),k=(w,C)=>{b(C),l(C===0?f:s),v(!1)},S=()=>v(!0);return o.jsxs(o.Fragment,{children:[o.jsxs(Eg,{value:g,onChange:k,"aria-label":"Control tabs",children:[o.jsx(ra,{label:"Virtual Controls",...Nt(0)}),o.jsx(ra,{label:"Key Bindings",...Nt(1)})]}),o.jsxs(oa,{value:g,index:0,children:[o.jsx(Cg,{id:f,onAfterSubmit:S}),o.jsx(ie,{id:p,sx:{marginTop:"10px"},onClick:h,children:"Reset All Positions"})]}),o.jsx(oa,{value:g,index:1,children:o.jsx(wg,{id:s,onAfterSubmit:S})})]})},Fg=()=>{const{setIsModalOpen:l}=je(),f=R.useId(),[s,p]=R.useState(`${f}--virtual-controls-form`),[v,h]=R.useState(!1),g=[{content:o.jsx("p",{children:"Select which virtual controls you wish to enable in this form tab."}),target:`#${CSS.escape(`${f}--virtual-controls-form`)}`},{content:o.jsx("p",{children:"Use this button to reset the positions of the screen, control panel, and all virtual controls."}),target:`#${CSS.escape(`${f}--reset-positions-button`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the tab panel to change which form you are seeing."}),o.jsxs("p",{children:["Select the ",o.jsx("i",{children:"KEY BINDINGS"})," tab above, then click next!"]})]}),placement:"right",target:`#${CSS.escape(Nt(1).id)}`,disableBeacon:!0,disableOverlayClose:!0,hideCloseButton:!1,spotlightClicks:!0},{content:o.jsx("p",{children:"Remap keybindings by selecting a form field and typing your desired input."}),placement:"top-end",target:`#${CSS.escape(`${f}--key-bindings-form`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Save Changes"})," button to persist changes from the current form tab."]}),target:`#${CSS.escape(`${f}--save-changes-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Controls"}),o.jsx(Ie,{children:o.jsx(jg,{setFormId:p,virtualControlsFormId:`${f}--virtual-controls-form`,keyBindingsFormId:`${f}--key-bindings-form`,resetPositionsButtonId:`${f}--reset-positions-button`,setIsSuccessfulSubmit:h})}),o.jsxs(Be,{children:[o.jsx(yr,{copy:"Save Changes",form:s,id:`${f}--save-changes-button`,type:"submit",showSuccess:v}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:g,completedProductTourStepName:"hasCompletedControlsTour"})]})},Lg=()=>{const l=Me(),{setIsModalOpen:f}=je(),{emulator:s}=ue(),p=R.useId(),[v,h]=R.useState(!1),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to download your current save file."}),o.jsx("p",{children:"Remember to save in game before downloading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Download Save"}),o.jsx(Ie,{children:v?o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:"Load a rom to download its save file"}):o.jsx(Ir,{children:"Remember to save in game before downloading your save file!"})}),o.jsxs(Be,{children:[o.jsx(ie,{id:p,variant:"contained",onClick:()=>{const b=s==null?void 0:s.getCurrentSave(),k=s==null?void 0:s.getCurrentSaveName();if(b&&k){const S=new Blob([b],{type:"data:application/octet-stream"}),w=document.createElement("a");w.download=k,w.href=URL.createObjectURL(S),w.click(),w.remove()}else h(!0)},children:"Download"}),o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})]}),o.jsx(He,{steps:g,completedProductTourStepName:"hasCompletedDownloadSaveTour"})]})},Ba=l=>o.jsx(Vt,{"data-testid":"action-box:minus",className:"minus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})}),$a=l=>o.jsx(Vt,{"data-testid":"action-box:plus",className:"plus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})}),Rg=l=>o.jsx(Vt,{"data-testid":"action-box:close",className:"close",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})}),Tg=I.div`
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: space-between;

  > p {
    margin: 0;
    word-wrap: break-word;
    max-width: 100%;
  }
`,Pg=I.div`
  display: flex;
  gap: 15px;
`,Mg=Yp(l=>o.jsx(Qp,{...l}))(({theme:l})=>({marginTop:5,[`& .${At.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${At.groupTransition}`]:{marginLeft:15,paddingLeft:10,borderLeft:`1px dashed ${Jp(l.palette.text.primary,.4)}`},[`& .${At.content}`]:{width:"auto",alignItems:"baseline"}})),Ag=({id:l,allFiles:f,deleteFile:s,downloadFile:p})=>{if(!f)return null;const v=h=>{const g=h.path.split("/").pop(),b=o.jsxs(Tg,{children:[o.jsx("p",{children:g}),o.jsxs(Pg,{children:[o.jsx(cr,{"aria-label":`Download ${g}`,sx:{padding:0,margin:0},onClick:()=>p(h.path),children:o.jsx(ha,{})}),o.jsx(cr,{"aria-label":`Delete ${g}`,sx:{padding:0},onClick:()=>s(h.path),children:o.jsx(qt,{})})]})]});return o.jsx(Mg,{itemId:h.path,label:h.isDir?g:b,children:h.isDir&&h.children?h.children.map(k=>v(k)):null},h.path)};return o.jsx(Zp,{id:l,"aria-label":"File System",defaultExpandedItems:[f.path],slots:{collapseIcon:Ba,endIcon:Rg,expandIcon:$a},sx:{height:"fit-content"},children:v(f)})},Na=ua`
  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
  font-weight: 400;
  font-size: 1rem;
  line-height: 1.5;
  letter-spacing: 0.00938em;
`,Dg=I.form`
  display: flex;
  flex-direction: column;

  /* copying styles from the treeitem to match file system display */
  & p {
    ${Na}
  }
`,Ig=I.p`
  margin: 0;
  ${Na}
`,Bg=I(Lr)`
  display: flex;
  align-items: center;
  gap: 8px;
  background-color: unset;
  border: none;
  color: inherit;
  margin: 0;
`,$g=({id:l})=>{const[f]=ke(Kt),{addCallbacksAndSaveSettings:s}=Fa(),[p,v]=R.useState(!1),{register:h,handleSubmit:g,watch:b}=er({values:f,resetOptions:{keepDirtyValues:!0}});return o.jsxs("div",{id:l,children:[o.jsxs(Bg,{onClick:()=>v(k=>!k),children:[o.jsx(Ig,{children:"Options"}),p?o.jsx(Ba,{}):o.jsx($a,{})]}),o.jsx(eh,{in:p,children:o.jsxs(Dg,{"aria-label":"File System Options Form",onSubmit:g(s),children:[o.jsx(gr,{label:"Save file system on in-game save",watcher:b("saveFileSystemOnInGameSave"),...h("saveFileSystemOnInGameSave")}),o.jsx(Ia,{label:"Enable Notifications",watcher:b("notificationsEnabled"),...h("notificationsEnabled")}),o.jsx(ie,{sx:{width:"fit-content"},type:"submit",children:"Save Options"})]})})]})},Ng=I(Ie)`
  display: flex;
  flex-direction: column;
  gap: 1em;
`,Ug=()=>{const{setIsModalOpen:l}=je(),{emulator:f}=ue(),[s,p]=R.useState(),v=R.useId(),h=R.useCallback(S=>{f==null||f.deleteFile(S),p(f==null?void 0:f.listAllFiles())},[f]),g=S=>{const w=S.split("/").pop(),C=f==null?void 0:f.getFile(S);if(C&&w){const L=new Blob([C],{type:"data:application/octet-stream"}),$=document.createElement("a");$.download=w,$.href=URL.createObjectURL(L),$.click(),$.remove()}},b=s??(f==null?void 0:f.listAllFiles()),k=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to view your current file tree, download files, and delete files from the tree."}),o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," and ",o.jsx("i",{children:"minus"})," icons to open and close file tree branches!"]})]}),target:`#${CSS.escape(`${v}--emulator-file-system`)}`},{content:o.jsxs("p",{children:["Click the ",o.jsx("i",{children:"Options"})," label to adjust and save settings related to the file system."]}),target:`#${CSS.escape(`${v}--file-system-options`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"SAVE FILE SYSTEM"})," button to persist all of your files to your device!"]}),target:`#${CSS.escape(`${v}--save-file-system-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"File System"}),o.jsxs(Ng,{children:[o.jsx(Ag,{id:`${v}--emulator-file-system`,allFiles:b,deleteFile:h,downloadFile:g}),o.jsx($g,{id:`${v}--file-system-options`})]}),o.jsxs(Be,{children:[o.jsx(yr,{copy:"Save File System",id:`${v}--save-file-system-button`,onClick:f==null?void 0:f.fsSync}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:k,completedProductTourStepName:"hasCompletedFileSystemTour"})]})},rt=I.button`
  padding: 0.5rem 1rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  text-decoration: none;
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,tt=I.li`
  cursor: pointer;
`,Og=I.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${tt}:first-child > ${rt} {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${tt}:last-child > ${rt} {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${tt}:not(:first-child) > ${rt} {
    border-top-width: 0;
  }
`,zg=()=>{var b,k,S;const{setIsModalOpen:l}=je(),{emulator:f}=ue(),s=R.useId(),p=lt(),v=[".",".."],h=(k=(b=f==null?void 0:f.listRoms)==null?void 0:b.call(f))==null?void 0:k.filter(w=>!v.includes(w)),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to load local roms that have been saved to your device."}),o.jsx("p",{children:"Tap the name of your rom file and your game will boot!"}),o.jsxs("p",{children:["To persist roms and other files, use the ",o.jsx("i",{children:"File System"})," menu item."]})]}),target:`#${CSS.escape(s)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Load Local Rom"}),o.jsx(Ie,{children:o.jsxs(Og,{id:s,children:[(S=h==null?void 0:h.map)==null?void 0:S.call(h,(w,C)=>o.jsx(tt,{children:o.jsx(rt,{onClick:()=>{p((f==null?void 0:f.filePaths().gamePath)+"/"+w),l(!1)},children:w})},`${w}_${C}`)),!(h!=null&&h.length)&&o.jsx("li",{children:o.jsx(Ir,{children:"No local roms, load a game and save your file system"})})]})}),o.jsx(Be,{children:o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})}),o.jsx(He,{steps:g,completedProductTourStepName:"hasCompletedLoadLocalRomTour"})]})},Gg=I.button`
  padding: 0.5rem 0.5rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: none;
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,nt=I.li`
  cursor: pointer;
  display: grid;
  grid-template-columns: auto 32px;
  gap: 10px;

  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
`,qg=I.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${nt}:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${nt}:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${nt}:not(:first-child) {
    border-top-width: 0;
  }
`,Vg=I(pa)`
  width: 25px;
  height: 25px;
`,Hg=I(qt)`
  height: 100%;
  width: 20px;
`,Wg=I.form`
  display: flex;
  justify-content: space-between;
  gap: 16px;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  margin-bottom: 16px;
  padding-bottom: 16px;
`,Xg=()=>{var X,U,H;const l=Me(),{setIsModalOpen:f}=je(),{emulator:s}=ue(),[p,v]=R.useState(),[h,g]=R.useState(null),[b,k]=ke(Ea,0),S=R.useId(),{register:w,handleSubmit:C,setValue:L,formState:{errors:$,isSubmitSuccessful:G}}=er({defaultValues:{saveStateSlot:b}}),D=R.useCallback(()=>{var O;const P=(O=s==null?void 0:s.listSaveStates())==null?void 0:O.filter(A=>A!=="."&&A!=="..");v(P)},[s]);R.useEffect(()=>{L("saveStateSlot",b)},[b,L]);const N=async P=>{k(P.saveStateSlot)},V=p??((X=s==null?void 0:s.listSaveStates())==null?void 0:X.filter(P=>P!=="."&&P!=="..")),Y=[{content:o.jsx("p",{children:"Use this input and button to manually update the current save state slot in use."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${S}--save-state-slot-form`)}`},{content:o.jsx("p",{children:"Tap a row to load a save state, or use the trash can icon to delete a save state."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${S}--save-state-list`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new save state. This will automatically increase the current save state number!"]}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${S}--add-state-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Manage Save States"}),o.jsxs(Ie,{children:[o.jsxs(Wg,{id:`${S}--save-state-slot-form`,onSubmit:C(N),children:[o.jsx(ir,{label:"Current Save State Slot",type:"number",InputLabelProps:{shrink:!0},size:"small",error:!!($!=null&&$.saveStateSlot),helperText:(U=$==null?void 0:$.saveStateSlot)==null?void 0:U.message,...w("saveStateSlot",{required:{value:!0,message:"Slot is required"},min:{value:0,message:"Slot must be >= 0"},valueAsNumber:!0})}),o.jsx(yr,{copy:"Update Slot",showSuccess:G,size:"small",type:"submit",sx:{maxHeight:"40px"}})]}),o.jsxs(qg,{id:`${S}--save-state-list`,children:[(H=V==null?void 0:V.map)==null?void 0:H.call(V,(P,O)=>o.jsxs(nt,{children:[o.jsx(Gg,{onClick:()=>{const A=P.split(".").pop(),K=A==null?void 0:A.replace("ss","");if(K){const m=parseInt(K);(s==null?void 0:s.loadSaveState(m))?(k(m),g(null)):g("Failed to load save state")}},children:P}),o.jsx(cr,{"aria-label":`Delete ${P}`,sx:{padding:0},onClick:()=>{const A=P.split(".").pop(),K=A==null?void 0:A.replace("ss","");if(K){const m=parseInt(K);s==null||s.deleteSaveState(m),D()}},children:o.jsx(Hg,{})})]},`${P}_${O}`)),!(V!=null&&V.length)&&o.jsx("li",{children:o.jsx(Ir,{children:"No save states"})})]}),o.jsx(cr,{id:`${S}--add-state-button`,"aria-label":"Create new save state",sx:{padding:0},onClick:()=>{(s==null?void 0:s.createSaveState(b+1))?(D(),k(O=>O+1),g(null)):g("Failed to create save state")},children:o.jsx(Vg,{})}),h&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:h})]}),o.jsx(Be,{children:o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})}),o.jsx(He,{steps:Y,completedProductTourStepName:"hasCompletedSaveStatesTour"})]})},Kg=I.div`
  cursor: pointer;
  border-color: ${({theme:l})=>l.blackRussian};
  background-color: ${({$isDragActive:l=!1,theme:f})=>l?f.arcticAirBlue:f.aliceBlue2};
  border-width: 1px;
  border-style: dashed;
  padding: 0.5rem;
  text-align: center;
`,Yg=I(Bt)`
  height: 60px;
  width: auto;
`,Qg=I.div`
  padding-top: 3px;
`,Jg=I.ul`
  display: flex;
  flex-direction: column;
  gap: 10px;
  list-style: none;
  margin: 0;
  max-width: 100%;
  padding: 10px 5px 5px 5px;

  > p {
    margin: 0;
  }
`,Zg=I.li`
  align-items: center;
  display: flex;
  gap: 10px;
  justify-content: space-between;

  > p {
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
`,ev=I.div`
  display: flex;
  gap: 15px;
`,rv=({fileNames:l,onDeleteFile:f})=>o.jsxs(Jg,{children:[o.jsxs("p",{children:["File",l.length>1&&"s"," to upload:"]}),l.map((s,p)=>o.jsxs(Zg,{children:[o.jsx("p",{children:s}),o.jsx(ev,{children:o.jsx(cr,{"aria-label":`Delete ${s}`,sx:{padding:0},onClick:()=>f(s),children:o.jsx(qt,{})})})]},`${s}_${p}`))]}),tv=(l,f)=>{const s=`.${l.name.split(".").pop()}`;return f.some(p=>typeof p=="string"?p===s:!!p.regex.exec(s))},Dt=l=>typeof l=="string"?l:l.displayText,nv=(l,f)=>{if(!l.length)return;const s=f?"At least one":"One";let p=`${s} `+l.slice(0,-1).map(Dt).join(", ")+`, or ${Dt(l.slice(-1)[0])} file is required`;return l.length==1&&(p=`${s} ${Dt(l[0])} file is required`),v=>!(v instanceof File)||v&&tv(v,l)?null:{message:p,code:yp.FileInvalidType}},ct=({ariaLabel:l,children:f,error:s,hideAcceptedFiles:p,hideErrors:v,id:h,multiple:g=!1,name:b,onDrop:k,validFileExtensions:S})=>{const w=Me(),[C,L]=R.useState([]),{getRootProps:$,getInputProps:G,isDragActive:D,fileRejections:N}=_p({multiple:g,onDrop:U=>{L(U),k(U)},validator:nv(S,g)}),V=s?[s]:N.length&&C.length?["Some files were rejected"]:[...new Set(N.flatMap(U=>U.errors).map(U=>U.message))],Y=U=>{const H=C.filter(P=>P.name!==U);L(H),k(H)},X=C.map(U=>U.name);return o.jsxs(o.Fragment,{children:[o.jsxs(Kg,{...$({id:h,$isDragActive:D,"aria-label":l}),children:[o.jsx("input",{"data-testid":"hidden-file-input",...G({name:b})}),o.jsx(Yg,{}),f]}),!!X.length&&!p&&o.jsx(rv,{fileNames:X,onDeleteFile:Y}),!!V.length&&!v&&o.jsx(Qg,{children:V.map(U=>o.jsx(dr,{icon:o.jsx(lr,{style:{color:w.errorRed}}),text:U},U))})]})},av=[".cheats"],ov=()=>{const{setIsModalOpen:l}=je(),{emulator:f}=ue(),{reset:s,handleSubmit:p,setValue:v,formState:{isSubmitSuccessful:h},control:g}=er(),b=R.useId(),k=R.useCallback(C=>{s(),v("cheatFiles",C,{shouldValidate:!0})},[s,v]),S=({cheatFiles:C})=>{C.forEach(L=>f==null?void 0:f.uploadCheats(L)),s()},w=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your cheat files, or click to select files."}),o.jsx("p",{children:"Cheat files should be in libretro format and have the extension '.cheats'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${b}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Cheats"}),o.jsx(Ie,{children:o.jsxs("form",{id:b,"aria-label":"Upload Cheats Form",onSubmit:p(S),children:[o.jsx(Br,{control:g,name:"cheatFiles",rules:{validate:C=>(C==null?void 0:C.length)>0||"At least one .cheats file is required"},render:({field:{name:C,value:L},fieldState:{error:$}})=>o.jsx(ct,{ariaLabel:"Upload Cheats",id:`${b}--drag-and-drop`,onDrop:k,name:C,validFileExtensions:av,error:$==null?void 0:$.message,hideAcceptedFiles:!(L!=null&&L.length),hideErrors:h,multiple:!0,children:o.jsxs("p",{children:["Drag and drop cheat files here,",o.jsx("br",{}),"or click to upload files"]})})}),h&&o.jsx(Ra,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Be,{children:[o.jsx(yr,{copy:"Upload",form:b,showSuccess:h,type:"submit"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:w,completedProductTourStepName:"hasCompletedUploadCheatsTour"})]})},sv=()=>{const l=R.useCallback(async h=>{var L,$,G;const g={method:"GET"};if(!h)return;const b=await fetch(h.url,g),k=(G=($=(L=b.headers.get("Content-Disposition"))==null?void 0:L.split(";").pop())==null?void 0:$.split("=").pop())==null?void 0:G.replace(/"/g,""),S=decodeURIComponent(h.url.pathname.split("/").pop()??"unknown_external.gba");if(!b.ok)throw new Error(`Received unexpected status code: ${b.status}`);const w=await b.blob();return new File([w],k??S)},[]),{data:f,isLoading:s,error:p,execute:v}=jr({fetchFn:l,clearDataOnLoad:!0});return{data:f,isLoading:s,error:p,execute:v}},iv=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,lv=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,sa=[".gba",".gbc",".gb",".zip",".7z"],cv=({isLoading:l,currentRomURL:f,children:s,indicator:p})=>l?o.jsxs(iv,{children:[o.jsxs(lv,{children:["Loading rom from url:",o.jsx("br",{}),f]}),p]}):s,dv=()=>{var O,A;const l=Me(),{setIsModalOpen:f}=je(),{emulator:s}=ue(),{register:p,handleSubmit:v,setValue:h,reset:g,formState:{errors:b},watch:k,control:S}=er(),[w,C]=R.useState(null),{data:L,isLoading:$,error:G,execute:D}=sv(),N=R.useId(),V=lt(),Y=!$&&!!L&&!!w;R.useEffect(()=>{if(Y){const K=()=>{V((s==null?void 0:s.filePaths().gamePath)+"/"+L.name)&&f(!1)};s==null||s.uploadRom(L,K),C(null)}},[Y,L,s,f,V]);const X=R.useCallback(K=>{g(),h("romFile",K[0],{shouldValidate:!0})},[g,h]),U=async({romFile:K,romURL:m})=>{if(m){C(m),await D({url:new URL(m)});return}const ee=()=>{V((s==null?void 0:s.filePaths().gamePath)+"/"+K.name)&&f(!1)};s==null||s.uploadRom(K,ee)},H=!!k("romFile"),P=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your rom or zipped rom file, or click to select a file."}),o.jsxs("p",{children:["Rom files should have an extension of:"," ",sa.map(K=>`'${K}'`).join(", "),"."]}),o.jsx("p",{children:"You may drop or select one rom at a time, once uploaded your game will boot!"})]}),target:`#${CSS.escape(`${N}--drag-and-drop`)}`},{content:o.jsx("p",{children:"Alternatively, you may load a rom file from an external URL."}),target:`#${CSS.escape(`${N}--rom-url`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Rom"}),o.jsx(Ie,{children:o.jsx(cv,{isLoading:$,currentRomURL:w,indicator:o.jsx(ot,{color:l.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),children:o.jsxs("form",{id:N,"aria-label":"Upload Rom Form",onSubmit:v(U),children:[o.jsx(Br,{control:S,name:"romFile",rules:{validate:(K,m)=>!!m.romURL||!!K||"A rom file or URL is required"},render:({field:{name:K},fieldState:{error:m}})=>o.jsx(ct,{ariaLabel:"Upload Rom",id:`${N}--drag-and-drop`,onDrop:X,name:K,validFileExtensions:sa,hideErrors:!!m,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})}),!H&&o.jsxs(o.Fragment,{children:[o.jsx(vr,{sx:{padding:"10px 0"},children:"or"}),o.jsx(ir,{id:`${N}--rom-url`,error:!!(b!=null&&b.romURL),label:"Upload from a URL",size:"small",autoComplete:"romURL",variant:"filled",helperText:(O=b==null?void 0:b.romURL)==null?void 0:O.message,"aria-label":"Upload Rom From URL",fullWidth:!0,...p("romURL",{validate:(K,m)=>{if(!K)return!0;if(m.romFile)return"Cannot specify both a file and a URL";try{return new URL(K),!0}catch{return"Invalid URL"}}})}),!!G&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:"Loading rom from URL has failed"})]}),((A=b.romFile)==null?void 0:A.message)&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:b.romFile.message})]})})}),o.jsxs(Be,{children:[o.jsx(ie,{form:N,type:"submit",variant:"contained",children:"Upload"}),o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})]}),o.jsx(He,{steps:P,completedProductTourStepName:"hasCompletedUploadRomTour"})]})},uv=()=>{const[l,f]=R.useState(0),s=R.useCallback(b=>b?new Promise((k,S)=>{console.log("Reflashing Cartridge...");let w=b.romFile.size;const C=new FileReader;C.onload=L=>{if(L.target&&L.target.result){let $=L.target.result;typeof $=="string"&&($=new TextEncoder().encode($));let G=new Uint8Array($);const D=new XMLHttpRequest;D.open("POST",`${b.esp32IP}/upload_rom_file?cartSize=${w}`,!0),D.upload.onprogress=function(N){if(N.lengthComputable){const V=N.loaded/N.total*67;f(V)}},D.onload=()=>{if(D.status>=200&&D.status<300){const N=new XMLHttpRequest;N.open("POST",`${b.esp32IP}/verify_rom_file?cartSize=${w}`,!0),N.upload.onprogress=function(V){if(V.lengthComputable){const Y=67+V.loaded/V.total*33;f(Y)}},N.onload=()=>{N.status>=200&&N.status<300?k(!0):S("Rom on cartridge has errors")},N.onerror=()=>S("Failed to upload rom for verification"),N.send(G)}else S("Failed to upload rom to cartridge")},D.onerror=()=>S("Failed to upload rom to cartridge"),D.send(G)}},C.readAsArrayBuffer(b.romFile)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:v,error:h,execute:g}=jr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:h,execute:g,progress:l}},fv=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,mv=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,pv=[".gba",".gbc",".gb",".zip",".7z"],hv=I.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,gv=({isLoading:l,children:f,indicator:s,progress:p})=>l?o.jsxs(fv,{children:[o.jsx(mv,{children:p<4?"Erasing Sectors...":p>67?"Verifying ROM...":"Flashing new ROM to cartridge..."}),s,o.jsx(hv,{progress:p,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(p),"%"]})})]}):f,vv=({esp32IP:l})=>{const f=Me(),{setIsModalOpen:s}=je(),{handleSubmit:p,setValue:v,reset:h,control:g}=er(),{data:b,isLoading:k,error:S,execute:w,progress:C}=uv(),L=R.useId(),$=R.useCallback(D=>{h(),v("romFile",D[0],{shouldValidate:!0})},[h,v]),G=async({romFile:D})=>{if(console.log(b),D){await w({romFile:D,esp32IP:l});return}};return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Rom"}),o.jsx(Ie,{children:o.jsxs(gv,{isLoading:k,indicator:o.jsx(ot,{color:f.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:C,children:[!!S&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:f.errorRed}}),text:"Writing rom has failed"}),o.jsx("form",{id:L,"aria-label":"Upload Rom Form",onSubmit:p(G),children:o.jsx(Br,{control:g,name:"romFile",rules:{validate:D=>!!D||"A rom file is required"},render:({field:{name:D},fieldState:{error:N}})=>o.jsx(ct,{ariaLabel:"Upload Rom",id:`${L}--drag-and-drop`,onDrop:$,name:D,validFileExtensions:pv,hideErrors:!!N,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})})})]})}),o.jsxs(Be,{children:[o.jsx(ie,{form:L,type:"submit",variant:"contained",children:"Reflash Repro"}),o.jsx(ie,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]})]})},xv=[".sav",{regex:/\.ss[0-9]+/,displayText:".ss"}],bv=()=>{const{setIsModalOpen:l}=je(),{emulator:f}=ue(),{reset:s,handleSubmit:p,setValue:v,formState:{isSubmitSuccessful:h},control:g}=er(),b=R.useId(),k=R.useCallback(C=>{s(),v("saveFiles",C,{shouldValidate:!0})},[s,v]),S=({saveFiles:C})=>{C.forEach(L=>f==null?void 0:f.uploadSaveOrSaveState(L)),s()},w=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your save or save state files, or click to select files."}),o.jsx("p",{children:"The name of your files must match the name of your rom."}),o.jsx("p",{children:"Save and save state files should have an extension '.sav' or start with '.ss'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${b}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Saves"}),o.jsx(Ie,{children:o.jsxs("form",{id:b,"aria-label":"Upload Saves Form",onSubmit:p(S),children:[o.jsx(Br,{control:g,name:"saveFiles",rules:{validate:C=>(C==null?void 0:C.length)>0||"At least one .sav, or .ss file is required"},render:({field:{name:C,value:L},fieldState:{error:$}})=>o.jsx(ct,{ariaLabel:"Upload Saves",id:`${b}--drag-and-drop`,onDrop:k,name:C,validFileExtensions:xv,error:$==null?void 0:$.message,hideAcceptedFiles:!(L!=null&&L.length),hideErrors:h,multiple:!0,children:o.jsx("p",{children:"Drag and drop save or save state files here, or click to upload files"})})}),h&&o.jsx(Ra,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Be,{children:[o.jsx(yr,{copy:"Upload",form:b,showSuccess:h,type:"submit"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:w,completedProductTourStepName:"hasCompletedUploadSavesTour"})]})},sr="https://raw.githubusercontent.com/webesp124/gb_data/refs/heads/main",Ua=["FLASH1M_V102","FLASH1M_V103","FLASH_V124","FLASH_V126","FLASH_ECLA","EEPROM_V122","EEPROM_V124","SRAM_V112","SRAM_V113","REPRO_FLASH1M","NONE"],Ut=l=>(console.log("Save Type: "+l),l[0]=="N"?0:l[0]=="E"?1:l[0]=="S"?3:l[0]=="F"&&l[5]=="1"?5:l[0]=="F"?4:l[0]=="R"&&l[11]=="1"?55:(console.log("Invalid Save Type"),-1)),_v=(l,f)=>{let s=Number(f.cartSize/1024/1024),p="";return s==1?p=l.checksum_1MB:s==2?p=l.checksum_2MB:s==4?p=l.checksum_4MB:s==8?p=l.checksum_8MB:s==16&&(p=l.checksum_16MB),p.toUpperCase()},yv=l=>new Promise(f=>setTimeout(f,l)),wv=async l=>{let f,s;s=null;let p="";try{if(f=await(await fetch(`${l}/get_game_info`,{method:"GET",headers:{"Access-Control-Request-Private-Network":"true"}})).json(),f.romName=="")throw new Error("Error Reading Cartridge, ROM name empty");if(f.is_gba){if(s=await(await fetch(sr+`/information_rom_gba/${f.cartID}.json`)).json(),console.log(s),p=_v(f,s),p!=s.checksum1000){console.log("Checksums do not match. Trying to get a different one...");try{const g=await fetch(sr+`/information_rom_gba/${p}-${f.cartID}.json`);if(!g.ok||g.status!=200)throw new Error(`HTTP error! Status: ${g.status}`);let b=await g.json();b&&Object.keys(b).length>0?(console.log("Additional Data exists"),s=b):console.log("Additional Data does not exist or is empty")}catch(g){console.error("An error occurred while fetching additional data: ",g)}}}else s=await(await fetch(sr+`/information_rom_gb/${f.romName}.json`)).json(),console.log(s),f.checksumStr!=s.global_checksum&&console.log("Checksums do not match. Trying to get a different one...");return[f,s,p]}catch(v){console.error("Error fetching game information:",v)}finally{return[f,s,p]}},Sv=(l,f)=>{let s=f.coverImage;return s?s.startsWith("/")?l.is_gba?sr+s.replace("/covers/","/covers_gba/"):sr+s.replace("/covers/","/covers_gb/"):s.startsWith(".")?l.is_gba?sr+s.substring(1).replace("/covers/","/covers_gba/"):sr+s.substring(1).replace("/covers/","/covers_gb/"):s:""},Cv=()=>{const[l,f]=R.useState(0),s=R.useCallback(b=>b?new Promise((k,S)=>{const w=new XMLHttpRequest;w.open("GET",b.url,!0),w.responseType="arraybuffer",w.overrideMimeType("text/plain; charset=x-user-defined"),w.onprogress=function(C){if(C.lengthComputable){const L=C.loaded/C.total*100;f(L)}},w.onload=()=>{var C,L;if(w.status>=200&&w.status<300){const $=w.getResponseHeader("Content-Disposition"),G=(L=(C=$==null?void 0:$.split(";").pop())==null?void 0:C.split("=").pop())==null?void 0:L.replace(/"/g,""),D=decodeURIComponent(b.url.pathname.split("/").pop()??"unknown_external.gba"),N=new File([w.response],b.fullName??G??D);if(b.patchFile!=null&&b.patchFile!=""){console.log("applying bps patch to file: "+b.patchFile),b.patchFile.startsWith(".")&&(b.patchFile=sr+b.patchFile.substring(1));const V=new XMLHttpRequest;V.open("GET",b.patchFile,!0),V.responseType="arraybuffer",V.overrideMimeType("text/plain; charset=x-user-defined"),V.onload=()=>{const Y=new Uint8Array(V.response),{instructions:X,checksum:U}=wp(Y);console.log(U);const H=new Uint8Array(w.response),P=Sp(X,H),O=new File([P],b.fullName??G??D);k(O)},V.onerror=()=>{console.error("Request for patch file failed"),S(new Error("Network error occurred: Patch File"))},V.send(null)}else console.log("resolved file"),k(N)}else console.error("Request failed2"),S(new Error(`Received unexpected status code: ${w.status}`))},w.onerror=()=>{console.error("Request failed"),S(new Error("Network error occurred"))},w.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:v,error:h,execute:g}=jr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:h,execute:g,progress:l}},Ev=()=>{const[l,f]=R.useState(0),s=R.useCallback(b=>b?new Promise((k,S)=>{console.log(b.fullName);const w=new XMLHttpRequest;w.open("GET",b.url,!0),w.responseType="arraybuffer",w.overrideMimeType("text/plain; charset=x-user-defined"),w.onprogress=function(C){if(C.lengthComputable){const L=C.loaded/C.total*100;f(L)}},w.onload=()=>{var C,L;if(w.status>=200&&w.status<300){const $=w.getResponseHeader("Content-Disposition"),G=(L=(C=$==null?void 0:$.split(";").pop())==null?void 0:C.split("=").pop())==null?void 0:L.replace(/"/g,""),D=decodeURIComponent(b.url.pathname.split("/").pop()??"unknown_external.sav"),N=new File([w.response],b.fullName??G??D);k(N)}else S(new Error(`Received unexpected status code: ${w.status}`))},w.onerror=()=>{console.error("Request failed"),S(new Error("Network error occurred"))},w.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:v,error:h,execute:g}=jr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:h,execute:g,progress:l}},ia=({gameData:l,checksum1000String:f,selectedSave:s,setSelectedSave:p,saveName:v})=>{var k;const{emulator:h}=ue(),g=S=>{p(S)},b=((k=h==null?void 0:h.listSaves)==null?void 0:k.call(h).filter(S=>S.includes(l.cartID+"_"+f)))||[];return R.useEffect(()=>{for(const S of b)v===S&&p(S)},[]),o.jsx(o.Fragment,{children:o.jsx(Ht,{children:o.jsxs(Wt,{children:[o.jsx(va,{children:o.jsxs(Ce,{children:[o.jsx(ne,{children:"Select"}),o.jsx(ne,{children:"Save"}),o.jsx(ne,{children:"Last Saved"})]})}),o.jsxs(Xt,{children:[o.jsxs(Ce,{children:[o.jsx(ne,{children:o.jsx(Dr,{checked:s==="Cartridge Save",onChange:()=>g("Cartridge Save")})}),o.jsx(ne,{children:"Cartridge Save"}),o.jsx(ne,{children:"-"})]},"cartridge-save"),b.length>0?b.map((S,w)=>{var C;return o.jsxs(Ce,{sx:{borderBottom:w===b.length-1?"none":void 0},children:[o.jsx(ne,{sx:{borderBottom:w===b.length-1?"none":void 0},children:o.jsx(Dr,{checked:s===S,onChange:()=>g(S)})}),o.jsx(ne,{sx:{borderBottom:w===b.length-1?"none":void 0},children:S}),o.jsx(ne,{sx:{borderBottom:w===b.length-1?"none":void 0},children:(C=h==null?void 0:h.getStatSaves)==null?void 0:C.call(h,S).mtime.toLocaleString()})]},w)}):o.jsx(Ce,{children:o.jsx(ne,{colSpan:3,children:"None"})})]})]})})})},Ot=({gameData:l,checksum1000String:f,selectedGame:s,setSelectedGame:p,romName:v})=>{var k,S;const{emulator:h}=ue(),g=w=>{p(w)};let b;return l==null?b=((k=h==null?void 0:h.listRoms)==null?void 0:k.call(h).filter(w=>w!=="."&&w!==".."))||[]:b=((S=h==null?void 0:h.listRoms)==null?void 0:S.call(h).filter(w=>w.includes(l.cartID+"_"+f)))||[],R.useEffect(()=>{for(const w of b)v===w&&p(w)},[]),o.jsx(o.Fragment,{children:o.jsx(Ht,{children:o.jsxs(Wt,{children:[o.jsx(va,{children:o.jsxs(Ce,{children:[o.jsx(ne,{children:"Select"}),o.jsx(ne,{children:"Rom File"}),o.jsx(ne,{children:"Created"})]})}),o.jsxs(Xt,{children:[o.jsxs(Ce,{children:[o.jsx(ne,{children:o.jsx(Dr,{checked:s==="Cartridge Rom",onChange:()=>g("Cartridge Rom")})}),o.jsx(ne,{children:"Cartridge Rom"}),o.jsx(ne,{children:"-"})]},"cartridge-game"),b.length>0?b.map((w,C)=>{var L;return o.jsxs(Ce,{sx:{borderBottom:C===b.length-1?"none":void 0},children:[o.jsx(ne,{sx:{borderBottom:C===b.length-1?"none":void 0},children:o.jsx(Dr,{checked:s===w,onChange:()=>g(w)})}),o.jsx(ne,{sx:{borderBottom:C===b.length-1?"none":void 0},children:w}),o.jsx(ne,{sx:{borderBottom:C===b.length-1?"none":void 0},children:(L=h==null?void 0:h.getStatRoms)==null?void 0:L.call(h,w).mtime.toLocaleString()})]},C)}):o.jsx(Ce,{children:o.jsx(ne,{colSpan:3,children:"None"})})]})]})})})},kv=I.form`
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100dvw;
  max-width: fill-available;
  max-width: stretch;
  max-width: -webkit-fill-available;
  max-width: -moz-available;
`,Oa=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`;I.p`
  margin: 0;
  font-size: 16px;
`;I.strong`
`;I.option`
`;I.select`
`;const jv=I.img`
  max-width: 75%;
  height: auto;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid black;
`,Fv=I.div`
display: flex;
gap: 10px;
width: 100%;
flex-direction: column;
`,la=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,Lv=I.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,Rv=({isLoading:l,isExternalRomLoading:f,children:s,indicator:p,progress:v})=>l?o.jsxs(Oa,{children:[f&&o.jsx(la,{children:"Dumping Rom from cartridge..."}),!f&&o.jsx(la,{children:"Dumping Save from cartridge..."}),p,o.jsx(Lv,{progress:v,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(v),"%"]})})]}):s,ca=({additionalData:l,setAdditionalData:f,gameData:s,setGameData:p,esp32IP:v,setEsp32IP:h})=>{const g=Me(),{setIsModalOpen:b}=je(),{emulator:k}=ue(),{data:S,isLoading:w,error:C,execute:L,progress:$}=Cv(),{data:G,execute:D}=Ev(),N=lt(),[V,Y]=R.useState(!1),[X,U]=R.useState(!1),H=!w&&!!S,[P,O]=R.useState(null),[A,K]=R.useState("Cartridge Save"),[m,ee]=R.useState("Cartridge Rom"),Q=oe=>{const{name:ve,value:Ee}=oe.target;f(de=>({...de,[ve]:Ee}))};R.useEffect(()=>{if(H){const oe=()=>{N((k==null?void 0:k.filePaths().gamePath)+"/"+S.name)&&b(!1)};k==null||k.uploadRom(S,oe)}},[H,S,k,b,N]);const ce=async()=>{try{Y(!0);const[oe,ve,Ee]=await wv([v]);p(oe),f(ve),O(Ee),Y(!1)}catch(oe){console.error("Error fetching game info:",oe)}};R.useEffect(()=>{G!=null&&(k==null||k.uploadSaveOrSaveState(G))},[G,k]),R.useEffect(()=>{V||ce()},[]);const Te=()=>s.is_gba?l?l.fullName+"_"+s.cartID+"_"+P:s.romName+"_"+s.cartID+"_"+P:l?l.fullName+"_"+s.romName+"_"+s.checksumStr:s.romName+"_"+s.checksumStr,We=async()=>{U(!0),console.log("Using save: "+A),console.log("Using save: "+A);let oe=Te()+".sav";A=="Cartridge Save"&&(s.is_gba?await Xe(l.saveType,oe):s.sramSize&&await Je(oe)),await yv(300),console.log("save loaded"),await tr(),U(!1)},Qe=async oe=>{var Ee;let ve=(Ee=k==null?void 0:k.listRoms)==null?void 0:Ee.call(k);return console.log(ve),ve&&ve.includes(oe)?(console.log("rom exists locally"),N((k==null?void 0:k.filePaths().gamePath)+"/"+oe),b(!1),U(!1),!0):!1},tr=async()=>{if(U(!0),m!="Cartridge Rom")await Qe(m)||console.log("Unable to load local rom");else if(s.is_gba){let oe=Te()+".gba",ve=l.cartSize,Ee=`${v}/get_current_game.gba?cartSize=${ve}&saveType=4`;await L({url:new URL(Ee),fullName:oe,patchFile:l.patchFile})}else{let oe=Te()+".gb",ve=`${v}/get_current_game.gb`;await L({url:new URL(ve),fullName:oe,patchFile:null})}U(!1)},Xe=async(oe,ve)=>{try{console.log(oe);var Ee=Ut(oe);if(Ee==-1){console.log("Invalid Save Type");return}console.log(Ee);var de=`${v}/get_current_save?saveType=${Ee}`;await D({url:new URL(de),fullName:ve})}catch(Ae){console.error("Error fetching save:",Ae)}finally{}},Je=async oe=>{try{var ve=`${v}/get_current_save`;await D({url:new URL(ve),fullName:oe})}catch(Ee){console.error("Error fetching save:",Ee)}finally{}};return o.jsxs(o.Fragment,{children:[s&&l?o.jsx(Re,{title:l.fullName}):s&&!l?o.jsx(Re,{title:s.romName==""?"Error Reading Cartridge":s.romName}):!s&&l?o.jsx(Re,{title:l.fullName}):o.jsx(Re,{title:"No Response from Cart Reader"}),o.jsx(Ie,{children:o.jsxs(Rv,{isLoading:X,isExternalRomLoading:w,indicator:o.jsx(ot,{color:g.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:$,children:[!!C&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:g.errorRed}}),text:"Loading rom from URL has failed"}),o.jsx(o.Fragment,{children:s&&l&&o.jsxs(o.Fragment,{children:[o.jsx(Oa,{children:o.jsx(jv,{id:"cover-image",src:Sv(s,l),alt:`${l.fullName} Cover`})}),o.jsx(Ht,{id:"game-info",children:o.jsx(Wt,{children:o.jsxs(Xt,{children:[o.jsxs(Ce,{children:[o.jsx(ne,{children:"Full Name:"}),o.jsx(ne,{children:l.fullName})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"ROM Name:"}),o.jsx(ne,{children:s.romName})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"Cart Size:"}),o.jsx(ne,{children:o.jsxs($t,{name:"cartSize",value:l.cartSize,onChange:Q,children:[o.jsxs(et,{value:l.cartSize,children:[(l.cartSize/1024/1024).toFixed(2),"MB"]},(l.cartSize/1024/1024).toFixed(2)),[1,2,4,8,16,32,64].map(oe=>o.jsxs(et,{value:oe*1024*1024,children:[oe,"MB"]},oe))]})})]}),s&&s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Save Type:"}),o.jsx(ne,{children:o.jsx($t,{name:"saveType",value:l.saveType,onChange:Q,children:Ua.map(oe=>o.jsx(et,{value:oe,children:oe},oe))})})]}),l.patchFile!=null&&l.patchFile.length>0&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"BPS Patch File:"})," ",o.jsx(ne,{children:l.patchFile})]}),s&&s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Cart ID:"})," ",o.jsx(ne,{children:s.cartID})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"ROM Version:"})," ",o.jsx(ne,{children:s.romVersion})]}),s&&s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Checksum:"})," ",o.jsxs(ne,{children:["0x",P]})]}),s&&!s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Checksum:"})," ",o.jsxs(ne,{children:["0x",s.checksum_gb]})]}),s&&!s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Global Checksum:"})," ",o.jsxs(ne,{children:["0x",s.checksumStr]})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"Publisher:"})," ",o.jsx(ne,{children:l.publisher})]}),o.jsxs(Ce,{children:[o.jsx(ne,{style:{border:"none"},children:"Release Date:"})," ",o.jsx(ne,{style:{border:"none"},children:l.releaseDate})]})]})})}),k&&o.jsxs(o.Fragment,{children:[o.jsx(vr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Saves"}),s&&s.is_gba&&o.jsx(ia,{gameData:s,checksum1000String:P,selectedSave:A,setSelectedSave:K,saveName:Te()+".sav"}),s&&!s.is_gba&&o.jsx(ia,{gameData:s,checksum1000String:s.checksum_gb,selectedSave:A,setSelectedSave:K,saveName:Te()+".sav"}),o.jsx(vr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Roms"}),s&&s.is_gba&&o.jsx(Ot,{gameData:s,checksum1000String:P,selectedGame:m,setSelectedGame:ee,romName:Te()+".gba"}),s&&!s.is_gba&&o.jsx(Ot,{gameData:s,checksum1000String:s.checksum_gb,selectedGame:m,setSelectedGame:ee,romName:Te()+".gb"})]}),o.jsx(vr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"})]})}),s&&!s.is_gba&&!1,o.jsxs(kv,{"aria-label":"Login Form",children:[o.jsx(ir,{label:"ESP32 IP Address",autoComplete:"esp32IPInputField",variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px"},defaultValue:v,onChange:oe=>{h(oe.target.value)}}),o.jsxs(ie,{variant:"outlined",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"8px"},onClick:()=>{ce()},children:[o.jsx(Cp,{style:{fontSize:"18px"}})," ","Refresh"]})]})]})}),o.jsx(Be,{children:!X&&o.jsxs(Fv,{children:[o.jsxs(ie,{variant:"contained",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>We(),children:[o.jsx(Ep,{style:{fontSize:"30px",marginRight:"10px"}})," ","Start Game"]}),o.jsx(ie,{variant:"outlined",style:{padding:"10px 20px 10px 20px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>b(!1),children:"Close"})]})})]})},Tv=()=>{const{setIsModalOpen:l}=je(),{emulator:f}=ue(),s=[{label:"Full Name",value:"fullName",setter:"setFullName"},{label:"Cover Image",value:"coverImage",setter:"setCoverImage"},{label:"Publisher",value:"publisher",setter:"setPublisher"},{label:"Release Date",value:"releaseDate",setter:"setReleaseDate"},{label:"CRC",value:"crc",setter:"setCrc"},{label:"Cart Size (Bytes)",value:"cartSize",setter:"setCartSize"},{label:"Save Type",value:"saveType",setter:"setSaveType"},{label:"Checksum 1000",value:"checksum1000",setter:"setChecksum1000"},{label:"Cart ID",value:"cartId",setter:"setCartId"},{label:"Patch File",value:"patchFile",setter:"setPatchFile"},{label:"Console",value:"console",setter:"setConsole"}],[p,v]=R.useState({fullName:"",coverImage:"",publisher:"",releaseDate:"",crc:"",cartSize:"",saveType:"",checksum1000:"",cartId:"",patchFile:"",console:".gba"}),[h,g]=R.useState(""),[b,k]=R.useState(""),[S,w]=R.useState(new Uint8Array);R.useEffect(()=>{h&&V(h)},[h]);const C=X=>{const U=X.target.files[0];if(U){k(U.name);let H=G(U.name).fileName;v(O=>({...O,fullName:H})),v(O=>({...O,patchFile:H+".bps"}));const P=new FileReader;P.onload=O=>{if(O.target&&O.target.result){let A=O.target.result;typeof A=="string"&&(A=new TextEncoder().encode(A)),w(new Uint8Array(A))}},P.readAsArrayBuffer(U)}},L=(X,U)=>{v(H=>({...H,[U]:X.target.value}))},$=R.useId();function G(X){const U=X.match(/\.(gb|gbc|gba)$/i);return U?{fileName:X.replace(/\.(gb|gbc|gba)$/i,""),removedExtension:U[0]}:{fileName:X,removedExtension:"gba"}}const D=async X=>{let H=await(await fetch(`./information_rom/${X}.json`)).json();v(P=>({...P,coverImage:H.coverImage})),v(P=>({...P,publisher:H.publisher})),v(P=>({...P,releaseDate:H.releaseDate})),v(P=>({...P,saveType:H.saveType}))},N=()=>{const X={fullName:p.fullName,coverImage:p.coverImage,publisher:p.publisher,releaseDate:p.releaseDate,crc:p.crc,cartSize:p.cartSize,saveType:p.saveType,checksum1000:p.checksum1000,patchFile:"./patches/"+p.patchFile,console:p.console},U=JSON.stringify(X,null,2),H=new Blob([U],{type:"application/json"}),P=document.createElement("a");P.href=URL.createObjectURL(H),P.download=p.checksum1000+"-"+p.cartId+".json",document.body.appendChild(P),P.click(),URL.revokeObjectURL(P.href),document.body.removeChild(P)},V=X=>{const U=X.split("/").pop();if(U){v(m=>({...m,console:G(U).removedExtension})),v(m=>{var ee;return{...m,cartSize:(ee=f==null?void 0:f.getStatRoms)==null?void 0:ee.call(f,X).size}});const H=/_([A-Z0-9]{1,4})_([A-Z0-9]{1,8})\./,P=U.match(H);if(!P){console.log("No match found");return}const O=P[1],A=P[2];console.log("CartID:",O),console.log("Checksum1000:",A),v(m=>({...m,checksum1000:A})),v(m=>({...m,cartId:O}));const K=f==null?void 0:f.getFile("/data/games/"+X);if(K){let m=(kp.buf(K)>>>0).toString(16).toUpperCase();v(ee=>({...ee,crc:m}))}D(O)}},Y=()=>{const X=f==null?void 0:f.getFile("/data/games/"+h),U=S;if(X&&U){const H=jp(X,U),{buffer:P,checksum:O}=Fp(H);console.log("Patch Checksum: "+O);const A=new Blob([P],{type:"application/octet-stream"}),K=document.createElement("a");K.href=URL.createObjectURL(A),K.download=p.patchFile,document.body.appendChild(K),K.click(),URL.revokeObjectURL(K.href),document.body.removeChild(K),N()}};return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"File System"}),o.jsxs(Ie,{children:[o.jsx(vr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Base Rom"}),o.jsx(Ot,{gameData:null,checksum1000String:null,selectedGame:h,setSelectedGame:g,romName:".gba"}),o.jsx(vr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Patched Rom"}),o.jsx("input",{type:"file",onChange:C,accept:".gba"}),b&&o.jsxs("p",{children:["Selected File: ",b]}),o.jsx(vr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Information"}),s.map(X=>X.value!="saveType"?o.jsx(ir,{label:X.label,variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px",width:"98%"},value:p[X.value],onChange:U=>L(U,X.value)},X.value):null),o.jsx(rh,{sx:{minWidth:120},children:o.jsxs(th,{fullWidth:!0,style:{padding:"3px 8px 3px 8px",marginLeft:"5px",width:"98%",marginTop:"5px"},children:[o.jsx(nh,{id:"demo-simple-select-label",children:"Save Type"}),o.jsx($t,{name:"saveType",value:p.saveType,onChange:X=>L(X,"saveType"),label:"Save Type",style:{fontSize:"14px"},children:Ua.map(X=>o.jsx(et,{value:X,children:X},X))})]})})]}),o.jsxs(Be,{children:[o.jsx(yr,{copy:"Create Patch File",id:`${$}--create-patch-button-button`,onClick:()=>Y()}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},Pv=I.div`
  width: ${br}px;
  height: 100dvh;
  position: fixed;
  background-color: ${({theme:l})=>l.mediumBlack};
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  z-index: 150;
  overflow-y: auto;
  text-align: left;
  left: 0;
  top: 0;
  touch-action: none;

  ${({$isExpanded:l=!1})=>!l&&`left: -${br+5}px;
    `}

  &::-webkit-scrollbar {
    display: none;
  }
`,Mv=I.h2`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0.5rem 1rem;
  font-size: calc(1.3rem + 0.6vw);
  font-weight: 500;
  line-height: 1.2;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;

  &:hover {
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Av=I.ul`
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
  margin-top: 0;
  list-style: none;
  padding: 0;
`,Dv=I(Lr)`
  background-color: ${({theme:l})=>l.mediumBlack};
  color: ${({theme:l})=>l.pureWhite};
  z-index: 200;
  position: fixed;
  left: ${br-6}px;
  top: 12px;
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  cursor: pointer;
  padding: 0.375rem 0.75rem;
  border-radius: 0.25rem;
  border: none;
  min-height: 36px;
  min-width: 40px;

  ${({$isExpanded:l=!1})=>!l&&`left: -8px;
    `}

  &:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
`,Iv=I.button`
  position: absolute;
  width: calc(100dvw - ${br}px);
  left: ${br}px;
  height: 99%;
  background: 0 0;
  z-index: 140;
  border: none;
`,Bv=()=>{const[l,f]=R.useState(!0),{setModalContent:s,setIsModalOpen:p}=je(),{canvas:v,emulator:h}=ue(),{isRunning:g}=rr(),b=Me(),k=xr(b.isLargerThanPhone),S=R.useId(),w=La(),[C,L]=R.useState(null),[$,G]=R.useState(null),D="https://192.168.1.3",[N,V]=R.useState(D);return R.useEffect(()=>{const X=new URLSearchParams(window.location.search).get("esp32_ip");X&&V("https://"+X);const U=setTimeout(()=>{console.log("run12"),s(o.jsx(ca,{additionalData:C,setAdditionalData:L,gameData:$,setGameData:G,esp32IP:N,setEsp32IP:V})),p(!0)},500);return()=>clearTimeout(U)},[C,$,N]),o.jsxs(o.Fragment,{children:[o.jsx(Dv,{id:"menu-btn",$isExpanded:l,onClick:()=>f(Y=>!Y),"aria-label":"Menu Toggle",children:o.jsx(Lp,{})}),o.jsxs(Pv,{"data-testid":"menu-wrapper",id:"menu-wrapper",$isExpanded:l,children:[o.jsx(Mv,{id:S,children:"Menu"}),o.jsxs(Av,{"aria-labelledby":S,children:[o.jsx(Le,{title:"My Cartridge",icon:o.jsx(Tt,{}),$withPadding:!0,onClick:()=>{s(o.jsx(ca,{additionalData:C,setAdditionalData:L,gameData:$,setGameData:G,esp32IP:N,setEsp32IP:V})),p(!0)}}),o.jsxs(Zr,{title:"Pre Game Actions",$disabled:g,$isExpanded:!g,icon:o.jsx(ea,{}),children:[o.jsx(Le,{title:"Upload Saves",$disabled:g,icon:o.jsx(Bt,{}),onClick:()=>{s(o.jsx(bv,{})),p(!0)}}),o.jsx(Le,{title:"Upload Cheats",$disabled:g,icon:o.jsx(Bt,{}),onClick:()=>{s(o.jsx(ov,{})),p(!0)}}),o.jsx(Le,{title:"Upload Rom",$disabled:g,icon:o.jsx(Pt,{}),onClick:()=>{s(o.jsx(dv,{})),p(!0)}}),o.jsx(Le,{title:"Load Local Rom",$disabled:g,icon:o.jsx(Pt,{}),onClick:()=>{s(o.jsx(zg,{})),p(!0)}})]}),o.jsxs(Zr,{title:"Cartridge Actions",$isExpanded:g,icon:o.jsx(Rp,{}),children:[o.jsx(Le,{title:"Save to Cartridge",$disabled:!g,icon:o.jsx(Tp,{}),onClick:()=>{const Y=h==null?void 0:h.getCurrentSave(),X=h==null?void 0:h.getCurrentSaveName();if(Y&&X){const H=new XMLHttpRequest;if(!C){console.log("No save type information.");return}var U=Ut(C.saveType);if(U==-1){console.log("Invalid Save Type");return}console.log(U);const P=new Promise((O,A)=>{H.open("POST",`${N}/upload_save_file?saveType=${U}`,!0),H.onload=()=>{if(H.status>=200&&H.status<300){const K=new XMLHttpRequest;K.open("POST",`${N}/verify_save_file?saveType=${U}`,!0),K.onload=()=>{K.status>=200&&K.status<300?O("Uploaded  and verified save on cartridge"):A("Save on cartridge has errors")},K.onerror=()=>A("Failed to upload save for verification"),K.send(Y)}else A("Failed to upload save to cartridge")},H.onerror=()=>A("Failed to upload save to cartridge"),H.send(Y)});Ve.promise(P,{loading:"Uploading save to cartridge...",success:O=>`${O}`,error:O=>`${O}`})}else Ve.error("Current save not available")}}),o.jsx(Le,{title:"Verify Cartridge Save",$disabled:!g,icon:o.jsx(Pp,{}),onClick:()=>{let Y=h==null?void 0:h.getCurrentSave();const X=h==null?void 0:h.getCurrentSaveName();if(Y&&X){Y.length>131072&&(Y=Y.slice(0,131072));const H=new XMLHttpRequest;if(!C){console.log("No save type information.");return}var U=Ut(C.saveType);if(U==-1){console.log("Invalid Save Type");return}const P=new Promise((O,A)=>{H.open("POST",`${N}/verify_save_file?saveType=${U}`,!0),H.upload.onprogress=function(K){if(K.lengthComputable){const m=67+K.loaded/K.total*33;console.log(m+"( "+K.loaded+" )")}else console.log("event.lengthComputable is false")},H.onload=()=>{H.status>=200&&H.status<300?O("Verified save on cartridge"):A("Save on cartridge is not the same.")},H.onerror=()=>A("Failed to upload save"),H.send(Y)});Ve.promise(P,{loading:"Verifying save on cartridge...",success:O=>`${O}`,error:O=>`${O}`})}else Ve.error("Current save not available")}}),o.jsx(Le,{title:"Reflash Cartridge Rom",icon:o.jsx(Pt,{}),onClick:()=>{s(o.jsx(vv,{esp32IP:N})),p(!0)}})]}),o.jsxs(Zr,{title:"In Game Actions",$disabled:!g,$isExpanded:g,icon:o.jsx(Mp,{}),children:[o.jsx(Le,{title:"Screenshot",$disabled:!g,icon:o.jsx(Ap,{}),onClick:()=>{h!=null&&h.screenshot()?Ve.success("Screenshot saved successfully"):Ve.error("Screenshot has failed")}}),o.jsx(Le,{title:"Full Screen",$disabled:!g,icon:o.jsx(Dp,{}),onClick:()=>{v==null||v.requestFullscreen().catch(()=>{Ve.error("Full screen request has failed")})}}),o.jsx(Le,{title:"Download Save",$disabled:!g,icon:o.jsx(ha,{}),onClick:()=>{s(o.jsx(Lg,{})),p(!0)}}),o.jsx(Le,{title:"Quick Reload",$disabled:!g,icon:o.jsx(Ip,{}),onClick:w}),o.jsx(Le,{title:"Manage Save States",$disabled:!g,icon:o.jsx(Bp,{}),onClick:()=>{s(o.jsx(Xg,{})),p(!0)}}),o.jsx(Le,{title:"Manage Cheats",$disabled:!g,icon:o.jsx($p,{}),onClick:()=>{s(o.jsx(_g,{})),p(!0)}})]}),o.jsx(Le,{title:"Controls",icon:o.jsx(Tt,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Fg,{})),p(!0)}}),o.jsx(Le,{title:"File System",icon:o.jsx(Np,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Ug,{})),p(!0)}}),o.jsxs(Zr,{title:"Other",icon:o.jsx(ea,{}),children:[o.jsx(Le,{title:"Create Patch File",icon:o.jsx(Tt,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Tv,{})),p(!0)}}),o.jsx(Le,{title:"About",icon:o.jsx(Up,{}),$withPadding:!0,onClick:()=>{s(o.jsx(ig,{})),p(!0)}})]})]})]}),l&&!k&&o.jsx(Iv,{"aria-label":"Menu Dismiss",onClick:()=>{f(!1)}})]})};I.ul`
  text-align: left;
`;const $v=()=>!0,Nv=()=>{const[l]=ke(nn);return l!=null&&l.hasCompletedProductTourIntro?o.jsx(Op,{}):null},Uv=240,Ov=160,zv=I.canvas`
  background-color: ${({theme:l})=>l.pureBlack};
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -moz-crisp-edges;
  image-rendering: -o-crisp-edges;
  width: 100%;
  height: 100%;
  display: block;
  margin: 0 auto;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`,Gv=I(fa)`
  background-color: ${({theme:l})=>l.pureBlack};
  border: solid 1px ${({theme:l})=>l.pureBlack};
  overflow: visible;
  width: 100dvw;
  height: calc(100dvw * 2 / 3);

  @media ${({theme:l})=>l.isLargerThanPhone} {
    width: min(
      calc(100dvw - ${br+35}px),
      calc(85dvh * 3 / 2)
    );
    height: 85dvh;
  }
`,qv={width:"",height:""},Vv=()=>{var G,D;const l=Me(),f=xr(l.isLargerThanPhone),{setCanvas:s}=ue(),{areItemsDraggable:p}=st(),{areItemsResizable:v}=Sa(),{layouts:h,setLayout:g,hasSetLayout:b}=Fr(),k=f?br+10:0,S=f?15:0,w=R.useCallback(N=>{var V,Y,X,U,H,P,O,A;b||((X=(Y=(V=N==null?void 0:N.resizableElement)==null?void 0:V.current)==null?void 0:Y.style)==null||X.removeProperty("width"),(P=(H=(U=N==null?void 0:N.resizableElement)==null?void 0:U.current)==null?void 0:H.style)==null||P.removeProperty("height")),!((O=h==null?void 0:h.screen)!=null&&O.initialBounds)&&N&&g("screen",{initialBounds:(A=N.resizableElement.current)==null?void 0:A.getBoundingClientRect()})},[b,h,g]),C=R.useCallback(N=>s(N),[s]),L=((G=h==null?void 0:h.screen)==null?void 0:G.position)??{x:k,y:S},$=((D=h==null?void 0:h.screen)==null?void 0:D.size)??qv;return o.jsx(Gv,{"data-testid":"screen-wrapper",disableDragging:!p,ref:w,enableResizing:v,resizeHandleComponent:{topRight:o.jsx(kr,{variation:"topRight"}),bottomRight:o.jsx(kr,{variation:"bottomRight"}),bottomLeft:o.jsx(kr,{variation:"bottomLeft"}),topLeft:o.jsx(kr,{variation:"topLeft"})},resizeHandleStyles:{topRight:{marginTop:"15px",marginRight:"15px"},bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"},topLeft:{marginTop:"15px",marginLeft:"15px"}},position:L,size:$,onDragStop:(N,V)=>{g("screen",{position:{x:V.x,y:V.y}})},onResizeStop:(N,V,Y,X,U)=>{g("screen",{size:{width:Y.clientWidth,height:Y.clientHeight},position:{...U}})},children:o.jsx(zv,{"data-testid":"screen-wrapper:render-canvas",ref:C,width:Uv,height:Ov})})},Hv=I.div`
  background-color: #fff;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  height: fit-content;
  inset: 10px;
  margin: 25px auto auto;
  padding-top: 25px;
  max-height: 80%;
  max-width: calc(100dvw - 20px);
  padding: 0;
  touch-action: none;
  user-select: text;
  width: fit-content;

  @media ${({theme:l})=>l.isLargerThanPhone} {
    max-width: 600px;
  }
`,Wv=I.div`
  background-color: rgba(0, 0, 0, 0.5);
  width: 100dvw;
  height: 100dvh;
  position: absolute;
`,Xv=I(Pa)`
  justify-content: center;
`,Kv=I(Ma)`
  padding: 1em 1em 0 1em;
`,Yv=I.img`
  object-fit: contain;
  max-width: 100%;
`,Qv=I(Aa)`
  justify-content: center;
  flex-wrap: wrap;
`,Jv=I.div`
  position: relative;
`,Zv=I.a`
  font-size: 5px;
  position: absolute;
  right: 15%;
  bottom: 6%;
`,da=()=>o.jsx("span",{children:"→"}),ex=({error:l,resetErrorBoundary:f})=>o.jsx(Wv,{children:o.jsxs(Hv,{role:"alert",children:[o.jsx(Xv,{children:o.jsx(Ta,{children:"An irrecoverable error occurred"})}),o.jsxs(Kv,{children:[o.jsxs(Jv,{children:[o.jsx(Yv,{src:"/img/error-512x512.png",alt:"GameBoy Advance with error icon"}),o.jsx(Zv,{target:"_blank",href:"https://www.freepik.com/free-vector/editable-text-effect-error-3d-hack-virus-font-style_21408324.htm",children:"Font by NACreative"})]}),o.jsx("p",{style:{color:"red"},children:l.message}),o.jsx("p",{children:"Please use the buttons below to copy the stack trace and create an issue, this helps a lot with error reporting!"})]}),o.jsxs(Qv,{children:[o.jsx(ie,{color:"info",variant:"contained",onClick:()=>{navigator.clipboard.writeText(l.stack??"No stack available")},children:"Copy trace"}),o.jsx(da,{}),o.jsx(ie,{color:"success",variant:"contained",href:"https://github.com/thenick775/gbajs3/issues",target:"_blank",children:"Create issue"}),o.jsx(da,{}),o.jsx(ie,{color:"secondary",variant:"contained",onClick:f,children:"Dismiss and reset"})]})]})}),rx=({children:l})=>o.jsx(zp,{fallbackRender:ex,children:l}),tx=()=>{const l=Me();return o.jsx(Gp,{toastOptions:{success:{duration:1e3},error:{duration:1500},style:{background:l.darkCharcoal,color:l.pureWhite}}})},nx=({children:l})=>o.jsx(uh,{children:o.jsx(mh,{children:o.jsx(sh,{children:o.jsx(fh,{children:l})})})}),ax={isLargerThanPhone:"only screen and (min-width: 600px)",isMobileLandscape:"only screen and (max-height: 1000px) and (max-width: 1000px) and (orientation: landscape)",isMobilePortrait:"only screen and (max-width: 1000px) and (orientation: portrait)",isMobileWithUrlBar:"only screen and (max-height: 700px) and (orientation: portrait)",aliceBlue1:"#f8f9fa",aliceBlue2:"#edf2f7",arcticAirBlue:"#cad8e5",blackRussian:"#1a202c",blueCharcoal:"#212529",checkMarkGreen:"#7ac142",darkCharcoal:"#333",darkGrayBlue:"#495057",disabledGray:"#6c757d",errorRed:"#d32f2f",gbaThemeBlue:"#0d6efd",mediumBlack:"#100901",menuHighlight:"#ffffff26",menuHover:"#0a58ca",pattensBlue:"#dee2e6",pureBlack:"#000",pureWhite:"#fff",darkGray:"#111",panelControlGray:"#a9a9a9",panelBlueGray:"#4f555a"},ox=()=>o.jsx(qp,{theme:ax,children:o.jsxs(rx,{children:[o.jsx($v,{}),o.jsx(tx,{}),o.jsx(Nv,{}),o.jsx(oh,{children:o.jsx(nx,{children:o.jsx(gh,{children:o.jsxs(vh,{children:[o.jsx(Bv,{}),o.jsx(Vv,{}),o.jsx(Th,{}),o.jsx(Yh,{}),o.jsx(Jh,{})]})})})})]})});Vp.createRoot(document.getElementById("root")).render(o.jsx(at.StrictMode,{children:o.jsx(ox,{})}));
