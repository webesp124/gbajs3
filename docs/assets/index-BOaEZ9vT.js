import{r as R,z as ap,A as Gt,j as o,B as Ce,D as op,E as I,q as ot,F as Me,H as sp,I as ma,J as pa,K as ha,L as ip,M as lp,N as cp,O as Zn,Q as ea,S as dp,U as up,V as fp,W as mp,X as Bt,Y as Ve,Z as lr,$ as st,a0 as pp,a1 as hp,a2 as vp,a3 as gp,a4 as xp,a5 as bp,a6 as qt,a7 as _p,a8 as va,a9 as er,aa as yp,ab as $r,ac as ga,ad as Vt,ae as $t,af as wp,ag as Sp,ah as Cp,ai as Ep,aj as kp,ak as jp,al as Fp,am as Lp,an as Rp,ao as Tp,ap as Pt,aq as ra,ar as Mt,as as Pp,at as Mp,au as Ap,av as Dp,aw as Ip,ax as Bp,ay as $p,az as Np,aA as Up,aB as Op,aC as zp,aD as Gp,aE as qp,aF as Vp,aG as Hp,aH as Wp}from"./vendor-D4aslcEV.js";import{S as At,c as Xp}from"./vendor_react-joyride-BJHucF7z.js";import{u as gr,S as Kp,I as cr,B as ie,F as xa,C as Ir,T as ir,a as Yp,b as Qp,c as ta,d as Ht,s as Jp,e as Zp,t as Dt,f as eh,g as rh,h as th,D as Qe,i as Wt,j as Xt,k as ba,l as Fe,m as oe,n as Kt,o as Nt,M as rt,p as nh,q as ah,r as oh}from"./vendor_@mui-CQqMkmd2.js";(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))p(x);new MutationObserver(x=>{for(const h of x)if(h.type==="childList")for(const v of h.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&p(v)}).observe(document,{childList:!0,subtree:!0});function s(x){const h={};return x.integrity&&(h.integrity=x.integrity),x.referrerPolicy&&(h.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?h.credentials="include":x.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function p(x){if(x.ep)return;x.ep=!0;const h=s(x);fetch(x.href,h)}})();const _a="currentEmulatorVolume",ya="currentEmulatorKeyBindings",wa="currentGameName",Sa="currentFastForward",Yt="currentCoreCallbacks",Fr=({fetchFn:l,loadOnMount:f=!1,clearDataOnLoad:s=!1})=>{const[p,x]=R.useState(null),[h,v]=R.useState(null),[b,k]=R.useState(!1),S=()=>v(null),w=R.useCallback(async C=>{k(!0),v(null),s&&x(null);try{const L=await l(C);x(L),k(!1)}catch(L){v(L),k(!1)}},[s,l]);return R.useEffect(()=>{f&&l&&w()},[]),{data:p,isLoading:b,error:h,clearError:S,execute:w}},sh=({loadOnMount:l=!1}={})=>{const s=R.useCallback(async()=>(await fetch("undefined/api/tokens/refresh",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json(),[void 0]),{data:p,isLoading:x,error:h,clearError:v,execute:b}=Fr({fetchFn:s,clearDataOnLoad:!0,loadOnMount:l});return{data:p,isLoading:x,error:h,clearError:v,execute:b}},Qt=R.createContext(null);Qt.displayName="AuthContext";const ih=({children:l})=>{const[p,x]=R.useState(null),[h,v]=R.useState(null),{data:b,isLoading:k,execute:S,error:w,clearError:C}=sh({loadOnMount:!1}),L=!k&&!!b;R.useEffect(()=>{L&&(x(b),v("refresh"))},[L,b]);const $=R.useCallback(()=>{if(p){const{exp:D}=ap(p);if(D&&Date.now()<=D*1e3)return!0}return!1},[p]),G=$()&&!b&&h!=="refresh";return R.useEffect(()=>{G&&C()},[G,C]),Gt(async()=>{await S()},$()&&!w?24e4:null),o.jsx(Qt.Provider,{value:{accessToken:p,setAccessToken:x,setAccessTokenSource:v,isAuthenticated:$},children:l})},Jt=R.createContext(null);Jt.displayName="DragContext";const lh=({children:l})=>{const[f,s]=R.useState(!1);return o.jsx(Jt.Provider,{value:{areItemsDraggable:f,setAreItemsDraggable:s},children:l})},Ye=0,ch=3,dh=l=>{const f=l.filePaths(),s=(b,k)=>{var w,C;let S=(w=b==null?void 0:b.split("/"))==null?void 0:w.pop();if(k){const L="."+((C=S==null?void 0:S.split("."))==null?void 0:C.pop());S=S==null?void 0:S.replace(L,k)}return S},p=()=>{const b={path:f.root,isDir:!0,children:[]},k=[".",".."],S=({path:w,children:C})=>{for(const L of l.FS.readdir(w)){if(k.includes(L))continue;const $=`${w}/${L}`,{mode:G}=l.FS.lookupPath($,{}).node,D={path:$,isDir:l.FS.isDir(G),children:[]};C==null||C.push(D),D.isDir&&S(D)}};return S(b),b},x=b=>{var L;const k=b.split(`
`),S=["cheats = ",""];if(!((L=k==null?void 0:k[0])!=null&&L.match("^cheats = [0-9]+$")))return[];const w={},C={desc:"desc",code:"code",enable:"enable"};for(const $ of k){if(S.includes($))continue;const G=$.match(/^cheat([0-9]+)_([a-zA-Z]+)\s*=\s*"?([a-zA-Z0-9\s+:_]+)"?$/);if(G){const[,D,N,V]=G,Y=C[N];w[D]=w[D]||{desc:"",code:"",enable:!1},Y&&(w[D][Y]=Y===C.enable?V.toLowerCase()==="true":V)}}return Object.values(w)},h=b=>{const k=b.map((C,L)=>`cheat${L}_desc = "${C.desc}"
cheat${L}_enable = ${C.enable}
cheat${L}_code = "${C.code}"
`),S=`cheats = ${k==null?void 0:k.length}

`,w=s(l.gameName,".cheats");if(k!=null&&k.length&&w){const C=S+k.join(`
`),L=new Blob([C],{type:"text/plain"});return new File([L],w)}return null},v=({key:b,location:k})=>{let S=k===ch?`Keypad ${b}`:b;return S.toLowerCase().includes("enter")&&(S=S.replace(/enter/gi,"Return")),S.toLowerCase().includes("arrow")&&(S=S.replace(/arrow/gi,"")),S};return{addCoreCallbacks:l.addCoreCallbacks,autoLoadCheats:l.autoLoadCheats,createSaveState:l.saveState,defaultKeyBindings:()=>[{gbaInput:"A",key:"X",location:Ye},{gbaInput:"B",key:"Z",location:Ye},{gbaInput:"L",key:"A",location:Ye},{gbaInput:"R",key:"S",location:Ye},{gbaInput:"Start",key:"Enter",location:Ye},{gbaInput:"Select",key:"Backspace",location:Ye},{gbaInput:"Up",key:"ArrowUp",location:Ye},{gbaInput:"Down",key:"ArrowDown",location:Ye},{gbaInput:"Left",key:"ArrowLeft",location:Ye},{gbaInput:"Right",key:"ArrowRight",location:Ye}],loadSaveState:l.loadState,listSaveStates:()=>l.FS.readdir(f.saveStatePath),listRoms:()=>l.FS.readdir(f.gamePath),listSaves:()=>l.FS.readdir(f.savePath),getStatSaves:b=>l.FS.stat("/data/saves/"+b),getStatRoms:b=>l.FS.stat("/data/games/"+b),setVolume:async b=>{(l.SDL2.audioContext.state==="suspended"||l.SDL2.audioContext.state==="interrupted")&&await l.SDL2.audioContext.resume(),l.setVolume(b)},getVolume:l.getVolume,enableKeyboardInput:()=>l.toggleInput(!0),disableKeyboardInput:()=>l.toggleInput(!1),simulateKeyDown:l.buttonPress,simulateKeyUp:l.buttonUnpress,setFastForwardMultiplier:l.setFastForwardMultiplier,isFastForwardEnabled:()=>l.getFastForwardMultiplier()>1,run:l.loadGame,getCurrentRom:()=>l.gameName?l.FS.readFile(l.gameName):null,getCurrentGameName:()=>s(l.gameName),setCurrentGameName:b=>{b&&!l.gameName&&(l.gameName=b)},getCurrentSave:()=>l.saveName?l.getSave():null,getCurrentSaveName:()=>s(l.saveName),getFile:b=>l.FS.readFile(b),uploadCheats:l.uploadCheats,uploadRom:l.uploadRom,uploadSaveOrSaveState:l.uploadSaveOrSaveState,deleteSaveState:b=>{const k=s(l.saveName,".ss"+b),S=`${f.saveStatePath}/${k}`;l.FS.unlink(S)},deleteFile:l.FS.unlink,pause:l.pauseGame,resume:l.resumeGame,quitGame:l.quitGame,quitEmulator:l.quitMgba,quickReload:l.quickReload,getCurrentCheatsFile:()=>{const b=s(l.gameName,".cheats"),k=`${f.cheatsPath}/${b}`;return l.FS.analyzePath(k).exists?l.FS.readFile(k):new Uint8Array},getCurrentCheatsFileName:()=>s(l.gameName,".cheats"),screenshot:l.screenshot,remapKeyBindings:b=>b.forEach(k=>l.bindKey(v(k),k.gbaInput)),filePaths:l.filePaths,fsSync:l.FSSync,listAllFiles:p,parseCheatsString:x,parsedCheatsToFile:h}};var uh=(()=>{var l=import.meta.url;return function(f={}){var s=f,p,x;s.ready=new Promise((e,r)=>{p=e,x=r}),s.loadGame=e=>{if(ue("loadGame","number",["string"])(e)){const t=e.split(".");t.pop();const n=t.join(".")+".sav";return s.gameName=e,s.saveName=n.replace("/data/games/","/data/saves/"),!0}return!1},s.getSave=()=>c.readFile(s.saveName),s.listRoms=()=>c.readdir("/data/games/"),s.listSaves=()=>c.readdir("/data/saves/"),s.FSInit=()=>new Promise((e,r)=>{c.mkdir("/data"),c.mount(c.filesystems.IDBFS,{},"/data"),c.syncfs(!0,t=>{t&&r(new Error(`Error syncing app data from IndexedDB: ${t}`));try{c.mkdir("/data/saves")}catch{}try{c.mkdir("/data/states")}catch{}try{c.mkdir("/data/games")}catch{}try{c.mkdir("/data/cheats")}catch{}try{c.mkdir("/data/screenshots")}catch{}e()})}),s.FSSync=()=>new Promise((e,r)=>{c.syncfs(t=>{t&&r(new Error(`Error syncing app data to IndexedDB: ${t}`)),e()})}),s.filePaths=()=>({root:"/data",cheatsPath:"/data/cheats",gamePath:"/data/games",savePath:"/data/saves",saveStatePath:"/data/states",screenshotsPath:"/data/screenshots"}),s.uploadSaveOrSaveState=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="sav")a="/data/saves/";else if(n.startsWith("ss"))a="/data/states/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadRom=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(["gba","gbc","gb","zip","7z"].includes(n))a="/data/games/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadCheats=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="cheats")a="/data/cheats/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)};const h=new Map([["a",0],["b",1],["select",2],["start",3],["right",4],["left",5],["up",6],["down",7],["r",8],["l",9]]);s.buttonPress=e=>{ue("buttonPress",null,["number"])(h.get(e.toLowerCase()))},s.buttonUnpress=e=>{ue("buttonUnpress",null,["number"])(h.get(e.toLowerCase()))},s.bindKey=(e,r)=>{ue("bindKey",null,["string","number"])(e,h.get(r.toLowerCase()))},s.pauseGame=()=>{ue("pauseGame",null,[])()},s.resumeGame=()=>{ue("resumeGame",null,[])()},s.getVolume=()=>ue("getVolume","number",[])(),s.setVolume=e=>{ue("setVolume",null,["number"])(e)},s.getMainLoopTimingMode=()=>ue("getMainLoopTimingMode","number",[])(),s.getMainLoopTimingValue=()=>ue("getMainLoopTimingValue","number",[])(),s.setMainLoopTiming=(e,r)=>{ue("setMainLoopTiming","number",["number","number"])(e,r)},s.quitGame=()=>{ue("quitGame",null,[])()},s.quitMgba=()=>{ue("quitMgba",null,[])()},s.quickReload=()=>{ue("quickReload",null,[])()},s.toggleInput=e=>{ue("setEventEnable",null,["boolean"])(e)},s.screenshot=e=>ue("screenshot","boolean",["string"])(e),s.saveState=e=>ue("saveState","boolean",["number"])(e),s.loadState=e=>ue("loadState","boolean",["number"])(e),s.saveStateSlot=(e,r)=>{var t=ue("saveStateSlot","number",["number","number"]);return s.saveStateSlot=(n,a)=>(a===void 0&&(a=63),t(n,a)),s.saveStateSlot(e,r)},s.loadStateSlot=(e,r)=>{var t=ue("loadStateSlot","number",["number","number"]);return s.loadStateSlot=(n,a)=>(a===void 0&&(a=61),t(n,a)),s.loadStateSlot(e,r)},s.autoLoadCheats=()=>ue("autoLoadCheats","bool",[])(),s.setFastForwardMultiplier=e=>{ue("setFastForwardMultiplier",null,["number"])(e)},s.getFastForwardMultiplier=()=>ue("getFastForwardMultiplier","number",[])();const v={alarmCallbackPtr:null,coreCrashedCallbackPtr:null,keysReadCallbackPtr:null,saveDataUpdatedCallbackPtr:null,videoFrameEndedCallbackPtr:null,videoFrameStartedCallbackPtr:null};s.addCoreCallbacks=e=>{const r=ue("addCoreCallbacks",null,["number"]);Object.keys(v).forEach(t=>{const n=t.replace("CallbackPtr","Callback"),a=e[n];a!==void 0&&v[t]&&(Hn(v[t]),v[t]=null),a&&(v[t]=Vn(a,"vi"))}),r(v.alarmCallbackPtr,v.coreCrashedCallbackPtr,v.keysReadCallbackPtr,v.saveDataUpdatedCallbackPtr,v.videoFrameEndedCallbackPtr,v.videoFrameStartedCallbackPtr)};var b=Object.assign({},s),k="./this.program",S=(e,r)=>{throw r},w=!0,C="";function L(e){return s.locateFile?s.locateFile(e,C):C+e}var $,G;typeof document<"u"&&document.currentScript&&(C=document.currentScript.src),l&&(C=l),C.startsWith("blob:")?C="":C=C.substr(0,C.replace(/[?#].*/,"").lastIndexOf("/")+1),$=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},G=(e,r,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){r(n.response);return}t()},n.onerror=t,n.send(null)};var D=s.print||console.log.bind(console),N=s.printErr||console.error.bind(console);Object.assign(s,b),b=null,s.arguments&&s.arguments,s.thisProgram&&(k=s.thisProgram),s.quit&&(S=s.quit);var V;s.wasmBinary&&(V=s.wasmBinary),typeof WebAssembly!="object"&&or("no native wasm support detected");var Y,X=!1,U;function H(e,r){e||or(r)}var P,O,A,K,m,ee,Q,ce;function Te(){var e=Y.buffer;s.HEAP8=P=new Int8Array(e),s.HEAP16=A=new Int16Array(e),s.HEAPU8=O=new Uint8Array(e),s.HEAPU16=K=new Uint16Array(e),s.HEAP32=m=new Int32Array(e),s.HEAPU32=ee=new Uint32Array(e),s.HEAPF32=Q=new Float32Array(e),s.HEAPF64=ce=new Float64Array(e)}var We=[],Je=[],tr=[],Xe=[];function ne(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)fe(s.preRun.shift());Ur(We)}function ge(){!s.noFSInit&&!c.init.initialized&&c.init(),c.ignorePermissions=!1,Ur(Je)}function Le(){Ur(tr)}function nr(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)$e(s.postRun.shift());Ur(Xe)}function fe(e){We.unshift(e)}function Be(e){Je.unshift(e)}function $e(e){Xe.unshift(e)}var ar=0,ur=null;function lx(e){return e}function ut(e){var r;ar++,(r=s.monitorRunDependencies)==null||r.call(s,ar)}function Nr(e){var t;if(ar--,(t=s.monitorRunDependencies)==null||t.call(s,ar),ar==0&&ur){var r=ur;ur=null,r()}}function or(e){var t;(t=s.onAbort)==null||t.call(s,e),e="Aborted("+e+")",N(e),X=!0,U=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw x(r),r}var qa="data:application/octet-stream;base64,",on=e=>e.startsWith(qa),fr;s.locateFile?(fr="mgba.wasm",on(fr)||(fr=L(fr))):fr=new URL(""+new URL("mgba-C3uUnxP8.wasm",import.meta.url).href,import.meta.url).href;function sn(e){if(e==fr&&V)return new Uint8Array(V);throw"both async and sync fetching of the wasm failed"}function Va(e){return!V&&w&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at '${e}'`;return r.arrayBuffer()}).catch(()=>sn(e)):Promise.resolve().then(()=>sn(e))}function ln(e,r,t){return Va(e).then(n=>WebAssembly.instantiate(n,r)).then(n=>n).then(t,n=>{N(`failed to asynchronously prepare wasm: ${n}`),or(n)})}function Ha(e,r,t,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!on(r)&&typeof fetch=="function"?fetch(r,{credentials:"same-origin"}).then(a=>{var i=WebAssembly.instantiateStreaming(a,t);return i.then(n,function(d){return N(`wasm streaming compile failed: ${d}`),N("falling back to ArrayBuffer instantiation"),ln(r,t,n)})}):ln(r,t,n)}function Wa(){var e={a:Vm};function r(n,a){return ae=n.exports,Y=ae._d,Te(),mr=ae.Ae,Be(ae.$d),Nr(),ae}ut();function t(n){r(n.instance)}if(s.instantiateWasm)try{return s.instantiateWasm(e,r)}catch(n){N(`Module.instantiateWasm callback failed with error: ${n}`),x(n)}return Ha(V,fr,e,t).catch(x),{}}var Z,me,cn={272368:(e,r)=>{s.canvas.width=e,s.canvas.height=r},272425:(e,r,t,n,a,i,d)=>{s.version={gitCommit:Pe(e),gitShort:Pe(r),gitBranch:Pe(t),gitRevision:n,binaryName:Pe(a),projectName:Pe(i),projectVersion:Pe(d)}},272657:()=>{c.syncfs(function(e){H(!e)})},272701:()=>typeof AudioContext<"u"?!0:typeof webkitAudioContext<"u",272848:()=>typeof navigator.mediaDevices<"u"&&typeof navigator.mediaDevices.getUserMedia<"u"?!0:typeof navigator.webkitGetUserMedia<"u",273082:e=>{typeof s.SDL2>"u"&&(s.SDL2={});var r=s.SDL2;return e?r.capture={}:r.audio={},r.audioContext||(typeof AudioContext<"u"?r.audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(r.audioContext=new webkitAudioContext),r.audioContext&&Ka(r.audioContext)),r.audioContext===void 0?-1:0},273575:()=>{var e=s.SDL2;return e.audioContext.sampleRate},273643:(e,r,t,n)=>{var a=s.SDL2,i=function(g){a.capture.silenceTimer!==void 0&&(clearTimeout(a.capture.silenceTimer),a.capture.silenceTimer=void 0),a.capture.mediaStreamNode=a.audioContext.createMediaStreamSource(g),a.capture.scriptProcessorNode=a.audioContext.createScriptProcessor(r,e,1),a.capture.scriptProcessorNode.onaudioprocess=function(_){a===void 0||a.capture===void 0||(_.outputBuffer.getChannelData(0).fill(0),a.capture.currentCaptureBuffer=_.inputBuffer,ft("vi",t,[n]))},a.capture.mediaStreamNode.connect(a.capture.scriptProcessorNode),a.capture.scriptProcessorNode.connect(a.audioContext.destination),a.capture.stream=g},d=function(g){};a.capture.silenceBuffer=a.audioContext.createBuffer(e,r,a.audioContext.sampleRate),a.capture.silenceBuffer.getChannelData(0).fill(0);var u=function(){a.capture.currentCaptureBuffer=a.capture.silenceBuffer,ft("vi",t,[n])};a.capture.silenceTimer=setTimeout(u,r/a.audioContext.sampleRate*1e3),navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(i).catch(d):navigator.webkitGetUserMedia!==void 0&&navigator.webkitGetUserMedia({audio:!0,video:!1},i,d)},275295:(e,r,t,n)=>{var a=s.SDL2;a.audio.scriptProcessorNode=a.audioContext.createScriptProcessor(r,0,e),a.audio.scriptProcessorNode.onaudioprocess=function(i){a===void 0||a.audio===void 0||(a.audio.currentOutputBuffer=i.outputBuffer,ft("vi",t,[n]))},a.audio.scriptProcessorNode.connect(a.audioContext.destination)},275705:(e,r)=>{for(var t=s.SDL2,n=t.capture.currentCaptureBuffer.numberOfChannels,a=0;a<n;++a){var i=t.capture.currentCaptureBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio capture buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";if(n==1)for(var d=0;d<r;++d)un(e+d*4,i[d],"float");else for(var d=0;d<r;++d)un(e+(d*n+a)*4,i[d],"float")}},276310:(e,r)=>{for(var t=s.SDL2,n=t.audio.currentOutputBuffer.numberOfChannels,a=0;a<n;++a){var i=t.audio.currentOutputBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio output buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";for(var d=0;d<r;++d)i[d]=Q[e+(d*n+a<<2)>>2]}},276790:e=>{var r=s.SDL2;if(e){if(r.capture.silenceTimer!==void 0&&clearTimeout(r.capture.silenceTimer),r.capture.stream!==void 0){for(var t=r.capture.stream.getAudioTracks(),n=0;n<t.length;n++)r.capture.stream.removeTrack(t[n]);r.capture.stream=void 0}r.capture.scriptProcessorNode!==void 0&&(r.capture.scriptProcessorNode.onaudioprocess=function(a){},r.capture.scriptProcessorNode.disconnect(),r.capture.scriptProcessorNode=void 0),r.capture.mediaStreamNode!==void 0&&(r.capture.mediaStreamNode.disconnect(),r.capture.mediaStreamNode=void 0),r.capture.silenceBuffer!==void 0&&(r.capture.silenceBuffer=void 0),r.capture=void 0}else r.audio.scriptProcessorNode!=null&&(r.audio.scriptProcessorNode.disconnect(),r.audio.scriptProcessorNode=void 0),r.audio=void 0;r.audioContext!==void 0&&r.audio===void 0&&r.capture===void 0&&(r.audioContext.close(),r.audioContext=void 0)},277962:(e,r,t)=>{var n=e,a=r,i=t;s.SDL2||(s.SDL2={});var d=s.SDL2;d.ctxCanvas!==s.canvas&&(d.ctx=s.createContext(s.canvas,!1,!0),d.ctxCanvas=s.canvas),(d.w!==n||d.h!==a||d.imageCtx!==d.ctx)&&(d.image=d.ctx.createImageData(n,a),d.w=n,d.h=a,d.imageCtx=d.ctx);var u=d.image.data,g=i>>2,_=0,E;if(typeof CanvasPixelArray<"u"&&u instanceof CanvasPixelArray)for(E=u.length;_<E;){var T=m[g];u[_]=T&255,u[_+1]=T>>8&255,u[_+2]=T>>16&255,u[_+3]=255,g++,_+=4}else{d.data32Data!==u&&(d.data32=new Int32Array(u.buffer),d.data8=new Uint8Array(u.buffer),d.data32Data=u);var q=d.data32;E=q.length,q.set(m.subarray(g,g+E));var M=d.data8,z=3,J=z+4*E;if(E%8==0)for(;z<J;)M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0,M[z]=255,z=z+4|0;else for(;z<J;)M[z]=255,z=z+4|0}d.ctx.putImageData(d.image,0,0)},279431:(e,r,t,n,a)=>{var i=e,d=r,u=t,g=n,_=a,E=document.createElement("canvas");E.width=i,E.height=d;var T=E.getContext("2d"),q=T.createImageData(i,d),M=q.data,z=_>>2,J=0,xe;if(typeof CanvasPixelArray<"u"&&M instanceof CanvasPixelArray)for(xe=M.length;J<xe;){var he=m[z];M[J]=he&255,M[J+1]=he>>8&255,M[J+2]=he>>16&255,M[J+3]=he>>24&255,z++,J+=4}else{var Se=new Int32Array(M.buffer);xe=Se.length,Se.set(m.subarray(z,z+xe))}T.putImageData(q,0,0);var be=u===0&&g===0?"url("+E.toDataURL()+"), auto":"url("+E.toDataURL()+") "+u+" "+g+", auto",_e=Ue(be.length+1);return ve(be,_e,be.length+1),_e},280420:e=>{s.canvas&&(s.canvas.style.cursor=Pe(e))},280503:()=>{s.canvas&&(s.canvas.style.cursor="none")},280572:()=>window.innerWidth,280602:()=>window.innerHeight};function dn(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Xa=(e,r,t)=>{e.addEventListener(r,t,{once:!0})},Ka=(e,r)=>{r||(r=[document,document.getElementById("canvas")]),["keydown","mousedown","touchstart"].forEach(t=>{r.forEach(n=>{n&&Xa(n,t,()=>{e.state==="suspended"&&e.resume()})})})},Ur=e=>{for(;e.length>0;)e.shift()(s)},Ya=(e,r,t)=>{var n=s["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)},Tr=[],mr,le=e=>{var r=Tr[e];return r||(e>=Tr.length&&(Tr.length=e+1),Tr[e]=r=mr.get(e)),r},ft=(e,r,t)=>{if(e.includes("j"))return Ya(e,r,t);var n=le(r).apply(null,t);return n},Qa=s.noExitRuntime||!0;function un(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":P[e>>0]=r;break;case"i8":P[e>>0]=r;break;case"i16":A[e>>1]=r;break;case"i32":m[e>>2]=r;break;case"i64":or("to do setValue(i64) use WASM_BIGINT");case"float":Q[e>>2]=r;break;case"double":ce[e>>3]=r;break;case"*":ee[e>>2]=r;break;default:or(`invalid type for setValue: ${t}`)}}var se={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var t=0,n=e.length-1;n>=0;n--){var a=e[n];a==="."?e.splice(n,1):a===".."?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t;t--)e.unshift("..");return e},normalize:e=>{var r=se.isAbs(e),t=e.substr(-1)==="/";return e=se.normalizeArray(e.split("/").filter(n=>!!n),!r).join("/"),!e&&!r&&(e="."),e&&t&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=se.splitPath(e),t=r[0],n=r[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)},basename:e=>{if(e==="/")return"/";e=se.normalize(e),e=e.replace(/\/$/,"");var r=e.lastIndexOf("/");return r===-1?e:e.substr(r+1)},join:function(){var e=Array.prototype.slice.call(arguments);return se.normalize(e.join("/"))},join2:(e,r)=>se.normalize(e+"/"+r)},Ja=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);or("initRandomDevice")},fn=e=>(fn=Ja())(e),Ze={resolve:function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var n=t>=0?arguments[t]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,r=se.isAbs(n)}return e=se.normalizeArray(e.split("/").filter(a=>!!a),!r).join("/"),(r?"/":"")+e||"."},relative:(e,r)=>{e=Ze.resolve(e).substr(1),r=Ze.resolve(r).substr(1);function t(_){for(var E=0;E<_.length&&_[E]==="";E++);for(var T=_.length-1;T>=0&&_[T]==="";T--);return E>T?[]:_.slice(E,T-E+1)}for(var n=t(e.split("/")),a=t(r.split("/")),i=Math.min(n.length,a.length),d=i,u=0;u<i;u++)if(n[u]!==a[u]){d=u;break}for(var g=[],u=d;u<n.length;u++)g.push("..");return g=g.concat(a.slice(d)),g.join("/")}},mn=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,yr=(e,r,t)=>{for(var n=r+t,a=r;e[a]&&!(a>=n);)++a;if(a-r>16&&e.buffer&&mn)return mn.decode(e.subarray(r,a));for(var i="";r<a;){var d=e[r++];if(!(d&128)){i+=String.fromCharCode(d);continue}var u=e[r++]&63;if((d&224)==192){i+=String.fromCharCode((d&31)<<6|u);continue}var g=e[r++]&63;if((d&240)==224?d=(d&15)<<12|u<<6|g:d=(d&7)<<18|u<<12|g<<6|e[r++]&63,d<65536)i+=String.fromCharCode(d);else{var _=d-65536;i+=String.fromCharCode(55296|_>>10,56320|_&1023)}}return i},mt=[],wr=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},pt=(e,r,t,n)=>{if(!(n>0))return 0;for(var a=t,i=t+n-1,d=0;d<e.length;++d){var u=e.charCodeAt(d);if(u>=55296&&u<=57343){var g=e.charCodeAt(++d);u=65536+((u&1023)<<10)|g&1023}if(u<=127){if(t>=i)break;r[t++]=u}else if(u<=2047){if(t+1>=i)break;r[t++]=192|u>>6,r[t++]=128|u&63}else if(u<=65535){if(t+2>=i)break;r[t++]=224|u>>12,r[t++]=128|u>>6&63,r[t++]=128|u&63}else{if(t+3>=i)break;r[t++]=240|u>>18,r[t++]=128|u>>12&63,r[t++]=128|u>>6&63,r[t++]=128|u&63}}return r[t]=0,t-a};function ht(e,r,t){var n=wr(e)+1,a=new Array(n),i=pt(e,a,0,a.length);return a.length=i,a}var Za=()=>{if(!mt.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"?(e=window.prompt("Input: "),e!==null&&(e+=`
`)):typeof readline=="function"&&(e=readline(),e!==null&&(e+=`
`)),!e)return null;mt=ht(e)}return mt.shift()},pr={ttys:[],init(){},shutdown(){},register(e,r){pr.ttys[e]={input:[],output:[],ops:r},c.registerDevice(e,pr.stream_ops)},stream_ops:{open(e){var r=pr.ttys[e.node.rdev];if(!r)throw new c.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,t,n,a){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var i=0,d=0;d<n;d++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&i===0)throw new c.ErrnoError(6);if(u==null)break;i++,r[t+d]=u}return i&&(e.node.timestamp=Date.now()),i},write(e,r,t,n,a){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,r[t+i])}catch{throw new c.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char(e){return Za()},put_char(e,r){r===null||r===10?(D(yr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(D(yr(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,t){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(N(yr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(N(yr(e.output,0)),e.output=[])}}},eo=(e,r)=>(O.fill(0,e,e+r),e),ro=(e,r)=>Math.ceil(e/r)*r,pn=e=>{e=ro(e,65536);var r=Yn(65536,e);return r?eo(r,e):0},te={ops_table:null,mount(e){return te.createNode(null,"/",16895,0)},createNode(e,r,t,n){if(c.isBlkdev(t)||c.isFIFO(t))throw new c.ErrnoError(63);te.ops_table||(te.ops_table={dir:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,lookup:te.node_ops.lookup,mknod:te.node_ops.mknod,rename:te.node_ops.rename,unlink:te.node_ops.unlink,rmdir:te.node_ops.rmdir,readdir:te.node_ops.readdir,symlink:te.node_ops.symlink},stream:{llseek:te.stream_ops.llseek}},file:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:{llseek:te.stream_ops.llseek,read:te.stream_ops.read,write:te.stream_ops.write,allocate:te.stream_ops.allocate,mmap:te.stream_ops.mmap,msync:te.stream_ops.msync}},link:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,readlink:te.node_ops.readlink},stream:{}},chrdev:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:c.chrdev_stream_ops}});var a=c.createNode(e,r,t,n);return c.isDir(a.mode)?(a.node_ops=te.ops_table.dir.node,a.stream_ops=te.ops_table.dir.stream,a.contents={}):c.isFile(a.mode)?(a.node_ops=te.ops_table.file.node,a.stream_ops=te.ops_table.file.stream,a.usedBytes=0,a.contents=null):c.isLink(a.mode)?(a.node_ops=te.ops_table.link.node,a.stream_ops=te.ops_table.link.stream):c.isChrdev(a.mode)&&(a.node_ops=te.ops_table.chrdev.node,a.stream_ops=te.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[r]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var t=e.contents?e.contents.length:0;if(!(t>=r)){var n=1024*1024;r=Math.max(r,t*(t<n?2:1.125)>>>0),t!=0&&(r=Math.max(r,256));var a=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var t=e.contents;e.contents=new Uint8Array(r),t&&e.contents.set(t.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=c.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,c.isDir(e.mode)?r.size=4096:c.isFile(e.mode)?r.size=e.usedBytes:c.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.timestamp),r.mtime=new Date(e.timestamp),r.ctime=new Date(e.timestamp),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){r.mode!==void 0&&(e.mode=r.mode),r.timestamp!==void 0&&(e.timestamp=r.timestamp),r.size!==void 0&&te.resizeFileStorage(e,r.size)},lookup(e,r){throw c.genericErrors[44]},mknod(e,r,t,n){return te.createNode(e,r,t,n)},rename(e,r,t){if(c.isDir(e.mode)){var n;try{n=c.lookupNode(r,t)}catch{}if(n)for(var a in n.contents)throw new c.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=t,r.contents[t]=e,r.timestamp=e.parent.timestamp,e.parent=r},unlink(e,r){delete e.contents[r],e.timestamp=Date.now()},rmdir(e,r){var t=c.lookupNode(e,r);for(var n in t.contents)throw new c.ErrnoError(55);delete e.contents[r],e.timestamp=Date.now()},readdir(e){var r=[".",".."];for(var t of Object.keys(e.contents))r.push(t);return r},symlink(e,r,t){var n=te.createNode(e,r,41471,0);return n.link=t,n},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,r,t,n,a){var i=e.node.contents;if(a>=e.node.usedBytes)return 0;var d=Math.min(e.node.usedBytes-a,n);if(d>8&&i.subarray)r.set(i.subarray(a,a+d),t);else for(var u=0;u<d;u++)r[t+u]=i[a+u];return d},write(e,r,t,n,a,i){if(r.buffer===P.buffer&&(i=!1),!n)return 0;var d=e.node;if(d.timestamp=Date.now(),r.subarray&&(!d.contents||d.contents.subarray)){if(i)return d.contents=r.subarray(t,t+n),d.usedBytes=n,n;if(d.usedBytes===0&&a===0)return d.contents=r.slice(t,t+n),d.usedBytes=n,n;if(a+n<=d.usedBytes)return d.contents.set(r.subarray(t,t+n),a),n}if(te.expandFileStorage(d,a+n),d.contents.subarray&&r.subarray)d.contents.set(r.subarray(t,t+n),a);else for(var u=0;u<n;u++)d.contents[a+u]=r[t+u];return d.usedBytes=Math.max(d.usedBytes,a+n),n},llseek(e,r,t){var n=r;if(t===1?n+=e.position:t===2&&c.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new c.ErrnoError(28);return n},allocate(e,r,t){te.expandFileStorage(e.node,r+t),e.node.usedBytes=Math.max(e.node.usedBytes,r+t)},mmap(e,r,t,n,a){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var i,d,u=e.node.contents;if(!(a&2)&&u.buffer===P.buffer)d=!1,i=u.byteOffset;else{if((t>0||t+r<u.length)&&(u.subarray?u=u.subarray(t,t+r):u=Array.prototype.slice.call(u,t,t+r)),d=!0,i=pn(r),!i)throw new c.ErrnoError(48);P.set(u,i)}return{ptr:i,allocated:d}},msync(e,r,t,n,a){return te.stream_ops.write(e,r,0,n,t,!1),0}}},to=(e,r,t,n)=>{var a=`al ${e}`;G(e,i=>{r(new Uint8Array(i)),a&&Nr()},i=>{if(t)t();else throw`Loading data file "${e}" failed.`}),a&&ut()},no=(e,r,t,n,a,i)=>{c.createDataFile(e,r,t,n,a,i)},vt=s.preloadPlugins||[],ao=(e,r,t,n)=>{typeof j<"u"&&j.init();var a=!1;return vt.forEach(i=>{a||i.canHandle(r)&&(i.handle(e,r,t,n),a=!0)}),a},oo=(e,r,t,n,a,i,d,u,g,_)=>{var E=r?Ze.resolve(se.join2(e,r)):e;function T(q){function M(z){_==null||_(),u||no(e,r,z,n,a,g),i==null||i(),Nr()}ao(q,E,M,()=>{d==null||d(),Nr()})||M(q)}ut(),typeof t=="string"?to(t,T,d):T(t)},so=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},t=r[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},gt=(e,r)=>{var t=0;return e&&(t|=365),r&&(t|=146),t},pe={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var e=null;return typeof window=="object"&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),H(e,"IDBFS used, but indexedDB not supported"),e},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:function(e){return te.mount.apply(null,arguments)},syncfs:(e,r,t)=>{pe.getLocalSet(e,(n,a)=>{if(n)return t(n);pe.getRemoteSet(e,(i,d)=>{if(i)return t(i);var u=r?d:a,g=r?a:d;pe.reconcile(u,g,t)})})},quit:()=>{Object.values(pe.dbs).forEach(e=>e.close()),pe.dbs={}},getDB:(e,r)=>{var t=pe.dbs[e];if(t)return r(null,t);var n;try{n=pe.indexedDB().open(e,pe.DB_VERSION)}catch(a){return r(a)}if(!n)return r("Unable to connect to IndexedDB");n.onupgradeneeded=a=>{var i=a.target.result,d=a.target.transaction,u;i.objectStoreNames.contains(pe.DB_STORE_NAME)?u=d.objectStore(pe.DB_STORE_NAME):u=i.createObjectStore(pe.DB_STORE_NAME),u.indexNames.contains("timestamp")||u.createIndex("timestamp","timestamp",{unique:!1})},n.onsuccess=()=>{t=n.result,pe.dbs[e]=t,r(null,t)},n.onerror=a=>{r(a.target.error),a.preventDefault()}},getLocalSet:(e,r)=>{var t={};function n(g){return g!=="."&&g!==".."}function a(g){return _=>se.join2(g,_)}for(var i=c.readdir(e.mountpoint).filter(n).map(a(e.mountpoint));i.length;){var d=i.pop(),u;try{u=c.stat(d)}catch(g){return r(g)}c.isDir(u.mode)&&i.push.apply(i,c.readdir(d).filter(n).map(a(d))),t[d]={timestamp:u.mtime}}return r(null,{type:"local",entries:t})},getRemoteSet:(e,r)=>{var t={};pe.getDB(e.mountpoint,(n,a)=>{if(n)return r(n);try{var i=a.transaction([pe.DB_STORE_NAME],"readonly");i.onerror=g=>{r(g.target.error),g.preventDefault()};var d=i.objectStore(pe.DB_STORE_NAME),u=d.index("timestamp");u.openKeyCursor().onsuccess=g=>{var _=g.target.result;if(!_)return r(null,{type:"remote",db:a,entries:t});t[_.primaryKey]={timestamp:_.key},_.continue()}}catch(g){return r(g)}})},loadLocalEntry:(e,r)=>{var t,n;try{var a=c.lookupPath(e);n=a.node,t=c.stat(e)}catch(i){return r(i)}return c.isDir(t.mode)?r(null,{timestamp:t.mtime,mode:t.mode}):c.isFile(t.mode)?(n.contents=te.getFileDataAsTypedArray(n),r(null,{timestamp:t.mtime,mode:t.mode,contents:n.contents})):r(new Error("node type not supported"))},storeLocalEntry:(e,r,t)=>{try{if(c.isDir(r.mode))c.mkdirTree(e,r.mode);else if(c.isFile(r.mode))c.writeFile(e,r.contents,{canOwn:!0});else return t(new Error("node type not supported"));c.chmod(e,r.mode),c.utime(e,r.timestamp,r.timestamp)}catch(n){return t(n)}t(null)},removeLocalEntry:(e,r)=>{try{var t=c.stat(e);c.isDir(t.mode)?c.rmdir(e):c.isFile(t.mode)&&c.unlink(e)}catch(n){return r(n)}r(null)},loadRemoteEntry:(e,r,t)=>{var n=e.get(r);n.onsuccess=a=>t(null,a.target.result),n.onerror=a=>{t(a.target.error),a.preventDefault()}},storeRemoteEntry:(e,r,t,n)=>{try{var a=e.put(t,r)}catch(i){n(i);return}a.onsuccess=i=>n(),a.onerror=i=>{n(i.target.error),i.preventDefault()}},removeRemoteEntry:(e,r,t)=>{var n=e.delete(r);n.onsuccess=a=>t(),n.onerror=a=>{t(a.target.error),a.preventDefault()}},reconcile:(e,r,t)=>{var n=0,a=[];Object.keys(e.entries).forEach(function(T){var q=e.entries[T],M=r.entries[T];(!M||q.timestamp.getTime()!=M.timestamp.getTime())&&(a.push(T),n++)});var i=[];if(Object.keys(r.entries).forEach(function(T){e.entries[T]||(i.push(T),n++)}),!n)return t(null);var d=!1,u=e.type==="remote"?e.db:r.db,g=u.transaction([pe.DB_STORE_NAME],"readwrite"),_=g.objectStore(pe.DB_STORE_NAME);function E(T){if(T&&!d)return d=!0,t(T)}g.onerror=T=>{E(this.error),T.preventDefault()},g.oncomplete=T=>{d||t(null)},a.sort().forEach(T=>{r.type==="local"?pe.loadRemoteEntry(_,T,(q,M)=>{if(q)return E(q);pe.storeLocalEntry(T,M,E)}):pe.loadLocalEntry(T,(q,M)=>{if(q)return E(q);pe.storeRemoteEntry(_,T,M,E)})}),i.sort().reverse().forEach(T=>{r.type==="local"?pe.removeLocalEntry(T,E):pe.removeRemoteEntry(_,T,E)})}},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){this.name="ErrnoError",this.errno=e}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(e,r={}){if(e=Ze.resolve(e),!e)return{path:"",node:null};var t={follow_mount:!0,recurse_count:0};if(r=Object.assign(t,r),r.recurse_count>8)throw new c.ErrnoError(32);for(var n=e.split("/").filter(T=>!!T),a=c.root,i="/",d=0;d<n.length;d++){var u=d===n.length-1;if(u&&r.parent)break;if(a=c.lookupNode(a,n[d]),i=se.join2(i,n[d]),c.isMountpoint(a)&&(!u||u&&r.follow_mount)&&(a=a.mounted.root),!u||r.follow)for(var g=0;c.isLink(a.mode);){var _=c.readlink(i);i=Ze.resolve(se.dirname(i),_);var E=c.lookupPath(i,{recurse_count:r.recurse_count+1});if(a=E.node,g++>40)throw new c.ErrnoError(32)}}return{path:i,node:a}},getPath(e){for(var r;;){if(c.isRoot(e)){var t=e.mount.mountpoint;return r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var t=0,n=0;n<r.length;n++)t=(t<<5)-t+r.charCodeAt(n)|0;return(e+t>>>0)%c.nameTable.length},hashAddNode(e){var r=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[r],c.nameTable[r]=e},hashRemoveNode(e){var r=c.hashName(e.parent.id,e.name);if(c.nameTable[r]===e)c.nameTable[r]=e.name_next;else for(var t=c.nameTable[r];t;){if(t.name_next===e){t.name_next=e.name_next;break}t=t.name_next}},lookupNode(e,r){var t=c.mayLookup(e);if(t)throw new c.ErrnoError(t);for(var n=c.hashName(e.id,r),a=c.nameTable[n];a;a=a.name_next){var i=a.name;if(a.parent.id===e.id&&i===r)return a}return c.lookup(e,r)},createNode(e,r,t,n){var a=new c.FSNode(e,r,t,n);return c.hashAddNode(a),a},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return c.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var r=c.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){try{var t=c.lookupNode(e,r);return 20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,r,t){var n;try{n=c.lookupNode(e,r)}catch(i){return i.errno}var a=c.nodePermissions(e,"wx");if(a)return a;if(t){if(!c.isDir(n.mode))return 54;if(c.isRoot(n)||c.getPath(n)===c.cwd())return 10}else if(c.isDir(n.mode))return 31;return 0},mayOpen(e,r){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(r)!=="r"||r&512)?31:c.nodePermissions(e,c.flagsToPermissionString(r)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var r=c.getStream(e);if(!r)throw new c.ErrnoError(8);return r},getStream:e=>c.streams[e],createStream(e,r=-1){return c.FSStream||(c.FSStream=function(){this.shared={}},c.FSStream.prototype={},Object.defineProperties(c.FSStream.prototype,{object:{get(){return this.node},set(t){this.node=t}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(t){this.shared.flags=t}},position:{get(){return this.shared.position},set(t){this.shared.position=t}}})),e=Object.assign(new c.FSStream,e),r==-1&&(r=c.nextfd()),e.fd=r,c.streams[r]=e,e},closeStream(e){c.streams[e]=null},chrdev_stream_ops:{open(e){var t,n;var r=c.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,(n=(t=e.stream_ops).open)==null||n.call(t,e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){c.devices[e]={stream_ops:r}},getDevice:e=>c.devices[e],getMounts(e){for(var r=[],t=[e];t.length;){var n=t.pop();r.push(n),t.push.apply(t,n.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&N(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var t=c.getMounts(c.root.mount),n=0;function a(d){return c.syncFSRequests--,r(d)}function i(d){if(d)return i.errored?void 0:(i.errored=!0,a(d));++n>=t.length&&a(null)}t.forEach(d=>{if(!d.type.syncfs)return i(null);d.type.syncfs(d,e,i)})},mount(e,r,t){var n=t==="/",a=!t,i;if(n&&c.root)throw new c.ErrnoError(10);if(!n&&!a){var d=c.lookupPath(t,{follow_mount:!1});if(t=d.path,i=d.node,c.isMountpoint(i))throw new c.ErrnoError(10);if(!c.isDir(i.mode))throw new c.ErrnoError(54)}var u={type:e,opts:r,mountpoint:t,mounts:[]},g=e.mount(u);return g.mount=u,u.root=g,n?c.root=g:i&&(i.mounted=u,i.mount&&i.mount.mounts.push(u)),g},unmount(e){var r=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(r.node))throw new c.ErrnoError(28);var t=r.node,n=t.mounted,a=c.getMounts(n);Object.keys(c.nameTable).forEach(d=>{for(var u=c.nameTable[d];u;){var g=u.name_next;a.includes(u.mount)&&c.destroyNode(u),u=g}}),t.mounted=null;var i=t.mount.mounts.indexOf(n);t.mount.mounts.splice(i,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,t){var n=c.lookupPath(e,{parent:!0}),a=n.node,i=se.basename(e);if(!i||i==="."||i==="..")throw new c.ErrnoError(28);var d=c.mayCreate(a,i);if(d)throw new c.ErrnoError(d);if(!a.node_ops.mknod)throw new c.ErrnoError(63);return a.node_ops.mknod(a,i,r,t)},create(e,r){return r=r!==void 0?r:438,r&=4095,r|=32768,c.mknod(e,r,0)},mkdir(e,r){return r=r!==void 0?r:511,r&=1023,r|=16384,c.mknod(e,r,0)},mkdirTree(e,r){for(var t=e.split("/"),n="",a=0;a<t.length;++a)if(t[a]){n+="/"+t[a];try{c.mkdir(n,r)}catch(i){if(i.errno!=20)throw i}}},mkdev(e,r,t){return typeof t>"u"&&(t=r,r=438),r|=8192,c.mknod(e,r,t)},symlink(e,r){if(!Ze.resolve(e))throw new c.ErrnoError(44);var t=c.lookupPath(r,{parent:!0}),n=t.node;if(!n)throw new c.ErrnoError(44);var a=se.basename(r),i=c.mayCreate(n,a);if(i)throw new c.ErrnoError(i);if(!n.node_ops.symlink)throw new c.ErrnoError(63);return n.node_ops.symlink(n,a,e)},rename(e,r){var t=se.dirname(e),n=se.dirname(r),a=se.basename(e),i=se.basename(r),d,u,g;if(d=c.lookupPath(e,{parent:!0}),u=d.node,d=c.lookupPath(r,{parent:!0}),g=d.node,!u||!g)throw new c.ErrnoError(44);if(u.mount!==g.mount)throw new c.ErrnoError(75);var _=c.lookupNode(u,a),E=Ze.relative(e,n);if(E.charAt(0)!==".")throw new c.ErrnoError(28);if(E=Ze.relative(r,t),E.charAt(0)!==".")throw new c.ErrnoError(55);var T;try{T=c.lookupNode(g,i)}catch{}if(_!==T){var q=c.isDir(_.mode),M=c.mayDelete(u,a,q);if(M)throw new c.ErrnoError(M);if(M=T?c.mayDelete(g,i,q):c.mayCreate(g,i),M)throw new c.ErrnoError(M);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(_)||T&&c.isMountpoint(T))throw new c.ErrnoError(10);if(g!==u&&(M=c.nodePermissions(u,"w"),M))throw new c.ErrnoError(M);c.hashRemoveNode(_);try{u.node_ops.rename(_,g,i)}catch(z){throw z}finally{c.hashAddNode(_)}}},rmdir(e){var r=c.lookupPath(e,{parent:!0}),t=r.node,n=se.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!0);if(i)throw new c.ErrnoError(i);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.rmdir(t,n),c.destroyNode(a)},readdir(e){var r=c.lookupPath(e,{follow:!0}),t=r.node;if(!t.node_ops.readdir)throw new c.ErrnoError(54);return t.node_ops.readdir(t)},unlink(e){var r=c.lookupPath(e,{parent:!0}),t=r.node;if(!t)throw new c.ErrnoError(44);var n=se.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!1);if(i)throw new c.ErrnoError(i);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.unlink(t,n),c.destroyNode(a)},readlink(e){var r=c.lookupPath(e),t=r.node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return Ze.resolve(c.getPath(t.parent),t.node_ops.readlink(t))},stat(e,r){var t=c.lookupPath(e,{follow:!r}),n=t.node;if(!n)throw new c.ErrnoError(44);if(!n.node_ops.getattr)throw new c.ErrnoError(63);return n.node_ops.getattr(n)},lstat(e){return c.stat(e,!0)},chmod(e,r,t){var n;if(typeof e=="string"){var a=c.lookupPath(e,{follow:!t});n=a.node}else n=e;if(!n.node_ops.setattr)throw new c.ErrnoError(63);n.node_ops.setattr(n,{mode:r&4095|n.mode&-4096,timestamp:Date.now()})},lchmod(e,r){c.chmod(e,r,!0)},fchmod(e,r){var t=c.getStreamChecked(e);c.chmod(t.node,r)},chown(e,r,t,n){var a;if(typeof e=="string"){var i=c.lookupPath(e,{follow:!n});a=i.node}else a=e;if(!a.node_ops.setattr)throw new c.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown(e,r,t){c.chown(e,r,t,!0)},fchown(e,r,t){var n=c.getStreamChecked(e);c.chown(n.node,r,t)},truncate(e,r){if(r<0)throw new c.ErrnoError(28);var t;if(typeof e=="string"){var n=c.lookupPath(e,{follow:!0});t=n.node}else t=e;if(!t.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var a=c.nodePermissions(t,"w");if(a)throw new c.ErrnoError(a);t.node_ops.setattr(t,{size:r,timestamp:Date.now()})},ftruncate(e,r){var t=c.getStreamChecked(e);if(!(t.flags&2097155))throw new c.ErrnoError(28);c.truncate(t.node,r)},utime(e,r,t){var n=c.lookupPath(e,{follow:!0}),a=n.node;a.node_ops.setattr(a,{timestamp:Math.max(r,t)})},open(e,r,t){if(e==="")throw new c.ErrnoError(44);r=typeof r=="string"?so(r):r,t=typeof t>"u"?438:t,r&64?t=t&4095|32768:t=0;var n;if(typeof e=="object")n=e;else{e=se.normalize(e);try{var a=c.lookupPath(e,{follow:!(r&131072)});n=a.node}catch{}}var i=!1;if(r&64)if(n){if(r&128)throw new c.ErrnoError(20)}else n=c.mknod(e,t,0),i=!0;if(!n)throw new c.ErrnoError(44);if(c.isChrdev(n.mode)&&(r&=-513),r&65536&&!c.isDir(n.mode))throw new c.ErrnoError(54);if(!i){var d=c.mayOpen(n,r);if(d)throw new c.ErrnoError(d)}r&512&&!i&&c.truncate(n,0),r&=-131713;var u=c.createStream({node:n,path:c.getPath(n),flags:r,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),s.logReadFiles&&!(r&1)&&(c.readFiles||(c.readFiles={}),e in c.readFiles||(c.readFiles[e]=1)),u},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(t!=0&&t!=1&&t!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,t),e.ungotten=[],e.position},read(e,r,t,n,a){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var i=typeof a<"u";if(!i)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var d=e.stream_ops.read(e,r,t,n,a);return i||(e.position+=d),d},write(e,r,t,n,a,i){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,r,t,n,a,i);return d||(e.position+=u),u},allocate(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(r<0||t<=0)throw new c.ErrnoError(28);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(!c.isFile(e.node.mode)&&!c.isDir(e.node.mode))throw new c.ErrnoError(43);if(!e.stream_ops.allocate)throw new c.ErrnoError(138);e.stream_ops.allocate(e,r,t)},mmap(e,r,t,n,a){if(n&2&&!(a&2)&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);return e.stream_ops.mmap(e,r,t,n,a)},msync(e,r,t,n,a){return e.stream_ops.msync?e.stream_ops.msync(e,r,t,n,a):0},munmap:e=>0,ioctl(e,r,t){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,r,t)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var t,n=c.open(e,r.flags),a=c.stat(e),i=a.size,d=new Uint8Array(i);return c.read(n,d,0,i,0),r.encoding==="utf8"?t=yr(d,0):r.encoding==="binary"&&(t=d),c.close(n),t},writeFile(e,r,t={}){t.flags=t.flags||577;var n=c.open(e,t.flags,t.mode);if(typeof r=="string"){var a=new Uint8Array(wr(r)+1),i=pt(r,a,0,a.length);c.write(n,a,0,i,void 0,t.canOwn)}else if(ArrayBuffer.isView(r))c.write(n,r,0,r.byteLength,void 0,t.canOwn);else throw new Error("Unsupported data type");c.close(n)},cwd:()=>c.currentPath,chdir(e){var r=c.lookupPath(e,{follow:!0});if(r.node===null)throw new c.ErrnoError(44);if(!c.isDir(r.node.mode))throw new c.ErrnoError(54);var t=c.nodePermissions(r.node,"x");if(t)throw new c.ErrnoError(t);c.currentPath=r.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(n,a,i,d,u)=>d}),c.mkdev("/dev/null",c.makedev(1,3)),pr.register(c.makedev(5,0),pr.default_tty_ops),pr.register(c.makedev(6,0),pr.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),r=0,t=()=>(r===0&&(r=fn(e).byteLength),e[--r]);c.createDevice("/dev","random",t),c.createDevice("/dev","urandom",t),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var r=c.createNode(e,"fd",16895,73);return r.node_ops={lookup(t,n){var a=+n,i=c.getStreamChecked(a),d={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>i.path}};return d.parent=d,d}},r}},{},"/proc/self/fd")},createStandardStreams(){s.stdin?c.createDevice("/dev","stdin",s.stdin):c.symlink("/dev/tty","/dev/stdin"),s.stdout?c.createDevice("/dev","stdout",null,s.stdout):c.symlink("/dev/tty","/dev/stdout"),s.stderr?c.createDevice("/dev","stderr",null,s.stderr):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){[44].forEach(e=>{c.genericErrors[e]=new c.ErrnoError(e),c.genericErrors[e].stack="<generic error, no stack>"}),c.nameTable=new Array(4096),c.mount(te,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:te,IDBFS:pe}},init(e,r,t){c.init.initialized=!0,s.stdin=e||s.stdin,s.stdout=r||s.stdout,s.stderr=t||s.stderr,c.createStandardStreams()},quit(){c.init.initialized=!1;for(var e=0;e<c.streams.length;e++){var r=c.streams[e];r&&c.close(r)}},findObject(e,r){var t=c.analyzePath(e,r);return t.exists?t.object:null},analyzePath(e,r){try{var t=c.lookupPath(e,{follow:!r});e=t.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=c.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=se.basename(e),t=c.lookupPath(e,{follow:!r}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot=t.path==="/"}catch(a){n.error=a.errno}return n},createPath(e,r,t,n){e=typeof e=="string"?e:c.getPath(e);for(var a=r.split("/").reverse();a.length;){var i=a.pop();if(i){var d=se.join2(e,i);try{c.mkdir(d)}catch{}e=d}}return d},createFile(e,r,t,n,a){var i=se.join2(typeof e=="string"?e:c.getPath(e),r),d=gt(n,a);return c.create(i,d)},createDataFile(e,r,t,n,a,i){var d=r;e&&(e=typeof e=="string"?e:c.getPath(e),d=r?se.join2(e,r):e);var u=gt(n,a),g=c.create(d,u);if(t){if(typeof t=="string"){for(var _=new Array(t.length),E=0,T=t.length;E<T;++E)_[E]=t.charCodeAt(E);t=_}c.chmod(g,u|146);var q=c.open(g,577);c.write(q,t,0,t.length,0,i),c.close(q),c.chmod(g,u)}},createDevice(e,r,t,n){var a=se.join2(typeof e=="string"?e:c.getPath(e),r),i=gt(!!t,!!n);c.createDevice.major||(c.createDevice.major=64);var d=c.makedev(c.createDevice.major++,0);return c.registerDevice(d,{open(u){u.seekable=!1},close(u){var g;(g=n==null?void 0:n.buffer)!=null&&g.length&&n(10)},read(u,g,_,E,T){for(var q=0,M=0;M<E;M++){var z;try{z=t()}catch{throw new c.ErrnoError(29)}if(z===void 0&&q===0)throw new c.ErrnoError(6);if(z==null)break;q++,g[_+M]=z}return q&&(u.node.timestamp=Date.now()),q},write(u,g,_,E,T){for(var q=0;q<E;q++)try{n(g[_+q])}catch{throw new c.ErrnoError(29)}return E&&(u.node.timestamp=Date.now()),q}}),c.mkdev(a,i,d)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if($)try{e.contents=ht($(e.url),!0),e.usedBytes=e.contents.length}catch{throw new c.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,r,t,n,a){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(M){if(!(M>this.length-1||M<0)){var z=M%this.chunkSize,J=M/this.chunkSize|0;return this.getter(J)[z]}},i.prototype.setDataGetter=function(M){this.getter=M},i.prototype.cacheLength=function(){var M=new XMLHttpRequest;if(M.open("HEAD",t,!1),M.send(null),!(M.status>=200&&M.status<300||M.status===304))throw new Error("Couldn't load "+t+". Status: "+M.status);var z=Number(M.getResponseHeader("Content-length")),J,xe=(J=M.getResponseHeader("Accept-Ranges"))&&J==="bytes",he=(J=M.getResponseHeader("Content-Encoding"))&&J==="gzip",Se=1024*1024;xe||(Se=z);var be=(ke,Ge)=>{if(ke>Ge)throw new Error("invalid range ("+ke+", "+Ge+") or no bytes requested!");if(Ge>z-1)throw new Error("only "+z+" bytes available! programmer error!");var ye=new XMLHttpRequest;if(ye.open("GET",t,!1),z!==Se&&ye.setRequestHeader("Range","bytes="+ke+"-"+Ge),ye.responseType="arraybuffer",ye.overrideMimeType&&ye.overrideMimeType("text/plain; charset=x-user-defined"),ye.send(null),!(ye.status>=200&&ye.status<300||ye.status===304))throw new Error("Couldn't load "+t+". Status: "+ye.status);return ye.response!==void 0?new Uint8Array(ye.response||[]):ht(ye.responseText||"")},_e=this;_e.setDataGetter(ke=>{var Ge=ke*Se,ye=(ke+1)*Se-1;if(ye=Math.min(ye,z-1),typeof _e.chunks[ke]>"u"&&(_e.chunks[ke]=be(Ge,ye)),typeof _e.chunks[ke]>"u")throw new Error("doXHR failed!");return _e.chunks[ke]}),(he||!z)&&(Se=z=1,z=this.getter(0).length,Se=z,D("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=z,this._chunkSize=Se,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var d,u}else var u={isDevice:!1,url:t};var g=c.createFile(e,r,u,n,a);u.contents?g.contents=u.contents:u.url&&(g.contents=null,g.url=u.url),Object.defineProperties(g,{usedBytes:{get:function(){return this.contents.length}}});var _={},E=Object.keys(g.stream_ops);E.forEach(q=>{var M=g.stream_ops[q];_[q]=function(){return c.forceLoadFile(g),M.apply(null,arguments)}});function T(q,M,z,J,xe){var he=q.node.contents;if(xe>=he.length)return 0;var Se=Math.min(he.length-xe,J);if(he.slice)for(var be=0;be<Se;be++)M[z+be]=he[xe+be];else for(var be=0;be<Se;be++)M[z+be]=he.get(xe+be);return Se}return _.read=(q,M,z,J,xe)=>(c.forceLoadFile(g),T(q,M,z,J,xe)),_.mmap=(q,M,z,J,xe)=>{c.forceLoadFile(g);var he=pn(M);if(!he)throw new c.ErrnoError(48);return T(q,P,he,M,z),{ptr:he,allocated:!0}},g.stream_ops=_,g}},Pe=(e,r)=>e?yr(O,e,r):"",re={DEFAULT_POLLMASK:5,calculateAt(e,r,t){if(se.isAbs(r))return r;var n;if(e===-100)n=c.cwd();else{var a=re.getStreamFromFD(e);n=a.path}if(r.length==0){if(!t)throw new c.ErrnoError(44);return n}return se.join2(n,r)},doStat(e,r,t){var n=e(r);m[t>>2]=n.dev,m[t+4>>2]=n.mode,ee[t+8>>2]=n.nlink,m[t+12>>2]=n.uid,m[t+16>>2]=n.gid,m[t+20>>2]=n.rdev,me=[n.size>>>0,(Z=n.size,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+24>>2]=me[0],m[t+28>>2]=me[1],m[t+32>>2]=4096,m[t+36>>2]=n.blocks;var a=n.atime.getTime(),i=n.mtime.getTime(),d=n.ctime.getTime();return me=[Math.floor(a/1e3)>>>0,(Z=Math.floor(a/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+40>>2]=me[0],m[t+44>>2]=me[1],ee[t+48>>2]=a%1e3*1e3,me=[Math.floor(i/1e3)>>>0,(Z=Math.floor(i/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+56>>2]=me[0],m[t+60>>2]=me[1],ee[t+64>>2]=i%1e3*1e3,me=[Math.floor(d/1e3)>>>0,(Z=Math.floor(d/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+72>>2]=me[0],m[t+76>>2]=me[1],ee[t+80>>2]=d%1e3*1e3,me=[n.ino>>>0,(Z=n.ino,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[t+88>>2]=me[0],m[t+92>>2]=me[1],0},doMsync(e,r,t,n,a){if(!c.isFile(r.node.mode))throw new c.ErrnoError(43);if(n&2)return 0;var i=O.slice(e,e+t);c.msync(r,i,a,t,n)},varargs:void 0,get(){var e=m[+re.varargs>>2];return re.varargs+=4,e},getp(){return re.get()},getStr(e){var r=Pe(e);return r},getStreamFromFD(e){var r=c.getStreamChecked(e);return r}};function io(e,r,t){re.varargs=t;try{var n=re.getStreamFromFD(e);switch(r){case 0:{var a=re.get();if(a<0)return-28;for(;c.streams[a];)a++;var i;return i=c.createStream(n,a),i.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var a=re.get();return n.flags|=a,0}case 12:{var a=re.getp(),d=0;return A[a+d>>1]=2,0}case 13:case 14:return 0}return-28}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function lo(e,r){try{var t=re.getStreamFromFD(e);return re.doStat(c.stat,t.path,r)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var Sr=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function co(e,r,t){var n=Sr(r,t);try{return isNaN(n)?61:(c.ftruncate(e,n),0)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var ve=(e,r,t)=>pt(e,O,r,t);function uo(e,r){try{if(r===0)return-28;var t=c.cwd(),n=wr(t)+1;return r<n?-68:(ve(t,e,r),n)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function fo(e,r,t){try{var n=re.getStreamFromFD(e);n.getdents||(n.getdents=c.readdir(n.path));for(var a=280,i=0,d=c.llseek(n,0,1),u=Math.floor(d/a);u<n.getdents.length&&i+a<=t;){var g,_,E=n.getdents[u];if(E===".")g=n.node.id,_=4;else if(E===".."){var T=c.lookupPath(n.path,{parent:!0});g=T.node.id,_=4}else{var q=c.lookupNode(n.node,E);g=q.id,_=c.isChrdev(q.mode)?2:c.isDir(q.mode)?4:c.isLink(q.mode)?10:8}me=[g>>>0,(Z=g,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[r+i>>2]=me[0],m[r+i+4>>2]=me[1],me=[(u+1)*a>>>0,(Z=(u+1)*a,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[r+i+8>>2]=me[0],m[r+i+12>>2]=me[1],A[r+i+16>>1]=280,P[r+i+18>>0]=_,ve(E,r+i+19,256),i+=a,u+=1}return c.llseek(n,u*a,0),i}catch(M){if(typeof c>"u"||M.name!=="ErrnoError")throw M;return-M.errno}}function mo(e,r,t){re.varargs=t;try{var n=re.getStreamFromFD(e);switch(r){case 21509:return n.tty?0:-59;case 21505:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var a=n.tty.ops.ioctl_tcgets(n),i=re.getp();m[i>>2]=a.c_iflag||0,m[i+4>>2]=a.c_oflag||0,m[i+8>>2]=a.c_cflag||0,m[i+12>>2]=a.c_lflag||0;for(var d=0;d<32;d++)P[i+d+17>>0]=a.c_cc[d]||0;return 0}return 0}case 21510:case 21511:case 21512:return n.tty?0:-59;case 21506:case 21507:case 21508:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){for(var i=re.getp(),u=m[i>>2],g=m[i+4>>2],_=m[i+8>>2],E=m[i+12>>2],T=[],d=0;d<32;d++)T.push(P[i+d+17>>0]);return n.tty.ops.ioctl_tcsets(n.tty,r,{c_iflag:u,c_oflag:g,c_cflag:_,c_lflag:E,c_cc:T})}return 0}case 21519:{if(!n.tty)return-59;var i=re.getp();return m[i>>2]=0,0}case 21520:return n.tty?-28:-59;case 21531:{var i=re.getp();return c.ioctl(n,r,i)}case 21523:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var q=n.tty.ops.ioctl_tiocgwinsz(n.tty),i=re.getp();A[i>>1]=q[0],A[i+2>>1]=q[1]}return 0}case 21524:return n.tty?0:-59;case 21515:return n.tty?0:-59;default:return-28}}catch(M){if(typeof c>"u"||M.name!=="ErrnoError")throw M;return-M.errno}}function po(e,r){try{return e=re.getStr(e),re.doStat(c.lstat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function ho(e,r,t){try{return r=re.getStr(r),r=re.calculateAt(e,r),r=se.normalize(r),r[r.length-1]==="/"&&(r=r.substr(0,r.length-1)),c.mkdir(r,t,0),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function vo(e,r,t,n){try{r=re.getStr(r);var a=n&256,i=n&4096;return n=n&-6401,r=re.calculateAt(e,r,i),re.doStat(a?c.lstat:c.stat,r,t)}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function go(e,r,t,n){re.varargs=n;try{r=re.getStr(r),r=re.calculateAt(e,r);var a=n?re.get():0;return c.open(r,t,a).fd}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function xo(e,r,t,n){try{if(r=re.getStr(r),r=re.calculateAt(e,r),n<=0)return-28;var a=c.readlink(r),i=Math.min(n,wr(a)),d=P[t+i];return ve(a,t,n+1),P[t+i]=d,i}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function bo(e){try{return e=re.getStr(e),c.rmdir(e),0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function _o(e,r){try{return e=re.getStr(e),re.doStat(c.stat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function yo(e,r,t){try{return r=re.getStr(r),r=re.calculateAt(e,r),t===0?c.unlink(r):t===512?c.rmdir(r):or("Invalid flags passed to unlinkat"),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var hn=e=>ee[e>>2]+m[e+4>>2]*4294967296;function wo(e,r,t,n){try{if(r=re.getStr(r),r=re.calculateAt(e,r,!0),t){var d=hn(t),u=m[t+8>>2];a=d*1e3+u/(1e3*1e3),t+=16,d=hn(t),u=m[t+8>>2],i=d*1e3+u/(1e3*1e3)}else var a=Date.now(),i=a;return c.utime(r,a,i),0}catch(g){if(typeof c>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}var So=1,Co=()=>So,Eo=()=>{throw 1/0},ko=e=>e%4===0&&(e%100!==0||e%400===0),jo=[0,31,60,91,121,152,182,213,244,274,305,335],Fo=[0,31,59,90,120,151,181,212,243,273,304,334],vn=e=>{var r=ko(e.getFullYear()),t=r?jo:Fo,n=t[e.getMonth()]+e.getDate()-1;return n};function Lo(e,r,t){var n=Sr(e,r),a=new Date(n*1e3);m[t>>2]=a.getSeconds(),m[t+4>>2]=a.getMinutes(),m[t+8>>2]=a.getHours(),m[t+12>>2]=a.getDate(),m[t+16>>2]=a.getMonth(),m[t+20>>2]=a.getFullYear()-1900,m[t+24>>2]=a.getDay();var i=vn(a)|0;m[t+28>>2]=i,m[t+36>>2]=-(a.getTimezoneOffset()*60);var d=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),g=d.getTimezoneOffset(),_=(u!=g&&a.getTimezoneOffset()==Math.min(g,u))|0;m[t+32>>2]=_}var Ro=function(e){var r=(()=>{var t=new Date(m[e+20>>2]+1900,m[e+16>>2],m[e+12>>2],m[e+8>>2],m[e+4>>2],m[e>>2],0),n=m[e+32>>2],a=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),d=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),g=Math.min(u,d);if(n<0)m[e+32>>2]=+(d!=u&&g==a);else if(n>0!=(g==a)){var _=Math.max(u,d),E=n>0?g:_;t.setTime(t.getTime()+(E-a)*6e4)}m[e+24>>2]=t.getDay();var T=vn(t)|0;m[e+28>>2]=T,m[e>>2]=t.getSeconds(),m[e+4>>2]=t.getMinutes(),m[e+8>>2]=t.getHours(),m[e+12>>2]=t.getDate(),m[e+16>>2]=t.getMonth(),m[e+20>>2]=t.getYear();var q=t.getTime();return isNaN(q)?-1:q/1e3})();return Kn((Z=r,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)),r>>>0};function To(e,r,t,n,a,i,d,u){var g=Sr(a,i);try{if(isNaN(g))return 61;var _=re.getStreamFromFD(n),E=c.mmap(_,e,g,r,t),T=E.ptr;return m[d>>2]=E.allocated,ee[u>>2]=T,0}catch(q){if(typeof c>"u"||q.name!=="ErrnoError")throw q;return-q.errno}}function Po(e,r,t,n,a,i,d){var u=Sr(i,d);try{return isNaN(u)?61:(re.doMsync(e,re.getStreamFromFD(a),r,n,u),0)}catch(g){if(typeof c>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function Mo(e,r,t,n,a,i,d){var u=Sr(i,d);try{if(isNaN(u))return 61;var g=re.getStreamFromFD(a);t&2&&re.doMsync(e,g,r,n,u),c.munmap(g)}catch(_){if(typeof c>"u"||_.name!=="ErrnoError")throw _;return-_.errno}}var Ke=e=>{var r=wr(e)+1,t=Ue(r);return t&&ve(e,t,r),t},Ao=(e,r,t)=>{var n=new Date().getFullYear(),a=new Date(n,0,1),i=new Date(n,6,1),d=a.getTimezoneOffset(),u=i.getTimezoneOffset(),g=Math.max(d,u);ee[e>>2]=g*60,m[r>>2]=+(d!=u);function _(z){var J=z.toTimeString().match(/\(([A-Za-z ]+)\)$/);return J?J[1]:"GMT"}var E=_(a),T=_(i),q=Ke(E),M=Ke(T);u<d?(ee[t>>2]=q,ee[t+4>>2]=M):(ee[t>>2]=M,ee[t+4>>2]=q)},Do=()=>{or("")},Cr=(e,r)=>{if(j.mainLoop.timingMode=e,j.mainLoop.timingValue=r,!j.mainLoop.func)return 1;if(j.mainLoop.running||(j.mainLoop.running=!0),e==0)j.mainLoop.scheduler=function(){var d=Math.max(0,j.mainLoop.tickStartTime+r-Or())|0;setTimeout(j.mainLoop.runner,d)},j.mainLoop.method="timeout";else if(e==1)j.mainLoop.scheduler=function(){j.requestAnimationFrame(j.mainLoop.runner)},j.mainLoop.method="rAF";else if(e==2){if(typeof j.setImmediate>"u")if(typeof setImmediate>"u"){var t=[],n="setimmediate",a=i=>{(i.data===n||i.data.target===n)&&(i.stopPropagation(),t.shift()())};addEventListener("message",a,!0),j.setImmediate=function(d){t.push(d),postMessage(n,"*")}}else j.setImmediate=setImmediate;j.mainLoop.scheduler=function(){j.setImmediate(j.mainLoop.runner)},j.mainLoop.method="immediate"}return 0},Or;Or=()=>performance.now();var gn=(e,r,t,n,a)=>{H(!j.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),j.mainLoop.func=e,j.mainLoop.arg=n;var i=j.mainLoop.currentlyRunningMainloop;function d(){return!(i<j.mainLoop.currentlyRunningMainloop)}if(j.mainLoop.running=!1,j.mainLoop.runner=function(){var T,q;if(!X){if(j.mainLoop.queue.length>0){var g=j.mainLoop.queue.shift();if(g.func(g.arg),j.mainLoop.remainingBlockers){var _=j.mainLoop.remainingBlockers,E=_%1==0?_-1:Math.floor(_);g.counted?j.mainLoop.remainingBlockers=E:(E=E+.5,j.mainLoop.remainingBlockers=(8*_+E)/9)}if(j.mainLoop.updateStatus(),!d())return;setTimeout(j.mainLoop.runner,0);return}if(d()){if(j.mainLoop.currentFrameNumber=j.mainLoop.currentFrameNumber+1|0,j.mainLoop.timingMode==1&&j.mainLoop.timingValue>1&&j.mainLoop.currentFrameNumber%j.mainLoop.timingValue!=0){j.mainLoop.scheduler();return}else j.mainLoop.timingMode==0&&(j.mainLoop.tickStartTime=Or());j.mainLoop.runIter(e),d()&&(typeof SDL=="object"&&((q=(T=SDL.audio)==null?void 0:T.queueNewAudioData)==null||q.call(T)),j.mainLoop.scheduler())}}},a||(r&&r>0?Cr(0,1e3/r):Cr(1,1),j.mainLoop.scheduler()),t)throw"unwind"},xt=e=>{if(e instanceof dn||e=="unwind")return U;S(1,e)},Io=0,xn=()=>Qa||Io>0,Bo=e=>{var r;U=e,xn()||((r=s.onExit)==null||r.call(s,e),X=!0),S(e,new dn(e))},bn=(e,r)=>{U=e,Bo(e)},_n=bn,$o=()=>{if(!xn())try{_n(U)}catch(e){xt(e)}},bt=e=>{if(!X)try{e(),$o()}catch(r){xt(r)}},yn=(e,r)=>setTimeout(()=>{bt(e)},r),j={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){j.mainLoop.scheduler=null,j.mainLoop.currentlyRunningMainloop++},resume(){j.mainLoop.currentlyRunningMainloop++;var e=j.mainLoop.timingMode,r=j.mainLoop.timingValue,t=j.mainLoop.func;j.mainLoop.func=null,gn(t,0,!1,j.mainLoop.arg,!0),Cr(e,r),j.mainLoop.scheduler()},updateStatus(){if(s.setStatus){var e=s.statusMessage||"Please wait...",r=j.mainLoop.remainingBlockers,t=j.mainLoop.expectedBlockers;r?r<t?s.setStatus(e+" ("+(t-r)+"/"+t+")"):s.setStatus(e):s.setStatus("")}},runIter(e){var t;if(!X){if(s.preMainLoop){var r=s.preMainLoop();if(r===!1)return}bt(e),(t=s.postMainLoop)==null||t.call(s)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(j.initted)return;j.initted=!0;var e={};e.canHandle=function(i){return!s.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(i)},e.handle=function(i,d,u,g){var _=new Blob([i],{type:j.getMimetype(d)});_.size!==i.length&&(_=new Blob([new Uint8Array(i).buffer],{type:j.getMimetype(d)}));var E=URL.createObjectURL(_),T=new Image;T.onload=()=>{H(T.complete,`Image ${d} could not be decoded`);var q=document.createElement("canvas");q.width=T.width,q.height=T.height;var M=q.getContext("2d");M.drawImage(T,0,0),URL.revokeObjectURL(E),u==null||u(i)},T.onerror=q=>{N(`Image ${E} could not be decoded`),g==null||g()},T.src=E},vt.push(e);var r={};r.canHandle=function(i){return!s.noAudioDecoding&&i.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(i,d,u,g){var _=!1;function E(z){_||(_=!0,u==null||u(i))}var T=new Blob([i],{type:j.getMimetype(d)}),q=URL.createObjectURL(T),M=new Audio;M.addEventListener("canplaythrough",()=>E(),!1),M.onerror=function(J){if(_)return;N(`warning: browser could not fully decode audio ${d}, trying slower base64 approach`);function xe(he){for(var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",be="=",_e="",ke=0,Ge=0,ye=0;ye<he.length;ye++)for(ke=ke<<8|he[ye],Ge+=8;Ge>=6;){var np=ke>>Ge-6&63;Ge-=6,_e+=Se[np]}return Ge==2?(_e+=Se[(ke&3)<<4],_e+=be+be):Ge==4&&(_e+=Se[(ke&15)<<2],_e+=be),_e}M.src="data:audio/x-"+d.substr(-3)+";base64,"+xe(i),E()},M.src=q,yn(()=>{E()},1e4)},vt.push(r);function t(){j.pointerLock=document.pointerLockElement===s.canvas||document.mozPointerLockElement===s.canvas||document.webkitPointerLockElement===s.canvas||document.msPointerLockElement===s.canvas}var n=s.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),s.elementPointerLock&&n.addEventListener("click",a=>{!j.pointerLock&&s.canvas.requestPointerLock&&(s.canvas.requestPointerLock(),a.preventDefault())},!1))},createContext(e,r,t,n){if(r&&s.ctx&&e==s.canvas)return s.ctx;var a,i;if(r){var d={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var u in n)d[u]=n[u];typeof F<"u"&&(i=F.createContext(e,d),i&&(a=F.getContext(i).GLctx))}else a=e.getContext("2d");return a?(t&&(r||H(typeof y>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),s.ctx=a,r&&F.makeContextCurrent(i),s.useWebGL=r,j.moduleContextCreatedCallbacks.forEach(g=>g()),j.init()),a):null},destroyContext(e,r,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(e,r){j.lockPointer=e,j.resizeCanvas=r,typeof j.lockPointer>"u"&&(j.lockPointer=!0),typeof j.resizeCanvas>"u"&&(j.resizeCanvas=!1);var t=s.canvas;function n(){var d,u;j.isFullscreen=!1;var i=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===i?(t.exitFullscreen=j.exitFullscreen,j.lockPointer&&t.requestPointerLock(),j.isFullscreen=!0,j.resizeCanvas?j.setFullscreenCanvasSize():j.updateCanvasDimensions(t)):(i.parentNode.insertBefore(t,i),i.parentNode.removeChild(i),j.resizeCanvas?j.setWindowedCanvasSize():j.updateCanvasDimensions(t)),(d=s.onFullScreen)==null||d.call(s,j.isFullscreen),(u=s.onFullscreen)==null||u.call(s,j.isFullscreen)}j.fullscreenHandlersInstalled||(j.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?()=>a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(a.webkitRequestFullScreen?()=>a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),a.requestFullscreen()},exitFullscreen(){if(!j.isFullscreen)return!1;var e=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return e.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(e){var r=Date.now();if(j.nextRAF===0)j.nextRAF=r+1e3/60;else for(;r+2>=j.nextRAF;)j.nextRAF+=1e3/60;var t=Math.max(j.nextRAF-r,0);setTimeout(e,t)},requestAnimationFrame(e){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(e);return}var r=j.fakeRequestAnimationFrame;r(e)},safeSetTimeout(e,r){return yn(e,r)},safeRequestAnimationFrame(e){return j.requestAnimationFrame(()=>{bt(e)})},getMimetype(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta(e){var r=0;switch(e.type){case"DOMMouseScroll":r=e.detail/3;break;case"mousewheel":r=e.wheelDelta/120;break;case"wheel":switch(r=e.deltaY,e.deltaMode){case 0:r/=100;break;case 1:r/=3;break;case 2:r*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return r},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(e,r){var t=s.canvas.getBoundingClientRect(),n=s.canvas.width,a=s.canvas.height,i=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,d=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset,u=e-(i+t.left),g=r-(d+t.top);return u=u*(n/t.width),g=g*(a/t.height),{x:u,y:g}},setMouseCoords(e,r){const{x:t,y:n}=j.calculateMouseCoords(e,r);j.mouseMovementX=t-j.mouseX,j.mouseMovementY=n-j.mouseY,j.mouseX=t,j.mouseY=n},calculateMouseEvent(e){if(j.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?j.mouseMovementX=j.mouseMovementY=0:(j.mouseMovementX=j.getMovementX(e),j.mouseMovementY=j.getMovementY(e)),typeof SDL<"u"?(j.mouseX=SDL.mouseX+j.mouseMovementX,j.mouseY=SDL.mouseY+j.mouseMovementY):(j.mouseX+=j.mouseMovementX,j.mouseY+=j.mouseMovementY);else{if(e.type==="touchstart"||e.type==="touchend"||e.type==="touchmove"){var r=e.touch;if(r===void 0)return;var t=j.calculateMouseCoords(r.pageX,r.pageY);if(e.type==="touchstart")j.lastTouches[r.identifier]=t,j.touches[r.identifier]=t;else if(e.type==="touchend"||e.type==="touchmove"){var n=j.touches[r.identifier];n||(n=t),j.lastTouches[r.identifier]=n,j.touches[r.identifier]=t}return}j.setMouseCoords(e.pageX,e.pageY)}},resizeListeners:[],updateResizeListeners(){var e=s.canvas;j.resizeListeners.forEach(r=>r(e.width,e.height))},setCanvasSize(e,r,t){var n=s.canvas;j.updateCanvasDimensions(n,e,r),t||j.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var e=ee[SDL.screen>>2];e=e|8388608,m[SDL.screen>>2]=e}j.updateCanvasDimensions(s.canvas),j.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var e=ee[SDL.screen>>2];e=e&-8388609,m[SDL.screen>>2]=e}j.updateCanvasDimensions(s.canvas),j.updateResizeListeners()},updateCanvasDimensions(e,r,t){r&&t?(e.widthNative=r,e.heightNative=t):(r=e.widthNative,t=e.heightNative);var n=r,a=t;if(s.forcedAspectRatio&&s.forcedAspectRatio>0&&(n/a<s.forcedAspectRatio?n=Math.round(a*s.forcedAspectRatio):a=Math.round(n/s.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&typeof screen<"u"){var i=Math.min(screen.width/n,screen.height/a);n=Math.round(n*i),a=Math.round(a*i)}j.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=a&&(e.height=a),typeof e.style<"u"&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=r&&(e.width=r),e.height!=t&&(e.height=t),typeof e.style<"u"&&(n!=r||a!=t?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}},W={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode(e){W.errorCode=e},chooseConfig(e,r,t,n,a){if(e!=62e3)return W.setErrorCode(12296),0;if(r)for(;;){var i=m[r>>2];if(i==12321){var d=m[r+4>>2];W.contextAttributes.alpha=d>0}else if(i==12325){var u=m[r+4>>2];W.contextAttributes.depth=u>0}else if(i==12326){var g=m[r+4>>2];W.contextAttributes.stencil=g>0}else if(i==12337){var _=m[r+4>>2];W.contextAttributes.antialias=_>0}else if(i==12338){var _=m[r+4>>2];W.contextAttributes.antialias=_==1}else if(i==12544){var E=m[r+4>>2];W.contextAttributes.lowLatency=E!=12547}else if(i==12344)break;r+=8}return(!t||!n)&&!a?(W.setErrorCode(12300),0):(a&&(m[a>>2]=1),t&&n>0&&(ee[t>>2]=62002),W.setErrorCode(12288),1)}},No=e=>e==12448?(W.setErrorCode(12288),1):(W.setErrorCode(12300),0),Uo=(e,r,t,n,a)=>W.chooseConfig(e,r,t,n,a),Oo=e=>{var r=e.getExtension("ANGLE_instanced_arrays");if(r)return e.vertexAttribDivisor=(t,n)=>r.vertexAttribDivisorANGLE(t,n),e.drawArraysInstanced=(t,n,a,i)=>r.drawArraysInstancedANGLE(t,n,a,i),e.drawElementsInstanced=(t,n,a,i,d)=>r.drawElementsInstancedANGLE(t,n,a,i,d),1},zo=e=>{var r=e.getExtension("OES_vertex_array_object");if(r)return e.createVertexArray=()=>r.createVertexArrayOES(),e.deleteVertexArray=t=>r.deleteVertexArrayOES(t),e.bindVertexArray=t=>r.bindVertexArrayOES(t),e.isVertexArray=t=>r.isVertexArrayOES(t),1},Go=e=>{var r=e.getExtension("WEBGL_draw_buffers");if(r)return e.drawBuffers=(t,n)=>r.drawBuffersWEBGL(t,n),1},qo=e=>!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")),wn=function(e){var r=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_half_float","EXT_float_blend","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw"];return(e.getSupportedExtensions()||[]).filter(t=>r.includes(t))},F={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(r){F.lastError||(F.lastError=r)},getNewId:e=>{for(var r=F.counter++,t=e.length;t<r;t++)e[t]=null;return r},getSource:(e,r,t,n)=>{for(var a="",i=0;i<r;++i){var d=n?ee[n+i*4>>2]:void 0;a+=Pe(ee[t+i*4>>2],d)}return a},createContext:(e,r)=>{if(!e.getContextSafariWebGL2Fixed){let a=function(i,d){var u=e.getContextSafariWebGL2Fixed(i,d);return i=="webgl"==u instanceof WebGLRenderingContext?u:null};e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=a}var t=e.getContext("webgl",r);if(!t)return 0;var n=F.registerContext(t,r);return n},registerContext:(e,r)=>{var t=F.getNewId(F.contexts),n={handle:t,attributes:r,version:r.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),F.contexts[t]=n,(typeof r.enableExtensionsByDefault>"u"||r.enableExtensionsByDefault)&&F.initExtensions(n),t},makeContextCurrent:e=>{var r;return F.currentContext=F.contexts[e],s.ctx=y=(r=F.currentContext)==null?void 0:r.GLctx,!(e&&!y)},getContext:e=>F.contexts[e],deleteContext:e=>{F.currentContext===F.contexts[e]&&(F.currentContext=null),typeof B=="object"&&B.removeAllHandlersOnTarget(F.contexts[e].GLctx.canvas),F.contexts[e]&&F.contexts[e].GLctx.canvas&&(F.contexts[e].GLctx.canvas.GLctxObject=void 0),F.contexts[e]=null},initExtensions:e=>{if(e||(e=F.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var r=e.GLctx;Oo(r),zo(r),Go(r),r.disjointTimerQueryExt=r.getExtension("EXT_disjoint_timer_query"),qo(r),wn(r).forEach(t=>{!t.includes("lose_context")&&!t.includes("debug")&&r.getExtension(t)})}}},Vo=(e,r,t,n)=>{if(e!=62e3)return W.setErrorCode(12296),0;for(var a=1;;){var i=m[n>>2];if(i==12440)a=m[n+4>>2];else{if(i==12344)break;return W.setErrorCode(12292),0}n+=8}return a!=2?(W.setErrorCode(12293),0):(W.contextAttributes.majorVersion=a-1,W.contextAttributes.minorVersion=0,W.context=F.createContext(s.canvas,W.contextAttributes),W.context!=0?(W.setErrorCode(12288),F.makeContextCurrent(W.context),s.useWebGL=!0,j.moduleContextCreatedCallbacks.forEach(function(d){d()}),F.makeContextCurrent(null),62004):(W.setErrorCode(12297),0))},Ho=(e,r,t,n)=>e!=62e3?(W.setErrorCode(12296),0):r!=62002?(W.setErrorCode(12293),0):(W.setErrorCode(12288),62006),Wo=(e,r)=>e!=62e3?(W.setErrorCode(12296),0):r!=62004?(W.setErrorCode(12294),0):(F.deleteContext(W.context),W.setErrorCode(12288),W.currentContext==r&&(W.currentContext=0),1),Xo=(e,r)=>e!=62e3?(W.setErrorCode(12296),0):r!=62006?(W.setErrorCode(12301),1):(W.currentReadSurface==r&&(W.currentReadSurface=0),W.currentDrawSurface==r&&(W.currentDrawSurface=0),W.setErrorCode(12288),1),Ko=(e,r,t,n)=>{if(e!=62e3)return W.setErrorCode(12296),0;if(r!=62002)return W.setErrorCode(12293),0;if(!n)return W.setErrorCode(12300),0;switch(W.setErrorCode(12288),t){case 12320:return m[n>>2]=W.contextAttributes.alpha?32:24,1;case 12321:return m[n>>2]=W.contextAttributes.alpha?8:0,1;case 12322:return m[n>>2]=8,1;case 12323:return m[n>>2]=8,1;case 12324:return m[n>>2]=8,1;case 12325:return m[n>>2]=W.contextAttributes.depth?24:0,1;case 12326:return m[n>>2]=W.contextAttributes.stencil?8:0,1;case 12327:return m[n>>2]=12344,1;case 12328:return m[n>>2]=62002,1;case 12329:return m[n>>2]=0,1;case 12330:return m[n>>2]=4096,1;case 12331:return m[n>>2]=16777216,1;case 12332:return m[n>>2]=4096,1;case 12333:return m[n>>2]=0,1;case 12334:return m[n>>2]=0,1;case 12335:return m[n>>2]=12344,1;case 12337:return m[n>>2]=W.contextAttributes.antialias?4:0,1;case 12338:return m[n>>2]=W.contextAttributes.antialias?1:0,1;case 12339:return m[n>>2]=4,1;case 12340:return m[n>>2]=12344,1;case 12341:case 12342:case 12343:return m[n>>2]=-1,1;case 12345:case 12346:return m[n>>2]=0,1;case 12347:return m[n>>2]=0,1;case 12348:return m[n>>2]=1,1;case 12349:case 12350:return m[n>>2]=0,1;case 12351:return m[n>>2]=12430,1;case 12352:return m[n>>2]=4,1;case 12354:return m[n>>2]=0,1;default:return W.setErrorCode(12292),0}},Yo=e=>(W.setErrorCode(12288),e!=0&&e!=1?0:62e3),Qo=()=>W.errorCode,Jo=(e,r,t)=>e!=62e3?(W.setErrorCode(12296),0):(r&&(m[r>>2]=1),t&&(m[t>>2]=4),W.defaultDisplayInitialized=!0,W.setErrorCode(12288),1),Zo=(e,r,t,n)=>e!=62e3?(W.setErrorCode(12296),0):n!=0&&n!=62004?(W.setErrorCode(12294),0):t!=0&&t!=62006||r!=0&&r!=62006?(W.setErrorCode(12301),0):(F.makeContextCurrent(n?W.context:null),W.currentContext=n,W.currentDrawSurface=r,W.currentReadSurface=t,W.setErrorCode(12288),1),es=(e,r)=>{if(e!=62e3)return W.setErrorCode(12296),0;if(W.setErrorCode(12288),W.stringCache[r])return W.stringCache[r];var t;switch(r){case 12371:t=Ke("Emscripten");break;case 12372:t=Ke("1.4 Emscripten EGL");break;case 12373:t=Ke("");break;case 12429:t=Ke("OpenGL_ES");break;default:return W.setErrorCode(12300),0}return W.stringCache[r]=t,t},rs=(e,r)=>{if(!W.defaultDisplayInitialized)W.setErrorCode(12289);else if(!s.ctx)W.setErrorCode(12290);else if(s.ctx.isContextLost())W.setErrorCode(12302);else return W.setErrorCode(12288),1;return 0},ts=(e,r)=>e!=62e3?(W.setErrorCode(12296),0):(r==0?Cr(0,0):Cr(1,r),W.setErrorCode(12288),1),ns=e=>e!=62e3?(W.setErrorCode(12296),0):(W.currentContext=0,W.currentReadSurface=0,W.currentDrawSurface=0,W.defaultDisplayInitialized=!1,W.setErrorCode(12288),1),as=()=>(W.setErrorCode(12288),1),os=as,ss=e=>(W.setErrorCode(12288),1),_t=[],Sn=(e,r)=>{_t.length=0;for(var t;t=O[e++];){var n=t!=105;n&=t!=112,r+=n&&r%8?4:0,_t.push(t==112?ee[r>>2]:t==105?m[r>>2]:ce[r>>3]),r+=n?8:4}return _t},is=(e,r,t)=>{var n=Sn(r,t);return cn[e].apply(null,n)},ls=(e,r,t)=>is(e,r,t),cs=(e,r,t,n)=>{var a=Sn(r,t);return cn[e].apply(null,a)},ds=(e,r,t)=>cs(e,r,t),us=()=>Date.now(),Cn=e=>{var r=Oe(),t=e();return ze(r),t},B={removeAllEventListeners(){for(;B.eventHandlers.length;)B._removeHandler(B.eventHandlers.length-1);B.deferredCalls=[]},inEventHandler:0,deferredCalls:[],deferCall(e,r,t){function n(d,u){if(d.length!=u.length)return!1;for(var g in d)if(d[g]!=u[g])return!1;return!0}for(var a in B.deferredCalls){var i=B.deferredCalls[a];if(i.targetFunction==e&&n(i.argsList,t))return}B.deferredCalls.push({targetFunction:e,precedence:r,argsList:t}),B.deferredCalls.sort((d,u)=>d.precedence<u.precedence)},removeDeferredCalls(e){for(var r=0;r<B.deferredCalls.length;++r)B.deferredCalls[r].targetFunction==e&&(B.deferredCalls.splice(r,1),--r)},canPerformEventHandlerRequests(){return navigator.userActivation?navigator.userActivation.isActive:B.inEventHandler&&B.currentEventHandler.allowsDeferredCalls},runDeferredCalls(){if(B.canPerformEventHandlerRequests())for(var e=0;e<B.deferredCalls.length;++e){var r=B.deferredCalls[e];B.deferredCalls.splice(e,1),--e,r.targetFunction.apply(null,r.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(e,r)=>{for(var t=0;t<B.eventHandlers.length;++t)B.eventHandlers[t].target==e&&(!r||r==B.eventHandlers[t].eventTypeString)&&B._removeHandler(t--)},_removeHandler(e){var r=B.eventHandlers[e];r.target.removeEventListener(r.eventTypeString,r.eventListenerFunc,r.useCapture),B.eventHandlers.splice(e,1)},registerOrRemoveHandler(e){if(!e.target)return-4;if(e.callbackfunc)e.eventListenerFunc=function(t){++B.inEventHandler,B.currentEventHandler=e,B.runDeferredCalls(),e.handlerFunc(t),B.runDeferredCalls(),--B.inEventHandler},e.target.addEventListener(e.eventTypeString,e.eventListenerFunc,e.useCapture),B.eventHandlers.push(e);else for(var r=0;r<B.eventHandlers.length;++r)B.eventHandlers[r].target==e.target&&B.eventHandlers[r].eventTypeString==e.eventTypeString&&B._removeHandler(r--);return 0},getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":(e==null?void 0:e.nodeName)||"":""},fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},zr={},fs=e=>e>2?Pe(e):e,Gr=[0,document,window],Ae=e=>{e=fs(e);var r=Gr[e]||document.querySelector(e);return r},En=Ae,ms=(e,r,t)=>{var n=En(e);if(!n)return-4;m[r>>2]=n.width,m[t>>2]=n.height},yt=e=>{var r=wr(e)+1,t=Kr(r);return ve(e,t,r),t},kn=e=>Cn(()=>{var r=Kr(8),t=r+4,n=yt(e.id);ms(n,r,t);var a=[m[r>>2],m[t>>2]];return a}),jn=(e,r,t)=>{var n=En(e);return n?(n.width=r,n.height=t,0):-4},Fn=(e,r,t)=>{e.controlTransferredOffscreen?Cn(()=>{var n=yt(e.id);jn(n,r,t)}):(e.width=r,e.height=t)},ps=e=>{var r=kn(e),t=r[0],n=r[1],a=e.style.width,i=e.style.height,d=e.style.backgroundColor,u=document.body.style.backgroundColor,g=e.style.paddingLeft,_=e.style.paddingRight,E=e.style.paddingTop,T=e.style.paddingBottom,q=e.style.marginLeft,M=e.style.marginRight,z=e.style.marginTop,J=e.style.marginBottom,xe=document.body.style.margin,he=document.documentElement.style.overflow,Se=document.body.scroll,be=e.style.imageRendering;function _e(){var ke=document.fullscreenElement||document.webkitFullscreenElement;ke||(document.removeEventListener("fullscreenchange",_e),document.removeEventListener("webkitfullscreenchange",_e),Fn(e,t,n),e.style.width=a,e.style.height=i,e.style.backgroundColor=d,u||(document.body.style.backgroundColor="white"),document.body.style.backgroundColor=u,e.style.paddingLeft=g,e.style.paddingRight=_,e.style.paddingTop=E,e.style.paddingBottom=T,e.style.marginLeft=q,e.style.marginRight=M,e.style.marginTop=z,e.style.marginBottom=J,document.body.style.margin=xe,document.documentElement.style.overflow=he,document.body.scroll=Se,e.style.imageRendering=be,e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,t,n),zr.canvasResizedCallback&&le(zr.canvasResizedCallback)(37,0,zr.canvasResizedCallbackUserData))}return document.addEventListener("fullscreenchange",_e),document.addEventListener("webkitfullscreenchange",_e),_e},wt=(e,r,t)=>{e.style.paddingLeft=e.style.paddingRight=t+"px",e.style.paddingTop=e.style.paddingBottom=r+"px"},qr=e=>Gr.indexOf(e)<0?e.getBoundingClientRect():{left:0,top:0},hs=(e,r)=>{var t=ps(e),n=r.softFullscreen?innerWidth:screen.width,a=r.softFullscreen?innerHeight:screen.height,i=qr(e),d=i.width,u=i.height,g=kn(e),_=g[0],E=g[1];if(r.scaleMode==3)wt(e,(a-u)/2,(n-d)/2),n=d,a=u;else if(r.scaleMode==2)if(n*E<_*a){var T=E*n/_;wt(e,(a-T)/2,0),a=T}else{var q=_*a/E;wt(e,0,(n-q)/2),n=q}e.style.backgroundColor||(e.style.backgroundColor="black"),document.body.style.backgroundColor||(document.body.style.backgroundColor="black"),e.style.width=n+"px",e.style.height=a+"px",r.filteringMode==1&&(e.style.imageRendering="optimizeSpeed",e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated");var M=r.canvasResolutionScaleMode==2?devicePixelRatio:1;if(r.canvasResolutionScaleMode!=0){var z=n*M|0,J=a*M|0;Fn(e,z,J),e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,z,J)}return t},St=(e,r)=>{if((r.scaleMode!=0||r.canvasResolutionScaleMode!=0)&&hs(e,r),e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else return B.fullscreenEnabled()?-3:-1;return zr=r,r.canvasResizedCallback&&le(r.canvasResizedCallback)(37,0,r.canvasResizedCallbackUserData),0},vs=()=>{if(!B.fullscreenEnabled())return-1;B.removeDeferredCalls(St);var e=Gr[1];if(e.exitFullscreen)e.fullscreenElement&&e.exitFullscreen();else if(e.webkitExitFullscreen)e.webkitFullscreenElement&&e.webkitExitFullscreen();else return-1;return 0},Ct=e=>{if(e.requestPointerLock)e.requestPointerLock();else return document.body.requestPointerLock?-3:-1;return 0},gs=()=>{if(B.removeDeferredCalls(Ct),document.exitPointerLock)document.exitPointerLock();else return-1;return 0},xs=()=>devicePixelRatio,bs=(e,r,t)=>{if(e=Ae(e),!e)return-4;var n=qr(e);return ce[r>>3]=n.width,ce[t>>3]=n.height,0},Ln=(e,r)=>{ce[e>>3]=r.timestamp;for(var t=0;t<r.axes.length;++t)ce[e+t*8+16>>3]=r.axes[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?ce[e+t*8+528>>3]=r.buttons[t].value:ce[e+t*8+528>>3]=r.buttons[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?m[e+t*4+1040>>2]=r.buttons[t].pressed:m[e+t*4+1040>>2]=r.buttons[t]==1;m[e+1296>>2]=r.connected,m[e+1300>>2]=r.index,m[e+8>>2]=r.axes.length,m[e+12>>2]=r.buttons.length,ve(r.id,e+1304,64),ve(r.mapping,e+1368,64)},_s=(e,r)=>e<0||e>=B.lastGamepadState.length?-5:B.lastGamepadState[e]?(Ln(r,B.lastGamepadState[e]),0):-7,ys=(e,r)=>{e&&(m[e>>2]=j.mainLoop.timingMode),r&&(m[r>>2]=j.mainLoop.timingValue)},ws=()=>B.lastGamepadState.length,Ss=(e,r)=>{m[e>>2]=screen.width,m[r>>2]=screen.height};function Cs(e){y.activeTexture(e)}var Es=Cs,ks=(e,r)=>{y.attachShader(F.programs[e],F.shaders[r])},js=ks,Fs=(e,r)=>{y.disjointTimerQueryExt.beginQueryEXT(e,F.queries[r])},Ls=Fs,Rs=(e,r,t)=>{y.bindAttribLocation(F.programs[e],r,Pe(t))},Ts=Rs,Ps=(e,r)=>{y.bindBuffer(e,F.buffers[r])},Ms=Ps,As=(e,r)=>{y.bindFramebuffer(e,F.framebuffers[r])},Ds=As,Is=(e,r)=>{y.bindRenderbuffer(e,F.renderbuffers[r])},Bs=Is,$s=(e,r)=>{y.bindTexture(e,F.textures[r])},Ns=$s,Us=e=>{y.bindVertexArray(F.vaos[e])},Os=Us,zs=Os;function Gs(e,r,t,n){y.blendColor(e,r,t,n)}var qs=Gs;function Vs(e){y.blendEquation(e)}var Hs=Vs;function Ws(e,r){y.blendEquationSeparate(e,r)}var Xs=Ws;function Ks(e,r){y.blendFunc(e,r)}var Ys=Ks;function Qs(e,r,t,n){y.blendFuncSeparate(e,r,t,n)}var Js=Qs,Zs=(e,r,t,n)=>{y.bufferData(e,t?O.subarray(t,t+r):r,n)},ei=Zs,ri=(e,r,t,n)=>{y.bufferSubData(e,r,O.subarray(n,n+t))},ti=ri;function ni(e){return y.checkFramebufferStatus(e)}var ai=ni;function oi(e){y.clear(e)}var si=oi;function ii(e,r,t,n){y.clearColor(e,r,t,n)}var li=ii;function ci(e){y.clearDepth(e)}var di=ci;function ui(e){y.clearStencil(e)}var fi=ui,mi=(e,r,t,n)=>{y.colorMask(!!e,!!r,!!t,!!n)},pi=mi,hi=e=>{y.compileShader(F.shaders[e])},vi=hi,gi=(e,r,t,n,a,i,d,u)=>{y.compressedTexImage2D(e,r,t,n,a,i,u?O.subarray(u,u+d):null)},xi=gi,bi=(e,r,t,n,a,i,d,u,g)=>{y.compressedTexSubImage2D(e,r,t,n,a,i,d,g?O.subarray(g,g+u):null)},_i=bi;function yi(e,r,t,n,a,i,d,u){y.copyTexImage2D(e,r,t,n,a,i,d,u)}var wi=yi;function Si(e,r,t,n,a,i,d,u){y.copyTexSubImage2D(e,r,t,n,a,i,d,u)}var Ci=Si,Ei=()=>{var e=F.getNewId(F.programs),r=y.createProgram();return r.name=e,r.maxUniformLength=r.maxAttributeLength=r.maxUniformBlockNameLength=0,r.uniformIdCounter=1,F.programs[e]=r,e},ki=Ei,ji=e=>{var r=F.getNewId(F.shaders);return F.shaders[r]=y.createShader(e),r},Fi=ji;function Li(e){y.cullFace(e)}var Ri=Li,Ti=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.buffers[n];a&&(y.deleteBuffer(a),a.name=0,F.buffers[n]=null)}},Pi=Ti,Mi=(e,r)=>{for(var t=0;t<e;++t){var n=m[r+t*4>>2],a=F.framebuffers[n];a&&(y.deleteFramebuffer(a),a.name=0,F.framebuffers[n]=null)}},Ai=Mi,Di=e=>{if(e){var r=F.programs[e];if(!r){F.recordError(1281);return}y.deleteProgram(r),r.name=0,F.programs[e]=null}},Ii=Di,Bi=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.queries[n];a&&(y.disjointTimerQueryExt.deleteQueryEXT(a),F.queries[n]=null)}},$i=Bi,Ni=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.renderbuffers[n];a&&(y.deleteRenderbuffer(a),a.name=0,F.renderbuffers[n]=null)}},Ui=Ni,Oi=e=>{if(e){var r=F.shaders[e];if(!r){F.recordError(1281);return}y.deleteShader(r),F.shaders[e]=null}},zi=Oi,Gi=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2],a=F.textures[n];a&&(y.deleteTexture(a),a.name=0,F.textures[n]=null)}},qi=Gi,Vi=(e,r)=>{for(var t=0;t<e;t++){var n=m[r+t*4>>2];y.deleteVertexArray(F.vaos[n]),F.vaos[n]=null}},Hi=Vi,Wi=Hi;function Xi(e){y.depthFunc(e)}var Ki=Xi,Yi=e=>{y.depthMask(!!e)},Qi=Yi;function Ji(e,r){y.depthRange(e,r)}var Zi=Ji,el=(e,r)=>{y.detachShader(F.programs[e],F.shaders[r])},rl=el;function tl(e){y.disable(e)}var nl=tl,al=e=>{y.disableVertexAttribArray(e)},ol=al,sl=(e,r,t)=>{y.drawArrays(e,r,t)},il=sl,ll=(e,r,t,n)=>{y.drawArraysInstanced(e,r,t,n)},cl=ll,dl=cl,Rn=[],ul=(e,r)=>{for(var t=Rn[e],n=0;n<e;n++)t[n]=m[r+n*4>>2];y.drawBuffers(t)},fl=ul,ml=fl,pl=(e,r,t,n)=>{y.drawElements(e,r,t,n)},hl=pl,vl=(e,r,t,n,a)=>{y.drawElementsInstanced(e,r,t,n,a)},gl=vl,xl=gl;function bl(e){y.enable(e)}var _l=bl,yl=e=>{y.enableVertexAttribArray(e)},wl=yl,Sl=e=>{y.disjointTimerQueryExt.endQueryEXT(e)},Cl=Sl;function El(){y.finish()}var kl=El;function jl(){y.flush()}var Fl=jl,Ll=(e,r,t,n)=>{y.framebufferRenderbuffer(e,r,t,F.renderbuffers[n])},Rl=Ll,Tl=(e,r,t,n,a)=>{y.framebufferTexture2D(e,r,t,F.textures[n],a)},Pl=Tl;function Ml(e){y.frontFace(e)}var Al=Ml,Pr=(e,r,t,n)=>{for(var a=0;a<e;a++){var i=y[t](),d=i&&F.getNewId(n);i?(i.name=d,n[d]=i):F.recordError(1282),m[r+a*4>>2]=d}},Dl=(e,r)=>{Pr(e,r,"createBuffer",F.buffers)},Il=Dl,Bl=(e,r)=>{Pr(e,r,"createFramebuffer",F.framebuffers)},$l=Bl,Nl=(e,r)=>{for(var t=0;t<e;t++){var n=y.disjointTimerQueryExt.createQueryEXT();if(!n){for(F.recordError(1282);t<e;)m[r+t++*4>>2]=0;return}var a=F.getNewId(F.queries);n.name=a,F.queries[a]=n,m[r+t*4>>2]=a}},Ul=Nl,Ol=(e,r)=>{Pr(e,r,"createRenderbuffer",F.renderbuffers)},zl=Ol,Gl=(e,r)=>{Pr(e,r,"createTexture",F.textures)},ql=Gl;function Vl(e,r){Pr(e,r,"createVertexArray",F.vaos)}var Hl=Vl,Wl=Hl;function Xl(e){y.generateMipmap(e)}var Kl=Xl,Tn=(e,r,t,n,a,i,d,u)=>{r=F.programs[r];var g=y[e](r,t);if(g){var _=u&&ve(g.name,u,n);a&&(m[a>>2]=_),i&&(m[i>>2]=g.size),d&&(m[d>>2]=g.type)}},Yl=(e,r,t,n,a,i,d)=>{Tn("getActiveAttrib",e,r,t,n,a,i,d)},Ql=Yl,Jl=(e,r,t,n,a,i,d)=>{Tn("getActiveUniform",e,r,t,n,a,i,d)},Zl=Jl,ec=(e,r,t,n)=>{var a=y.getAttachedShaders(F.programs[e]),i=a.length;i>r&&(i=r),m[t>>2]=i;for(var d=0;d<i;++d){var u=F.shaders.indexOf(a[d]);m[n+d*4>>2]=u}},rc=ec,tc=(e,r)=>y.getAttribLocation(F.programs[e],Pe(r)),nc=tc,Pn=(e,r)=>{ee[e>>2]=r;var t=ee[e>>2];ee[e+4>>2]=(r-t)/4294967296},Et=(e,r,t)=>{if(!r){F.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:t!=0&&t!=1&&F.recordError(1280);return;case 36345:n=0;break;case 34466:var a=y.getParameter(34467);n=a?a.length:0;break}if(n===void 0){var i=y.getParameter(e);switch(typeof i){case"number":n=i;break;case"boolean":n=i?1:0;break;case"string":F.recordError(1280);return;case"object":if(i===null)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:{n=0;break}default:{F.recordError(1280);return}}else if(i instanceof Float32Array||i instanceof Uint32Array||i instanceof Int32Array||i instanceof Array){for(var d=0;d<i.length;++d)switch(t){case 0:m[r+d*4>>2]=i[d];break;case 2:Q[r+d*4>>2]=i[d];break;case 4:P[r+d>>0]=i[d]?1:0;break}return}else try{n=i.name|0}catch(u){F.recordError(1280),N(`GL_INVALID_ENUM in glGet${t}v: Unknown object returned from WebGL getParameter(${e})! (error: ${u})`);return}break;default:F.recordError(1280),N(`GL_INVALID_ENUM in glGet${t}v: Native code calling glGet${t}v(${e}) and it returns ${i} of type ${typeof i}!`);return}}switch(t){case 1:Pn(r,n);break;case 0:m[r>>2]=n;break;case 2:Q[r>>2]=n;break;case 4:P[r>>0]=n?1:0;break}},ac=(e,r)=>Et(e,r,4),oc=ac,sc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getBufferParameter(e,r)},ic=sc,lc=()=>{var e=y.getError()||F.lastError;return F.lastError=0,e},cc=lc,dc=(e,r)=>Et(e,r,2),uc=dc,fc=(e,r,t,n)=>{var a=y.getFramebufferAttachmentParameter(e,r,t);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=a.name|0),m[n>>2]=a},mc=fc,pc=(e,r)=>Et(e,r,0),hc=pc,vc=(e,r,t,n)=>{var a=y.getProgramInfoLog(F.programs[e]);a===null&&(a="(unknown error)");var i=r>0&&n?ve(a,n,r):0;t&&(m[t>>2]=i)},gc=vc,xc=(e,r,t)=>{if(!t){F.recordError(1281);return}if(e>=F.counter){F.recordError(1281);return}if(e=F.programs[e],r==35716){var n=y.getProgramInfoLog(e);n===null&&(n="(unknown error)"),m[t>>2]=n.length+1}else if(r==35719){if(!e.maxUniformLength)for(var a=0;a<y.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,y.getActiveUniform(e,a).name.length+1);m[t>>2]=e.maxUniformLength}else if(r==35722){if(!e.maxAttributeLength)for(var a=0;a<y.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,y.getActiveAttrib(e,a).name.length+1);m[t>>2]=e.maxAttributeLength}else if(r==35381){if(!e.maxUniformBlockNameLength)for(var a=0;a<y.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,y.getActiveUniformBlockName(e,a).length+1);m[t>>2]=e.maxUniformBlockNameLength}else m[t>>2]=y.getProgramParameter(e,r)},bc=xc,Mn=(e,r,t)=>{if(!t){F.recordError(1281);return}var n=F.queries[e],a;a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r);var i;typeof a=="boolean"?i=a?1:0:i=a,Pn(t,i)},_c=Mn,An=(e,r,t)=>{if(!t){F.recordError(1281);return}var n=F.queries[e],a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r),i;typeof a=="boolean"?i=a?1:0:i=a,m[t>>2]=i},yc=An,wc=Mn,Sc=wc,Cc=An,Ec=Cc,kc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.disjointTimerQueryExt.getQueryEXT(e,r)},jc=kc,Fc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getRenderbufferParameter(e,r)},Lc=Fc,Rc=(e,r,t,n)=>{var a=y.getShaderInfoLog(F.shaders[e]);a===null&&(a="(unknown error)");var i=r>0&&n?ve(a,n,r):0;t&&(m[t>>2]=i)},Tc=Rc,Pc=(e,r,t,n)=>{var a=y.getShaderPrecisionFormat(e,r);m[t>>2]=a.rangeMin,m[t+4>>2]=a.rangeMax,m[n>>2]=a.precision},Mc=Pc,Ac=(e,r,t,n)=>{var a=y.getShaderSource(F.shaders[e]);if(a){var i=r>0&&n?ve(a,n,r):0;t&&(m[t>>2]=i)}},Dc=Ac,Ic=(e,r,t)=>{if(!t){F.recordError(1281);return}if(r==35716){var n=y.getShaderInfoLog(F.shaders[e]);n===null&&(n="(unknown error)");var a=n?n.length+1:0;m[t>>2]=a}else if(r==35720){var i=y.getShaderSource(F.shaders[e]),d=i?i.length+1:0;m[t>>2]=d}else m[t>>2]=y.getShaderParameter(F.shaders[e],r)},Bc=Ic,$c=function(){var r=wn(y);return r=r.concat(r.map(t=>"GL_"+t)),r},Nc=e=>{var r=F.stringCache[e];if(!r){switch(e){case 7939:r=Ke($c().join(" "));break;case 7936:case 7937:case 37445:case 37446:var t=y.getParameter(e);t||F.recordError(1280),r=t?Ke(t):0;break;case 7938:var n=y.getParameter(7938);n=`OpenGL ES 2.0 (${n})`,r=Ke(n);break;case 35724:var a=y.getParameter(35724),i=/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/,d=a.match(i);d!==null&&(d[1].length==3&&(d[1]=d[1]+"0"),a=`OpenGL ES GLSL ES ${d[1]} (${a})`),r=Ke(a);break;default:F.recordError(1280)}F.stringCache[e]=r}return r},Uc=Nc,Oc=(e,r,t)=>{if(!t){F.recordError(1281);return}Q[t>>2]=y.getTexParameter(e,r)},zc=Oc,Gc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getTexParameter(e,r)},qc=Gc,Vc=e=>parseInt(e),Dn=e=>e.slice(-1)=="]"&&e.lastIndexOf("["),In=e=>{var r=e.uniformLocsById,t=e.uniformSizeAndIdsByName,n,a;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},n=0;n<y.getProgramParameter(e,35718);++n){var i=y.getActiveUniform(e,n),d=i.name,u=i.size,g=Dn(d),_=g>0?d.slice(0,g):d,E=e.uniformIdCounter;for(e.uniformIdCounter+=u,t[_]=[u,E],a=0;a<u;++a)r[E]=a,e.uniformArrayNamesById[E++]=_}},Hc=(e,r)=>{if(r=Pe(r),e=F.programs[e]){In(e);var t=e.uniformLocsById,n=0,a=r,i=Dn(r);i>0&&(n=Vc(r.slice(i+1))>>>0,a=r.slice(0,i));var d=e.uniformSizeAndIdsByName[a];if(d&&n<d[0]&&(n+=d[1],t[n]=t[n]||y.getUniformLocation(e,r)))return n}else F.recordError(1281);return-1},Wc=Hc,we=e=>{var r=y.currentProgram;if(r){var t=r.uniformLocsById[e];return typeof t=="number"&&(r.uniformLocsById[e]=t=y.getUniformLocation(r,r.uniformArrayNamesById[e]+(t>0?`[${t}]`:""))),t}else F.recordError(1282)},Bn=(e,r,t,n)=>{if(!t){F.recordError(1281);return}e=F.programs[e],In(e);var a=y.getUniform(e,we(r));if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:m[t>>2]=a;break;case 2:Q[t>>2]=a;break}else for(var i=0;i<a.length;i++)switch(n){case 0:m[t+i*4>>2]=a[i];break;case 2:Q[t+i*4>>2]=a[i];break}},Xc=(e,r,t)=>{Bn(e,r,t,2)},Kc=Xc,Yc=(e,r,t)=>{Bn(e,r,t,0)},Qc=Yc,Jc=(e,r,t)=>{if(!t){F.recordError(1281);return}m[t>>2]=y.getVertexAttribOffset(e,r)},Zc=Jc,$n=(e,r,t,n)=>{if(!t){F.recordError(1281);return}var a=y.getVertexAttrib(e,r);if(r==34975)m[t>>2]=a&&a.name;else if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:m[t>>2]=a;break;case 2:Q[t>>2]=a;break;case 5:m[t>>2]=Math.fround(a);break}else for(var i=0;i<a.length;i++)switch(n){case 0:m[t+i*4>>2]=a[i];break;case 2:Q[t+i*4>>2]=a[i];break;case 5:m[t+i*4>>2]=Math.fround(a[i]);break}},ed=(e,r,t)=>{$n(e,r,t,2)},rd=ed,td=(e,r,t)=>{$n(e,r,t,5)},nd=td;function ad(e,r){y.hint(e,r)}var od=ad,sd=e=>{var r=F.buffers[e];return r?y.isBuffer(r):0},id=sd;function ld(e){return y.isEnabled(e)}var cd=ld,dd=e=>{var r=F.framebuffers[e];return r?y.isFramebuffer(r):0},ud=dd,fd=e=>(e=F.programs[e],e?y.isProgram(e):0),md=fd,pd=e=>{var r=F.queries[e];return r?y.disjointTimerQueryExt.isQueryEXT(r):0},hd=pd,vd=e=>{var r=F.renderbuffers[e];return r?y.isRenderbuffer(r):0},gd=vd,xd=e=>{var r=F.shaders[e];return r?y.isShader(r):0},bd=xd,_d=e=>{var r=F.textures[e];return r?y.isTexture(r):0},yd=_d,wd=e=>{var r=F.vaos[e];return r?y.isVertexArray(r):0},Sd=wd,Cd=Sd;function Ed(e){y.lineWidth(e)}var kd=Ed,jd=e=>{e=F.programs[e],y.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},Fd=jd,Ld=(e,r)=>{e==3317&&(F.unpackAlignment=r),y.pixelStorei(e,r)},Rd=Ld;function Td(e,r){y.polygonOffset(e,r)}var Pd=Td,Md=(e,r)=>{y.disjointTimerQueryExt.queryCounterEXT(F.queries[e],r)},Ad=Md,Dd=(e,r,t,n)=>{function a(u,g){return u+g-1&-g}var i=e*t,d=a(i,n);return r*d},Id=e=>{var r={5:3,6:4,8:2,29502:3,29504:4};return r[e-6402]||1},Bd=e=>(e-=5120,e==1?O:e==4?m:e==6?Q:e==5||e==28922?ee:K),$d=e=>31-Math.clz32(e.BYTES_PER_ELEMENT),kt=(e,r,t,n,a,i)=>{var d=Bd(e),u=$d(d),g=1<<u,_=Id(r)*g,E=Dd(t,n,_,F.unpackAlignment);return d.subarray(a>>u,a+E>>u)},Nd=(e,r,t,n,a,i,d)=>{var u=kt(i,a,t,n,d);if(!u){F.recordError(1280);return}y.readPixels(e,r,t,n,a,i,u)},Ud=Nd,Od=()=>{},zd=Od;function Gd(e,r,t,n){y.renderbufferStorage(e,r,t,n)}var qd=Gd,Vd=(e,r)=>{y.sampleCoverage(e,!!r)},Hd=Vd;function Wd(e,r,t,n){y.scissor(e,r,t,n)}var Xd=Wd,Kd=(e,r,t,n,a)=>{F.recordError(1280)},Yd=Kd,Qd=(e,r,t,n)=>{var a=F.getSource(e,r,t,n);y.shaderSource(F.shaders[e],a)},Jd=Qd;function Zd(e,r,t){y.stencilFunc(e,r,t)}var eu=Zd;function ru(e,r,t,n){y.stencilFuncSeparate(e,r,t,n)}var tu=ru;function nu(e){y.stencilMask(e)}var au=nu;function ou(e,r){y.stencilMaskSeparate(e,r)}var su=ou;function iu(e,r,t){y.stencilOp(e,r,t)}var lu=iu;function cu(e,r,t,n){y.stencilOpSeparate(e,r,t,n)}var du=cu,uu=(e,r,t,n,a,i,d,u,g)=>{y.texImage2D(e,r,t,n,a,i,d,u,g?kt(u,d,n,a,g):null)},fu=uu;function mu(e,r,t){y.texParameterf(e,r,t)}var pu=mu,hu=(e,r,t)=>{var n=Q[t>>2];y.texParameterf(e,r,n)},vu=hu;function gu(e,r,t){y.texParameteri(e,r,t)}var xu=gu,bu=(e,r,t)=>{var n=m[t>>2];y.texParameteri(e,r,n)},_u=bu,yu=(e,r,t,n,a,i,d,u,g)=>{var _=null;g&&(_=kt(u,d,a,i,g)),y.texSubImage2D(e,r,t,n,a,i,d,u,_)},wu=yu,Su=(e,r)=>{y.uniform1f(we(e),r)},Cu=Su,sr=[],Eu=(e,r,t)=>{if(r<=288)for(var n=sr[r-1],a=0;a<r;++a)n[a]=Q[t+4*a>>2];else var n=Q.subarray(t>>2,t+r*4>>2);y.uniform1fv(we(e),n)},ku=Eu,ju=(e,r)=>{y.uniform1i(we(e),r)},Fu=ju,Mr=[],Lu=(e,r,t)=>{if(r<=288)for(var n=Mr[r-1],a=0;a<r;++a)n[a]=m[t+4*a>>2];else var n=m.subarray(t>>2,t+r*4>>2);y.uniform1iv(we(e),n)},Ru=Lu,Tu=(e,r,t)=>{y.uniform2f(we(e),r,t)},Pu=Tu,Mu=(e,r,t)=>{if(r<=144)for(var n=sr[2*r-1],a=0;a<2*r;a+=2)n[a]=Q[t+4*a>>2],n[a+1]=Q[t+(4*a+4)>>2];else var n=Q.subarray(t>>2,t+r*8>>2);y.uniform2fv(we(e),n)},Au=Mu,Du=(e,r,t)=>{y.uniform2i(we(e),r,t)},Iu=Du,Bu=(e,r,t)=>{if(r<=144)for(var n=Mr[2*r-1],a=0;a<2*r;a+=2)n[a]=m[t+4*a>>2],n[a+1]=m[t+(4*a+4)>>2];else var n=m.subarray(t>>2,t+r*8>>2);y.uniform2iv(we(e),n)},$u=Bu,Nu=(e,r,t,n)=>{y.uniform3f(we(e),r,t,n)},Uu=Nu,Ou=(e,r,t)=>{if(r<=96)for(var n=sr[3*r-1],a=0;a<3*r;a+=3)n[a]=Q[t+4*a>>2],n[a+1]=Q[t+(4*a+4)>>2],n[a+2]=Q[t+(4*a+8)>>2];else var n=Q.subarray(t>>2,t+r*12>>2);y.uniform3fv(we(e),n)},zu=Ou,Gu=(e,r,t,n)=>{y.uniform3i(we(e),r,t,n)},qu=Gu,Vu=(e,r,t)=>{if(r<=96)for(var n=Mr[3*r-1],a=0;a<3*r;a+=3)n[a]=m[t+4*a>>2],n[a+1]=m[t+(4*a+4)>>2],n[a+2]=m[t+(4*a+8)>>2];else var n=m.subarray(t>>2,t+r*12>>2);y.uniform3iv(we(e),n)},Hu=Vu,Wu=(e,r,t,n,a)=>{y.uniform4f(we(e),r,t,n,a)},Xu=Wu,Ku=(e,r,t)=>{if(r<=72){var n=sr[4*r-1],a=Q;t>>=2;for(var i=0;i<4*r;i+=4){var d=t+i;n[i]=a[d],n[i+1]=a[d+1],n[i+2]=a[d+2],n[i+3]=a[d+3]}}else var n=Q.subarray(t>>2,t+r*16>>2);y.uniform4fv(we(e),n)},Yu=Ku,Qu=(e,r,t,n,a)=>{y.uniform4i(we(e),r,t,n,a)},Ju=Qu,Zu=(e,r,t)=>{if(r<=72)for(var n=Mr[4*r-1],a=0;a<4*r;a+=4)n[a]=m[t+4*a>>2],n[a+1]=m[t+(4*a+4)>>2],n[a+2]=m[t+(4*a+8)>>2],n[a+3]=m[t+(4*a+12)>>2];else var n=m.subarray(t>>2,t+r*16>>2);y.uniform4iv(we(e),n)},ef=Zu,rf=(e,r,t,n)=>{if(r<=72)for(var a=sr[4*r-1],i=0;i<4*r;i+=4)a[i]=Q[n+4*i>>2],a[i+1]=Q[n+(4*i+4)>>2],a[i+2]=Q[n+(4*i+8)>>2],a[i+3]=Q[n+(4*i+12)>>2];else var a=Q.subarray(n>>2,n+r*16>>2);y.uniformMatrix2fv(we(e),!!t,a)},tf=rf,nf=(e,r,t,n)=>{if(r<=32)for(var a=sr[9*r-1],i=0;i<9*r;i+=9)a[i]=Q[n+4*i>>2],a[i+1]=Q[n+(4*i+4)>>2],a[i+2]=Q[n+(4*i+8)>>2],a[i+3]=Q[n+(4*i+12)>>2],a[i+4]=Q[n+(4*i+16)>>2],a[i+5]=Q[n+(4*i+20)>>2],a[i+6]=Q[n+(4*i+24)>>2],a[i+7]=Q[n+(4*i+28)>>2],a[i+8]=Q[n+(4*i+32)>>2];else var a=Q.subarray(n>>2,n+r*36>>2);y.uniformMatrix3fv(we(e),!!t,a)},af=nf,of=(e,r,t,n)=>{if(r<=18){var a=sr[16*r-1],i=Q;n>>=2;for(var d=0;d<16*r;d+=16){var u=n+d;a[d]=i[u],a[d+1]=i[u+1],a[d+2]=i[u+2],a[d+3]=i[u+3],a[d+4]=i[u+4],a[d+5]=i[u+5],a[d+6]=i[u+6],a[d+7]=i[u+7],a[d+8]=i[u+8],a[d+9]=i[u+9],a[d+10]=i[u+10],a[d+11]=i[u+11],a[d+12]=i[u+12],a[d+13]=i[u+13],a[d+14]=i[u+14],a[d+15]=i[u+15]}}else var a=Q.subarray(n>>2,n+r*64>>2);y.uniformMatrix4fv(we(e),!!t,a)},sf=of,lf=e=>{e=F.programs[e],y.useProgram(e),y.currentProgram=e},cf=lf,df=e=>{y.validateProgram(F.programs[e])},uf=df;function ff(e,r){y.vertexAttrib1f(e,r)}var mf=ff,pf=(e,r)=>{y.vertexAttrib1f(e,Q[r>>2])},hf=pf;function vf(e,r,t){y.vertexAttrib2f(e,r,t)}var gf=vf,xf=(e,r)=>{y.vertexAttrib2f(e,Q[r>>2],Q[r+4>>2])},bf=xf;function _f(e,r,t,n){y.vertexAttrib3f(e,r,t,n)}var yf=_f,wf=(e,r)=>{y.vertexAttrib3f(e,Q[r>>2],Q[r+4>>2],Q[r+8>>2])},Sf=wf;function Cf(e,r,t,n,a){y.vertexAttrib4f(e,r,t,n,a)}var Ef=Cf,kf=(e,r)=>{y.vertexAttrib4f(e,Q[r>>2],Q[r+4>>2],Q[r+8>>2],Q[r+12>>2])},jf=kf,Ff=(e,r)=>{y.vertexAttribDivisor(e,r)},Lf=Ff,Rf=Lf,Tf=(e,r,t,n,a,i)=>{y.vertexAttribPointer(e,r,t,!!n,a,i)},Pf=Tf;function Mf(e,r,t,n){y.viewport(e,r,t,n)}var Af=Mf,Df=()=>0,If=(e,r,t)=>O.copyWithin(e,r,r+t),Bf=()=>{j.mainLoop.pause()},$f=(e,r)=>{if(!B.fullscreenEnabled())return-1;if(e=Ae(e),!e)return-4;if(!e.requestFullscreen&&!e.webkitRequestFullscreen)return-3;var t=B.canPerformEventHandlerRequests();return t?St(e,r):r.deferUntilInEventHandler?(B.deferCall(St,1,[e,r]),1):-2},Nf=(e,r,t)=>{var n={scaleMode:m[t>>2],canvasResolutionScaleMode:m[t+4>>2],filteringMode:m[t+8>>2],deferUntilInEventHandler:r,canvasResizedCallback:m[t+12>>2],canvasResizedCallbackUserData:m[t+16>>2]};return $f(e,n)},Uf=(e,r)=>{if(e=Ae(e),!e)return-4;if(!e.requestPointerLock)return-1;var t=B.canPerformEventHandlerRequests();return t?Ct(e):r?(B.deferCall(Ct,2,[e]),1):-2},Of=()=>2147483648,zf=e=>{var r=Y.buffer,t=(e-r.byteLength+65535)/65536;try{return Y.grow(t),Te(),1}catch{}},Gf=e=>{var r=O.length;e>>>=0;var t=Of();if(e>t)return!1;for(var n=(g,_)=>g+(_-g%_)%_,a=1;a<=4;a*=2){var i=r*(1+.2/a);i=Math.min(i,e+100663296);var d=Math.min(t,n(Math.max(e,i),65536)),u=zf(d);if(u)return!0}return!1},qf=()=>{j.mainLoop.resume()},jt=()=>{try{if(navigator.getGamepads)return(B.lastGamepadState=navigator.getGamepads())?0:-1}catch{navigator.getGamepads=null}return-1},Vf=(e,r,t,n,a,i)=>{var d=(g=event)=>{var _=le(n)(a,0,r);if(_&&(_=Pe(_)),_)return g.preventDefault(),g.returnValue=_,_},u={target:Ae(e),eventTypeString:i,callbackfunc:n,handlerFunc:d,useCapture:t};return B.registerOrRemoveHandler(u)},Hf=(e,r,t)=>typeof onbeforeunload>"u"?-1:t!==1?-5:Vf(2,e,!0,r,28,"beforeunload"),Nn=(e,r,t,n,a,i,d)=>{B.focusEvent||(B.focusEvent=Ue(256));var u=(_=event)=>{var E=B.getNodeNameForTarget(_.target),T=_.target.id?_.target.id:"",q=B.focusEvent;ve(E,q+0,128),ve(T,q+128,128),le(n)(a,q,r)&&_.preventDefault()},g={target:Ae(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},Wf=(e,r,t,n,a)=>Nn(e,r,t,n,12,"blur"),Xf=(e,r,t)=>(e=Ae(e),e?(e.style.width=r+"px",e.style.height=t+"px",0):-4),Kf=(e,r,t,n,a)=>Nn(e,r,t,n,13,"focus"),Yf=e=>{var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=!!r;m[e>>2]=t,m[e+4>>2]=B.fullscreenEnabled();var n=t?r:B.previousFullscreenElement,a=B.getNodeNameForTarget(n),i=(n==null?void 0:n.id)||"";ve(a,e+8,128),ve(i,e+136,128),m[e+264>>2]=n?n.clientWidth:0,m[e+268>>2]=n?n.clientHeight:0,m[e+272>>2]=screen.width,m[e+276>>2]=screen.height,t&&(B.previousFullscreenElement=r)},Un=(e,r,t,n,a,i,d)=>{B.fullscreenChangeEvent||(B.fullscreenChangeEvent=Ue(280));var u=(_=event)=>{var E=B.fullscreenChangeEvent;Yf(E),le(n)(a,E,r)&&_.preventDefault()},g={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},Qf=(e,r,t,n,a)=>B.fullscreenEnabled()?(e=Ae(e),e?(Un(e,r,t,n,19,"webkitfullscreenchange"),Un(e,r,t,n,19,"fullscreenchange")):-4):-1,On=(e,r,t,n,a,i,d)=>{B.gamepadEvent||(B.gamepadEvent=Ue(1432));var u=(_=event)=>{var E=B.gamepadEvent;Ln(E,_.gamepad),le(n)(a,E,r)&&_.preventDefault()},g={target:Ae(e),allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},Jf=(e,r,t,n)=>jt()?-1:On(2,e,r,t,26,"gamepadconnected"),Zf=(e,r,t,n)=>jt()?-1:On(2,e,r,t,27,"gamepaddisconnected"),Ft=(e,r,t,n,a,i,d)=>{B.keyEvent||(B.keyEvent=Ue(176));var u=_=>{var E=B.keyEvent;ce[E>>3]=_.timeStamp;var T=E>>2;m[T+2]=_.location,m[T+3]=_.ctrlKey,m[T+4]=_.shiftKey,m[T+5]=_.altKey,m[T+6]=_.metaKey,m[T+7]=_.repeat,m[T+8]=_.charCode,m[T+9]=_.keyCode,m[T+10]=_.which,ve(_.key||"",E+44,32),ve(_.code||"",E+76,32),ve(_.char||"",E+108,32),ve(_.locale||"",E+140,32),le(n)(a,E,r)&&_.preventDefault()},g={target:Ae(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},em=(e,r,t,n,a)=>Ft(e,r,t,n,2,"keydown"),rm=(e,r,t,n,a)=>Ft(e,r,t,n,1,"keypress"),tm=(e,r,t,n,a)=>Ft(e,r,t,n,3,"keyup"),nm=(e,r,t)=>{var n=le(e);gn(n,r,t)},zn=(e,r,t)=>{ce[e>>3]=r.timeStamp;var n=e>>2;m[n+2]=r.screenX,m[n+3]=r.screenY,m[n+4]=r.clientX,m[n+5]=r.clientY,m[n+6]=r.ctrlKey,m[n+7]=r.shiftKey,m[n+8]=r.altKey,m[n+9]=r.metaKey,A[n*2+20]=r.button,A[n*2+21]=r.buttons,m[n+11]=r.movementX,m[n+12]=r.movementY;var a=qr(t);m[n+13]=r.clientX-a.left,m[n+14]=r.clientY-a.top},Ar=(e,r,t,n,a,i,d)=>{B.mouseEvent||(B.mouseEvent=Ue(72)),e=Ae(e);var u=(_=event)=>{zn(B.mouseEvent,_,e),le(n)(a,B.mouseEvent,r)&&_.preventDefault()},g={target:e,allowsDeferredCalls:i!="mousemove"&&i!="mouseenter"&&i!="mouseleave",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},am=(e,r,t,n,a)=>Ar(e,r,t,n,5,"mousedown"),om=(e,r,t,n,a)=>Ar(e,r,t,n,33,"mouseenter"),sm=(e,r,t,n,a)=>Ar(e,r,t,n,34,"mouseleave"),im=(e,r,t,n,a)=>Ar(e,r,t,n,8,"mousemove"),lm=(e,r,t,n,a)=>Ar(e,r,t,n,6,"mouseup"),cm=e=>{var r=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement,t=!!r;m[e>>2]=t;var n=B.getNodeNameForTarget(r),a=(r==null?void 0:r.id)||"";ve(n,e+4,128),ve(a,e+132,128)},Vr=(e,r,t,n,a,i,d)=>{B.pointerlockChangeEvent||(B.pointerlockChangeEvent=Ue(260));var u=(_=event)=>{var E=B.pointerlockChangeEvent;cm(E),le(n)(a,E,r)&&_.preventDefault()},g={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},dm=(e,r,t,n,a)=>!document||!document.body||!document.body.requestPointerLock&&!document.body.mozRequestPointerLock&&!document.body.webkitRequestPointerLock&&!document.body.msRequestPointerLock?-1:(e=Ae(e),e?(Vr(e,r,t,n,20,"mozpointerlockchange"),Vr(e,r,t,n,20,"webkitpointerlockchange"),Vr(e,r,t,n,20,"mspointerlockchange"),Vr(e,r,t,n,20,"pointerlockchange")):-4),um=(e,r,t,n,a,i,d)=>{B.uiEvent||(B.uiEvent=Ue(36)),e=Ae(e);var u=(_=event)=>{if(_.target==e){var E=document.body;if(E){var T=B.uiEvent;m[T>>2]=_.detail,m[T+4>>2]=E.clientWidth,m[T+8>>2]=E.clientHeight,m[T+12>>2]=innerWidth,m[T+16>>2]=innerHeight,m[T+20>>2]=outerWidth,m[T+24>>2]=outerHeight,m[T+28>>2]=pageXOffset,m[T+32>>2]=pageYOffset,le(n)(a,T,r)&&_.preventDefault()}}},g={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},fm=(e,r,t,n,a)=>um(e,r,t,n,10,"resize"),Hr=(e,r,t,n,a,i,d)=>{B.touchEvent||(B.touchEvent=Ue(1696)),e=Ae(e);var u=_=>{for(var E,T={},q=_.touches,M=0;M<q.length;++M)E=q[M],E.isChanged=E.onTarget=0,T[E.identifier]=E;for(var M=0;M<_.changedTouches.length;++M)E=_.changedTouches[M],E.isChanged=1,T[E.identifier]=E;for(var M=0;M<_.targetTouches.length;++M)T[_.targetTouches[M].identifier].onTarget=1;var z=B.touchEvent;ce[z>>3]=_.timeStamp;var J=z>>2;m[J+3]=_.ctrlKey,m[J+4]=_.shiftKey,m[J+5]=_.altKey,m[J+6]=_.metaKey,J+=7;var xe=qr(e),he=0;for(var M in T)if(E=T[M],m[J+0]=E.identifier,m[J+1]=E.screenX,m[J+2]=E.screenY,m[J+3]=E.clientX,m[J+4]=E.clientY,m[J+5]=E.pageX,m[J+6]=E.pageY,m[J+7]=E.isChanged,m[J+8]=E.onTarget,m[J+9]=E.clientX-xe.left,m[J+10]=E.clientY-xe.top,J+=13,++he>31)break;m[z+8>>2]=he,le(n)(a,z,r)&&_.preventDefault()},g={target:e,allowsDeferredCalls:i=="touchstart"||i=="touchend",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},mm=(e,r,t,n,a)=>Hr(e,r,t,n,25,"touchcancel"),pm=(e,r,t,n,a)=>Hr(e,r,t,n,23,"touchend"),hm=(e,r,t,n,a)=>Hr(e,r,t,n,24,"touchmove"),vm=(e,r,t,n,a)=>Hr(e,r,t,n,22,"touchstart"),gm=e=>{var r=["hidden","visible","prerender","unloaded"],t=r.indexOf(document.visibilityState);m[e>>2]=document.hidden,m[e+4>>2]=t},xm=(e,r,t,n,a,i,d)=>{B.visibilityChangeEvent||(B.visibilityChangeEvent=Ue(8));var u=(_=event)=>{var E=B.visibilityChangeEvent;gm(E),le(n)(a,E,r)&&_.preventDefault()},g={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},bm=(e,r,t,n)=>xm(Gr[1],e,r,t,21,"visibilitychange"),_m=(e,r,t,n,a,i,d)=>{B.wheelEvent||(B.wheelEvent=Ue(104));var u=(_=event)=>{var E=B.wheelEvent;zn(E,_,e),ce[E+72>>3]=_.deltaX,ce[E+80>>3]=_.deltaY,ce[E+88>>3]=_.deltaZ,m[E+96>>2]=_.deltaMode,le(n)(a,E,r)&&_.preventDefault()},g={target:e,allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return B.registerOrRemoveHandler(g)},ym=(e,r,t,n,a)=>(e=Ae(e),e?typeof e.onwheel<"u"?_m(e,r,t,n,9,"wheel"):-1:-4),wm=e=>document.title=Pe(e),Sm=()=>{throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},Lt={},Cm=()=>k||"./this.program",Dr=()=>{if(!Dr.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Cm()};for(var t in Lt)Lt[t]===void 0?delete r[t]:r[t]=Lt[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);Dr.strings=n}return Dr.strings},Em=(e,r)=>{for(var t=0;t<e.length;++t)P[r++>>0]=e.charCodeAt(t);P[r>>0]=0},km=(e,r)=>{var t=0;return Dr().forEach((n,a)=>{var i=r+t;ee[e+a*4>>2]=i,Em(n,i),t+=n.length+1}),0},jm=(e,r)=>{var t=Dr();ee[e>>2]=t.length;var n=0;return t.forEach(a=>n+=a.length+1),ee[r>>2]=n,0};function Fm(e){try{var r=re.getStreamFromFD(e);return c.close(r),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return t.errno}}var Lm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=ee[r>>2],u=ee[r+4>>2];r+=8;var g=c.read(e,P,d,u,n);if(g<0)return-1;if(a+=g,g<u)break}return a};function Rm(e,r,t,n){try{var a=re.getStreamFromFD(e),i=Lm(a,r,t);return ee[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}function Tm(e,r,t,n,a){var i=Sr(r,t);try{if(isNaN(i))return 61;var d=re.getStreamFromFD(e);return c.llseek(d,i,n),me=[d.position>>>0,(Z=d.position,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],m[a>>2]=me[0],m[a+4>>2]=me[1],d.getdents&&i===0&&n===0&&(d.getdents=null),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function Pm(e){var t;try{var r=re.getStreamFromFD(e);return(t=r.stream_ops)!=null&&t.fsync?r.stream_ops.fsync(r):0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return n.errno}}var Mm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=ee[r>>2],u=ee[r+4>>2];r+=8;var g=c.write(e,P,d,u,n);if(g<0)return-1;a+=g}return a};function Am(e,r,t,n){try{var a=re.getStreamFromFD(e),i=Mm(a,r,t);return ee[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var Gn=e=>{var r=s["_"+e];return r},Dm=(e,r)=>{P.set(e,r)},Im=(e,r,t,n,a)=>{var i={string:z=>{var J=0;return z!=null&&z!==0&&(J=yt(z)),J},array:z=>{var J=Kr(z.length);return Dm(z,J),J}};function d(z){return r==="string"?Pe(z):r==="boolean"?!!z:z}var u=Gn(e),g=[],_=0;if(n)for(var E=0;E<n.length;E++){var T=i[t[E]];T?(_===0&&(_=Oe()),g[E]=T(n[E])):g[E]=n[E]}var q=u.apply(null,g);function M(z){return _!==0&&ze(_),d(z)}return q=M(q),q},ue=(e,r,t,n)=>{var a=!t||t.every(d=>d==="number"||d==="boolean"),i=r!=="string";return i&&a&&!n?Gn(e):function(){return Im(e,r,t,arguments)}},qn=(e,r)=>{e<128?r.push(e):r.push(e%128|128,e>>7)},Bm=e=>{for(var r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},t={parameters:[],results:e[0]=="v"?[]:[r[e[0]]]},n=1;n<e.length;++n)t.parameters.push(r[e[n]]);return t},$m=(e,r)=>{var t=e.slice(0,1),n=e.slice(1),a={i:127,p:127,j:126,f:125,d:124,e:111};r.push(96),qn(n.length,r);for(var i=0;i<n.length;++i)r.push(a[n[i]]);t=="v"?r.push(0):r.push(1,a[t])},Nm=(e,r)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Bm(r),e);var t=[1];$m(r,t);var n=[0,97,115,109,1,0,0,0,1];qn(t.length,n),n.push.apply(n,t),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var a=new WebAssembly.Module(new Uint8Array(n)),i=new WebAssembly.Instance(a,{e:{f:e}}),d=i.exports.f;return d},Um=(e,r)=>{if(hr)for(var t=e;t<e+r;t++){var n=le(t);n&&hr.set(n,t)}},hr,Om=e=>(hr||(hr=new WeakMap,Um(0,mr.length)),hr.get(e)||0),Rt=[],zm=()=>{if(Rt.length)return Rt.pop();try{mr.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return mr.length-1},Tt=(e,r)=>{mr.set(e,r),Tr[e]=mr.get(e)},Vn=(e,r)=>{var t=Om(e);if(t)return t;var n=zm();try{Tt(n,e)}catch(i){if(!(i instanceof TypeError))throw i;var a=Nm(e,r);Tt(n,a)}return hr.set(e,n),n},Hn=e=>{hr.delete(le(e)),Tt(e,null),Rt.push(e)},Wn=function(e,r,t,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=c.nextInode++,this.name=r,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},Wr=365,Xr=146;Object.defineProperties(Wn.prototype,{read:{get:function(){return(this.mode&Wr)===Wr},set:function(e){e?this.mode|=Wr:this.mode&=~Wr}},write:{get:function(){return(this.mode&Xr)===Xr},set:function(e){e?this.mode|=Xr:this.mode&=~Xr}},isFolder:{get:function(){return c.isDir(this.mode)}},isDevice:{get:function(){return c.isChrdev(this.mode)}}}),c.FSNode=Wn,c.createPreloadedFile=oo,c.staticInit(),s.requestFullscreen=j.requestFullscreen,s.requestAnimationFrame=j.requestAnimationFrame,s.setCanvasSize=j.setCanvasSize,s.pauseMainLoop=j.mainLoop.pause,s.resumeMainLoop=j.mainLoop.resume,s.getUserMedia=j.getUserMedia,s.createContext=j.createContext;for(var y,Ne=0;Ne<32;++Ne)Rn.push(new Array(Ne));for(var Gm=new Float32Array(288),Ne=0;Ne<288;++Ne)sr[Ne]=Gm.subarray(0,Ne+1);for(var qm=new Int32Array(288),Ne=0;Ne<288;++Ne)Mr[Ne]=qm.subarray(0,Ne+1);var Vm={Q:io,rb:lo,ab:co,mb:uo,ib:fo,sb:mo,ob:po,jb:ho,pb:vo,S:go,hb:xo,fb:bo,qb:_o,gb:yo,db:wo,tb:Co,bb:Eo,Za:Lo,_a:Ro,Wa:To,Xa:Po,Ya:Mo,eb:Ao,a:Do,Qa:No,Ua:Uo,Ga:Vo,Ja:Ho,Ha:Wo,Ka:Xo,Va:Ko,O:Yo,Fa:Qo,Ra:Jo,La:Zo,Ea:es,Ma:rs,Na:ts,Ta:ns,Pa:os,Oa:ss,i:ls,b:ds,T:us,ya:vs,Ca:gs,h:xs,e:bs,V:_s,X:ys,l:Or,Ub:ws,Da:Ss,ea:Es,da:js,ua:Ls,ca:Ts,ba:Ms,aa:Ds,$:Bs,_:Ns,ma:zs,Zd:qs,Yd:Hs,Xd:Xs,Wd:Ys,Vd:Js,Ud:ei,Td:ti,Sd:ai,Rd:si,Qd:li,Pd:di,Od:fi,Nd:pi,Md:vi,Ld:xi,Kd:_i,Jd:wi,Id:Ci,Hd:ki,Gd:Fi,Fd:Ri,Ed:Pi,Dd:Ai,Cd:Ii,wa:$i,Bd:Ui,Ad:zi,zd:qi,la:Wi,yd:Ki,xd:Qi,wd:Zi,vd:rl,ud:nl,td:ol,sd:il,ha:dl,ia:ml,rd:hl,ga:xl,qd:_l,pd:wl,ta:Cl,od:kl,nd:Fl,md:Rl,kd:Pl,jd:Al,id:Il,gd:$l,xa:Ul,fd:zl,ed:ql,ka:Wl,hd:Kl,dd:Ql,cd:Zl,bd:rc,ad:nc,$c:oc,_c:ic,Zc:cc,Yc:uc,Xc:mc,Wc:hc,Uc:gc,Vc:bc,oa:_c,qa:yc,na:Sc,pa:Ec,ra:jc,Tc:Lc,Rc:Tc,Qc:Mc,Pc:Dc,Sc:Bc,Oc:Uc,Nc:zc,Mc:qc,Jc:Wc,Lc:Kc,Kc:Qc,Fc:Zc,Hc:rd,Gc:nd,Ec:od,Dc:id,Cc:cd,Bc:ud,Ac:md,va:hd,zc:gd,yc:bd,wc:yd,ja:Cd,vc:kd,uc:Fd,tc:Rd,sc:Pd,sa:Ad,rc:Ud,qc:zd,pc:qd,oc:Hd,nc:Xd,mc:Yd,lc:Jd,kc:eu,jc:tu,ic:au,hc:su,gc:lu,fc:du,ec:fu,dc:pu,cc:vu,bc:xu,ac:_u,$b:wu,_b:Cu,Zb:ku,Yb:Fu,Xb:Ru,Wb:Pu,Vb:Au,Tb:Iu,Sb:$u,Rb:Uu,Qb:zu,Pb:qu,Ob:Hu,Nb:Xu,Mb:Yu,Lb:Ju,Kb:ef,Jb:tf,Ib:af,Hb:sf,Gb:cf,Fb:uf,Eb:mf,Db:hf,Cb:gf,Bb:bf,Ab:yf,zb:Sf,yb:Ef,xb:jf,fa:Rf,wb:Pf,vb:Af,o:Df,ub:If,q:Bf,za:Nf,N:Uf,cb:Gf,M:qf,W:jt,s:Hf,E:Wf,g:jn,m:Xf,F:Kf,v:Qf,U:Jf,R:Zf,y:em,w:rm,x:tm,Ba:nm,Sa:Cr,K:am,I:om,H:sm,L:im,J:lm,z:dm,u:fm,A:mm,C:pm,B:hm,D:vm,t:bm,G:ym,Aa:wm,n:Sm,kb:km,lb:jm,Ia:_n,j:Fm,P:Rm,$a:Tm,nb:Pm,p:Am,Z:Ym,Y:Zm,c:Wm,r:Hm,Ic:ep,d:Xm,k:Jm,f:Km,xc:rp,ld:Qm},ae=Wa();s._screenshot=e=>(s._screenshot=ae.ae)(e),s._buttonPress=e=>(s._buttonPress=ae.be)(e),s._buttonUnpress=e=>(s._buttonUnpress=ae.ce)(e),s._setVolume=e=>(s._setVolume=ae.de)(e),s._getVolume=()=>(s._getVolume=ae.ee)(),s._getMainLoopTimingMode=()=>(s._getMainLoopTimingMode=ae.fe)(),s._getMainLoopTimingValue=()=>(s._getMainLoopTimingValue=ae.ge)(),s._setMainLoopTiming=(e,r)=>(s._setMainLoopTiming=ae.he)(e,r),s._setFastForwardMultiplier=e=>(s._setFastForwardMultiplier=ae.ie)(e),s._getFastForwardMultiplier=()=>(s._getFastForwardMultiplier=ae.je)(),s._quitGame=()=>(s._quitGame=ae.ke)(),s._quitMgba=()=>(s._quitMgba=ae.le)(),s._quickReload=()=>(s._quickReload=ae.me)(),s._pauseGame=()=>(s._pauseGame=ae.ne)(),s._resumeGame=()=>(s._resumeGame=ae.oe)(),s._setEventEnable=e=>(s._setEventEnable=ae.pe)(e),s._bindKey=(e,r)=>(s._bindKey=ae.qe)(e,r),s._saveState=e=>(s._saveState=ae.re)(e),s._loadState=e=>(s._loadState=ae.se)(e),s._autoLoadCheats=()=>(s._autoLoadCheats=ae.te)(),s._loadGame=e=>(s._loadGame=ae.ue)(e),s._saveStateSlot=(e,r)=>(s._saveStateSlot=ae.ve)(e,r),s._loadStateSlot=(e,r)=>(s._loadStateSlot=ae.we)(e,r),s._addCoreCallbacks=(e,r,t,n,a,i)=>(s._addCoreCallbacks=ae.xe)(e,r,t,n,a,i),s._setupConstants=()=>(s._setupConstants=ae.ye)();var Xn=s._main=(e,r)=>(Xn=s._main=ae.ze)(e,r),Ue=e=>(Ue=ae.Be)(e),Kn=e=>(Kn=ae.Ce)(e),Yn=(e,r)=>(Yn=ae.De)(e,r),qe=(e,r)=>(qe=ae.Ee)(e,r),Oe=()=>(Oe=ae.Fe)(),ze=e=>(ze=ae.Ge)(e),Kr=e=>(Kr=ae.He)(e);s.dynCall_ji=(e,r)=>(s.dynCall_ji=ae.Ie)(e,r),s.dynCall_jiji=(e,r,t,n,a)=>(s.dynCall_jiji=ae.Je)(e,r,t,n,a),s.dynCall_iiiji=(e,r,t,n,a,i)=>(s.dynCall_iiiji=ae.Ke)(e,r,t,n,a,i),s.dynCall_jii=(e,r,t)=>(s.dynCall_jii=ae.Le)(e,r,t),s._GBAInputInfo=109920,s._binaryName=186992,s._projectName=186996,s._projectVersion=187e3,s._gitCommit=186976,s._gitCommitShort=186980,s._gitBranch=186984,s._gitRevision=186988,s._GBIORegisterNames=49376,s._GBSavestateMagic=64640,s._GBSavestateVersion=64644,s._GBA_LUX_LEVELS=93136,s._GBAVideoObjSizes=138416,s._GBASavestateMagic=138208,s._GBASavestateVersion=138212;function Hm(e,r,t,n,a){var i=Oe();try{return le(e)(r,t,n,a)}catch(d){if(ze(i),d!==d+0)throw d;qe(1,0)}}function Wm(e,r,t,n){var a=Oe();try{return le(e)(r,t,n)}catch(i){if(ze(a),i!==i+0)throw i;qe(1,0)}}function Xm(e,r,t){var n=Oe();try{le(e)(r,t)}catch(a){if(ze(n),a!==a+0)throw a;qe(1,0)}}function Km(e,r,t,n,a){var i=Oe();try{le(e)(r,t,n,a)}catch(d){if(ze(i),d!==d+0)throw d;qe(1,0)}}function Ym(e,r){var t=Oe();try{return le(e)(r)}catch(n){if(ze(t),n!==n+0)throw n;qe(1,0)}}function Qm(e,r,t,n,a,i,d,u,g,_){var E=Oe();try{le(e)(r,t,n,a,i,d,u,g,_)}catch(T){if(ze(E),T!==T+0)throw T;qe(1,0)}}function Jm(e,r,t,n){var a=Oe();try{le(e)(r,t,n)}catch(i){if(ze(a),i!==i+0)throw i;qe(1,0)}}function Zm(e,r,t){var n=Oe();try{return le(e)(r,t)}catch(a){if(ze(n),a!==a+0)throw a;qe(1,0)}}function ep(e,r){var t=Oe();try{le(e)(r)}catch(n){if(ze(t),n!==n+0)throw n;qe(1,0)}}function rp(e,r,t,n,a,i){var d=Oe();try{le(e)(r,t,n,a,i)}catch(u){if(ze(d),u!==u+0)throw u;qe(1,0)}}s.cwrap=ue,s.addFunction=Vn,s.removeFunction=Hn,s.FS=c;var Yr;ur=function e(){Yr||Qn(),Yr||(ur=e)};function tp(){var e=Xn,r=0,t=0;try{var n=e(r,t);return bn(n,!0),n}catch(a){return xt(a)}}function Qn(){if(ar>0||(ne(),ar>0))return;function e(){Yr||(Yr=!0,s.calledRun=!0,!X&&(ge(),Le(),p(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),Jn&&tp(),nr()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),e()},1)):e()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();var Jn=!0;return s.noInitialRun&&(Jn=!1),Qn(),f.ready}})();const fh=l=>{const[f,s]=R.useState(null);return R.useEffect(()=>{(async()=>{if(l){const x=await uh({canvas:l}),h=x.version.projectName+" "+x.version.projectVersion;console.log(h),await x.FSInit();const v=dh(x);s(v)}})()},[l]),f},Zt=R.createContext(null);Zt.displayName="EmulatorContext";const mh=({children:l})=>{const[f,s]=R.useState(null),p=fh(f);return o.jsx(Zt.Provider,{value:{emulator:p,canvas:f,setCanvas:s},children:l})},en=R.createContext(null);en.displayName="ResizeContext";const ph=({children:l})=>{const[f,s]=R.useState(!1);return o.jsx(en.Provider,{value:{areItemsResizable:f,setAreItemsResizable:s},children:l})},rn=R.createContext(null);rn.displayName="RunningContext";const hh=({children:l})=>{const[f,s]=R.useState(!1);return o.jsx(rn.Provider,{value:{isRunning:f,setIsRunning:s},children:l})},vh="componentLayouts",gh=()=>{const[l,f]=Ce(vh,{}),s=R.useCallback(()=>f({}),[f]),p=R.useMemo(()=>!!Object.values(l).some(x=>!!(x!=null&&x.position)||!!(x!=null&&x.size)),[l]);return{layouts:l,setLayouts:f,hasSetLayout:p,clearLayouts:s}},tn=R.createContext(null);tn.displayName="LayoutContext";const xh=({children:l})=>{const{layouts:f,setLayouts:s,hasSetLayout:p,clearLayouts:x}=gh(),h=R.useCallback((v,b)=>s(k=>({...k,[v]:{...k==null?void 0:k[v],...b}})),[s]);return R.useEffect(()=>{p||x()},[]),o.jsx(tn.Provider,{value:{layouts:f,hasSetLayout:p,clearLayouts:x,setLayout:h},children:l})},nn=R.createContext(null);nn.displayName="ModalContext";const bh=({children:l})=>{const[f,s]=R.useState(null),[p,x]=R.useState(!1);return o.jsx(nn.Provider,{value:{modalContent:f,setModalContent:s,isModalOpen:p,setIsModalOpen:x},children:l})},br=l=>{const f=l.displayName,s=R.useContext(l);if(!s)throw new Error(`${f??"This context"} must be loaded under the matching ${f?`${f}.Provider`:"Provider"}`);return s},Ca=()=>br(Qt),Lr=()=>br(tn),Ee=()=>br(nn),de=()=>br(Zt),it=()=>br(Jt),Ea=()=>br(en),rr=()=>br(rn),_h=({isPaused:l})=>{const f=op(),{emulator:s}=de(),{isRunning:p}=rr(),[x,h]=R.useState(!1),v=p&&!l;R.useEffect(()=>{v&&(!f&&!x?(s==null||s.pause(),h(!0)):f&&x&&(s==null||s.resume(),h(!1)))},[s,f,v,x])},yh=l=>{const f=l.getContext("webgl");f==null||f.clearColor(0,0,0,1),f==null||f.clear(f==null?void 0:f.COLOR_BUFFER_BIT)},wh=l=>{const f=l.getContext("2d"),s=40,p=50;let x=0;if(!f)return;const h=l.width,v=l.height,b=h/2,k=v/2,S=f.getImageData(0,0,h,v),w=setInterval(()=>{x++;for(let C=0;C<v;++C)for(let L=0;L<h;++L){const $=Math.abs(L-b),G=Math.abs(C-k)*.8,D=(b-x-$)/b,N=(k-x-(C&1)*10-G+Math.pow($,1/2))/k;S.data[(L+C*h)*4+3]*=Math.pow(D,1/3)*Math.pow(N,1/2)}f.putImageData(S,0,0),x>s&&(clearInterval(w),l.remove())},p)},Sh=(l,f)=>{if(!l||!f)return;const s=document.createElement("canvas"),p=s.getContext("2d"),x=URL.createObjectURL(f);s.className=l.className,s.height=l.height,s.width=l.width,s.style.backgroundColor=l.style.backgroundColor,s.style.height=`${l.clientHeight}px`,s.style.imageRendering=l.style.imageRendering,s.style.margin=l.style.margin,s.style.objectFit=l.style.objectFit,s.style.width=`${l.clientWidth}px`,s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.right="0";const h=new Image;h.onload=()=>{var v;p==null||p.drawImage(h,0,0),(v=l.parentElement)==null||v.appendChild(s),yh(l),wh(s)},h.src=x},Ch=l=>{if(!l)return null;const f="fade-copy.png",s=(l==null?void 0:l.filePaths().screenshotsPath)+"/"+f;if(!l.screenshot(f))return null;const x=l.getFile(s);return l==null||l.deleteFile(s),new Blob([x],{type:"image/png"})},Eh=()=>{const{canvas:l,emulator:f}=de(),{isRunning:s,setIsRunning:p}=rr();return R.useCallback(()=>{s&&(Sh(l,Ch(f)),f==null||f.quitGame()),p(!1)},[l,f,s,p])},an="completedProductTour",kh={locale:{skip:o.jsx("strong",{"aria-label":"Skip",children:"Skip"})},placement:"auto",placementBeacon:"right-end",spotlightPadding:10},He=({completedProductTourStepName:l,steps:f,allowScrolling:s=!0,isNotInModal:p=!1,millisecondDelay:x=500,renderWithoutDelay:h=!1,skipIfIntroSkipped:v=!0,skipRenderCondition:b=!1,zIndex:k=500})=>{const[S,w]=Ce(an),{isModalOpen:C}=Ee(),[L,$]=R.useState(h);if(Gt(()=>{$(!0)},h?null:x),!L||S!=null&&S[l]||v&&(S==null?void 0:S.hasCompletedProductTourIntro)===At.SKIPPED||!(S!=null&&S.hasCompletedProductTourIntro)||!p&&!C||b)return null;const G=f.map(D=>({...kh,...D}));return o.jsx(Xp,{continuous:!0,disableScrollParentFix:s,hideCloseButton:!0,showProgress:!0,showSkipButton:!0,steps:G,styles:{options:{zIndex:k}},callback:({status:D})=>{[At.FINISHED,At.SKIPPED].includes(D)&&w(N=>({...N,[l]:D}))}})},jh=I.button`
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
  padding: inherit;
`,Rr=ot.forwardRef(({children:l,...f},s)=>o.jsx(jh,{ref:s,...f,children:l})),jr=({variation:l})=>{const f=Me(),s=function(){switch(l){case"topLeft":return"-45deg";case"topRight":return"45deg";case"bottomLeft":return"45deg";case"bottomRight":return"-45deg";default:return"0deg"}}();return o.jsx(sp,{"data-testid":"gripper-handle",color:f.gbaThemeBlue,style:{transform:`rotate(${s})`}})},Fh=I.ul`
  background-color: ${({theme:l})=>l.panelBlueGray};
  list-style: none;
  padding: 10px;
  margin: 0;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-template-areas:
    '. . . .'
    'volume volume fastForward fastForward';

  ${({$controlled:l,$isLargerThanPhone:f})=>(l||f)&&`
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
  `}
`,Lh=I.li`
  display: contents;
`,ka=ma`
  cursor: pointer;
  background-color: ${({theme:l})=>l.panelControlGray};
  border-radius: 0.25rem;
  min-width: 40px;
  min-height: 40px;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:l})=>l.pureBlack};
  width: ${({$controlled:l})=>l?"auto":"100%"};

  ${({$controlled:l,theme:f})=>!l&&`
    @media ${f.isLargerThanPhone} {
      width: auto;
    }
  `}
`,Rh=I(Rr).attrs({className:"noDrag"})`
  ${ka}

  border: none;
  flex-grow: 1;
  margin: 0;
  padding: 0;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  &:active {
    color: ${({theme:l})=>l.gbaThemeBlue};
  }
`,Th=I.li`
  ${ka}
  grid-area: ${({$gridArea:l})=>l};
  max-height: 40px;
`,Ph=I(Kp)`
  flex-grow: 1;

  > .MuiSlider-markActive {
    opacity: 1;
    background-color: currentColor;
  }
`,Qr=({ariaLabel:l,children:f,controlled:s,id:p,onClick:x})=>o.jsx(Lh,{children:o.jsx(Rh,{"aria-label":l,id:p,onClick:x,$controlled:s,children:f})}),Jr=({icon:l,...f})=>{const s=Me();return o.jsx(cr,{size:"small",sx:{padding:0,color:s.pureBlack,"&:active":{color:s.gbaThemeBlue}},...f,children:l})},na=({controlled:l,gridArea:f,id:s,maxIcon:p,minIcon:x,...h})=>o.jsxs(Th,{id:s,$gridArea:f,$controlled:l,children:[x,o.jsx(Ph,{marks:!0,sx:{width:"85px",margin:"0 10px",maxHeight:"40px"},valueLabelDisplay:"auto",...h}),p]}),Mh=()=>{var ne,ge,Le,nr;const{emulator:l}=de(),{isRunning:f}=rr(),{areItemsDraggable:s,setAreItemsDraggable:p}=it(),{areItemsResizable:x,setAreItemsResizable:h}=Ea(),{layouts:v,setLayout:b}=Lr(),k=Me(),S=gr(k.isLargerThanPhone),[w,C]=R.useState(!1),[L,$]=R.useState(!1),G=R.useId(),D=Eh(),[N,V]=Ce(_a,1),[Y,X]=Ce(Sa,1);_h({isPaused:w});const U=R.useCallback(fe=>{var Be,$e;!((Be=v==null?void 0:v.controlPanel)!=null&&Be.initialBounds)&&fe&&b("controlPanel",{initialBounds:($e=fe.resizableElement.current)==null?void 0:$e.getBoundingClientRect()})},[b,v]),H=(ne=v==null?void 0:v.screen)==null?void 0:ne.initialBounds;if(!H)return null;const P=S?5:0,O=!!((ge=v==null?void 0:v.controlPanel)!=null&&ge.size)||L,A=()=>{f&&(w?l==null||l.resume():l==null||l.pause(),C(fe=>!fe))},K=fe=>{l==null||l.setVolume(fe),V(fe)},m=fe=>{var $e;const Be=Number(($e=fe.target)==null?void 0:$e.value);K(Be)},ee=fe=>{l==null||l.setFastForwardMultiplier(fe),X(fe)},Q=fe=>{var $e;const Be=Number(($e=fe.target)==null?void 0:$e.value);l==null||l.setFastForwardMultiplier(Be),X(Be)},ce=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the control panel to quickly perform in game actions and reposition controls."}),o.jsx("p",{children:"Click next to take a tour of the controls!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(G)}`},{content:o.jsx("p",{children:"Use the this button to pause and resume your game if it is running."}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--play`)}`},{content:o.jsx("p",{children:"Use this button to quit your current game."}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--quit-game`)}`},{content:o.jsx("p",{children:"Use this button to enable dragging and repositioning of the screen, controls, and control panel."}),placement:S?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--drag`)}`},{content:o.jsx("p",{children:"Use this button to resize the screen and control panel."}),placement:S?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--resize`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the emulator volume."}),o.jsx("p",{children:"Your volume setting will be saved between refreshes!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--volume-slider`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the fast forward speed."}),o.jsx("p",{children:"Your fast forward setting will be saved between refreshes!"})]}),placement:S?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--fast-forward`)}`}],Te={x:Math.floor(H.left),y:Math.floor(H.bottom+P)},We={width:S?"auto":"100dvw",height:"auto"},Je=((Le=v==null?void 0:v.controlPanel)==null?void 0:Le.position)??Te,tr=((nr=v==null?void 0:v.controlPanel)==null?void 0:nr.size)??We,Xe={onFocus:l==null?void 0:l.disableKeyboardInput,onBlur:l==null?void 0:l.enableKeyboardInput,onClick:l==null?void 0:l.enableKeyboardInput};return o.jsxs(o.Fragment,{children:[o.jsx(pa,{"data-testid":"control-panel-wrapper",id:G,disableDragging:!s,enableResizing:x,resizeHandleComponent:{bottomRight:o.jsx(jr,{variation:"bottomRight"}),bottomLeft:o.jsx(jr,{variation:"bottomLeft"})},resizeHandleStyles:{bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"}},ref:U,cancel:".noDrag",position:Je,size:tr,onDragStop:(fe,Be)=>{b("controlPanel",{position:{x:Be.x,y:Be.y}})},onResizeStart:()=>$(!0),onResizeStop:(fe,Be,$e,ar,ur)=>{b("controlPanel",{size:{width:$e.clientWidth,height:$e.clientHeight},position:{...ur}}),$(!1)},default:{...Te,...We},children:o.jsx(Fh,{$controlled:O,$isLargerThanPhone:S,children:o.jsxs(ha.Provider,{value:{size:"2em"},children:[o.jsx(Qr,{id:`${G}--play`,ariaLabel:w||!f?"Play":"Pause",onClick:A,controlled:O,children:w||!f?o.jsx(ip,{}):o.jsx(lp,{})}),o.jsx(Qr,{id:`${G}--quit-game`,ariaLabel:"Quit Game",onClick:()=>{D(),C(!1)},controlled:O,children:o.jsx(cp,{})}),o.jsx(Qr,{id:`${G}--drag`,ariaLabel:s?"Anchor Items":"Drag Items",onClick:()=>{p(fe=>!fe)},controlled:O,children:s?o.jsx(Zn,{color:k.gbaThemeBlue}):o.jsx(Zn,{})}),o.jsx(Qr,{id:`${G}--resize`,ariaLabel:x?"Stop Resizing Items":"Resize Items",onClick:()=>{h(fe=>!fe)},controlled:O,children:x?o.jsx(ea,{color:k.gbaThemeBlue}):o.jsx(ea,{})}),o.jsx(na,{id:`${G}--volume-slider`,"aria-label":"Volume Slider",gridArea:"volume",controlled:O,value:N,step:.1,min:0,max:1,minIcon:o.jsx(Jr,{"aria-label":"Mute Volume",icon:o.jsx(dp,{style:{maxHeight:"100%"}}),onClick:()=>K(0)}),maxIcon:o.jsx(Jr,{"aria-label":"Max Volume",icon:o.jsx(up,{style:{maxHeight:"100%"}}),onClick:()=>K(1)}),valueLabelFormat:`${N*100}`,onChange:m,...Xe}),o.jsx(na,{id:`${G}--fast-forward`,"aria-label":"Fast Forward Slider",gridArea:"fastForward",controlled:O,value:Y,step:1,min:1,max:5,minIcon:o.jsx(Jr,{"aria-label":"Regular Speed",icon:o.jsx(fp,{style:{maxHeight:"100%"}}),onClick:()=>ee(1)}),maxIcon:o.jsx(Jr,{"aria-label":"Max Fast Forward",icon:o.jsx(mp,{style:{maxHeight:"100%"}}),onClick:()=>ee(5)}),valueLabelFormat:`x${Y}`,onChange:Q,...Xe})]})})}),o.jsx(He,{steps:ce,completedProductTourStepName:"hasCompletedControlPanelTour",zIndex:S?160:0,renderWithoutDelay:!0,isNotInModal:!0})]})},ja="currentSaveStateSlot",Fa="areVirtualControlsEnabled",Ah=I.section`
  position: absolute;
  background-color: red;
  border-radius: 50%;
  width: 12rem;
  height: 12rem;
  background: ${({theme:l})=>l.pureBlack};
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-color: ${({$areItemsDraggable:l=!1,theme:f})=>l?f.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};
  border-width: 2px;
  z-index: 12;

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `};
`,Dh=I.div`
  position: absolute;
  height: 4rem;
  width: 4rem;
  border: 2px solid ${({theme:l})=>l.gbaThemeBlue};
  border-radius: 50%;
  background-color: ${({theme:l})=>l.pureBlack};
  transition: ${({$isControlled:l=!1})=>l?"transform 0.3s ease-in-out":"none"};

  &:before {
    position: absolute;
    content: '';
    top: -0.8rem;
    left: -0.8rem;
    right: -0.8rem;
    bottom: -0.8rem;
    border: 0.8rem solid ${({theme:l})=>l.gbaThemeBlue}50;
    border-radius: 50%;
  }
`,lt=I.div`
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
`,Ih=I(lt)`
  border-width: 0 15px 25px 15px;
  border-color: transparent transparent ${({theme:l})=>l.pureWhite}
    transparent;
  top: 10px;
`,Bh=I(lt)`
  border-width: 25px 15px 0 15px;
  border-color: ${({theme:l})=>l.pureWhite} transparent transparent
    transparent;
  bottom: 10px;
`,$h=I(lt)`
  border-width: 15px 25px 15px 0;
  border-color: transparent ${({theme:l})=>l.pureWhite} transparent
    transparent;
  left: 10px;
`,Nh=I(lt)`
  border-width: 15px 0 15px 25px;
  border-color: transparent transparent transparent
    ${({theme:l})=>l.pureWhite};
  right: 10px;
`,Uh=({initialPosition:l})=>{var U;const{emulator:f}=de(),{areItemsDraggable:s}=it(),{layouts:p,setLayout:x}=Lr(),[h,v]=R.useState({x:0,y:0}),[b,k]=R.useState(!0),S=R.useRef(null),w=R.useRef(null),[C,L]=R.useState({});R.useEffect(()=>{Object.keys(C).forEach(H=>{C[H]?f==null||f.simulateKeyDown(H):f==null||f.simulateKeyUp(H)})},[C,f]);const $=R.useCallback((H,P)=>L(O=>({...O,[H]:P})),[]),G=R.useCallback(H=>L(P=>Object.fromEntries(Object.entries(P).map(([O,A])=>[O,A===H?void 0:A]))),[]),D=({x:H,y:P})=>{const O=H*Math.cos(Math.PI/4)-P*Math.sin(Math.PI/4),A=H*Math.sin(Math.PI/4)+P*Math.cos(Math.PI/4);return O>=0&&A>=0?"RIGHT":O<0&&A>=0?"DOWN":O<0&&A<0?"LEFT":O>=0&&A<0?"UP":null},N=R.useCallback(H=>{if(!S.current||!w.current)return;const P=S.current.getBoundingClientRect(),O=w.current.getBoundingClientRect(),A=Math.max(-P.width/2+O.width/2,Math.min(H.clientX-P.left-P.width/2,P.width/2-O.width/2)),K=Math.max(-P.height/2+O.height/2,Math.min(H.clientY-P.top-P.height/2,P.height/2-O.height/2));s||v({x:A,y:K});const m=D({x:A,y:K});m&&!C[m]&&(G(H.pointerId),$(m,H.pointerId))},[s,C,$,G]),V=R.useCallback(H=>{if(k(!1),!S.current)return;const P=S.current.getBoundingClientRect(),O=H.clientX-P.left-P.width/2,A=H.clientY-P.top-P.width/2;s||v({x:O,y:A});const K=D({x:O,y:A});K&&$(K,H.pointerId)},[s,$]),Y=H=>{k(!0),v({x:0,y:0}),G(H.pointerId)},X=((U=p==null?void 0:p.oPad)==null?void 0:U.position)??{x:0,y:0};return o.jsx(Bt,{nodeRef:S,disabled:!s,position:X,onStop:(H,P)=>x("oPad",{position:{x:P.x,y:P.y}}),children:o.jsxs(Ah,{"aria-label":"O-Pad",ref:S,$initialPosition:l,$areItemsDraggable:s,onPointerDown:V,onPointerMove:N,onPointerUp:Y,onPointerCancel:Y,onPointerOut:Y,onPointerLeave:Y,children:[o.jsx(Bt,{disabled:!0,nodeRef:w,position:h,children:o.jsx(Dh,{ref:w,$isControlled:b})}),o.jsx($h,{}),o.jsx(Nh,{}),o.jsx(Ih,{}),o.jsx(Bh,{})]})})},La=I(Rr)`
  background-color: ${({theme:l})=>l.darkGray};
  border-style: solid;
  border-color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  cursor: pointer;
  box-sizing: content-box;
  border-width: 2px;
`,Oh=I(La)`
  width: ${({$diameter:l=60})=>l}px;
  height: ${({$diameter:l=60})=>l}px;
  border-radius: 100px;
  border-color: ${({$areItemsDraggable:l=!1,theme:f})=>l?f.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,zh=I(La)`
  border-radius: 16px;
  width: fit-content;
  min-width: 85px;
  border-color: ${({$areItemsDraggable:l=!1,theme:f})=>l?f.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Gh=({isRectangular:l=!1,width:f=60,children:s,keyId:p,inputName:x,onClick:h,initialPosition:v,initialOffset:b,enabled:k=!1,ariaLabel:S})=>{var X;const{emulator:w}=de(),{areItemsDraggable:C}=it(),{layouts:L,setLayout:$}=Lr(),G=R.useRef(null);if(!k)return null;const D=h?{onClick:h}:{},N=p?{onPointerDown:()=>{w==null||w.simulateKeyDown(p)},onPointerUp:()=>{w==null||w.simulateKeyUp(p)},onPointerLeave:()=>{w==null||w.simulateKeyUp(p)},onPointerOut:()=>{w==null||w.simulateKeyUp(p)},onPointerCancel:()=>{w==null||w.simulateKeyUp(p)}}:{},V=p?{onKeyDown:U=>{(U.code=="Space"||U.key==" ")&&(w==null||w.simulateKeyDown(p))},onKeyUp:U=>{(U.code=="Space"||U.key==" ")&&(w==null||w.simulateKeyUp(p))}}:{},Y=((X=L==null?void 0:L[x])==null?void 0:X.position)??{x:0,y:0};return o.jsx(Bt,{nodeRef:G,positionOffset:b,position:Y,disabled:!C,onStop:(U,H)=>$(x,{position:{x:H.x,y:H.y}}),children:l?o.jsx(zh,{ref:G,$initialPosition:v,$areItemsDraggable:C,"aria-label":S,...N,...D,...V,children:s}):o.jsx(Oh,{ref:G,$initialPosition:v,$diameter:f,$areItemsDraggable:C,"aria-label":S,...N,...D,...V,children:s})})},qh=(l,f)=>l?f:null,Ra=()=>{const{isRunning:l}=rr(),{emulator:f}=de(),[,s]=Ce(Yt),p=R.useCallback(h=>f==null?void 0:f.addCoreCallbacks({saveDataUpdatedCallback:qh(h.saveFileSystemOnInGameSave,()=>{f.fsSync(),h.notificationsEnabled&&Ve.success("Saved File System ")})}),[f]),x=R.useCallback(h=>{s(v=>({...v,...h})),l&&p(h)},[p,l,s]);return{addCallbacks:p,addCallbacksAndSaveSettings:x}},ct=()=>{const{emulator:l}=de(),{setIsRunning:f}=rr(),[,s]=Ce(wa),[p]=Ce(ya),[x]=Ce(_a,1),[h]=Ce(Sa,1),[v]=Ce(Yt,{saveFileSystemOnInGameSave:!1,notificationsEnabled:!0}),{addCallbacks:b}=Ra();return R.useCallback(S=>{const w=l==null?void 0:l.run(S);return f(!!w),s(S),l==null||l.setVolume(x),w&&(p&&(l==null||l.remapKeyBindings(p)),h>1&&!(l!=null&&l.isFastForwardEnabled())&&(l==null||l.setFastForwardMultiplier(h)),b(v)),!!w},[b,v,x,p,l,h,f,s])},Ta=()=>{const l=ct(),{isRunning:f,setIsRunning:s}=rr(),{emulator:p}=de(),[x]=Ce(wa);return R.useCallback(()=>{if(f)p==null||p.quickReload();else if(p!=null&&p.getCurrentGameName()){const v=l(p.filePaths().gamePath+"/"+p.getCurrentGameName());s(!!v)}else if(x){const v=l(x);s(!!v)}},[p,f,s,l,x])},Pa=I.div`
  text-align: center;
`,Br=I.p`
  text-align: center;
  margin: 0;
`,Ma=I.h3`
  margin: 0;
`,Aa=I.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,Da=I.div`
  padding: 1rem;
  overflow-y: auto;
`,Ia=I.div`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
  border-top: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,De=({children:l,className:f})=>o.jsx(Da,{className:f,children:l}),Ie=({children:l})=>o.jsx(Ia,{"data-testid":"modal-footer:wrapper",children:l}),Vh=I.button`
  width: 1em;
  height: 1em;
  padding: 1rem;
  margin: 0 0 0 auto;
  cursor: pointer;
  color: ${({theme:l})=>l.pureBlack};
  border: 0;
  border-radius: 0.25rem;
  opacity: 0.5;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    opacity: 1;
  }

  &:hover {
    opacity: 0.75;
  }

  background: transparent
    url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e")
    center/1em auto no-repeat;
`,Re=({title:l,showExitIndicator:f=!0})=>{const{setIsModalOpen:s}=Ee();return o.jsxs(Aa,{children:[o.jsx(Ma,{id:"modalHeader",children:l}),f&&o.jsx(Vh,{"aria-label":"Close",onClick:()=>s(!1)})]})},Hh=()=>{const{accessToken:f}=Ca(),s=R.useCallback(async b=>{const k="undefined/api/save/upload",S=new FormData;S.append("save",(b==null?void 0:b.saveFile)??"");const w={method:"POST",headers:{Authorization:`Bearer ${f}`},body:S},C=await fetch(k,w);if(!C.ok)throw new Error(`Received unexpected status code: ${C.status}`);return C},[void 0,f]),{data:p,isLoading:x,error:h,execute:v}=Fr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:x,error:h,execute:v}},Wh=I.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,Xh=I.p`
  margin: 0;
  color: ${({theme:l})=>l.errorRed};
`,dr=({icon:l,text:f,className:s})=>o.jsxs(Wh,{"data-testid":"error-with-icon",className:s,children:[l,o.jsx(Xh,{children:f})]}),Kh=({errorColor:l,loadingColor:f,respStatus:s,isLoading:p,hasError:x})=>{const h=()=>o.jsx(st,{"data-testid":"upload-save-spinner",color:f,cssOverride:{margin:"0 auto"}});let v=null;return p?v=h:x?v=()=>o.jsx(dr,{icon:o.jsx(lr,{style:{color:l}}),text:"Save file upload has failed"}):s===200?v=()=>o.jsx(Br,{children:"Save file upload was successful!"}):v=()=>o.jsx(Br,{children:"Are you sure you want to upload your current save file to the server?"}),o.jsx(De,{children:o.jsx(v,{})})},Yh=()=>{const l=Me(),{setIsModalOpen:f}=Ee(),{emulator:s}=de(),p=R.useId(),{data:x,isLoading:h,error:v,execute:b}=Hh(),k=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to upload your current save file to the server."}),o.jsx("p",{children:"Remember to save in game before uploading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Send Save to Server"}),o.jsx(Kh,{errorColor:l.errorRed,loadingColor:l.gbaThemeBlue,isLoading:h,hasError:!!v,respStatus:x==null?void 0:x.status}),o.jsxs(Ie,{children:[o.jsx(ie,{id:p,variant:"contained",onClick:()=>{const S=s==null?void 0:s.getCurrentSave(),w=s==null?void 0:s.getCurrentSaveName();if(S&&w){const C=new Blob([S]),L=new File([C],w);b({saveFile:L})}},children:"Upload"}),o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})]}),o.jsx(He,{steps:k,completedProductTourStepName:"hasCompletedUploadSaveToServerTour"})]})},aa=I.p`
  text-align: center;
  vertical-align: middle;
  line-height: 54px;
  color: ${({theme:l})=>l.pureWhite};
  margin: 0;
  font-size: 1.5em;
`,Zr=I.p`
  color: ${({theme:l})=>l.pureWhite};
  margin: 4px 5px;
`,Qh=l=>l.replace("-"," ").replace(/\w\S*/g,f=>f.charAt(0).toUpperCase()+f.substring(1).toLowerCase()),Jh=()=>{var O;const l=Me(),f=gr(l.isLargerThanPhone),s=gr(l.isMobileWithUrlBar),{emulator:p}=de(),{isRunning:x}=rr(),{isAuthenticated:h}=Ca(),{setModalContent:v,setIsModalOpen:b}=Ee(),{layouts:k}=Lr(),S=R.useId(),w=Ta(),[C]=Ce(ja,0),[L]=Ce(Fa),$=(O=k==null?void 0:k.controlPanel)==null?void 0:O.initialBounds;if(!$)return null;const G=A=>A===void 0&&!f||!!A,D=G(L==null?void 0:L.OpadAndButtons),N=(L==null?void 0:L.NotificationsEnabled)??!0,V=$.bottom,Y=$.left,X={"a-button":{defaultMobile:{top:`calc(${V}px + 12%)`,left:"calc(100dvw - 25px)"},mobileWithUrlBar:{top:`calc(${V}px + 10%)`},largerThanPhone:{top:`calc(${V}px + 35px - 3%)`,left:`calc(${Y}px + 450px)`}},"b-button":{defaultMobile:{top:`calc(${V}px + 15%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${V}px + 13%)`},largerThanPhone:{top:`calc(${V}px + 35px)`,left:`calc(${Y}px + 375px)`}},"start-button":{defaultMobile:{top:"88dvh",left:"25dvw"},mobileWithUrlBar:{top:"92dvh",left:"50dvw"},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`${Y}px`}},"select-button":{defaultMobile:{top:"88dvh",left:"55dvw"},mobileWithUrlBar:{top:"92dvh",left:"75dvw"},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${Y}px + 103px)`}},"l-button":{defaultMobile:{top:`${V+15}px`,left:"15px"},largerThanPhone:{top:`calc(${V}px + 15px)`,left:`${Y}px`}},"r-button":{defaultMobile:{top:`${V+15}px`,left:"calc(100dvw - 15px)"},largerThanPhone:{top:`calc(${V}px + 15px)`,left:`calc(${Y}px + 190px)`}},"quickreload-button":{defaultMobile:{top:`${V+10}px`,left:"135px"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${Y}px + 205px)`}},"uploadsave-button":{defaultMobile:{top:`${V+10}px`,left:"calc(100dvw - 135px)"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${Y}px + 300px)`}},"loadstate-button":{defaultMobile:{top:`calc(${V}px + 25%)`,left:"calc(100dvw - 40px)"},mobileWithUrlBar:{top:`calc(${V}px + 23%)`},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${Y}px + 248px)`}},"savestate-button":{defaultMobile:{top:`calc(${V}px + 27%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${V}px + 25%)`},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${Y}px + 300px)`}},"o-pad":{defaultMobile:{top:`calc(${V}px + 11%)`,left:"10px"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${Y}px + 450px)`}}},U=A=>{var m,ee,Q,ce;let K;return s&&((m=X[A])!=null&&m.mobileWithUrlBar)?K=(ee=X[A])==null?void 0:ee.mobileWithUrlBar:f&&((Q=X[A])!=null&&Q.largerThanPhone)&&(K=(ce=X[A])==null?void 0:ce.largerThanPhone),{...X[A].defaultMobile,...K}},H=(A,K,m)=>{N&&Ve[A?"success":"error"](A?K:m,{id:S})},P=[{keyId:"A",children:o.jsx(aa,{children:"A"}),initialPosition:U("a-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"a-button",enabled:D},{keyId:"B",children:o.jsx(aa,{children:"B"}),initialPosition:U("b-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"b-button",enabled:D},{keyId:"START",isRectangular:!0,children:o.jsx(Zr,{children:"Start"}),initialPosition:U("start-button"),keyName:"start-button",enabled:D},{keyId:"SELECT",isRectangular:!0,children:o.jsx(Zr,{children:"Select"}),initialPosition:U("select-button"),keyName:"select-button",enabled:D},{keyId:"L",isRectangular:!0,children:o.jsx(Zr,{children:"L"}),initialPosition:U("l-button"),keyName:"l-button",enabled:D},{keyId:"R",isRectangular:!0,children:o.jsx(Zr,{children:"R"}),initialPosition:U("r-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"r-button",enabled:D},{children:o.jsx(pp,{}),onClick:()=>{w(),!(p!=null&&p.getCurrentGameName())&&N&&Ve.error("Load a game to quick reload",{id:S})},width:40,initialPosition:U("quickreload-button"),keyName:"quickreload-button",enabled:G(L==null?void 0:L.QuickReload)},{children:o.jsx(hp,{}),onClick:()=>{h()&&x?(v(o.jsx(Yh,{})),b(!0)):N&&Ve.error("Please log in and load a game",{id:S})},width:40,initialPosition:U("uploadsave-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"uploadsave-button",enabled:G(L==null?void 0:L.SendSaveToServer)},{children:o.jsx(vp,{}),onClick:()=>{const A=p==null?void 0:p.loadSaveState(C);H(!!A,`Loaded slot: ${C}`,`Failed to load slot: ${C}`)},width:40,initialPosition:U("loadstate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"loadstate-button",enabled:G(L==null?void 0:L.LoadState)},{children:o.jsx(gp,{}),onClick:()=>{const A=p==null?void 0:p.createSaveState(C);H(!!A,`Saved slot: ${C}`,`Failed to save slot: ${C}`)},width:40,initialPosition:U("savestate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"savestate-button",enabled:G(L==null?void 0:L.SaveState)}];return o.jsxs(ha.Provider,{value:{color:l.pureWhite,size:"2em"},children:[D&&o.jsx(Uh,{initialPosition:U("o-pad")}),P.map(A=>o.jsx(Gh,{ariaLabel:Qh(A.keyName),inputName:A.keyName,...A},A.keyName))]})},Zh={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:400},content:{width:"calc(100dvw - 20px)",height:"fit-content",margin:"25px auto auto auto",backgroundColor:"#fff",inset:"10px",maxWidth:"500px",padding:"0",maxHeight:"90dvh",display:"flex",touchAction:"none",flexDirection:"column",userSelect:"text"}},ev=()=>{const{modalContent:l,isModalOpen:f,setIsModalOpen:s}=Ee(),{emulator:p}=de();return o.jsx(xp,{appElement:document.getElementById("root")||void 0,closeTimeoutMS:400,isOpen:f,style:Zh,onRequestClose:()=>s(!1),onAfterOpen:p==null?void 0:p.disableKeyboardInput,onAfterClose:p==null?void 0:p.enableKeyboardInput,aria:{labelledby:"modalHeader"},children:l})},xr=250,rv=I.li`
  color: ${({theme:l})=>l.gbaThemeBlue};
  padding: 0 2px;

  ${({$disabled:l=!1,theme:f})=>l&&`color: ${f.disabledGray};
     pointer-events: none;
     cursor: default;
    `}
`,tv=I(Rr)`
  background-color: unset;
  border: none;
  color: inherit;
  cursor: pointer;
  height: 100%;
  padding: 0.5rem 1rem;
  text-align: inherit;
  width: 100%;

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,nv=I.span`
  margin-left: 0.5rem;
`,av=I.ul`
  padding-left: 2rem;
`,et=({title:l,icon:f,children:s,$isExpanded:p=!1,$disabled:x=!1})=>{const[h,v]=R.useState(p?"auto":0);return R.useEffect(()=>{v(p?"auto":0)},[p]),o.jsxs(rv,{$disabled:x,children:[o.jsxs(tv,{disabled:x,onClick:()=>{v(h===0?"auto":0)},children:[f,o.jsx(nv,{children:l})]}),o.jsx(bp,{duration:350,easing:"ease-in-out",height:h,children:o.jsx(av,{children:s})})]})},ov=I.li`
  cursor: pointer;
  color: ${({theme:l})=>l.gbaThemeBlue};
  list-style-type: none;
  padding: 0 2px;

  ${({$disabled:l=!1,theme:f})=>l&&`color: ${f.disabledGray};
     pointer-events: none;
     cursor: default;
    `}

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,sv=I(Rr)`
  background-color: unset;
  border: none;
  color: inherit;
  height: 100%;
  margin: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};

  text-align: inherit;
  width: 100%;
  cursor: pointer;
`,iv=I.span`
  margin-left: 0.5rem;
`,lv=I.a`
  display: block;
  text-decoration: none;
  color: unset;
  outline-offset: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};
`,je=({title:l,icon:f,onClick:s=void 0,$link:p=void 0,$disabled:x=!1,$withPadding:h=!1})=>{const v=o.jsxs(o.Fragment,{children:[f,o.jsx(iv,{children:l})]});return o.jsx(ov,{$disabled:x,children:p?o.jsx(lv,{href:p,$withPadding:h,target:"_blank",children:v}):o.jsx(sv,{disabled:x,onClick:s,$withPadding:h,children:v})})},cv=()=>{const{setIsModalOpen:l}=Ee(),[,f]=Ce(an);return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"About"}),o.jsxs(De,{children:[o.jsx("p",{children:"Gbajs3 is a full featured Game Boy Advance emulator meant to operate online and offline in the browser."}),o.jsx("p",{children:"We currently support the mGBA core through the use of webassembly."}),o.jsx("p",{children:"Getting Started:"}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Using the ",o.jsx("i",{children:"Pre Game Actions"})," menu, upload a sav file if you have one available"]}),o.jsxs("li",{children:["Then, load a rom of your choice through the ",o.jsx("i",{children:"Upload Rom"})," or"," ",o.jsx("i",{children:"Load Local Rom"})," menu items"]}),o.jsx("li",{children:"Enjoy, your game will boot!"})]})]}),o.jsxs(Ie,{children:[o.jsx(ie,{variant:"contained",onClick:()=>{f({}),l(!1)},children:"Take a tour"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},Ba=qt`
  100% {
    stroke-dashoffset: 0;
  }
`,dv=qt`
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
`,uv=qt`
  100% {
    box-shadow: inset 0 0 0 100vh var(--checkmark-fill-color);
  }
`,fv=I.svg`
  position: absolute;
  width: 24px;
  height: 24px;

  display: block;
  margin-left: auto;
  margin-right: auto;
  border-radius: 50%;
  stroke: ${({theme:l})=>l.pureWhite};
  stroke-width: 5;
  stroke-miterlimit: 10;
  animation: ${uv} 0.2s ease-in-out 0.2s forwards,
    ${dv} 0.12s ease-in-out 0.45s both;
`,mv=I.circle`
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 5;
  stroke-miterlimit: 10;
  stroke: ${({theme:l})=>l.checkMarkGreen};
  fill: none;
  animation: ${Ba} 0.3s cubic-bezier(0.65, 0, 0.45, 1) forwards;
`,pv=I.path`
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: ${Ba} 0.15s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
`,hv=I.span`
  ${({$isSuccessCheckVisible:l=!1})=>l&&"visibility: hidden;"}
`,_r=({copy:l,msDuration:f=1100,onClick:s,showSuccess:p=!0,...x})=>{const h=R.useId(),[v,b]=R.useState(!1),k=!!p&&v;return Gt(()=>b(!1),k?f:null),o.jsxs(ie,{onClick:S=>{b(!0),s==null||s(S)},variant:"contained",...x,children:[k&&o.jsxs(fv,{role:"graphics-symbol","aria-labelledby":h,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52",children:[o.jsx("title",{id:h,children:"Circle Check"}),o.jsx(mv,{cx:"26",cy:"26",r:"25",fill:"none"}),o.jsx(pv,{fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),o.jsx(hv,{$isSuccessCheckVisible:k,children:l})]})},vr=ot.forwardRef(({id:l,label:f,watcher:s,...p},x)=>o.jsx(xa,{"data-testid":"managed-checkbox:label",id:l,control:o.jsx(Ir,{ref:x,checked:!!s,...p}),label:f,style:{margin:0}})),vv=I.ul`
  list-style: none;
  display: ${({$shouldHide:l=!1})=>l?"none":"flex"};
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  margin: 0;
  max-width: 100%;
`,gv=I.li`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding-bottom: 10px;
  width: 100%;
`,xv=I(_p)`
  min-height: 40px;
  min-width: 40px;
`,bv=I(va)`
  width: 25px;
  height: 25px;
`,oa=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: ${({$fullWidth:l=!1})=>l?"100%":"auto"};

  @media ${({theme:l})=>l.isLargerThanPhone} {
    flex-direction: row;
  }
`,_v=I.div`
  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: space-between;
`,yv=I.p`
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
  margin-top: ${({$withMargin:l=!1})=>l?"5px":"0"};
`,wv=()=>{var P;const l=Me(),f=gr(l.isLargerThanPhone),{setIsModalOpen:s}=Ee(),{emulator:p}=de(),[x,h]=R.useState(!1),v=R.useId(),b={desc:"",code:"",enable:!1},[k,S]=R.useMemo(()=>{const O=p==null?void 0:p.getCurrentCheatsFile(),A=new TextDecoder().decode(O);return[A,p==null?void 0:p.parseCheatsString(A)]},[p]),{register:w,control:C,handleSubmit:L,watch:$,setValue:G,formState:{errors:D,isSubmitSuccessful:N}}=er({defaultValues:{rawCheats:k,cheats:S!=null&&S.length?S:[b]}}),{fields:V,append:Y,remove:X}=yp({control:C,name:"cheats"}),U=R.useCallback(()=>{const O=p==null?void 0:p.getCurrentCheatsFile(),A=new TextDecoder().decode(O),K=(p==null?void 0:p.parseCheatsString(A))??[];x?G("cheats",K):G("rawCheats",A)},[p,G,x]),H=[{content:o.jsx("p",{children:"Use this form to enter, add, and delete cheats."}),target:`#${CSS.escape(`${v}--cheats-form`)}`},{content:o.jsx("p",{children:"This form field is for the name of the cheat."}),target:`#${CSS.escape(`${v}--name`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Put your cheat code into this field."}),o.jsx("p",{children:"Remember to separate multi-line cheats with the '+' character!"})]}),target:`#${CSS.escape(`${v}--cheat-code`)}`},{content:o.jsx("p",{children:"Use the checkbox to enable/disable a cheat."}),placement:"right",target:`#${CSS.escape(`${v}--enabled`)}`},{content:o.jsx("p",{children:"Use the trash button to remove a cheat entirely."}),placement:"right",target:`#${CSS.escape(`${v}--remove`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new cheat."]}),target:`#${CSS.escape(`${v}--add-cheat`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Submit"})," button to save your cheats, and convert them to libretro format."]}),target:`#${CSS.escape(`${v}--submit-button`)}`},{content:o.jsx("p",{children:"Use this button to toggle between viewing parsed cheats or raw cheats in libretro file format."}),placement:"right",target:`#${CSS.escape(`${v}--toggle-raw-cheats`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Manage Cheats"}),o.jsx(De,{children:o.jsxs("form",{"aria-label":"Cheats Form",id:`${v}--cheats-form`,onSubmit:L(O=>{const A=x?new File([new Blob([O.rawCheats],{type:"text/plain"})],(p==null?void 0:p.getCurrentCheatsFileName())??"unknown.cheats"):p==null?void 0:p.parsedCheatsToFile(O.cheats);A&&(p==null||p.uploadCheats(A,()=>{p.autoLoadCheats(),U()}))}),children:[o.jsx(ir,{error:!!(D!=null&&D.rawCheats),label:"Raw Libretro Cheats",InputLabelProps:{shrink:!0},multiline:!0,fullWidth:!0,minRows:6,variant:"outlined",InputProps:{sx:{textarea:{whiteSpace:"pre",overflowX:"auto !important"}}},helperText:(P=D==null?void 0:D.rawCheats)==null?void 0:P.message,style:{display:x?"block":"none"},...w("rawCheats")}),o.jsx(vv,{$shouldHide:x,children:V.map((O,A)=>{var m,ee,Q,ce,Te,We,Je,tr,Xe,ne;const K=ge=>A===0?ge:void 0;return o.jsxs(gv,{children:[o.jsxs(oa,{$fullWidth:!0,children:[o.jsx(ir,{id:K(`${v}--name`),label:"Name",error:!!((ee=(m=D==null?void 0:D.cheats)==null?void 0:m[A])!=null&&ee.desc),size:"small",autoComplete:"Name",style:f?{maxWidth:100}:void 0,helperText:(Te=(ce=(Q=D==null?void 0:D.cheats)==null?void 0:Q[A])==null?void 0:ce.desc)==null?void 0:Te.message,...w(`cheats.${A}.desc`,{required:{value:!0,message:"required"}})}),o.jsx(ir,{id:K(`${v}--cheat-code`),label:"Cheat Code",error:!!((Je=(We=D==null?void 0:D.cheats)==null?void 0:We[A])!=null&&Je.code),size:"small",autoComplete:"Code",helperText:(ne=(Xe=(tr=D==null?void 0:D.cheats)==null?void 0:tr[A])==null?void 0:Xe.code)==null?void 0:ne.message,...w(`cheats.${A}.code`,{required:{value:!0,message:"required"}})})]}),o.jsxs(oa,{children:[o.jsx(vr,{id:K(`${v}--enabled`),label:"Enabled",watcher:$(`cheats.${A}.enable`),...w(`cheats.${A}.enable`)}),o.jsx(cr,{"aria-label":"Delete",id:K(`${v}--remove`),sx:{padding:0,marginRight:"auto","&:hover":{borderRadius:"10px"},"&:focus":{borderRadius:"10px"},"& .MuiTouchRipple-root .MuiTouchRipple-child":{borderRadius:"10px"}},onClick:()=>X(A),children:o.jsx(xv,{})})]})]},O.id)})}),o.jsxs(_v,{children:[o.jsx(cr,{"aria-label":"Create new cheat",id:`${v}--add-cheat`,sx:{padding:0,display:x?"none":"flex"},onClick:()=>Y(b),children:o.jsx(bv,{})}),o.jsx(yv,{$withMargin:x,children:"Join multi-line codes with '+'"})]})]})}),o.jsxs(Ie,{children:[o.jsx(_r,{copy:"Submit",form:`${v}--cheats-form`,id:`${v}--submit-button`,showSuccess:N,type:"submit"}),o.jsx(ie,{id:`${v}--toggle-raw-cheats`,color:"info",variant:"contained",onClick:()=>h(O=>!O),children:x?"Parsed":"Raw"}),o.jsx(ie,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]}),o.jsx(He,{steps:H,completedProductTourStepName:"hasCompletedCheatsTour"})]})},Sv=I.form`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,Cv=({id:l,onAfterSubmit:f})=>{const{emulator:s}=de(),{isRunning:p}=rr(),{handleSubmit:x,setValue:h,control:v,formState:{errors:b}}=er(),k=s==null?void 0:s.defaultKeyBindings(),[S,w]=Ce(ya),C=$=>{const G=Object.entries($).filter(([,D])=>!!D).map(([,D])=>D);p&&(s==null||s.remapKeyBindings(G)),w(G),f()},L=S??k;return o.jsx(Sv,{"aria-label":"Key Bindings Form",id:l,onSubmit:x(C),children:L==null?void 0:L.map($=>o.jsx($r,{control:v,name:$.gbaInput,defaultValue:$,rules:{validate:{noSpace:G=>G.key!==" "||"Space is reserved for accessibility requirements",noTab:G=>{var D;return((D=G.key)==null?void 0:D.toLowerCase())!=="tab"||"Tab is reserved for accessibility requirements"}}},render:({field:{value:G}})=>{var D;return o.jsx(ir,{variant:"outlined",label:G.gbaInput,value:G.key,onKeyDown:N=>{N.key.toLowerCase()!=="tab"&&(h(G.gbaInput,{gbaInput:G.gbaInput,key:N.key,location:N.location}),N.preventDefault())},error:!!b[$.gbaInput],helperText:(D=b==null?void 0:b[$.gbaInput])==null?void 0:D.message})}},`gba_input_${$.gbaInput.toLowerCase()}`))})},$a=ot.forwardRef(({id:l,label:f,watcher:s,...p},x)=>o.jsx(xa,{"data-testid":"managed-switch:label",id:l,control:o.jsx(Yp,{ref:x,checked:!!s,...p}),label:f,style:{margin:0}})),Ev=I.form`
  display: flex;
  flex-direction: column;
`,kv=({id:l,onAfterSubmit:f})=>{const[s,p]=Ce(Fa),x=Me(),h=gr(x.isLargerThanPhone),v=C=>C===void 0&&!h||!!C,{register:b,handleSubmit:k,watch:S}=er({values:s??{OpadAndButtons:v(void 0),SaveState:v(void 0),LoadState:v(void 0),QuickReload:v(void 0),SendSaveToServer:v(void 0),NotificationsEnabled:!0},resetOptions:{keepDirtyValues:!0}}),w=async C=>{p(L=>({...L,...C})),f()};return o.jsxs(Ev,{"aria-label":"Virtual Controls Form",id:l,onSubmit:k(w),children:[o.jsx(vr,{label:"Virtual D-pad/Buttons",watcher:S("OpadAndButtons"),...b("OpadAndButtons")}),o.jsx(vr,{label:"Save State",watcher:S("SaveState"),...b("SaveState")}),o.jsx(vr,{label:"Load State",watcher:S("LoadState"),...b("LoadState")}),o.jsx(vr,{label:"Quick Reload",watcher:S("QuickReload"),...b("QuickReload")}),o.jsx(vr,{label:"Send save to server",watcher:S("SendSaveToServer"),...b("SendSaveToServer")}),o.jsx($a,{label:"Enable Notifications",watcher:S("NotificationsEnabled"),...b("NotificationsEnabled")})]})},jv=I(Qp)`
  border-bottom: 1px solid;
  border-color: rgba(0, 0, 0, 0.12);
`,Fv=I.div`
  padding: 24px;
`,Ut=l=>({id:`control-tab-${l}`,"aria-controls":`tabpanel-${l}`}),sa=({children:l,index:f,value:s})=>o.jsx("div",{role:"tabpanel",hidden:s!==f,id:`tabpanel-${f}`,"aria-labelledby":`tab-${f}`,children:s===f&&o.jsx(Fv,{children:l})}),Lv=({setFormId:l,virtualControlsFormId:f,keyBindingsFormId:s,resetPositionsButtonId:p,setIsSuccessfulSubmit:x})=>{const{clearLayouts:h}=Lr(),[v,b]=R.useState(0),k=(w,C)=>{b(C),l(C===0?f:s),x(!1)},S=()=>x(!0);return o.jsxs(o.Fragment,{children:[o.jsxs(jv,{value:v,onChange:k,"aria-label":"Control tabs",children:[o.jsx(ta,{label:"Virtual Controls",...Ut(0)}),o.jsx(ta,{label:"Key Bindings",...Ut(1)})]}),o.jsxs(sa,{value:v,index:0,children:[o.jsx(kv,{id:f,onAfterSubmit:S}),o.jsx(ie,{id:p,sx:{marginTop:"10px"},onClick:h,children:"Reset All Positions"})]}),o.jsx(sa,{value:v,index:1,children:o.jsx(Cv,{id:s,onAfterSubmit:S})})]})},Rv=()=>{const{setIsModalOpen:l}=Ee(),f=R.useId(),[s,p]=R.useState(`${f}--virtual-controls-form`),[x,h]=R.useState(!1),v=[{content:o.jsx("p",{children:"Select which virtual controls you wish to enable in this form tab."}),target:`#${CSS.escape(`${f}--virtual-controls-form`)}`},{content:o.jsx("p",{children:"Use this button to reset the positions of the screen, control panel, and all virtual controls."}),target:`#${CSS.escape(`${f}--reset-positions-button`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the tab panel to change which form you are seeing."}),o.jsxs("p",{children:["Select the ",o.jsx("i",{children:"KEY BINDINGS"})," tab above, then click next!"]})]}),placement:"right",target:`#${CSS.escape(Ut(1).id)}`,disableBeacon:!0,disableOverlayClose:!0,hideCloseButton:!1,spotlightClicks:!0},{content:o.jsx("p",{children:"Remap keybindings by selecting a form field and typing your desired input."}),placement:"top-end",target:`#${CSS.escape(`${f}--key-bindings-form`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Save Changes"})," button to persist changes from the current form tab."]}),target:`#${CSS.escape(`${f}--save-changes-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Controls"}),o.jsx(De,{children:o.jsx(Lv,{setFormId:p,virtualControlsFormId:`${f}--virtual-controls-form`,keyBindingsFormId:`${f}--key-bindings-form`,resetPositionsButtonId:`${f}--reset-positions-button`,setIsSuccessfulSubmit:h})}),o.jsxs(Ie,{children:[o.jsx(_r,{copy:"Save Changes",form:s,id:`${f}--save-changes-button`,type:"submit",showSuccess:x}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:v,completedProductTourStepName:"hasCompletedControlsTour"})]})},Tv=()=>{const l=Me(),{setIsModalOpen:f}=Ee(),{emulator:s}=de(),p=R.useId(),[x,h]=R.useState(!1),v=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to download your current save file."}),o.jsx("p",{children:"Remember to save in game before downloading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Download Save"}),o.jsx(De,{children:x?o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:"Load a rom to download its save file"}):o.jsx(Br,{children:"Remember to save in game before downloading your save file!"})}),o.jsxs(Ie,{children:[o.jsx(ie,{id:p,variant:"contained",onClick:()=>{const b=s==null?void 0:s.getCurrentSave(),k=s==null?void 0:s.getCurrentSaveName();if(b&&k){const S=new Blob([b],{type:"data:application/octet-stream"}),w=document.createElement("a");w.download=k,w.href=URL.createObjectURL(S),w.click(),w.remove()}else h(!0)},children:"Download"}),o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})]}),o.jsx(He,{steps:v,completedProductTourStepName:"hasCompletedDownloadSaveTour"})]})},Na=l=>o.jsx(Ht,{"data-testid":"action-box:minus",className:"minus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})}),Ua=l=>o.jsx(Ht,{"data-testid":"action-box:plus",className:"plus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})}),Pv=l=>o.jsx(Ht,{"data-testid":"action-box:close",className:"close",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})}),Mv=I.div`
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: space-between;

  > p {
    margin: 0;
    word-wrap: break-word;
    max-width: 100%;
  }
`,Av=I.div`
  display: flex;
  gap: 15px;
`,Dv=Jp(l=>o.jsx(Zp,{...l}))(({theme:l})=>({marginTop:5,[`& .${Dt.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${Dt.groupTransition}`]:{marginLeft:15,paddingLeft:10,borderLeft:`1px dashed ${eh(l.palette.text.primary,.4)}`},[`& .${Dt.content}`]:{width:"auto",alignItems:"baseline"}})),Iv=({id:l,allFiles:f,deleteFile:s,downloadFile:p})=>{if(!f)return null;const x=h=>{const v=h.path.split("/").pop(),b=o.jsxs(Mv,{children:[o.jsx("p",{children:v}),o.jsxs(Av,{children:[o.jsx(cr,{"aria-label":`Download ${v}`,sx:{padding:0,margin:0},onClick:()=>p(h.path),children:o.jsx(ga,{})}),o.jsx(cr,{"aria-label":`Delete ${v}`,sx:{padding:0},onClick:()=>s(h.path),children:o.jsx(Vt,{})})]})]});return o.jsx(Dv,{itemId:h.path,label:h.isDir?v:b,children:h.isDir&&h.children?h.children.map(k=>x(k)):null},h.path)};return o.jsx(rh,{id:l,"aria-label":"File System",defaultExpandedItems:[f.path],slots:{collapseIcon:Na,endIcon:Pv,expandIcon:Ua},sx:{height:"fit-content"},children:x(f)})},Oa=ma`
  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
  font-weight: 400;
  font-size: 1rem;
  line-height: 1.5;
  letter-spacing: 0.00938em;
`,Bv=I.form`
  display: flex;
  flex-direction: column;

  /* copying styles from the treeitem to match file system display */
  & p {
    ${Oa}
  }
`,$v=I.p`
  margin: 0;
  ${Oa}
`,Nv=I(Rr)`
  display: flex;
  align-items: center;
  gap: 8px;
  background-color: unset;
  border: none;
  color: inherit;
  margin: 0;
`,Uv=({id:l})=>{const[f]=Ce(Yt),{addCallbacksAndSaveSettings:s}=Ra(),[p,x]=R.useState(!1),{register:h,handleSubmit:v,watch:b}=er({values:f,resetOptions:{keepDirtyValues:!0}});return o.jsxs("div",{id:l,children:[o.jsxs(Nv,{onClick:()=>x(k=>!k),children:[o.jsx($v,{children:"Options"}),p?o.jsx(Na,{}):o.jsx(Ua,{})]}),o.jsx(th,{in:p,children:o.jsxs(Bv,{"aria-label":"File System Options Form",onSubmit:v(s),children:[o.jsx(vr,{label:"Save file system on in-game save",watcher:b("saveFileSystemOnInGameSave"),...h("saveFileSystemOnInGameSave")}),o.jsx($a,{label:"Enable Notifications",watcher:b("notificationsEnabled"),...h("notificationsEnabled")}),o.jsx(ie,{sx:{width:"fit-content"},type:"submit",children:"Save Options"})]})})]})},Ov=I(De)`
  display: flex;
  flex-direction: column;
  gap: 1em;
`,zv=()=>{const{setIsModalOpen:l}=Ee(),{emulator:f}=de(),[s,p]=R.useState(),x=R.useId(),h=R.useCallback(S=>{f==null||f.deleteFile(S),p(f==null?void 0:f.listAllFiles())},[f]),v=S=>{const w=S.split("/").pop(),C=f==null?void 0:f.getFile(S);if(C&&w){const L=new Blob([C],{type:"data:application/octet-stream"}),$=document.createElement("a");$.download=w,$.href=URL.createObjectURL(L),$.click(),$.remove()}},b=s??(f==null?void 0:f.listAllFiles()),k=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to view your current file tree, download files, and delete files from the tree."}),o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," and ",o.jsx("i",{children:"minus"})," icons to open and close file tree branches!"]})]}),target:`#${CSS.escape(`${x}--emulator-file-system`)}`},{content:o.jsxs("p",{children:["Click the ",o.jsx("i",{children:"Options"})," label to adjust and save settings related to the file system."]}),target:`#${CSS.escape(`${x}--file-system-options`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"SAVE FILE SYSTEM"})," button to persist all of your files to your device!"]}),target:`#${CSS.escape(`${x}--save-file-system-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"File System"}),o.jsxs(Ov,{children:[o.jsx(Iv,{id:`${x}--emulator-file-system`,allFiles:b,deleteFile:h,downloadFile:v}),o.jsx(Uv,{id:`${x}--file-system-options`})]}),o.jsxs(Ie,{children:[o.jsx(_r,{copy:"Save File System",id:`${x}--save-file-system-button`,onClick:f==null?void 0:f.fsSync}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:k,completedProductTourStepName:"hasCompletedFileSystemTour"})]})},tt=I.button`
  padding: 0.5rem 1rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  text-decoration: none;
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,nt=I.li`
  cursor: pointer;
`,Gv=I.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${nt}:first-child > ${tt} {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${nt}:last-child > ${tt} {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${nt}:not(:first-child) > ${tt} {
    border-top-width: 0;
  }
`,qv=()=>{var b,k,S;const{setIsModalOpen:l}=Ee(),{emulator:f}=de(),s=R.useId(),p=ct(),x=[".",".."],h=(k=(b=f==null?void 0:f.listRoms)==null?void 0:b.call(f))==null?void 0:k.filter(w=>!x.includes(w)),v=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to load local roms that have been saved to your device."}),o.jsx("p",{children:"Tap the name of your rom file and your game will boot!"}),o.jsxs("p",{children:["To persist roms and other files, use the ",o.jsx("i",{children:"File System"})," menu item."]})]}),target:`#${CSS.escape(s)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Load Local Rom"}),o.jsx(De,{children:o.jsxs(Gv,{id:s,children:[(S=h==null?void 0:h.map)==null?void 0:S.call(h,(w,C)=>o.jsx(nt,{children:o.jsx(tt,{onClick:()=>{p((f==null?void 0:f.filePaths().gamePath)+"/"+w),l(!1)},children:w})},`${w}_${C}`)),!(h!=null&&h.length)&&o.jsx("li",{children:o.jsx(Br,{children:"No local roms, load a game and save your file system"})})]})}),o.jsx(Ie,{children:o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})}),o.jsx(He,{steps:v,completedProductTourStepName:"hasCompletedLoadLocalRomTour"})]})},Vv=I.button`
  padding: 0.5rem 0.5rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: none;
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,at=I.li`
  cursor: pointer;
  display: grid;
  grid-template-columns: auto 32px;
  gap: 10px;

  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
`,Hv=I.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${at}:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${at}:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${at}:not(:first-child) {
    border-top-width: 0;
  }
`,Wv=I(va)`
  width: 25px;
  height: 25px;
`,Xv=I(Vt)`
  height: 100%;
  width: 20px;
`,Kv=I.form`
  display: flex;
  justify-content: space-between;
  gap: 16px;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  margin-bottom: 16px;
  padding-bottom: 16px;
`,Yv=()=>{var X,U,H;const l=Me(),{setIsModalOpen:f}=Ee(),{emulator:s}=de(),[p,x]=R.useState(),[h,v]=R.useState(null),[b,k]=Ce(ja,0),S=R.useId(),{register:w,handleSubmit:C,setValue:L,formState:{errors:$,isSubmitSuccessful:G}}=er({defaultValues:{saveStateSlot:b}}),D=R.useCallback(()=>{var O;const P=(O=s==null?void 0:s.listSaveStates())==null?void 0:O.filter(A=>A!=="."&&A!=="..");x(P)},[s]);R.useEffect(()=>{L("saveStateSlot",b)},[b,L]);const N=async P=>{k(P.saveStateSlot)},V=p??((X=s==null?void 0:s.listSaveStates())==null?void 0:X.filter(P=>P!=="."&&P!=="..")),Y=[{content:o.jsx("p",{children:"Use this input and button to manually update the current save state slot in use."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${S}--save-state-slot-form`)}`},{content:o.jsx("p",{children:"Tap a row to load a save state, or use the trash can icon to delete a save state."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${S}--save-state-list`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new save state. This will automatically increase the current save state number!"]}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${S}--add-state-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Manage Save States"}),o.jsxs(De,{children:[o.jsxs(Kv,{id:`${S}--save-state-slot-form`,onSubmit:C(N),children:[o.jsx(ir,{label:"Current Save State Slot",type:"number",InputLabelProps:{shrink:!0},size:"small",error:!!($!=null&&$.saveStateSlot),helperText:(U=$==null?void 0:$.saveStateSlot)==null?void 0:U.message,...w("saveStateSlot",{required:{value:!0,message:"Slot is required"},min:{value:0,message:"Slot must be >= 0"},valueAsNumber:!0})}),o.jsx(_r,{copy:"Update Slot",showSuccess:G,size:"small",type:"submit",sx:{maxHeight:"40px"}})]}),o.jsxs(Hv,{id:`${S}--save-state-list`,children:[(H=V==null?void 0:V.map)==null?void 0:H.call(V,(P,O)=>o.jsxs(at,{children:[o.jsx(Vv,{onClick:()=>{const A=P.split(".").pop(),K=A==null?void 0:A.replace("ss","");if(K){const m=parseInt(K);(s==null?void 0:s.loadSaveState(m))?(k(m),v(null)):v("Failed to load save state")}},children:P}),o.jsx(cr,{"aria-label":`Delete ${P}`,sx:{padding:0},onClick:()=>{const A=P.split(".").pop(),K=A==null?void 0:A.replace("ss","");if(K){const m=parseInt(K);s==null||s.deleteSaveState(m),D()}},children:o.jsx(Xv,{})})]},`${P}_${O}`)),!(V!=null&&V.length)&&o.jsx("li",{children:o.jsx(Br,{children:"No save states"})})]}),o.jsx(cr,{id:`${S}--add-state-button`,"aria-label":"Create new save state",sx:{padding:0},onClick:()=>{(s==null?void 0:s.createSaveState(b+1))?(D(),k(O=>O+1),v(null)):v("Failed to create save state")},children:o.jsx(Wv,{})}),h&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:h})]}),o.jsx(Ie,{children:o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})}),o.jsx(He,{steps:Y,completedProductTourStepName:"hasCompletedSaveStatesTour"})]})},Qv=I.div`
  cursor: pointer;
  border-color: ${({theme:l})=>l.blackRussian};
  background-color: ${({$isDragActive:l=!1,theme:f})=>l?f.arcticAirBlue:f.aliceBlue2};
  border-width: 1px;
  border-style: dashed;
  padding: 0.5rem;
  text-align: center;
`,Jv=I($t)`
  height: 60px;
  width: auto;
`,Zv=I.div`
  padding-top: 3px;
`,eg=I.ul`
  display: flex;
  flex-direction: column;
  gap: 10px;
  list-style: none;
  margin: 0;
  max-width: 100%;
  padding: 10px 5px 5px 5px;

  > p {
    margin: 0;
  }
`,rg=I.li`
  align-items: center;
  display: flex;
  gap: 10px;
  justify-content: space-between;

  > p {
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
`,tg=I.div`
  display: flex;
  gap: 15px;
`,ng=({fileNames:l,onDeleteFile:f})=>o.jsxs(eg,{children:[o.jsxs("p",{children:["File",l.length>1&&"s"," to upload:"]}),l.map((s,p)=>o.jsxs(rg,{children:[o.jsx("p",{children:s}),o.jsx(tg,{children:o.jsx(cr,{"aria-label":`Delete ${s}`,sx:{padding:0},onClick:()=>f(s),children:o.jsx(Vt,{})})})]},`${s}_${p}`))]}),ag=(l,f)=>{const s=`.${l.name.split(".").pop()}`;return f.some(p=>typeof p=="string"?p===s:!!p.regex.exec(s))},It=l=>typeof l=="string"?l:l.displayText,og=(l,f)=>{if(!l.length)return;const s=f?"At least one":"One";let p=`${s} `+l.slice(0,-1).map(It).join(", ")+`, or ${It(l.slice(-1)[0])} file is required`;return l.length==1&&(p=`${s} ${It(l[0])} file is required`),x=>!(x instanceof File)||x&&ag(x,l)?null:{message:p,code:Sp.FileInvalidType}},dt=({ariaLabel:l,children:f,error:s,hideAcceptedFiles:p,hideErrors:x,id:h,multiple:v=!1,name:b,onDrop:k,validFileExtensions:S})=>{const w=Me(),[C,L]=R.useState([]),{getRootProps:$,getInputProps:G,isDragActive:D,fileRejections:N}=wp({multiple:v,onDrop:U=>{L(U),k(U)},validator:og(S,v)}),V=s?[s]:N.length&&C.length?["Some files were rejected"]:[...new Set(N.flatMap(U=>U.errors).map(U=>U.message))],Y=U=>{const H=C.filter(P=>P.name!==U);L(H),k(H)},X=C.map(U=>U.name);return o.jsxs(o.Fragment,{children:[o.jsxs(Qv,{...$({id:h,$isDragActive:D,"aria-label":l}),children:[o.jsx("input",{"data-testid":"hidden-file-input",...G({name:b})}),o.jsx(Jv,{}),f]}),!!X.length&&!p&&o.jsx(ng,{fileNames:X,onDeleteFile:Y}),!!V.length&&!x&&o.jsx(Zv,{children:V.map(U=>o.jsx(dr,{icon:o.jsx(lr,{style:{color:w.errorRed}}),text:U},U))})]})},sg=[".cheats"],ig=()=>{const{setIsModalOpen:l}=Ee(),{emulator:f}=de(),{reset:s,handleSubmit:p,setValue:x,formState:{isSubmitSuccessful:h},control:v}=er(),b=R.useId(),k=R.useCallback(C=>{s(),x("cheatFiles",C,{shouldValidate:!0})},[s,x]),S=({cheatFiles:C})=>{C.forEach(L=>f==null?void 0:f.uploadCheats(L)),s()},w=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your cheat files, or click to select files."}),o.jsx("p",{children:"Cheat files should be in libretro format and have the extension '.cheats'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${b}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Cheats"}),o.jsx(De,{children:o.jsxs("form",{id:b,"aria-label":"Upload Cheats Form",onSubmit:p(S),children:[o.jsx($r,{control:v,name:"cheatFiles",rules:{validate:C=>(C==null?void 0:C.length)>0||"At least one .cheats file is required"},render:({field:{name:C,value:L},fieldState:{error:$}})=>o.jsx(dt,{ariaLabel:"Upload Cheats",id:`${b}--drag-and-drop`,onDrop:k,name:C,validFileExtensions:sg,error:$==null?void 0:$.message,hideAcceptedFiles:!(L!=null&&L.length),hideErrors:h,multiple:!0,children:o.jsxs("p",{children:["Drag and drop cheat files here,",o.jsx("br",{}),"or click to upload files"]})})}),h&&o.jsx(Pa,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Ie,{children:[o.jsx(_r,{copy:"Upload",form:b,showSuccess:h,type:"submit"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:w,completedProductTourStepName:"hasCompletedUploadCheatsTour"})]})},lg=()=>{const l=R.useCallback(async h=>{var L,$,G;const v={method:"GET"};if(!h)return;const b=await fetch(h.url,v),k=(G=($=(L=b.headers.get("Content-Disposition"))==null?void 0:L.split(";").pop())==null?void 0:$.split("=").pop())==null?void 0:G.replace(/"/g,""),S=decodeURIComponent(h.url.pathname.split("/").pop()??"unknown_external.gba");if(!b.ok)throw new Error(`Received unexpected status code: ${b.status}`);const w=await b.blob();return new File([w],k??S)},[]),{data:f,isLoading:s,error:p,execute:x}=Fr({fetchFn:l,clearDataOnLoad:!0});return{data:f,isLoading:s,error:p,execute:x}},cg=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,dg=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,ia=[".gba",".gbc",".gb",".zip",".7z"],ug=({isLoading:l,currentRomURL:f,children:s,indicator:p})=>l?o.jsxs(cg,{children:[o.jsxs(dg,{children:["Loading rom from url:",o.jsx("br",{}),f]}),p]}):s,fg=()=>{var O,A;const l=Me(),{setIsModalOpen:f}=Ee(),{emulator:s}=de(),{register:p,handleSubmit:x,setValue:h,reset:v,formState:{errors:b},watch:k,control:S}=er(),[w,C]=R.useState(null),{data:L,isLoading:$,error:G,execute:D}=lg(),N=R.useId(),V=ct(),Y=!$&&!!L&&!!w;R.useEffect(()=>{if(Y){const K=()=>{V((s==null?void 0:s.filePaths().gamePath)+"/"+L.name)&&f(!1)};s==null||s.uploadRom(L,K),C(null)}},[Y,L,s,f,V]);const X=R.useCallback(K=>{v(),h("romFile",K[0],{shouldValidate:!0})},[v,h]),U=async({romFile:K,romURL:m})=>{if(m){C(m),await D({url:new URL(m)});return}const ee=()=>{V((s==null?void 0:s.filePaths().gamePath)+"/"+K.name)&&f(!1)};s==null||s.uploadRom(K,ee)},H=!!k("romFile"),P=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your rom or zipped rom file, or click to select a file."}),o.jsxs("p",{children:["Rom files should have an extension of:"," ",ia.map(K=>`'${K}'`).join(", "),"."]}),o.jsx("p",{children:"You may drop or select one rom at a time, once uploaded your game will boot!"})]}),target:`#${CSS.escape(`${N}--drag-and-drop`)}`},{content:o.jsx("p",{children:"Alternatively, you may load a rom file from an external URL."}),target:`#${CSS.escape(`${N}--rom-url`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Rom"}),o.jsx(De,{children:o.jsx(ug,{isLoading:$,currentRomURL:w,indicator:o.jsx(st,{color:l.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),children:o.jsxs("form",{id:N,"aria-label":"Upload Rom Form",onSubmit:x(U),children:[o.jsx($r,{control:S,name:"romFile",rules:{validate:(K,m)=>!!m.romURL||!!K||"A rom file or URL is required"},render:({field:{name:K},fieldState:{error:m}})=>o.jsx(dt,{ariaLabel:"Upload Rom",id:`${N}--drag-and-drop`,onDrop:X,name:K,validFileExtensions:ia,hideErrors:!!m,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})}),!H&&o.jsxs(o.Fragment,{children:[o.jsx(Qe,{sx:{padding:"10px 0"},children:"or"}),o.jsx(ir,{id:`${N}--rom-url`,error:!!(b!=null&&b.romURL),label:"Upload from a URL",size:"small",autoComplete:"romURL",variant:"filled",helperText:(O=b==null?void 0:b.romURL)==null?void 0:O.message,"aria-label":"Upload Rom From URL",fullWidth:!0,...p("romURL",{validate:(K,m)=>{if(!K)return!0;if(m.romFile)return"Cannot specify both a file and a URL";try{return new URL(K),!0}catch{return"Invalid URL"}}})}),!!G&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:"Loading rom from URL has failed"})]}),((A=b.romFile)==null?void 0:A.message)&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:l.errorRed}}),text:b.romFile.message})]})})}),o.jsxs(Ie,{children:[o.jsx(ie,{form:N,type:"submit",variant:"contained",children:"Upload"}),o.jsx(ie,{variant:"outlined",onClick:()=>f(!1),children:"Close"})]}),o.jsx(He,{steps:P,completedProductTourStepName:"hasCompletedUploadRomTour"})]})},mg=()=>{const[l,f]=R.useState(0),s=R.useCallback(b=>b?new Promise((k,S)=>{console.log("Reflashing Cartridge...");let w=b.romFile.size;const C=new FileReader;C.onload=L=>{if(L.target&&L.target.result){let $=L.target.result;typeof $=="string"&&($=new TextEncoder().encode($));let G=new Uint8Array($);const D=new XMLHttpRequest;D.open("POST",`${b.esp32IP}/upload_rom_file?cartSize=${w}`,!0),D.upload.onprogress=function(N){if(N.lengthComputable){const V=N.loaded/N.total*67;f(V)}},D.onload=()=>{if(D.status>=200&&D.status<300){const N=new XMLHttpRequest;N.open("POST",`${b.esp32IP}/verify_rom_file?cartSize=${w}`,!0),N.upload.onprogress=function(V){if(V.lengthComputable){const Y=67+V.loaded/V.total*33;f(Y)}},N.onload=()=>{N.status>=200&&N.status<300?k(!0):S("Rom on cartridge has errors")},N.onerror=()=>S("Failed to upload rom for verification"),N.send(G)}else S("Failed to upload rom to cartridge")},D.onerror=()=>S("Failed to upload rom to cartridge"),D.send(G)}},C.readAsArrayBuffer(b.romFile)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:x,error:h,execute:v}=Fr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:x,error:h,execute:v,progress:l}},pg=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,hg=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,vg=[".gba",".gbc",".gb",".zip",".7z"],gg=I.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,xg=({isLoading:l,children:f,indicator:s,progress:p})=>l?o.jsxs(pg,{children:[o.jsx(hg,{children:p<4?"Erasing Sectors...":p>67?"Verifying ROM...":"Flashing new ROM to cartridge..."}),s,o.jsx(gg,{progress:p,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(p),"%"]})})]}):f,bg=({esp32IP:l})=>{const f=Me(),{setIsModalOpen:s}=Ee(),{handleSubmit:p,setValue:x,reset:h,control:v}=er(),{data:b,isLoading:k,error:S,execute:w,progress:C}=mg(),L=R.useId(),$=R.useCallback(D=>{h(),x("romFile",D[0],{shouldValidate:!0})},[h,x]),G=async({romFile:D})=>{if(console.log(b),D){await w({romFile:D,esp32IP:l});return}};return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Rom"}),o.jsx(De,{children:o.jsxs(xg,{isLoading:k,indicator:o.jsx(st,{color:f.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:C,children:[!!S&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:f.errorRed}}),text:"Writing rom has failed"}),o.jsx("form",{id:L,"aria-label":"Upload Rom Form",onSubmit:p(G),children:o.jsx($r,{control:v,name:"romFile",rules:{validate:D=>!!D||"A rom file is required"},render:({field:{name:D},fieldState:{error:N}})=>o.jsx(dt,{ariaLabel:"Upload Rom",id:`${L}--drag-and-drop`,onDrop:$,name:D,validFileExtensions:vg,hideErrors:!!N,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})})})]})}),o.jsxs(Ie,{children:[o.jsx(ie,{form:L,type:"submit",variant:"contained",children:"Reflash Repro"}),o.jsx(ie,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]})]})},_g=[".sav",{regex:/\.ss[0-9]+/,displayText:".ss"}],yg=()=>{const{setIsModalOpen:l}=Ee(),{emulator:f}=de(),{reset:s,handleSubmit:p,setValue:x,formState:{isSubmitSuccessful:h},control:v}=er(),b=R.useId(),k=R.useCallback(C=>{s(),x("saveFiles",C,{shouldValidate:!0})},[s,x]),S=({saveFiles:C})=>{C.forEach(L=>f==null?void 0:f.uploadSaveOrSaveState(L)),s()},w=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your save or save state files, or click to select files."}),o.jsx("p",{children:"The name of your files must match the name of your rom."}),o.jsx("p",{children:"Save and save state files should have an extension '.sav' or start with '.ss'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${b}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Saves"}),o.jsx(De,{children:o.jsxs("form",{id:b,"aria-label":"Upload Saves Form",onSubmit:p(S),children:[o.jsx($r,{control:v,name:"saveFiles",rules:{validate:C=>(C==null?void 0:C.length)>0||"At least one .sav, or .ss file is required"},render:({field:{name:C,value:L},fieldState:{error:$}})=>o.jsx(dt,{ariaLabel:"Upload Saves",id:`${b}--drag-and-drop`,onDrop:k,name:C,validFileExtensions:_g,error:$==null?void 0:$.message,hideAcceptedFiles:!(L!=null&&L.length),hideErrors:h,multiple:!0,children:o.jsx("p",{children:"Drag and drop save or save state files here, or click to upload files"})})}),h&&o.jsx(Pa,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Ie,{children:[o.jsx(_r,{copy:"Upload",form:b,showSuccess:h,type:"submit"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(He,{steps:w,completedProductTourStepName:"hasCompletedUploadSavesTour"})]})},wg=()=>{const[l,f]=R.useState(0),s=R.useCallback(b=>b?new Promise((k,S)=>{const w=new XMLHttpRequest;w.open("GET",b.url,!0),w.responseType="arraybuffer",w.overrideMimeType("text/plain; charset=x-user-defined"),w.onprogress=function(C){if(C.lengthComputable){const L=C.loaded/C.total*100;f(L)}},w.onload=()=>{var C,L;if(w.status>=200&&w.status<300){const $=w.getResponseHeader("Content-Disposition"),G=(L=(C=$==null?void 0:$.split(";").pop())==null?void 0:C.split("=").pop())==null?void 0:L.replace(/"/g,""),D=decodeURIComponent(b.url.pathname.split("/").pop()??"unknown_external.gba"),N=new File([w.response],b.fullName??G??D);if(b.patchFile!=null&&b.patchFile!=""){console.log("applying bps patch to file: "+b.patchFile);const V=new XMLHttpRequest;V.open("GET",b.patchFile,!0),V.responseType="arraybuffer",V.overrideMimeType("text/plain; charset=x-user-defined"),V.onload=()=>{const Y=new Uint8Array(V.response),{instructions:X,checksum:U}=Cp(Y);console.log(U);const H=new Uint8Array(w.response),P=Ep(X,H),O=new File([P],b.fullName??G??D);k(O)},V.onerror=()=>{console.error("Request for patch file failed"),S(new Error("Network error occurred: Patch File"))},V.send(null)}else console.log("resolved file"),k(N)}else console.error("Request failed2"),S(new Error(`Received unexpected status code: ${w.status}`))},w.onerror=()=>{console.error("Request failed"),S(new Error("Network error occurred"))},w.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:x,error:h,execute:v}=Fr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:x,error:h,execute:v,progress:l}},Sg=()=>{const[l,f]=R.useState(0),s=R.useCallback(b=>b?new Promise((k,S)=>{console.log(b.fullName);const w=new XMLHttpRequest;w.open("GET",b.url,!0),w.responseType="arraybuffer",w.overrideMimeType("text/plain; charset=x-user-defined"),w.onprogress=function(C){if(C.lengthComputable){const L=C.loaded/C.total*100;f(L)}},w.onload=()=>{var C,L;if(w.status>=200&&w.status<300){const $=w.getResponseHeader("Content-Disposition"),G=(L=(C=$==null?void 0:$.split(";").pop())==null?void 0:C.split("=").pop())==null?void 0:L.replace(/"/g,""),D=decodeURIComponent(b.url.pathname.split("/").pop()??"unknown_external.sav"),N=new File([w.response],b.fullName??G??D);k(N)}else S(new Error(`Received unexpected status code: ${w.status}`))},w.onerror=()=>{console.error("Request failed"),S(new Error("Network error occurred"))},w.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:x,error:h,execute:v}=Fr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:x,error:h,execute:v,progress:l}},za=["FLASH1M_V102","FLASH1M_V103","FLASH_V124","FLASH_V126","FLASH_ECLA","EEPROM_V122","EEPROM_V124","SRAM_V112","SRAM_V113","REPRO_FLASH1M","NONE"],Ot=l=>(console.log("Save Type: "+l),l[0]=="N"?0:l[0]=="E"?1:l[0]=="S"?3:l[0]=="F"&&l[5]=="1"?5:l[0]=="F"?4:l[0]=="R"&&l[11]=="1"?55:(console.log("Invalid Save Type"),-1)),Cg=(l,f)=>{let s=Number(f.cartSize/1024/1024),p="";return s==1?p=l.checksum_1MB:s==2?p=l.checksum_2MB:s==4?p=l.checksum_4MB:s==8?p=l.checksum_8MB:s==16&&(p=l.checksum_16MB),p.toUpperCase()},Eg=l=>new Promise(f=>setTimeout(f,l)),kg=async l=>{let f,s,p="";try{if(f=await(await fetch(`${l}/get_game_info`,{method:"GET",headers:{"Access-Control-Request-Private-Network":"true"}})).json(),f.is_gba&&(s=await(await fetch(`./information_rom/${f.cartID}.json`)).json(),console.log(s),p=Cg(f,s),p!=s.checksum1000)){console.log("Checksums do not match. Trying to get a different one...");try{const v=await fetch(`./information_rom/${p}-${f.cartID}.json`);if(!v.ok||v.status!=200)throw new Error(`HTTP error! Status: ${v.status}`);let b=await v.json();b&&Object.keys(b).length>0?(console.log("Additional Data exists"),s=b):console.log("Additional Data does not exist or is empty")}catch(v){console.error("An error occurred while fetching additional data: ",v)}}return[f,s,p]}catch(x){console.error("Error fetching game information:",x)}finally{return[f,s,p]}},la=({gameData:l,checksum1000String:f,selectedSave:s,setSelectedSave:p,saveName:x})=>{var k;const{emulator:h}=de(),v=S=>{p(S)},b=((k=h==null?void 0:h.listSaves)==null?void 0:k.call(h).filter(S=>S.includes(l.cartID+"_"+f)))||[];return R.useEffect(()=>{for(const S of b)x===S&&p(S)},[]),o.jsx(o.Fragment,{children:o.jsx(Wt,{children:o.jsxs(Xt,{children:[o.jsx(ba,{children:o.jsxs(Fe,{children:[o.jsx(oe,{children:"Select"}),o.jsx(oe,{children:"Save"}),o.jsx(oe,{children:"Last Saved"})]})}),o.jsxs(Kt,{children:[o.jsxs(Fe,{children:[o.jsx(oe,{children:o.jsx(Ir,{checked:s==="Cartridge Save",onChange:()=>v("Cartridge Save")})}),o.jsx(oe,{children:"Cartridge Save"}),o.jsx(oe,{children:"-"})]},"cartridge-save"),b.length>0?b.map((S,w)=>{var C;return o.jsxs(Fe,{sx:{borderBottom:w===b.length-1?"none":void 0},children:[o.jsx(oe,{sx:{borderBottom:w===b.length-1?"none":void 0},children:o.jsx(Ir,{checked:s===S,onChange:()=>v(S)})}),o.jsx(oe,{sx:{borderBottom:w===b.length-1?"none":void 0},children:S}),o.jsx(oe,{sx:{borderBottom:w===b.length-1?"none":void 0},children:(C=h==null?void 0:h.getStatSaves)==null?void 0:C.call(h,S).mtime.toLocaleString()})]},w)}):o.jsx(Fe,{children:o.jsx(oe,{colSpan:3,children:"None"})})]})]})})})},zt=({gameData:l,checksum1000String:f,selectedGame:s,setSelectedGame:p,romName:x})=>{var k,S;const{emulator:h}=de(),v=w=>{p(w)};let b;return l==null?b=((k=h==null?void 0:h.listRoms)==null?void 0:k.call(h).filter(w=>w!=="."&&w!==".."))||[]:b=((S=h==null?void 0:h.listRoms)==null?void 0:S.call(h).filter(w=>w.includes(l.cartID+"_"+f)))||[],R.useEffect(()=>{for(const w of b)x===w&&p(w)},[]),o.jsx(o.Fragment,{children:o.jsx(Wt,{children:o.jsxs(Xt,{children:[o.jsx(ba,{children:o.jsxs(Fe,{children:[o.jsx(oe,{children:"Select"}),o.jsx(oe,{children:"Rom File"}),o.jsx(oe,{children:"Created"})]})}),o.jsxs(Kt,{children:[o.jsxs(Fe,{children:[o.jsx(oe,{children:o.jsx(Ir,{checked:s==="Cartridge Rom",onChange:()=>v("Cartridge Rom")})}),o.jsx(oe,{children:"Cartridge Rom"}),o.jsx(oe,{children:"-"})]},"cartridge-game"),b.length>0?b.map((w,C)=>{var L;return o.jsxs(Fe,{sx:{borderBottom:C===b.length-1?"none":void 0},children:[o.jsx(oe,{sx:{borderBottom:C===b.length-1?"none":void 0},children:o.jsx(Ir,{checked:s===w,onChange:()=>v(w)})}),o.jsx(oe,{sx:{borderBottom:C===b.length-1?"none":void 0},children:w}),o.jsx(oe,{sx:{borderBottom:C===b.length-1?"none":void 0},children:(L=h==null?void 0:h.getStatRoms)==null?void 0:L.call(h,w).mtime.toLocaleString()})]},C)}):o.jsx(Fe,{children:o.jsx(oe,{colSpan:3,children:"None"})})]})]})})})},jg=I.form`
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100dvw;
  max-width: fill-available;
  max-width: stretch;
  max-width: -webkit-fill-available;
  max-width: -moz-available;
`,Ga=I.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,Er=I.p`
  margin: 0;
  font-size: 16px;
`,kr=I.strong`
`,ca=I.option`
`,Fg=I.select`
`,Lg=I.img`
  max-width: 75%;
  height: auto;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid black;
`,Rg=I.div`
display: flex;
gap: 10px;
width: 100%;
flex-direction: column;
`,da=I.p`
  word-wrap: break-word;
  max-width: 100%;
`,Tg=I.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,Pg=({isLoading:l,isExternalRomLoading:f,children:s,indicator:p,progress:x})=>l?o.jsxs(Ga,{children:[f&&o.jsx(da,{children:"Dumping Rom from cartridge..."}),!f&&o.jsx(da,{children:"Dumping Save from cartridge..."}),p,o.jsx(Tg,{progress:x,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(x),"%"]})})]}):s,ua=({additionalData:l,setAdditionalData:f,gameData:s,setGameData:p,esp32IP:x,setEsp32IP:h})=>{const v=Me(),{setIsModalOpen:b}=Ee(),{emulator:k}=de(),{data:S,isLoading:w,error:C,execute:L,progress:$}=wg(),{data:G,execute:D}=Sg(),N=ct(),[V,Y]=R.useState(!1),[X,U]=R.useState(!1),H=!w&&!!S,[P,O]=R.useState(null),[A,K]=R.useState("Cartridge Save"),[m,ee]=R.useState("Cartridge Rom"),Q=ne=>{const{name:ge,value:Le}=ne.target;f(nr=>({...nr,[ge]:Le}))};R.useEffect(()=>{if(H){const ne=()=>{N((k==null?void 0:k.filePaths().gamePath)+"/"+S.name)&&b(!1)};k==null||k.uploadRom(S,ne)}},[H,S,k,b,N]);const ce=async()=>{try{Y(!0);const[ne,ge,Le]=await kg([x]);p(ne),f(ge),O(Le),Y(!1)}catch(ne){console.error("Error fetching game info:",ne)}};R.useEffect(()=>{G!=null&&(k==null||k.uploadSaveOrSaveState(G))},[G,k]),R.useEffect(()=>{V||ce()},[]);const Te=()=>l?l.fullName+"_"+s.cartID+"_"+P:s.romName+"_"+s.cartID+"_"+P,We=async()=>{if(U(!0),s.is_gba){console.log("Using save: "+A);let ne=Te()+".sav";A=="Cartridge Save"&&await Xe(l.saveType,ne),await Eg(300),console.log("save loaded")}await tr(),U(!1)},Je=async ne=>{var Le;let ge=(Le=k==null?void 0:k.listRoms)==null?void 0:Le.call(k);return console.log(ge),ge&&ge.includes(ne)?(console.log("rom exists locally"),N((k==null?void 0:k.filePaths().gamePath)+"/"+ne),b(!1),U(!1),!0):!1},tr=async()=>{if(U(!0),m!="Cartridge Rom")await Je(m)||console.log("Unable to load local rom");else if(s.is_gba){let ne=Te()+".gba",ge=l.cartSize,Le=`${x}/get_current_game.gba?cartSize=${ge}&saveType=4`;await L({url:new URL(Le),fullName:ne,patchFile:l.patchFile})}else{let ne=Te()+".gb",ge=`${x}/get_current_game.gb`;await L({url:new URL(ge),fullName:ne,patchFile:null})}U(!1)},Xe=async(ne,ge)=>{try{console.log(ne);var Le=Ot(ne);if(Le==-1){console.log("Invalid Save Type");return}console.log(Le);var nr=`${x}/get_current_save?saveType=${Le}`;await D({url:new URL(nr),fullName:ge})}catch(fe){console.error("Error fetching save:",fe)}finally{}};return o.jsxs(o.Fragment,{children:[s&&l?o.jsx(Re,{title:l.fullName}):s&&!l?o.jsx(Re,{title:s.romName}):!s&&l?o.jsx(Re,{title:l.fullName}):o.jsx(Re,{title:"No Response from Cart Reader"}),o.jsx(De,{children:o.jsxs(Pg,{isLoading:X,isExternalRomLoading:w,indicator:o.jsx(st,{color:v.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:$,children:[!!C&&o.jsx(dr,{icon:o.jsx(lr,{style:{color:v.errorRed}}),text:"Loading rom from URL has failed"}),s&&s.is_gba&&o.jsx(o.Fragment,{children:s&&l&&o.jsxs(o.Fragment,{children:[o.jsx(Ga,{children:o.jsx(Lg,{id:"cover-image",src:l.coverImage?l.coverImage.startsWith("/")?`.${l.coverImage}`:l.coverImage:"",alt:`${l.fullName} Cover`})}),o.jsx(Wt,{id:"game-info",children:o.jsx(Xt,{children:o.jsxs(Kt,{children:[o.jsxs(Fe,{children:[o.jsx(oe,{children:"Full Name:"}),o.jsx(oe,{children:l.fullName})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"ROM Name:"}),o.jsx(oe,{children:s.romName})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"Cart Size:"}),o.jsx(oe,{children:o.jsxs(Nt,{name:"cartSize",value:l.cartSize,onChange:Q,children:[o.jsxs(rt,{value:l.cartSize,children:[(l.cartSize/1024/1024).toFixed(2),"MB"]},(l.cartSize/1024/1024).toFixed(2)),[1,2,4,8,16,32,64].map(ne=>o.jsxs(rt,{value:ne*1024*1024,children:[ne,"MB"]},ne))]})})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"Save Type:"}),o.jsx(oe,{children:o.jsx(Nt,{name:"saveType",value:l.saveType,onChange:Q,children:za.map(ne=>o.jsx(rt,{value:ne,children:ne},ne))})})]}),l.patchFile!=null&&l.patchFile.length>0&&o.jsxs(Fe,{children:[o.jsx(oe,{children:"BPS Patch File:"})," ",o.jsx(oe,{children:l.patchFile})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"Cart ID:"})," ",o.jsx(oe,{children:s.cartID})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"ROM Version:"})," ",o.jsx(oe,{children:s.romVersion})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"Checksum:"})," ",o.jsxs(oe,{children:["0x",P]})]}),o.jsxs(Fe,{children:[o.jsx(oe,{children:"Publisher:"})," ",o.jsx(oe,{children:l.publisher})]}),o.jsxs(Fe,{children:[o.jsx(oe,{style:{border:"none"},children:"Release Date:"})," ",o.jsx(oe,{style:{border:"none"},children:l.releaseDate})]})]})})}),k&&o.jsxs(o.Fragment,{children:[o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Saves"}),o.jsx(la,{gameData:s,checksum1000String:P,selectedSave:A,setSelectedSave:K,saveName:Te()+".sav"}),o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Roms"}),o.jsx(zt,{gameData:s,checksum1000String:P,selectedGame:m,setSelectedGame:ee,romName:Te()+".gba"})]}),o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"})]})}),s&&!s.is_gba&&o.jsx(o.Fragment,{children:s&&o.jsxs(o.Fragment,{children:[o.jsxs(Er,{children:[o.jsx(kr,{children:"ROM Name:"})," ",s.romName]}),o.jsxs(Er,{children:[o.jsx(kr,{children:"Cart Size (KB):"}),o.jsxs(Fg,{name:"cartSize",value:s.romSizeBytes_gb/1024,onChange:Q,children:[o.jsxs(ca,{value:s.romSizeBytes_gb,children:[(s.romSizeBytes_gb/1024).toFixed(2),"MB"]},(s.romSizeBytes_gb/1024).toFixed(2)),[32,64,128,256,512,1024,2048,4096,8192].map(ne=>o.jsxs(ca,{value:ne*1024,children:[ne,"KB"]},ne))]})]}),o.jsxs(Er,{children:[o.jsx(kr,{children:"Rom Banks:"})," ",s.romBanks]}),o.jsxs(Er,{children:[o.jsx(kr,{children:"Checksum:"})," 0x",s.checksum_gb]}),o.jsxs(Er,{children:[o.jsx(kr,{children:"SRAM Size:"})," ",s.sramSize]}),o.jsxs(Er,{children:[o.jsx(kr,{children:"Audio WE used:"})," ",s.audioWE?"true":"false"]}),k&&o.jsxs(o.Fragment,{children:[o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Saves"}),o.jsx(la,{gameData:s,checksum1000String:P,selectedSave:A,setSelectedSave:K,saveName:Te()+".sav"}),o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Roms"}),o.jsx(zt,{gameData:s,checksum1000String:P,selectedGame:m,setSelectedGame:ee,romName:Te()+".gba"})]}),o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"})]})}),o.jsxs(jg,{"aria-label":"Login Form",children:[o.jsx(ir,{label:"ESP32 IP Address",autoComplete:"esp32IPInputField",variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px"},defaultValue:x,onChange:ne=>{h(ne.target.value)}}),o.jsxs(ie,{variant:"outlined",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"8px"},onClick:()=>{ce()},children:[o.jsx(kp,{style:{fontSize:"18px"}})," ","Refresh"]})]})]})}),o.jsx(Ie,{children:!X&&o.jsxs(Rg,{children:[o.jsxs(ie,{variant:"contained",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>We(),children:[o.jsx(jp,{style:{fontSize:"30px",marginRight:"10px"}})," ","Start Game"]}),o.jsx(ie,{variant:"outlined",style:{padding:"10px 20px 10px 20px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>b(!1),children:"Close"})]})})]})},Mg=()=>{const{setIsModalOpen:l}=Ee(),{emulator:f}=de(),s=[{label:"Full Name",value:"fullName",setter:"setFullName"},{label:"Cover Image",value:"coverImage",setter:"setCoverImage"},{label:"Publisher",value:"publisher",setter:"setPublisher"},{label:"Release Date",value:"releaseDate",setter:"setReleaseDate"},{label:"CRC",value:"crc",setter:"setCrc"},{label:"Cart Size (Bytes)",value:"cartSize",setter:"setCartSize"},{label:"Save Type",value:"saveType",setter:"setSaveType"},{label:"Checksum 1000",value:"checksum1000",setter:"setChecksum1000"},{label:"Cart ID",value:"cartId",setter:"setCartId"},{label:"Patch File",value:"patchFile",setter:"setPatchFile"},{label:"Console",value:"console",setter:"setConsole"}],[p,x]=R.useState({fullName:"",coverImage:"",publisher:"",releaseDate:"",crc:"",cartSize:"",saveType:"",checksum1000:"",cartId:"",patchFile:"",console:".gba"}),[h,v]=R.useState(""),[b,k]=R.useState(""),[S,w]=R.useState(new Uint8Array);R.useEffect(()=>{h&&V(h)},[h]);const C=X=>{const U=X.target.files[0];if(U){k(U.name);let H=G(U.name).fileName;x(O=>({...O,fullName:H})),x(O=>({...O,patchFile:H+".bps"}));const P=new FileReader;P.onload=O=>{if(O.target&&O.target.result){let A=O.target.result;typeof A=="string"&&(A=new TextEncoder().encode(A)),w(new Uint8Array(A))}},P.readAsArrayBuffer(U)}},L=(X,U)=>{x(H=>({...H,[U]:X.target.value}))},$=R.useId();function G(X){const U=X.match(/\.(gb|gbc|gba)$/i);return U?{fileName:X.replace(/\.(gb|gbc|gba)$/i,""),removedExtension:U[0]}:{fileName:X,removedExtension:"gba"}}const D=async X=>{let H=await(await fetch(`./information_rom/${X}.json`)).json();x(P=>({...P,coverImage:H.coverImage})),x(P=>({...P,publisher:H.publisher})),x(P=>({...P,releaseDate:H.releaseDate})),x(P=>({...P,saveType:H.saveType}))},N=()=>{const X={fullName:p.fullName,coverImage:p.coverImage,publisher:p.publisher,releaseDate:p.releaseDate,crc:p.crc,cartSize:p.cartSize,saveType:p.saveType,checksum1000:p.checksum1000,patchFile:"./patches/"+p.patchFile,console:p.console},U=JSON.stringify(X,null,2),H=new Blob([U],{type:"application/json"}),P=document.createElement("a");P.href=URL.createObjectURL(H),P.download=p.checksum1000+"-"+p.cartId+".json",document.body.appendChild(P),P.click(),URL.revokeObjectURL(P.href),document.body.removeChild(P)},V=X=>{const U=X.split("/").pop();if(U){x(m=>({...m,console:G(U).removedExtension})),x(m=>{var ee;return{...m,cartSize:(ee=f==null?void 0:f.getStatRoms)==null?void 0:ee.call(f,X).size}});const H=/_([A-Z0-9]{1,4})_([A-Z0-9]{1,8})\./,P=U.match(H);if(!P){console.log("No match found");return}const O=P[1],A=P[2];console.log("CartID:",O),console.log("Checksum1000:",A),x(m=>({...m,checksum1000:A})),x(m=>({...m,cartId:O}));const K=f==null?void 0:f.getFile("/data/games/"+X);if(K){let m=(Fp.buf(K)>>>0).toString(16).toUpperCase();x(ee=>({...ee,crc:m}))}D(O)}},Y=()=>{const X=f==null?void 0:f.getFile("/data/games/"+h),U=S;if(X&&U){const H=Lp(X,U),{buffer:P,checksum:O}=Rp(H);console.log("Patch Checksum: "+O);const A=new Blob([P],{type:"application/octet-stream"}),K=document.createElement("a");K.href=URL.createObjectURL(A),K.download=p.patchFile,document.body.appendChild(K),K.click(),URL.revokeObjectURL(K.href),document.body.removeChild(K),N()}};return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"File System"}),o.jsxs(De,{children:[o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Base Rom"}),o.jsx(zt,{gameData:null,checksum1000String:null,selectedGame:h,setSelectedGame:v,romName:".gba"}),o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Patched Rom"}),o.jsx("input",{type:"file",onChange:C,accept:".gba"}),b&&o.jsxs("p",{children:["Selected File: ",b]}),o.jsx(Qe,{sx:{padding:"10px 0",color:"darkgrey"},children:"Information"}),s.map(X=>X.value!="saveType"?o.jsx(ir,{label:X.label,variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px",width:"98%"},value:p[X.value],onChange:U=>L(U,X.value)},X.value):null),o.jsx(nh,{sx:{minWidth:120},children:o.jsxs(ah,{fullWidth:!0,style:{padding:"3px 8px 3px 8px",marginLeft:"5px",width:"98%",marginTop:"5px"},children:[o.jsx(oh,{id:"demo-simple-select-label",children:"Save Type"}),o.jsx(Nt,{name:"saveType",value:p.saveType,onChange:X=>L(X,"saveType"),label:"Save Type",style:{fontSize:"14px"},children:za.map(X=>o.jsx(rt,{value:X,children:X},X))})]})})]}),o.jsxs(Ie,{children:[o.jsx(_r,{copy:"Create Patch File",id:`${$}--create-patch-button-button`,onClick:()=>Y()}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},Ag=I.div`
  width: ${xr}px;
  height: 100dvh;
  position: fixed;
  background-color: ${({theme:l})=>l.mediumBlack};
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  z-index: 150;
  overflow-y: auto;
  text-align: left;
  left: 0;
  top: 0;
  touch-action: none;

  ${({$isExpanded:l=!1})=>!l&&`left: -${xr+5}px;
    `}

  &::-webkit-scrollbar {
    display: none;
  }
`,Dg=I.h2`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0.5rem 1rem;
  font-size: calc(1.3rem + 0.6vw);
  font-weight: 500;
  line-height: 1.2;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;

  &:hover {
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Ig=I.ul`
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
  margin-top: 0;
  list-style: none;
  padding: 0;
`,Bg=I(Rr)`
  background-color: ${({theme:l})=>l.mediumBlack};
  color: ${({theme:l})=>l.pureWhite};
  z-index: 200;
  position: fixed;
  left: ${xr-6}px;
  top: 12px;
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  cursor: pointer;
  padding: 0.375rem 0.75rem;
  border-radius: 0.25rem;
  border: none;
  min-height: 36px;
  min-width: 40px;

  ${({$isExpanded:l=!1})=>!l&&`left: -8px;
    `}

  &:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
`,$g=I.button`
  position: absolute;
  width: calc(100dvw - ${xr}px);
  left: ${xr}px;
  height: 99%;
  background: 0 0;
  z-index: 140;
  border: none;
`,Ng=()=>{const[l,f]=R.useState(!0),{setModalContent:s,setIsModalOpen:p}=Ee(),{canvas:x,emulator:h}=de(),{isRunning:v}=rr(),b=Me(),k=gr(b.isLargerThanPhone),S=R.useId(),w=Ta(),[C,L]=R.useState(null),[$,G]=R.useState(null),D="https://192.168.1.3",[N,V]=R.useState(D);return R.useEffect(()=>{const X=new URLSearchParams(window.location.search).get("esp32_ip");X&&V(X);const U=setTimeout(()=>{console.log("run12"),s(o.jsx(ua,{additionalData:C,setAdditionalData:L,gameData:$,setGameData:G,esp32IP:N,setEsp32IP:V})),p(!0)},500);return()=>clearTimeout(U)},[C,$,N]),o.jsxs(o.Fragment,{children:[o.jsx(Bg,{id:"menu-btn",$isExpanded:l,onClick:()=>f(Y=>!Y),"aria-label":"Menu Toggle",children:o.jsx(Tp,{})}),o.jsxs(Ag,{"data-testid":"menu-wrapper",id:"menu-wrapper",$isExpanded:l,children:[o.jsx(Dg,{id:S,children:"Menu"}),o.jsxs(Ig,{"aria-labelledby":S,children:[o.jsx(je,{title:"My Cartridge",icon:o.jsx(Pt,{}),$withPadding:!0,onClick:()=>{s(o.jsx(ua,{additionalData:C,setAdditionalData:L,gameData:$,setGameData:G,esp32IP:N,setEsp32IP:V})),p(!0)}}),o.jsxs(et,{title:"Pre Game Actions",$disabled:v,$isExpanded:!v,icon:o.jsx(ra,{}),children:[o.jsx(je,{title:"Upload Saves",$disabled:v,icon:o.jsx($t,{}),onClick:()=>{s(o.jsx(yg,{})),p(!0)}}),o.jsx(je,{title:"Upload Cheats",$disabled:v,icon:o.jsx($t,{}),onClick:()=>{s(o.jsx(ig,{})),p(!0)}}),o.jsx(je,{title:"Upload Rom",$disabled:v,icon:o.jsx(Mt,{}),onClick:()=>{s(o.jsx(fg,{})),p(!0)}}),o.jsx(je,{title:"Load Local Rom",$disabled:v,icon:o.jsx(Mt,{}),onClick:()=>{s(o.jsx(qv,{})),p(!0)}})]}),o.jsxs(et,{title:"Cartridge Actions",$isExpanded:v,icon:o.jsx(Pp,{}),children:[o.jsx(je,{title:"Save to Cartridge",$disabled:!v,icon:o.jsx(Mp,{}),onClick:()=>{const Y=h==null?void 0:h.getCurrentSave(),X=h==null?void 0:h.getCurrentSaveName();if(Y&&X){const H=new XMLHttpRequest;if(!C){console.log("No save type information.");return}var U=Ot(C.saveType);if(U==-1){console.log("Invalid Save Type");return}console.log(U);const P=new Promise((O,A)=>{H.open("POST",`${N}/upload_save_file?saveType=${U}`,!0),H.onload=()=>{if(H.status>=200&&H.status<300){const K=new XMLHttpRequest;K.open("POST",`${N}/verify_save_file?saveType=${U}`,!0),K.onload=()=>{K.status>=200&&K.status<300?O("Uploaded  and verified save on cartridge"):A("Save on cartridge has errors")},K.onerror=()=>A("Failed to upload save for verification"),K.send(Y)}else A("Failed to upload save to cartridge")},H.onerror=()=>A("Failed to upload save to cartridge"),H.send(Y)});Ve.promise(P,{loading:"Uploading save to cartridge...",success:O=>`${O}`,error:O=>`${O}`})}else Ve.error("Current save not available")}}),o.jsx(je,{title:"Verify Cartridge Save",$disabled:!v,icon:o.jsx(Ap,{}),onClick:()=>{const Y=h==null?void 0:h.getCurrentSave(),X=h==null?void 0:h.getCurrentSaveName();if(Y&&X){const H=new XMLHttpRequest;if(!C){console.log("No save type information.");return}var U=Ot(C.saveType);if(U==-1){console.log("Invalid Save Type");return}const P=new Promise((O,A)=>{H.open("POST",`${N}/verify_save_file?saveType=${U}`,!0),H.onload=()=>{H.status>=200&&H.status<300?O("Verified save on cartridge"):A("Save on cartridge is not the same.")},H.onerror=()=>A("Failed to upload save"),H.send(Y)});Ve.promise(P,{loading:"Verifying save on cartridge...",success:O=>`${O}`,error:O=>`${O}`})}else Ve.error("Current save not available")}}),o.jsx(je,{title:"Reflash Cartridge Rom",icon:o.jsx(Mt,{}),onClick:()=>{s(o.jsx(bg,{esp32IP:N})),p(!0)}})]}),o.jsxs(et,{title:"In Game Actions",$disabled:!v,$isExpanded:v,icon:o.jsx(Dp,{}),children:[o.jsx(je,{title:"Screenshot",$disabled:!v,icon:o.jsx(Ip,{}),onClick:()=>{h!=null&&h.screenshot()?Ve.success("Screenshot saved successfully"):Ve.error("Screenshot has failed")}}),o.jsx(je,{title:"Full Screen",$disabled:!v,icon:o.jsx(Bp,{}),onClick:()=>{x==null||x.requestFullscreen().catch(()=>{Ve.error("Full screen request has failed")})}}),o.jsx(je,{title:"Download Save",$disabled:!v,icon:o.jsx(ga,{}),onClick:()=>{s(o.jsx(Tv,{})),p(!0)}}),o.jsx(je,{title:"Quick Reload",$disabled:!v,icon:o.jsx($p,{}),onClick:w}),o.jsx(je,{title:"Manage Save States",$disabled:!v,icon:o.jsx(Np,{}),onClick:()=>{s(o.jsx(Yv,{})),p(!0)}}),o.jsx(je,{title:"Manage Cheats",$disabled:!v,icon:o.jsx(Up,{}),onClick:()=>{s(o.jsx(wv,{})),p(!0)}})]}),o.jsx(je,{title:"Controls",icon:o.jsx(Pt,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Rv,{})),p(!0)}}),o.jsx(je,{title:"File System",icon:o.jsx(Op,{}),$withPadding:!0,onClick:()=>{s(o.jsx(zv,{})),p(!0)}}),o.jsxs(et,{title:"Other",icon:o.jsx(ra,{}),children:[o.jsx(je,{title:"Create Patch File",icon:o.jsx(Pt,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Mg,{})),p(!0)}}),o.jsx(je,{title:"About",icon:o.jsx(zp,{}),$withPadding:!0,onClick:()=>{s(o.jsx(cv,{})),p(!0)}})]})]})]}),l&&!k&&o.jsx($g,{"aria-label":"Menu Dismiss",onClick:()=>{f(!1)}})]})};I.ul`
  text-align: left;
`;const Ug=()=>!0,Og=()=>{const[l]=Ce(an);return l!=null&&l.hasCompletedProductTourIntro?o.jsx(Gp,{}):null},zg=240,Gg=160,qg=I.canvas`
  background-color: ${({theme:l})=>l.pureBlack};
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -moz-crisp-edges;
  image-rendering: -o-crisp-edges;
  width: 100%;
  height: 100%;
  display: block;
  margin: 0 auto;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`,Vg=I(pa)`
  background-color: ${({theme:l})=>l.pureBlack};
  border: solid 1px ${({theme:l})=>l.pureBlack};
  overflow: visible;
  width: 100dvw;
  height: calc(100dvw * 2 / 3);

  @media ${({theme:l})=>l.isLargerThanPhone} {
    width: min(
      calc(100dvw - ${xr+35}px),
      calc(85dvh * 3 / 2)
    );
    height: 85dvh;
  }
`,Hg={width:"",height:""},Wg=()=>{var G,D;const l=Me(),f=gr(l.isLargerThanPhone),{setCanvas:s}=de(),{areItemsDraggable:p}=it(),{areItemsResizable:x}=Ea(),{layouts:h,setLayout:v,hasSetLayout:b}=Lr(),k=f?xr+10:0,S=f?15:0,w=R.useCallback(N=>{var V,Y,X,U,H,P,O,A;b||((X=(Y=(V=N==null?void 0:N.resizableElement)==null?void 0:V.current)==null?void 0:Y.style)==null||X.removeProperty("width"),(P=(H=(U=N==null?void 0:N.resizableElement)==null?void 0:U.current)==null?void 0:H.style)==null||P.removeProperty("height")),!((O=h==null?void 0:h.screen)!=null&&O.initialBounds)&&N&&v("screen",{initialBounds:(A=N.resizableElement.current)==null?void 0:A.getBoundingClientRect()})},[b,h,v]),C=R.useCallback(N=>s(N),[s]),L=((G=h==null?void 0:h.screen)==null?void 0:G.position)??{x:k,y:S},$=((D=h==null?void 0:h.screen)==null?void 0:D.size)??Hg;return o.jsx(Vg,{"data-testid":"screen-wrapper",disableDragging:!p,ref:w,enableResizing:x,resizeHandleComponent:{topRight:o.jsx(jr,{variation:"topRight"}),bottomRight:o.jsx(jr,{variation:"bottomRight"}),bottomLeft:o.jsx(jr,{variation:"bottomLeft"}),topLeft:o.jsx(jr,{variation:"topLeft"})},resizeHandleStyles:{topRight:{marginTop:"15px",marginRight:"15px"},bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"},topLeft:{marginTop:"15px",marginLeft:"15px"}},position:L,size:$,onDragStop:(N,V)=>{v("screen",{position:{x:V.x,y:V.y}})},onResizeStop:(N,V,Y,X,U)=>{v("screen",{size:{width:Y.clientWidth,height:Y.clientHeight},position:{...U}})},children:o.jsx(qg,{"data-testid":"screen-wrapper:render-canvas",ref:C,width:zg,height:Gg})})},Xg=I.div`
  background-color: #fff;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  height: fit-content;
  inset: 10px;
  margin: 25px auto auto;
  padding-top: 25px;
  max-height: 80%;
  max-width: calc(100dvw - 20px);
  padding: 0;
  touch-action: none;
  user-select: text;
  width: fit-content;

  @media ${({theme:l})=>l.isLargerThanPhone} {
    max-width: 600px;
  }
`,Kg=I.div`
  background-color: rgba(0, 0, 0, 0.5);
  width: 100dvw;
  height: 100dvh;
  position: absolute;
`,Yg=I(Aa)`
  justify-content: center;
`,Qg=I(Da)`
  padding: 1em 1em 0 1em;
`,Jg=I.img`
  object-fit: contain;
  max-width: 100%;
`,Zg=I(Ia)`
  justify-content: center;
  flex-wrap: wrap;
`,ex=I.div`
  position: relative;
`,rx=I.a`
  font-size: 5px;
  position: absolute;
  right: 15%;
  bottom: 6%;
`,fa=()=>o.jsx("span",{children:""}),tx=({error:l,resetErrorBoundary:f})=>o.jsx(Kg,{children:o.jsxs(Xg,{role:"alert",children:[o.jsx(Yg,{children:o.jsx(Ma,{children:"An irrecoverable error occurred"})}),o.jsxs(Qg,{children:[o.jsxs(ex,{children:[o.jsx(Jg,{src:"/img/error-512x512.png",alt:"GameBoy Advance with error icon"}),o.jsx(rx,{target:"_blank",href:"https://www.freepik.com/free-vector/editable-text-effect-error-3d-hack-virus-font-style_21408324.htm",children:"Font by NACreative"})]}),o.jsx("p",{style:{color:"red"},children:l.message}),o.jsx("p",{children:"Please use the buttons below to copy the stack trace and create an issue, this helps a lot with error reporting!"})]}),o.jsxs(Zg,{children:[o.jsx(ie,{color:"info",variant:"contained",onClick:()=>{navigator.clipboard.writeText(l.stack??"No stack available")},children:"Copy trace"}),o.jsx(fa,{}),o.jsx(ie,{color:"success",variant:"contained",href:"https://github.com/thenick775/gbajs3/issues",target:"_blank",children:"Create issue"}),o.jsx(fa,{}),o.jsx(ie,{color:"secondary",variant:"contained",onClick:f,children:"Dismiss and reset"})]})]})}),nx=({children:l})=>o.jsx(qp,{fallbackRender:tx,children:l}),ax=()=>{const l=Me();return o.jsx(Vp,{toastOptions:{success:{duration:1e3},error:{duration:1500},style:{background:l.darkCharcoal,color:l.pureWhite}}})},ox=({children:l})=>o.jsx(mh,{children:o.jsx(hh,{children:o.jsx(lh,{children:o.jsx(ph,{children:l})})})}),sx={isLargerThanPhone:"only screen and (min-width: 600px)",isMobileLandscape:"only screen and (max-height: 1000px) and (max-width: 1000px) and (orientation: landscape)",isMobilePortrait:"only screen and (max-width: 1000px) and (orientation: portrait)",isMobileWithUrlBar:"only screen and (max-height: 700px) and (orientation: portrait)",aliceBlue1:"#f8f9fa",aliceBlue2:"#edf2f7",arcticAirBlue:"#cad8e5",blackRussian:"#1a202c",blueCharcoal:"#212529",checkMarkGreen:"#7ac142",darkCharcoal:"#333",darkGrayBlue:"#495057",disabledGray:"#6c757d",errorRed:"#d32f2f",gbaThemeBlue:"#0d6efd",mediumBlack:"#100901",menuHighlight:"#ffffff26",menuHover:"#0a58ca",pattensBlue:"#dee2e6",pureBlack:"#000",pureWhite:"#fff",darkGray:"#111",panelControlGray:"#a9a9a9",panelBlueGray:"#4f555a"},ix=()=>o.jsx(Hp,{theme:sx,children:o.jsxs(nx,{children:[o.jsx(Ug,{}),o.jsx(ax,{}),o.jsx(Og,{}),o.jsx(ih,{children:o.jsx(ox,{children:o.jsx(xh,{children:o.jsxs(bh,{children:[o.jsx(Ng,{}),o.jsx(Wg,{}),o.jsx(Mh,{}),o.jsx(Jh,{}),o.jsx(ev,{})]})})})})]})});Wp.createRoot(document.getElementById("root")).render(o.jsx(ot.StrictMode,{children:o.jsx(ix,{})}));
