import{r as P,z as jm,A as kt,j as o,B as je,D as Lm,E as A,q as Yr,F as Te,H as Fm,I as Rm,J as Xn,K as Kn,L as Yn,M as Tm,N as Pm,O as Mn,Q as An,S as Mm,U as Am,V as Dm,W as Bm,X as St,Y as sr,Z as jt,$ as Im,a0 as Je,a1 as $m,a2 as Nm,a3 as Um,a4 as Om,a5 as Gm,a6 as Lt,a7 as zm,a8 as Qn,a9 as dr,aa as qm,ab as Qr,ac as Jn,ad as Ft,ae as Et,af as Vm,ag as Hm,ah as Wm,ai as Xm,aj as Km,ak as Ym,al as Qm,am as Dn,an as Jm,ao as Zm,ap as Bn,aq as ep,ar as In,as as rp,at as tp,au as np,av as ap,aw as op,ax as sp,ay as ip,az as lp,aA as cp,aB as dp}from"./vendor-C46dVg2t.js";import{S as _t,c as up}from"./vendor_react-joyride-Bdy49H5G.js";import{u as ir,S as fp,I as Ze,B as ie,F as Zn,C as mp,T as or,a as pp,b as hp,c as $n,d as Rt,s as vp,e as gp,t as yt,f as xp,g as bp,D as ea}from"./vendor_@mui-DHTLE3Ge.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))p(x);new MutationObserver(x=>{for(const y of x)if(y.type==="childList")for(const g of y.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&p(g)}).observe(document,{childList:!0,subtree:!0});function i(x){const y={};return x.integrity&&(y.integrity=x.integrity),x.referrerPolicy&&(y.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?y.credentials="include":x.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function p(x){if(x.ep)return;x.ep=!0;const y=i(x);fetch(x.href,y)}})();const ra="currentEmulatorVolume",ta="currentEmulatorKeyBindings",na="currentGameName",aa="currentFastForward",jr=({fetchFn:l,loadOnMount:m=!1,clearDataOnLoad:i=!1})=>{const[p,x]=P.useState(null),[y,g]=P.useState(null),[_,j]=P.useState(!1),k=()=>g(null),E=P.useCallback(async L=>{j(!0),g(null),i&&x(null);try{const R=await l(L);x(R),j(!1)}catch(R){g(R),j(!1)}},[i,l]);return P.useEffect(()=>{m&&l&&E()},[]),{data:p,isLoading:_,error:y,clearError:k,execute:E}},_p=({loadOnMount:l=!1}={})=>{const i=P.useCallback(async()=>(await fetch("undefined/api/tokens/refresh",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json(),[void 0]),{data:p,isLoading:x,error:y,clearError:g,execute:_}=jr({fetchFn:i,clearDataOnLoad:!0,loadOnMount:l});return{data:p,isLoading:x,error:y,clearError:g,execute:_}},Tt=P.createContext(null);Tt.displayName="AuthContext";const yp=({children:l})=>{const[p,x]=P.useState(null),[y,g]=P.useState(null),{data:_,isLoading:j,execute:k,error:E,clearError:L}=_p({loadOnMount:!1}),R=!j&&!!_;P.useEffect(()=>{R&&(x(_),g("refresh"))},[R,_]);const $=P.useCallback(()=>{if(p){const{exp:B}=jm(p);if(B&&Date.now()<=B*1e3)return!0}return!1},[p]),U=$()&&!_&&y!=="refresh";return P.useEffect(()=>{U&&L()},[U,L]),kt(async()=>{await k()},$()&&!E?24e4:null),o.jsx(Tt.Provider,{value:{accessToken:p,setAccessToken:x,setAccessTokenSource:g,isAuthenticated:$},children:l})},Pt=P.createContext(null);Pt.displayName="DragContext";const wp=({children:l})=>{const[m,i]=P.useState(!1);return o.jsx(Pt.Provider,{value:{areItemsDraggable:m,setAreItemsDraggable:i},children:l})},Ve=0,Sp=3,Ep=l=>{const m=l.filePaths(),i=(_,j)=>{var E,L;let k=(E=_==null?void 0:_.split("/"))==null?void 0:E.pop();if(j){const R="."+((L=k==null?void 0:k.split("."))==null?void 0:L.pop());k=k==null?void 0:k.replace(R,j)}return k},p=()=>{const _={path:m.root,isDir:!0,children:[]},j=[".",".."],k=({path:E,children:L})=>{for(const R of l.FS.readdir(E)){if(j.includes(R))continue;const $=`${E}/${R}`,{mode:U}=l.FS.lookupPath($,{}).node,B={path:$,isDir:l.FS.isDir(U),children:[]};L==null||L.push(B),B.isDir&&k(B)}};return k(_),_},x=_=>{var R;const j=_.split(`
`),k=["cheats = ",""];if(!((R=j==null?void 0:j[0])!=null&&R.match("^cheats = [0-9]+$")))return[];const E={},L={desc:"desc",code:"code",enable:"enable"};for(const $ of j){if(k.includes($))continue;const U=$.match(/^cheat([0-9]+)_([a-zA-Z]+)\s*=\s*"?([a-zA-Z0-9\s+:_]+)"?$/);if(U){const[,B,H,G]=U,Y=L[H];E[B]=E[B]||{desc:"",code:"",enable:!1},Y&&(E[B][Y]=Y===L.enable?G.toLowerCase()==="true":G)}}return Object.values(E)},y=_=>{const j=_.map((L,R)=>`cheat${R}_desc = "${L.desc}"
cheat${R}_enable = ${L.enable}
cheat${R}_code = "${L.code}"
`),k=`cheats = ${j==null?void 0:j.length}

`,E=i(l.gameName,".cheats");if(j!=null&&j.length&&E){const L=k+j.join(`
`),R=new Blob([L],{type:"text/plain"});return new File([R],E)}return null},g=({key:_,location:j})=>{let k=j===Sp?`Keypad ${_}`:_;return k.toLowerCase().includes("enter")&&(k=k.replace(/enter/gi,"Return")),k.toLowerCase().includes("arrow")&&(k=k.replace(/arrow/gi,"")),k};return{autoLoadCheats:l.autoLoadCheats,createSaveState:l.saveState,defaultKeyBindings:()=>[{gbaInput:"A",key:"X",location:Ve},{gbaInput:"B",key:"Z",location:Ve},{gbaInput:"L",key:"A",location:Ve},{gbaInput:"R",key:"S",location:Ve},{gbaInput:"Start",key:"Enter",location:Ve},{gbaInput:"Select",key:"Backspace",location:Ve},{gbaInput:"Up",key:"ArrowUp",location:Ve},{gbaInput:"Down",key:"ArrowDown",location:Ve},{gbaInput:"Left",key:"ArrowLeft",location:Ve},{gbaInput:"Right",key:"ArrowRight",location:Ve}],loadSaveState:l.loadState,listSaveStates:()=>l.FS.readdir(m.saveStatePath),listRoms:()=>l.FS.readdir(m.gamePath),setVolume:async _=>{(l.SDL2.audioContext.state==="suspended"||l.SDL2.audioContext.state==="interrupted")&&await l.SDL2.audioContext.resume(),l.setVolume(_)},getVolume:l.getVolume,enableKeyboardInput:()=>l.toggleInput(!0),disableKeyboardInput:()=>l.toggleInput(!1),simulateKeyDown:l.buttonPress,simulateKeyUp:l.buttonUnpress,setFastForwardMultiplier:l.setFastForwardMultiplier,isFastForwardEnabled:()=>l.getFastForwardMultiplier()>1,run:l.loadGame,getCurrentRom:()=>l.gameName?l.FS.readFile(l.gameName):null,getCurrentGameName:()=>i(l.gameName),setCurrentGameName:_=>{_&&!l.gameName&&(l.gameName=_)},getCurrentSave:()=>l.saveName?l.getSave():null,getCurrentSaveName:()=>i(l.saveName),getFile:_=>l.FS.readFile(_),uploadCheats:l.uploadCheats,uploadRom:l.uploadRom,uploadSaveOrSaveState:l.uploadSaveOrSaveState,deleteSaveState:_=>{const j=i(l.saveName,".ss"+_),k=`${m.saveStatePath}/${j}`;l.FS.unlink(k)},deleteFile:l.FS.unlink,pause:l.pauseGame,resume:l.resumeGame,quitGame:l.quitGame,quitEmulator:l.quitMgba,quickReload:l.quickReload,getCurrentCheatsFile:()=>{const _=i(l.gameName,".cheats"),j=`${m.cheatsPath}/${_}`;return l.FS.analyzePath(j).exists?l.FS.readFile(j):new Uint8Array},getCurrentCheatsFileName:()=>i(l.gameName,".cheats"),screenshot:l.screenshot,remapKeyBindings:_=>_.forEach(j=>l.bindKey(g(j),j.gbaInput)),filePaths:l.filePaths,fsSync:l.FSSync,listAllFiles:p,parseCheatsString:x,parsedCheatsToFile:y}};var Cp=(()=>{var l=import.meta.url;return function(m={}){var i=m,p,x;i.ready=new Promise((e,r)=>{p=e,x=r}),i.loadGame=e=>{if(de("loadGame","number",["string"])(e)){const t=e.split(".");t.pop();const n=t.join(".")+".sav";return i.gameName=e,i.saveName=n.replace("/data/games/","/data/saves/"),!0}return!1},i.getSave=()=>c.readFile(i.saveName),i.listRoms=()=>c.readdir("/data/games/"),i.listSaves=()=>c.readdir("/data/saves/"),i.FSInit=()=>new Promise((e,r)=>{c.mkdir("/data"),c.mount(c.filesystems.IDBFS,{},"/data"),c.syncfs(!0,t=>{t&&r(new Error(`Error syncing app data from IndexedDB: ${t}`));try{c.mkdir("/data/saves")}catch{}try{c.mkdir("/data/states")}catch{}try{c.mkdir("/data/games")}catch{}try{c.mkdir("/data/cheats")}catch{}try{c.mkdir("/data/screenshots")}catch{}e()})}),i.FSSync=()=>new Promise((e,r)=>{c.syncfs(t=>{t&&r(new Error(`Error syncing app data to IndexedDB: ${t}`)),e()})}),i.filePaths=()=>({root:"/data",cheatsPath:"/data/cheats",gamePath:"/data/games",savePath:"/data/saves",saveStatePath:"/data/states",screenshotsPath:"/data/screenshots"}),i.uploadSaveOrSaveState=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="sav")a="/data/saves/";else if(n.startsWith("ss"))a="/data/states/";else{console.warn("unrecognized file extension: "+n);return}const s=new FileReader;s.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},s.readAsArrayBuffer(e)},i.uploadRom=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(["gba","gbc","gb","zip","7z"].includes(n))a="/data/games/";else{console.warn("unrecognized file extension: "+n);return}const s=new FileReader;s.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},s.readAsArrayBuffer(e)},i.uploadCheats=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="cheats")a="/data/cheats/";else{console.warn("unrecognized file extension: "+n);return}const s=new FileReader;s.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},s.readAsArrayBuffer(e)};const y=new Map([["a",0],["b",1],["select",2],["start",3],["right",4],["left",5],["up",6],["down",7],["r",8],["l",9]]);i.buttonPress=e=>{de("buttonPress",null,["number"])(y.get(e.toLowerCase()))},i.buttonUnpress=e=>{de("buttonUnpress",null,["number"])(y.get(e.toLowerCase()))},i.bindKey=(e,r)=>{de("bindKey",null,["string","number"])(e,y.get(r.toLowerCase()))},i.pauseGame=()=>{de("pauseGame",null,[])()},i.resumeGame=()=>{de("resumeGame",null,[])()},i.getVolume=()=>de("getVolume","number",[])(),i.setVolume=e=>{de("setVolume",null,["number"])(e)},i.getMainLoopTimingMode=()=>de("getMainLoopTimingMode","number",[])(),i.getMainLoopTimingValue=()=>de("getMainLoopTimingValue","number",[])(),i.setMainLoopTiming=(e,r)=>{de("setMainLoopTiming","number",["number","number"])(e,r)},i.quitGame=()=>{de("quitGame",null,[])()},i.quitMgba=()=>{de("quitMgba",null,[])()},i.quickReload=()=>{de("quickReload",null,[])()},i.toggleInput=e=>{de("setEventEnable",null,["boolean"])(e)},i.screenshot=e=>de("screenshot","boolean",["string"])(e),i.saveState=e=>de("saveState","boolean",["number"])(e),i.loadState=e=>de("loadState","boolean",["number"])(e),i.saveStateSlot=(e,r)=>{var t=de("saveStateSlot","number",["number","number"]);return i.saveStateSlot=(n,a)=>(a===void 0&&(a=63),t(n,a)),i.saveStateSlot(e,r)},i.loadStateSlot=(e,r)=>{var t=de("loadStateSlot","number",["number","number"]);return i.loadStateSlot=(n,a)=>(a===void 0&&(a=61),t(n,a)),i.loadStateSlot(e,r)},i.autoLoadCheats=()=>de("autoLoadCheats","bool",[])(),i.setFastForwardMultiplier=e=>{de("setFastForwardMultiplier",null,["number"])(e)},i.getFastForwardMultiplier=()=>de("getFastForwardMultiplier","number",[])();var g=Object.assign({},i),_="./this.program",j=(e,r)=>{throw r},k=!0,E="";function L(e){return i.locateFile?i.locateFile(e,E):E+e}var R,$;typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),l&&(E=l),E.startsWith("blob:")?E="":E=E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),R=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},$=(e,r,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){r(n.response);return}t()},n.onerror=t,n.send(null)};var U=i.print||console.log.bind(console),B=i.printErr||console.error.bind(console);Object.assign(i,g),g=null,i.arguments&&i.arguments,i.thisProgram&&(_=i.thisProgram),i.quit&&(j=i.quit);var H;i.wasmBinary&&(H=i.wasmBinary),typeof WebAssembly!="object"&&Ye("no native wasm support detected");var G,Y=!1,te;function K(e,r){e||Ye(r)}var z,q,V,O,f,X,W,oe;function ne(){var e=G.buffer;i.HEAP8=z=new Int8Array(e),i.HEAP16=V=new Int16Array(e),i.HEAPU8=q=new Uint8Array(e),i.HEAPU16=O=new Uint16Array(e),i.HEAP32=f=new Int32Array(e),i.HEAPU32=X=new Uint32Array(e),i.HEAPF32=W=new Float32Array(e),i.HEAPF64=oe=new Float64Array(e)}var _e=[],he=[],Ne=[],Xe=[];function rr(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)Rr(i.preRun.shift());Pr(_e)}function tr(){!i.noFSInit&&!c.init.initialized&&c.init(),c.ignorePermissions=!1,Pr(he)}function fr(){Pr(Ne)}function Fr(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)Pe(i.postRun.shift());Pr(Xe)}function Rr(e){_e.unshift(e)}function fe(e){he.unshift(e)}function Pe(e){Xe.unshift(e)}var Se=0,mr=null;function Ut(e){return e}function rt(e){var r;Se++,(r=i.monitorRunDependencies)==null||r.call(i,Se)}function Tr(e){var t;if(Se--,(t=i.monitorRunDependencies)==null||t.call(i,Se),Se==0&&mr){var r=mr;mr=null,r()}}function Ye(e){var t;(t=i.onAbort)==null||t.call(i,e),e="Aborted("+e+")",B(e),Y=!0,te=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw x(r),r}var ba="data:application/octet-stream;base64,",Ot=e=>e.startsWith(ba),nr;i.locateFile?(nr="mgba.wasm",Ot(nr)||(nr=L(nr))):nr=new URL(""+new URL("mgba-xM1paPxV.wasm",import.meta.url).href,import.meta.url).href;function Gt(e){if(e==nr&&H)return new Uint8Array(H);throw"both async and sync fetching of the wasm failed"}function _a(e){return!H&&k&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at '${e}'`;return r.arrayBuffer()}).catch(()=>Gt(e)):Promise.resolve().then(()=>Gt(e))}function zt(e,r,t){return _a(e).then(n=>WebAssembly.instantiate(n,r)).then(n=>n).then(t,n=>{B(`failed to asynchronously prepare wasm: ${n}`),Ye(n)})}function ya(e,r,t,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!Ot(r)&&typeof fetch=="function"?fetch(r,{credentials:"same-origin"}).then(a=>{var s=WebAssembly.instantiateStreaming(a,t);return s.then(n,function(d){return B(`wasm streaming compile failed: ${d}`),B("falling back to ArrayBuffer instantiation"),zt(r,t,n)})}):zt(r,t,n)}function wa(){var e={a:pm};function r(n,a){return re=n.exports,G=re._d,ne(),Ht=re.ze,fe(re.$d),Tr(),re}rt();function t(n){r(n.instance)}if(i.instantiateWasm)try{return i.instantiateWasm(e,r)}catch(n){B(`Module.instantiateWasm callback failed with error: ${n}`),x(n)}return ya(H,nr,e,t).catch(x),{}}var J,le,qt={272368:(e,r)=>{i.canvas.width=e,i.canvas.height=r},272425:(e,r,t,n,a,s,d)=>{i.version={gitCommit:ke(e),gitShort:ke(r),gitBranch:ke(t),gitRevision:n,binaryName:ke(a),projectName:ke(s),projectVersion:ke(d)}},272657:()=>{c.syncfs(function(e){K(!e)})},272701:()=>typeof AudioContext<"u"?!0:typeof webkitAudioContext<"u",272848:()=>typeof navigator.mediaDevices<"u"&&typeof navigator.mediaDevices.getUserMedia<"u"?!0:typeof navigator.webkitGetUserMedia<"u",273082:e=>{typeof i.SDL2>"u"&&(i.SDL2={});var r=i.SDL2;return e?r.capture={}:r.audio={},r.audioContext||(typeof AudioContext<"u"?r.audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(r.audioContext=new webkitAudioContext),r.audioContext&&Ea(r.audioContext)),r.audioContext===void 0?-1:0},273575:()=>{var e=i.SDL2;return e.audioContext.sampleRate},273643:(e,r,t,n)=>{var a=i.SDL2,s=function(h){a.capture.silenceTimer!==void 0&&(clearTimeout(a.capture.silenceTimer),a.capture.silenceTimer=void 0),a.capture.mediaStreamNode=a.audioContext.createMediaStreamSource(h),a.capture.scriptProcessorNode=a.audioContext.createScriptProcessor(r,e,1),a.capture.scriptProcessorNode.onaudioprocess=function(v){a===void 0||a.capture===void 0||(v.outputBuffer.getChannelData(0).fill(0),a.capture.currentCaptureBuffer=v.inputBuffer,tt("vi",t,[n]))},a.capture.mediaStreamNode.connect(a.capture.scriptProcessorNode),a.capture.scriptProcessorNode.connect(a.audioContext.destination),a.capture.stream=h},d=function(h){};a.capture.silenceBuffer=a.audioContext.createBuffer(e,r,a.audioContext.sampleRate),a.capture.silenceBuffer.getChannelData(0).fill(0);var u=function(){a.capture.currentCaptureBuffer=a.capture.silenceBuffer,tt("vi",t,[n])};a.capture.silenceTimer=setTimeout(u,r/a.audioContext.sampleRate*1e3),navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(s).catch(d):navigator.webkitGetUserMedia!==void 0&&navigator.webkitGetUserMedia({audio:!0,video:!1},s,d)},275295:(e,r,t,n)=>{var a=i.SDL2;a.audio.scriptProcessorNode=a.audioContext.createScriptProcessor(r,0,e),a.audio.scriptProcessorNode.onaudioprocess=function(s){a===void 0||a.audio===void 0||(a.audio.currentOutputBuffer=s.outputBuffer,tt("vi",t,[n]))},a.audio.scriptProcessorNode.connect(a.audioContext.destination)},275705:(e,r)=>{for(var t=i.SDL2,n=t.capture.currentCaptureBuffer.numberOfChannels,a=0;a<n;++a){var s=t.capture.currentCaptureBuffer.getChannelData(a);if(s.length!=r)throw"Web Audio capture buffer length mismatch! Destination size: "+s.length+" samples vs expected "+r+" samples!";if(n==1)for(var d=0;d<r;++d)Wt(e+d*4,s[d],"float");else for(var d=0;d<r;++d)Wt(e+(d*n+a)*4,s[d],"float")}},276310:(e,r)=>{for(var t=i.SDL2,n=t.audio.currentOutputBuffer.numberOfChannels,a=0;a<n;++a){var s=t.audio.currentOutputBuffer.getChannelData(a);if(s.length!=r)throw"Web Audio output buffer length mismatch! Destination size: "+s.length+" samples vs expected "+r+" samples!";for(var d=0;d<r;++d)s[d]=W[e+(d*n+a<<2)>>2]}},276790:e=>{var r=i.SDL2;if(e){if(r.capture.silenceTimer!==void 0&&clearTimeout(r.capture.silenceTimer),r.capture.stream!==void 0){for(var t=r.capture.stream.getAudioTracks(),n=0;n<t.length;n++)r.capture.stream.removeTrack(t[n]);r.capture.stream=void 0}r.capture.scriptProcessorNode!==void 0&&(r.capture.scriptProcessorNode.onaudioprocess=function(a){},r.capture.scriptProcessorNode.disconnect(),r.capture.scriptProcessorNode=void 0),r.capture.mediaStreamNode!==void 0&&(r.capture.mediaStreamNode.disconnect(),r.capture.mediaStreamNode=void 0),r.capture.silenceBuffer!==void 0&&(r.capture.silenceBuffer=void 0),r.capture=void 0}else r.audio.scriptProcessorNode!=null&&(r.audio.scriptProcessorNode.disconnect(),r.audio.scriptProcessorNode=void 0),r.audio=void 0;r.audioContext!==void 0&&r.audio===void 0&&r.capture===void 0&&(r.audioContext.close(),r.audioContext=void 0)},277962:(e,r,t)=>{var n=e,a=r,s=t;i.SDL2||(i.SDL2={});var d=i.SDL2;d.ctxCanvas!==i.canvas&&(d.ctx=i.createContext(i.canvas,!1,!0),d.ctxCanvas=i.canvas),(d.w!==n||d.h!==a||d.imageCtx!==d.ctx)&&(d.image=d.ctx.createImageData(n,a),d.w=n,d.h=a,d.imageCtx=d.ctx);var u=d.image.data,h=s>>2,v=0,w;if(typeof CanvasPixelArray<"u"&&u instanceof CanvasPixelArray)for(w=u.length;v<w;){var F=f[h];u[v]=F&255,u[v+1]=F>>8&255,u[v+2]=F>>16&255,u[v+3]=255,h++,v+=4}else{d.data32Data!==u&&(d.data32=new Int32Array(u.buffer),d.data8=new Uint8Array(u.buffer),d.data32Data=u);var I=d.data32;w=I.length,I.set(f.subarray(h,h+w));var T=d.data8,D=3,Q=D+4*w;if(w%8==0)for(;D<Q;)T[D]=255,D=D+4|0,T[D]=255,D=D+4|0,T[D]=255,D=D+4|0,T[D]=255,D=D+4|0,T[D]=255,D=D+4|0,T[D]=255,D=D+4|0,T[D]=255,D=D+4|0,T[D]=255,D=D+4|0;else for(;D<Q;)T[D]=255,D=D+4|0}d.ctx.putImageData(d.image,0,0)},279431:(e,r,t,n,a)=>{var s=e,d=r,u=t,h=n,v=a,w=document.createElement("canvas");w.width=s,w.height=d;var F=w.getContext("2d"),I=F.createImageData(s,d),T=I.data,D=v>>2,Q=0,ve;if(typeof CanvasPixelArray<"u"&&T instanceof CanvasPixelArray)for(ve=T.length;Q<ve;){var ue=f[D];T[Q]=ue&255,T[Q+1]=ue>>8&255,T[Q+2]=ue>>16&255,T[Q+3]=ue>>24&255,D++,Q+=4}else{var we=new Int32Array(T.buffer);ve=we.length,we.set(f.subarray(D,D+ve))}F.putImageData(I,0,0);var ge=u===0&&h===0?"url("+w.toDataURL()+"), auto":"url("+w.toDataURL()+") "+u+" "+h+", auto",xe=Ae(ge.length+1);return me(ge,xe,ge.length+1),xe},280420:e=>{i.canvas&&(i.canvas.style.cursor=ke(e))},280503:()=>{i.canvas&&(i.canvas.style.cursor="none")},280572:()=>window.innerWidth,280602:()=>window.innerHeight};function Vt(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Sa=(e,r,t)=>{e.addEventListener(r,t,{once:!0})},Ea=(e,r)=>{r||(r=[document,document.getElementById("canvas")]),["keydown","mousedown","touchstart"].forEach(t=>{r.forEach(n=>{n&&Sa(n,t,()=>{e.state==="suspended"&&e.resume()})})})},Pr=e=>{for(;e.length>0;)e.shift()(i)},Ca=(e,r,t)=>{var n=i["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)},Mr=[],Ht,se=e=>{var r=Mr[e];return r||(e>=Mr.length&&(Mr.length=e+1),Mr[e]=r=Ht.get(e)),r},tt=(e,r,t)=>{if(e.includes("j"))return Ca(e,r,t);var n=se(r).apply(null,t);return n},ka=i.noExitRuntime||!0;function Wt(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":z[e>>0]=r;break;case"i8":z[e>>0]=r;break;case"i16":V[e>>1]=r;break;case"i32":f[e>>2]=r;break;case"i64":Ye("to do setValue(i64) use WASM_BIGINT");case"float":W[e>>2]=r;break;case"double":oe[e>>3]=r;break;case"*":X[e>>2]=r;break;default:Ye(`invalid type for setValue: ${t}`)}}var ae={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var t=0,n=e.length-1;n>=0;n--){var a=e[n];a==="."?e.splice(n,1):a===".."?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t;t--)e.unshift("..");return e},normalize:e=>{var r=ae.isAbs(e),t=e.substr(-1)==="/";return e=ae.normalizeArray(e.split("/").filter(n=>!!n),!r).join("/"),!e&&!r&&(e="."),e&&t&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=ae.splitPath(e),t=r[0],n=r[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)},basename:e=>{if(e==="/")return"/";e=ae.normalize(e),e=e.replace(/\/$/,"");var r=e.lastIndexOf("/");return r===-1?e:e.substr(r+1)},join:function(){var e=Array.prototype.slice.call(arguments);return ae.normalize(e.join("/"))},join2:(e,r)=>ae.normalize(e+"/"+r)},ja=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);Ye("initRandomDevice")},Xt=e=>(Xt=ja())(e),Ke={resolve:function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var n=t>=0?arguments[t]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,r=ae.isAbs(n)}return e=ae.normalizeArray(e.split("/").filter(a=>!!a),!r).join("/"),(r?"/":"")+e||"."},relative:(e,r)=>{e=Ke.resolve(e).substr(1),r=Ke.resolve(r).substr(1);function t(v){for(var w=0;w<v.length&&v[w]==="";w++);for(var F=v.length-1;F>=0&&v[F]==="";F--);return w>F?[]:v.slice(w,F-w+1)}for(var n=t(e.split("/")),a=t(r.split("/")),s=Math.min(n.length,a.length),d=s,u=0;u<s;u++)if(n[u]!==a[u]){d=u;break}for(var h=[],u=d;u<n.length;u++)h.push("..");return h=h.concat(a.slice(d)),h.join("/")}},Kt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,pr=(e,r,t)=>{for(var n=r+t,a=r;e[a]&&!(a>=n);)++a;if(a-r>16&&e.buffer&&Kt)return Kt.decode(e.subarray(r,a));for(var s="";r<a;){var d=e[r++];if(!(d&128)){s+=String.fromCharCode(d);continue}var u=e[r++]&63;if((d&224)==192){s+=String.fromCharCode((d&31)<<6|u);continue}var h=e[r++]&63;if((d&240)==224?d=(d&15)<<12|u<<6|h:d=(d&7)<<18|u<<12|h<<6|e[r++]&63,d<65536)s+=String.fromCharCode(d);else{var v=d-65536;s+=String.fromCharCode(55296|v>>10,56320|v&1023)}}return s},nt=[],hr=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},at=(e,r,t,n)=>{if(!(n>0))return 0;for(var a=t,s=t+n-1,d=0;d<e.length;++d){var u=e.charCodeAt(d);if(u>=55296&&u<=57343){var h=e.charCodeAt(++d);u=65536+((u&1023)<<10)|h&1023}if(u<=127){if(t>=s)break;r[t++]=u}else if(u<=2047){if(t+1>=s)break;r[t++]=192|u>>6,r[t++]=128|u&63}else if(u<=65535){if(t+2>=s)break;r[t++]=224|u>>12,r[t++]=128|u>>6&63,r[t++]=128|u&63}else{if(t+3>=s)break;r[t++]=240|u>>18,r[t++]=128|u>>12&63,r[t++]=128|u>>6&63,r[t++]=128|u&63}}return r[t]=0,t-a};function ot(e,r,t){var n=hr(e)+1,a=new Array(n),s=at(e,a,0,a.length);return a.length=s,a}var La=()=>{if(!nt.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"?(e=window.prompt("Input: "),e!==null&&(e+=`
`)):typeof readline=="function"&&(e=readline(),e!==null&&(e+=`
`)),!e)return null;nt=ot(e)}return nt.shift()},ar={ttys:[],init(){},shutdown(){},register(e,r){ar.ttys[e]={input:[],output:[],ops:r},c.registerDevice(e,ar.stream_ops)},stream_ops:{open(e){var r=ar.ttys[e.node.rdev];if(!r)throw new c.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,t,n,a){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var s=0,d=0;d<n;d++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&s===0)throw new c.ErrnoError(6);if(u==null)break;s++,r[t+d]=u}return s&&(e.node.timestamp=Date.now()),s},write(e,r,t,n,a){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var s=0;s<n;s++)e.tty.ops.put_char(e.tty,r[t+s])}catch{throw new c.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),s}},default_tty_ops:{get_char(e){return La()},put_char(e,r){r===null||r===10?(U(pr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(U(pr(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,t){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(B(pr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(B(pr(e.output,0)),e.output=[])}}},Fa=(e,r)=>(q.fill(0,e,e+r),e),Ra=(e,r)=>Math.ceil(e/r)*r,Yt=e=>{e=Ra(e,65536);var r=Rn(65536,e);return r?Fa(r,e):0},ee={ops_table:null,mount(e){return ee.createNode(null,"/",16895,0)},createNode(e,r,t,n){if(c.isBlkdev(t)||c.isFIFO(t))throw new c.ErrnoError(63);ee.ops_table||(ee.ops_table={dir:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,lookup:ee.node_ops.lookup,mknod:ee.node_ops.mknod,rename:ee.node_ops.rename,unlink:ee.node_ops.unlink,rmdir:ee.node_ops.rmdir,readdir:ee.node_ops.readdir,symlink:ee.node_ops.symlink},stream:{llseek:ee.stream_ops.llseek}},file:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:{llseek:ee.stream_ops.llseek,read:ee.stream_ops.read,write:ee.stream_ops.write,allocate:ee.stream_ops.allocate,mmap:ee.stream_ops.mmap,msync:ee.stream_ops.msync}},link:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr,readlink:ee.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ee.node_ops.getattr,setattr:ee.node_ops.setattr},stream:c.chrdev_stream_ops}});var a=c.createNode(e,r,t,n);return c.isDir(a.mode)?(a.node_ops=ee.ops_table.dir.node,a.stream_ops=ee.ops_table.dir.stream,a.contents={}):c.isFile(a.mode)?(a.node_ops=ee.ops_table.file.node,a.stream_ops=ee.ops_table.file.stream,a.usedBytes=0,a.contents=null):c.isLink(a.mode)?(a.node_ops=ee.ops_table.link.node,a.stream_ops=ee.ops_table.link.stream):c.isChrdev(a.mode)&&(a.node_ops=ee.ops_table.chrdev.node,a.stream_ops=ee.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[r]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var t=e.contents?e.contents.length:0;if(!(t>=r)){var n=1024*1024;r=Math.max(r,t*(t<n?2:1.125)>>>0),t!=0&&(r=Math.max(r,256));var a=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var t=e.contents;e.contents=new Uint8Array(r),t&&e.contents.set(t.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=c.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,c.isDir(e.mode)?r.size=4096:c.isFile(e.mode)?r.size=e.usedBytes:c.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.timestamp),r.mtime=new Date(e.timestamp),r.ctime=new Date(e.timestamp),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){r.mode!==void 0&&(e.mode=r.mode),r.timestamp!==void 0&&(e.timestamp=r.timestamp),r.size!==void 0&&ee.resizeFileStorage(e,r.size)},lookup(e,r){throw c.genericErrors[44]},mknod(e,r,t,n){return ee.createNode(e,r,t,n)},rename(e,r,t){if(c.isDir(e.mode)){var n;try{n=c.lookupNode(r,t)}catch{}if(n)for(var a in n.contents)throw new c.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=t,r.contents[t]=e,r.timestamp=e.parent.timestamp,e.parent=r},unlink(e,r){delete e.contents[r],e.timestamp=Date.now()},rmdir(e,r){var t=c.lookupNode(e,r);for(var n in t.contents)throw new c.ErrnoError(55);delete e.contents[r],e.timestamp=Date.now()},readdir(e){var r=[".",".."];for(var t of Object.keys(e.contents))r.push(t);return r},symlink(e,r,t){var n=ee.createNode(e,r,41471,0);return n.link=t,n},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,r,t,n,a){var s=e.node.contents;if(a>=e.node.usedBytes)return 0;var d=Math.min(e.node.usedBytes-a,n);if(d>8&&s.subarray)r.set(s.subarray(a,a+d),t);else for(var u=0;u<d;u++)r[t+u]=s[a+u];return d},write(e,r,t,n,a,s){if(r.buffer===z.buffer&&(s=!1),!n)return 0;var d=e.node;if(d.timestamp=Date.now(),r.subarray&&(!d.contents||d.contents.subarray)){if(s)return d.contents=r.subarray(t,t+n),d.usedBytes=n,n;if(d.usedBytes===0&&a===0)return d.contents=r.slice(t,t+n),d.usedBytes=n,n;if(a+n<=d.usedBytes)return d.contents.set(r.subarray(t,t+n),a),n}if(ee.expandFileStorage(d,a+n),d.contents.subarray&&r.subarray)d.contents.set(r.subarray(t,t+n),a);else for(var u=0;u<n;u++)d.contents[a+u]=r[t+u];return d.usedBytes=Math.max(d.usedBytes,a+n),n},llseek(e,r,t){var n=r;if(t===1?n+=e.position:t===2&&c.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new c.ErrnoError(28);return n},allocate(e,r,t){ee.expandFileStorage(e.node,r+t),e.node.usedBytes=Math.max(e.node.usedBytes,r+t)},mmap(e,r,t,n,a){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var s,d,u=e.node.contents;if(!(a&2)&&u.buffer===z.buffer)d=!1,s=u.byteOffset;else{if((t>0||t+r<u.length)&&(u.subarray?u=u.subarray(t,t+r):u=Array.prototype.slice.call(u,t,t+r)),d=!0,s=Yt(r),!s)throw new c.ErrnoError(48);z.set(u,s)}return{ptr:s,allocated:d}},msync(e,r,t,n,a){return ee.stream_ops.write(e,r,0,n,t,!1),0}}},Ta=(e,r,t,n)=>{var a=`al ${e}`;$(e,s=>{r(new Uint8Array(s)),a&&Tr()},s=>{if(t)t();else throw`Loading data file "${e}" failed.`}),a&&rt()},Pa=(e,r,t,n,a,s)=>{c.createDataFile(e,r,t,n,a,s)},st=i.preloadPlugins||[],Ma=(e,r,t,n)=>{typeof S<"u"&&S.init();var a=!1;return st.forEach(s=>{a||s.canHandle(r)&&(s.handle(e,r,t,n),a=!0)}),a},Aa=(e,r,t,n,a,s,d,u,h,v)=>{var w=r?Ke.resolve(ae.join2(e,r)):e;function F(I){function T(D){v==null||v(),u||Pa(e,r,D,n,a,h),s==null||s(),Tr()}Ma(I,w,T,()=>{d==null||d(),Tr()})||T(I)}rt(),typeof t=="string"?Ta(t,F,d):F(t)},Da=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},t=r[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},it=(e,r)=>{var t=0;return e&&(t|=365),r&&(t|=146),t},ce={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var e=null;return typeof window=="object"&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),K(e,"IDBFS used, but indexedDB not supported"),e},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:function(e){return ee.mount.apply(null,arguments)},syncfs:(e,r,t)=>{ce.getLocalSet(e,(n,a)=>{if(n)return t(n);ce.getRemoteSet(e,(s,d)=>{if(s)return t(s);var u=r?d:a,h=r?a:d;ce.reconcile(u,h,t)})})},quit:()=>{Object.values(ce.dbs).forEach(e=>e.close()),ce.dbs={}},getDB:(e,r)=>{var t=ce.dbs[e];if(t)return r(null,t);var n;try{n=ce.indexedDB().open(e,ce.DB_VERSION)}catch(a){return r(a)}if(!n)return r("Unable to connect to IndexedDB");n.onupgradeneeded=a=>{var s=a.target.result,d=a.target.transaction,u;s.objectStoreNames.contains(ce.DB_STORE_NAME)?u=d.objectStore(ce.DB_STORE_NAME):u=s.createObjectStore(ce.DB_STORE_NAME),u.indexNames.contains("timestamp")||u.createIndex("timestamp","timestamp",{unique:!1})},n.onsuccess=()=>{t=n.result,ce.dbs[e]=t,r(null,t)},n.onerror=a=>{r(a.target.error),a.preventDefault()}},getLocalSet:(e,r)=>{var t={};function n(h){return h!=="."&&h!==".."}function a(h){return v=>ae.join2(h,v)}for(var s=c.readdir(e.mountpoint).filter(n).map(a(e.mountpoint));s.length;){var d=s.pop(),u;try{u=c.stat(d)}catch(h){return r(h)}c.isDir(u.mode)&&s.push.apply(s,c.readdir(d).filter(n).map(a(d))),t[d]={timestamp:u.mtime}}return r(null,{type:"local",entries:t})},getRemoteSet:(e,r)=>{var t={};ce.getDB(e.mountpoint,(n,a)=>{if(n)return r(n);try{var s=a.transaction([ce.DB_STORE_NAME],"readonly");s.onerror=h=>{r(h.target.error),h.preventDefault()};var d=s.objectStore(ce.DB_STORE_NAME),u=d.index("timestamp");u.openKeyCursor().onsuccess=h=>{var v=h.target.result;if(!v)return r(null,{type:"remote",db:a,entries:t});t[v.primaryKey]={timestamp:v.key},v.continue()}}catch(h){return r(h)}})},loadLocalEntry:(e,r)=>{var t,n;try{var a=c.lookupPath(e);n=a.node,t=c.stat(e)}catch(s){return r(s)}return c.isDir(t.mode)?r(null,{timestamp:t.mtime,mode:t.mode}):c.isFile(t.mode)?(n.contents=ee.getFileDataAsTypedArray(n),r(null,{timestamp:t.mtime,mode:t.mode,contents:n.contents})):r(new Error("node type not supported"))},storeLocalEntry:(e,r,t)=>{try{if(c.isDir(r.mode))c.mkdirTree(e,r.mode);else if(c.isFile(r.mode))c.writeFile(e,r.contents,{canOwn:!0});else return t(new Error("node type not supported"));c.chmod(e,r.mode),c.utime(e,r.timestamp,r.timestamp)}catch(n){return t(n)}t(null)},removeLocalEntry:(e,r)=>{try{var t=c.stat(e);c.isDir(t.mode)?c.rmdir(e):c.isFile(t.mode)&&c.unlink(e)}catch(n){return r(n)}r(null)},loadRemoteEntry:(e,r,t)=>{var n=e.get(r);n.onsuccess=a=>t(null,a.target.result),n.onerror=a=>{t(a.target.error),a.preventDefault()}},storeRemoteEntry:(e,r,t,n)=>{try{var a=e.put(t,r)}catch(s){n(s);return}a.onsuccess=s=>n(),a.onerror=s=>{n(s.target.error),s.preventDefault()}},removeRemoteEntry:(e,r,t)=>{var n=e.delete(r);n.onsuccess=a=>t(),n.onerror=a=>{t(a.target.error),a.preventDefault()}},reconcile:(e,r,t)=>{var n=0,a=[];Object.keys(e.entries).forEach(function(F){var I=e.entries[F],T=r.entries[F];(!T||I.timestamp.getTime()!=T.timestamp.getTime())&&(a.push(F),n++)});var s=[];if(Object.keys(r.entries).forEach(function(F){e.entries[F]||(s.push(F),n++)}),!n)return t(null);var d=!1,u=e.type==="remote"?e.db:r.db,h=u.transaction([ce.DB_STORE_NAME],"readwrite"),v=h.objectStore(ce.DB_STORE_NAME);function w(F){if(F&&!d)return d=!0,t(F)}h.onerror=F=>{w(this.error),F.preventDefault()},h.oncomplete=F=>{d||t(null)},a.sort().forEach(F=>{r.type==="local"?ce.loadRemoteEntry(v,F,(I,T)=>{if(I)return w(I);ce.storeLocalEntry(F,T,w)}):ce.loadLocalEntry(F,(I,T)=>{if(I)return w(I);ce.storeRemoteEntry(v,F,T,w)})}),s.sort().reverse().forEach(F=>{r.type==="local"?ce.removeLocalEntry(F,w):ce.removeRemoteEntry(v,F,w)})}},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){this.name="ErrnoError",this.errno=e}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(e,r={}){if(e=Ke.resolve(e),!e)return{path:"",node:null};var t={follow_mount:!0,recurse_count:0};if(r=Object.assign(t,r),r.recurse_count>8)throw new c.ErrnoError(32);for(var n=e.split("/").filter(F=>!!F),a=c.root,s="/",d=0;d<n.length;d++){var u=d===n.length-1;if(u&&r.parent)break;if(a=c.lookupNode(a,n[d]),s=ae.join2(s,n[d]),c.isMountpoint(a)&&(!u||u&&r.follow_mount)&&(a=a.mounted.root),!u||r.follow)for(var h=0;c.isLink(a.mode);){var v=c.readlink(s);s=Ke.resolve(ae.dirname(s),v);var w=c.lookupPath(s,{recurse_count:r.recurse_count+1});if(a=w.node,h++>40)throw new c.ErrnoError(32)}}return{path:s,node:a}},getPath(e){for(var r;;){if(c.isRoot(e)){var t=e.mount.mountpoint;return r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var t=0,n=0;n<r.length;n++)t=(t<<5)-t+r.charCodeAt(n)|0;return(e+t>>>0)%c.nameTable.length},hashAddNode(e){var r=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[r],c.nameTable[r]=e},hashRemoveNode(e){var r=c.hashName(e.parent.id,e.name);if(c.nameTable[r]===e)c.nameTable[r]=e.name_next;else for(var t=c.nameTable[r];t;){if(t.name_next===e){t.name_next=e.name_next;break}t=t.name_next}},lookupNode(e,r){var t=c.mayLookup(e);if(t)throw new c.ErrnoError(t);for(var n=c.hashName(e.id,r),a=c.nameTable[n];a;a=a.name_next){var s=a.name;if(a.parent.id===e.id&&s===r)return a}return c.lookup(e,r)},createNode(e,r,t,n){var a=new c.FSNode(e,r,t,n);return c.hashAddNode(a),a},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return c.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var r=c.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){try{var t=c.lookupNode(e,r);return 20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,r,t){var n;try{n=c.lookupNode(e,r)}catch(s){return s.errno}var a=c.nodePermissions(e,"wx");if(a)return a;if(t){if(!c.isDir(n.mode))return 54;if(c.isRoot(n)||c.getPath(n)===c.cwd())return 10}else if(c.isDir(n.mode))return 31;return 0},mayOpen(e,r){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(r)!=="r"||r&512)?31:c.nodePermissions(e,c.flagsToPermissionString(r)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var r=c.getStream(e);if(!r)throw new c.ErrnoError(8);return r},getStream:e=>c.streams[e],createStream(e,r=-1){return c.FSStream||(c.FSStream=function(){this.shared={}},c.FSStream.prototype={},Object.defineProperties(c.FSStream.prototype,{object:{get(){return this.node},set(t){this.node=t}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(t){this.shared.flags=t}},position:{get(){return this.shared.position},set(t){this.shared.position=t}}})),e=Object.assign(new c.FSStream,e),r==-1&&(r=c.nextfd()),e.fd=r,c.streams[r]=e,e},closeStream(e){c.streams[e]=null},chrdev_stream_ops:{open(e){var t,n;var r=c.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,(n=(t=e.stream_ops).open)==null||n.call(t,e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){c.devices[e]={stream_ops:r}},getDevice:e=>c.devices[e],getMounts(e){for(var r=[],t=[e];t.length;){var n=t.pop();r.push(n),t.push.apply(t,n.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&B(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var t=c.getMounts(c.root.mount),n=0;function a(d){return c.syncFSRequests--,r(d)}function s(d){if(d)return s.errored?void 0:(s.errored=!0,a(d));++n>=t.length&&a(null)}t.forEach(d=>{if(!d.type.syncfs)return s(null);d.type.syncfs(d,e,s)})},mount(e,r,t){var n=t==="/",a=!t,s;if(n&&c.root)throw new c.ErrnoError(10);if(!n&&!a){var d=c.lookupPath(t,{follow_mount:!1});if(t=d.path,s=d.node,c.isMountpoint(s))throw new c.ErrnoError(10);if(!c.isDir(s.mode))throw new c.ErrnoError(54)}var u={type:e,opts:r,mountpoint:t,mounts:[]},h=e.mount(u);return h.mount=u,u.root=h,n?c.root=h:s&&(s.mounted=u,s.mount&&s.mount.mounts.push(u)),h},unmount(e){var r=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(r.node))throw new c.ErrnoError(28);var t=r.node,n=t.mounted,a=c.getMounts(n);Object.keys(c.nameTable).forEach(d=>{for(var u=c.nameTable[d];u;){var h=u.name_next;a.includes(u.mount)&&c.destroyNode(u),u=h}}),t.mounted=null;var s=t.mount.mounts.indexOf(n);t.mount.mounts.splice(s,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,t){var n=c.lookupPath(e,{parent:!0}),a=n.node,s=ae.basename(e);if(!s||s==="."||s==="..")throw new c.ErrnoError(28);var d=c.mayCreate(a,s);if(d)throw new c.ErrnoError(d);if(!a.node_ops.mknod)throw new c.ErrnoError(63);return a.node_ops.mknod(a,s,r,t)},create(e,r){return r=r!==void 0?r:438,r&=4095,r|=32768,c.mknod(e,r,0)},mkdir(e,r){return r=r!==void 0?r:511,r&=1023,r|=16384,c.mknod(e,r,0)},mkdirTree(e,r){for(var t=e.split("/"),n="",a=0;a<t.length;++a)if(t[a]){n+="/"+t[a];try{c.mkdir(n,r)}catch(s){if(s.errno!=20)throw s}}},mkdev(e,r,t){return typeof t>"u"&&(t=r,r=438),r|=8192,c.mknod(e,r,t)},symlink(e,r){if(!Ke.resolve(e))throw new c.ErrnoError(44);var t=c.lookupPath(r,{parent:!0}),n=t.node;if(!n)throw new c.ErrnoError(44);var a=ae.basename(r),s=c.mayCreate(n,a);if(s)throw new c.ErrnoError(s);if(!n.node_ops.symlink)throw new c.ErrnoError(63);return n.node_ops.symlink(n,a,e)},rename(e,r){var t=ae.dirname(e),n=ae.dirname(r),a=ae.basename(e),s=ae.basename(r),d,u,h;if(d=c.lookupPath(e,{parent:!0}),u=d.node,d=c.lookupPath(r,{parent:!0}),h=d.node,!u||!h)throw new c.ErrnoError(44);if(u.mount!==h.mount)throw new c.ErrnoError(75);var v=c.lookupNode(u,a),w=Ke.relative(e,n);if(w.charAt(0)!==".")throw new c.ErrnoError(28);if(w=Ke.relative(r,t),w.charAt(0)!==".")throw new c.ErrnoError(55);var F;try{F=c.lookupNode(h,s)}catch{}if(v!==F){var I=c.isDir(v.mode),T=c.mayDelete(u,a,I);if(T)throw new c.ErrnoError(T);if(T=F?c.mayDelete(h,s,I):c.mayCreate(h,s),T)throw new c.ErrnoError(T);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(v)||F&&c.isMountpoint(F))throw new c.ErrnoError(10);if(h!==u&&(T=c.nodePermissions(u,"w"),T))throw new c.ErrnoError(T);c.hashRemoveNode(v);try{u.node_ops.rename(v,h,s)}catch(D){throw D}finally{c.hashAddNode(v)}}},rmdir(e){var r=c.lookupPath(e,{parent:!0}),t=r.node,n=ae.basename(e),a=c.lookupNode(t,n),s=c.mayDelete(t,n,!0);if(s)throw new c.ErrnoError(s);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.rmdir(t,n),c.destroyNode(a)},readdir(e){var r=c.lookupPath(e,{follow:!0}),t=r.node;if(!t.node_ops.readdir)throw new c.ErrnoError(54);return t.node_ops.readdir(t)},unlink(e){var r=c.lookupPath(e,{parent:!0}),t=r.node;if(!t)throw new c.ErrnoError(44);var n=ae.basename(e),a=c.lookupNode(t,n),s=c.mayDelete(t,n,!1);if(s)throw new c.ErrnoError(s);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.unlink(t,n),c.destroyNode(a)},readlink(e){var r=c.lookupPath(e),t=r.node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return Ke.resolve(c.getPath(t.parent),t.node_ops.readlink(t))},stat(e,r){var t=c.lookupPath(e,{follow:!r}),n=t.node;if(!n)throw new c.ErrnoError(44);if(!n.node_ops.getattr)throw new c.ErrnoError(63);return n.node_ops.getattr(n)},lstat(e){return c.stat(e,!0)},chmod(e,r,t){var n;if(typeof e=="string"){var a=c.lookupPath(e,{follow:!t});n=a.node}else n=e;if(!n.node_ops.setattr)throw new c.ErrnoError(63);n.node_ops.setattr(n,{mode:r&4095|n.mode&-4096,timestamp:Date.now()})},lchmod(e,r){c.chmod(e,r,!0)},fchmod(e,r){var t=c.getStreamChecked(e);c.chmod(t.node,r)},chown(e,r,t,n){var a;if(typeof e=="string"){var s=c.lookupPath(e,{follow:!n});a=s.node}else a=e;if(!a.node_ops.setattr)throw new c.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown(e,r,t){c.chown(e,r,t,!0)},fchown(e,r,t){var n=c.getStreamChecked(e);c.chown(n.node,r,t)},truncate(e,r){if(r<0)throw new c.ErrnoError(28);var t;if(typeof e=="string"){var n=c.lookupPath(e,{follow:!0});t=n.node}else t=e;if(!t.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var a=c.nodePermissions(t,"w");if(a)throw new c.ErrnoError(a);t.node_ops.setattr(t,{size:r,timestamp:Date.now()})},ftruncate(e,r){var t=c.getStreamChecked(e);if(!(t.flags&2097155))throw new c.ErrnoError(28);c.truncate(t.node,r)},utime(e,r,t){var n=c.lookupPath(e,{follow:!0}),a=n.node;a.node_ops.setattr(a,{timestamp:Math.max(r,t)})},open(e,r,t){if(e==="")throw new c.ErrnoError(44);r=typeof r=="string"?Da(r):r,t=typeof t>"u"?438:t,r&64?t=t&4095|32768:t=0;var n;if(typeof e=="object")n=e;else{e=ae.normalize(e);try{var a=c.lookupPath(e,{follow:!(r&131072)});n=a.node}catch{}}var s=!1;if(r&64)if(n){if(r&128)throw new c.ErrnoError(20)}else n=c.mknod(e,t,0),s=!0;if(!n)throw new c.ErrnoError(44);if(c.isChrdev(n.mode)&&(r&=-513),r&65536&&!c.isDir(n.mode))throw new c.ErrnoError(54);if(!s){var d=c.mayOpen(n,r);if(d)throw new c.ErrnoError(d)}r&512&&!s&&c.truncate(n,0),r&=-131713;var u=c.createStream({node:n,path:c.getPath(n),flags:r,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),i.logReadFiles&&!(r&1)&&(c.readFiles||(c.readFiles={}),e in c.readFiles||(c.readFiles[e]=1)),u},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(t!=0&&t!=1&&t!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,t),e.ungotten=[],e.position},read(e,r,t,n,a){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var s=typeof a<"u";if(!s)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var d=e.stream_ops.read(e,r,t,n,a);return s||(e.position+=d),d},write(e,r,t,n,a,s){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,r,t,n,a,s);return d||(e.position+=u),u},allocate(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(r<0||t<=0)throw new c.ErrnoError(28);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(!c.isFile(e.node.mode)&&!c.isDir(e.node.mode))throw new c.ErrnoError(43);if(!e.stream_ops.allocate)throw new c.ErrnoError(138);e.stream_ops.allocate(e,r,t)},mmap(e,r,t,n,a){if(n&2&&!(a&2)&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);return e.stream_ops.mmap(e,r,t,n,a)},msync(e,r,t,n,a){return e.stream_ops.msync?e.stream_ops.msync(e,r,t,n,a):0},munmap:e=>0,ioctl(e,r,t){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,r,t)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var t,n=c.open(e,r.flags),a=c.stat(e),s=a.size,d=new Uint8Array(s);return c.read(n,d,0,s,0),r.encoding==="utf8"?t=pr(d,0):r.encoding==="binary"&&(t=d),c.close(n),t},writeFile(e,r,t={}){t.flags=t.flags||577;var n=c.open(e,t.flags,t.mode);if(typeof r=="string"){var a=new Uint8Array(hr(r)+1),s=at(r,a,0,a.length);c.write(n,a,0,s,void 0,t.canOwn)}else if(ArrayBuffer.isView(r))c.write(n,r,0,r.byteLength,void 0,t.canOwn);else throw new Error("Unsupported data type");c.close(n)},cwd:()=>c.currentPath,chdir(e){var r=c.lookupPath(e,{follow:!0});if(r.node===null)throw new c.ErrnoError(44);if(!c.isDir(r.node.mode))throw new c.ErrnoError(54);var t=c.nodePermissions(r.node,"x");if(t)throw new c.ErrnoError(t);c.currentPath=r.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(n,a,s,d,u)=>d}),c.mkdev("/dev/null",c.makedev(1,3)),ar.register(c.makedev(5,0),ar.default_tty_ops),ar.register(c.makedev(6,0),ar.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),r=0,t=()=>(r===0&&(r=Xt(e).byteLength),e[--r]);c.createDevice("/dev","random",t),c.createDevice("/dev","urandom",t),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var r=c.createNode(e,"fd",16895,73);return r.node_ops={lookup(t,n){var a=+n,s=c.getStreamChecked(a),d={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>s.path}};return d.parent=d,d}},r}},{},"/proc/self/fd")},createStandardStreams(){i.stdin?c.createDevice("/dev","stdin",i.stdin):c.symlink("/dev/tty","/dev/stdin"),i.stdout?c.createDevice("/dev","stdout",null,i.stdout):c.symlink("/dev/tty","/dev/stdout"),i.stderr?c.createDevice("/dev","stderr",null,i.stderr):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){[44].forEach(e=>{c.genericErrors[e]=new c.ErrnoError(e),c.genericErrors[e].stack="<generic error, no stack>"}),c.nameTable=new Array(4096),c.mount(ee,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:ee,IDBFS:ce}},init(e,r,t){c.init.initialized=!0,i.stdin=e||i.stdin,i.stdout=r||i.stdout,i.stderr=t||i.stderr,c.createStandardStreams()},quit(){c.init.initialized=!1;for(var e=0;e<c.streams.length;e++){var r=c.streams[e];r&&c.close(r)}},findObject(e,r){var t=c.analyzePath(e,r);return t.exists?t.object:null},analyzePath(e,r){try{var t=c.lookupPath(e,{follow:!r});e=t.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=c.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=ae.basename(e),t=c.lookupPath(e,{follow:!r}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot=t.path==="/"}catch(a){n.error=a.errno}return n},createPath(e,r,t,n){e=typeof e=="string"?e:c.getPath(e);for(var a=r.split("/").reverse();a.length;){var s=a.pop();if(s){var d=ae.join2(e,s);try{c.mkdir(d)}catch{}e=d}}return d},createFile(e,r,t,n,a){var s=ae.join2(typeof e=="string"?e:c.getPath(e),r),d=it(n,a);return c.create(s,d)},createDataFile(e,r,t,n,a,s){var d=r;e&&(e=typeof e=="string"?e:c.getPath(e),d=r?ae.join2(e,r):e);var u=it(n,a),h=c.create(d,u);if(t){if(typeof t=="string"){for(var v=new Array(t.length),w=0,F=t.length;w<F;++w)v[w]=t.charCodeAt(w);t=v}c.chmod(h,u|146);var I=c.open(h,577);c.write(I,t,0,t.length,0,s),c.close(I),c.chmod(h,u)}},createDevice(e,r,t,n){var a=ae.join2(typeof e=="string"?e:c.getPath(e),r),s=it(!!t,!!n);c.createDevice.major||(c.createDevice.major=64);var d=c.makedev(c.createDevice.major++,0);return c.registerDevice(d,{open(u){u.seekable=!1},close(u){var h;(h=n==null?void 0:n.buffer)!=null&&h.length&&n(10)},read(u,h,v,w,F){for(var I=0,T=0;T<w;T++){var D;try{D=t()}catch{throw new c.ErrnoError(29)}if(D===void 0&&I===0)throw new c.ErrnoError(6);if(D==null)break;I++,h[v+T]=D}return I&&(u.node.timestamp=Date.now()),I},write(u,h,v,w,F){for(var I=0;I<w;I++)try{n(h[v+I])}catch{throw new c.ErrnoError(29)}return w&&(u.node.timestamp=Date.now()),I}}),c.mkdev(a,s,d)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(R)try{e.contents=ot(R(e.url),!0),e.usedBytes=e.contents.length}catch{throw new c.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,r,t,n,a){function s(){this.lengthKnown=!1,this.chunks=[]}if(s.prototype.get=function(T){if(!(T>this.length-1||T<0)){var D=T%this.chunkSize,Q=T/this.chunkSize|0;return this.getter(Q)[D]}},s.prototype.setDataGetter=function(T){this.getter=T},s.prototype.cacheLength=function(){var T=new XMLHttpRequest;if(T.open("HEAD",t,!1),T.send(null),!(T.status>=200&&T.status<300||T.status===304))throw new Error("Couldn't load "+t+". Status: "+T.status);var D=Number(T.getResponseHeader("Content-length")),Q,ve=(Q=T.getResponseHeader("Accept-Ranges"))&&Q==="bytes",ue=(Q=T.getResponseHeader("Content-Encoding"))&&Q==="gzip",we=1024*1024;ve||(we=D);var ge=(Ee,Ie)=>{if(Ee>Ie)throw new Error("invalid range ("+Ee+", "+Ie+") or no bytes requested!");if(Ie>D-1)throw new Error("only "+D+" bytes available! programmer error!");var be=new XMLHttpRequest;if(be.open("GET",t,!1),D!==we&&be.setRequestHeader("Range","bytes="+Ee+"-"+Ie),be.responseType="arraybuffer",be.overrideMimeType&&be.overrideMimeType("text/plain; charset=x-user-defined"),be.send(null),!(be.status>=200&&be.status<300||be.status===304))throw new Error("Couldn't load "+t+". Status: "+be.status);return be.response!==void 0?new Uint8Array(be.response||[]):ot(be.responseText||"")},xe=this;xe.setDataGetter(Ee=>{var Ie=Ee*we,be=(Ee+1)*we-1;if(be=Math.min(be,D-1),typeof xe.chunks[Ee]>"u"&&(xe.chunks[Ee]=ge(Ie,be)),typeof xe.chunks[Ee]>"u")throw new Error("doXHR failed!");return xe.chunks[Ee]}),(ue||!D)&&(we=D=1,D=this.getter(0).length,we=D,U("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=D,this._chunkSize=we,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var d,u}else var u={isDevice:!1,url:t};var h=c.createFile(e,r,u,n,a);u.contents?h.contents=u.contents:u.url&&(h.contents=null,h.url=u.url),Object.defineProperties(h,{usedBytes:{get:function(){return this.contents.length}}});var v={},w=Object.keys(h.stream_ops);w.forEach(I=>{var T=h.stream_ops[I];v[I]=function(){return c.forceLoadFile(h),T.apply(null,arguments)}});function F(I,T,D,Q,ve){var ue=I.node.contents;if(ve>=ue.length)return 0;var we=Math.min(ue.length-ve,Q);if(ue.slice)for(var ge=0;ge<we;ge++)T[D+ge]=ue[ve+ge];else for(var ge=0;ge<we;ge++)T[D+ge]=ue.get(ve+ge);return we}return v.read=(I,T,D,Q,ve)=>(c.forceLoadFile(h),F(I,T,D,Q,ve)),v.mmap=(I,T,D,Q,ve)=>{c.forceLoadFile(h);var ue=Yt(T);if(!ue)throw new c.ErrnoError(48);return F(I,z,ue,T,D),{ptr:ue,allocated:!0}},h.stream_ops=v,h}},ke=(e,r)=>e?pr(q,e,r):"",Z={DEFAULT_POLLMASK:5,calculateAt(e,r,t){if(ae.isAbs(r))return r;var n;if(e===-100)n=c.cwd();else{var a=Z.getStreamFromFD(e);n=a.path}if(r.length==0){if(!t)throw new c.ErrnoError(44);return n}return ae.join2(n,r)},doStat(e,r,t){var n=e(r);f[t>>2]=n.dev,f[t+4>>2]=n.mode,X[t+8>>2]=n.nlink,f[t+12>>2]=n.uid,f[t+16>>2]=n.gid,f[t+20>>2]=n.rdev,le=[n.size>>>0,(J=n.size,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+24>>2]=le[0],f[t+28>>2]=le[1],f[t+32>>2]=4096,f[t+36>>2]=n.blocks;var a=n.atime.getTime(),s=n.mtime.getTime(),d=n.ctime.getTime();return le=[Math.floor(a/1e3)>>>0,(J=Math.floor(a/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+40>>2]=le[0],f[t+44>>2]=le[1],X[t+48>>2]=a%1e3*1e3,le=[Math.floor(s/1e3)>>>0,(J=Math.floor(s/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+56>>2]=le[0],f[t+60>>2]=le[1],X[t+64>>2]=s%1e3*1e3,le=[Math.floor(d/1e3)>>>0,(J=Math.floor(d/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+72>>2]=le[0],f[t+76>>2]=le[1],X[t+80>>2]=d%1e3*1e3,le=[n.ino>>>0,(J=n.ino,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+88>>2]=le[0],f[t+92>>2]=le[1],0},doMsync(e,r,t,n,a){if(!c.isFile(r.node.mode))throw new c.ErrnoError(43);if(n&2)return 0;var s=q.slice(e,e+t);c.msync(r,s,a,t,n)},varargs:void 0,get(){var e=f[+Z.varargs>>2];return Z.varargs+=4,e},getp(){return Z.get()},getStr(e){var r=ke(e);return r},getStreamFromFD(e){var r=c.getStreamChecked(e);return r}};function Ba(e,r,t){Z.varargs=t;try{var n=Z.getStreamFromFD(e);switch(r){case 0:{var a=Z.get();if(a<0)return-28;for(;c.streams[a];)a++;var s;return s=c.createStream(n,a),s.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var a=Z.get();return n.flags|=a,0}case 12:{var a=Z.getp(),d=0;return V[a+d>>1]=2,0}case 13:case 14:return 0}return-28}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Ia(e,r){try{var t=Z.getStreamFromFD(e);return Z.doStat(c.stat,t.path,r)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var vr=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function $a(e,r,t){var n=vr(r,t);try{return isNaN(n)?61:(c.ftruncate(e,n),0)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var me=(e,r,t)=>at(e,q,r,t);function Na(e,r){try{if(r===0)return-28;var t=c.cwd(),n=hr(t)+1;return r<n?-68:(me(t,e,r),n)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Ua(e,r,t){try{var n=Z.getStreamFromFD(e);n.getdents||(n.getdents=c.readdir(n.path));for(var a=280,s=0,d=c.llseek(n,0,1),u=Math.floor(d/a);u<n.getdents.length&&s+a<=t;){var h,v,w=n.getdents[u];if(w===".")h=n.node.id,v=4;else if(w===".."){var F=c.lookupPath(n.path,{parent:!0});h=F.node.id,v=4}else{var I=c.lookupNode(n.node,w);h=I.id,v=c.isChrdev(I.mode)?2:c.isDir(I.mode)?4:c.isLink(I.mode)?10:8}le=[h>>>0,(J=h,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[r+s>>2]=le[0],f[r+s+4>>2]=le[1],le=[(u+1)*a>>>0,(J=(u+1)*a,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[r+s+8>>2]=le[0],f[r+s+12>>2]=le[1],V[r+s+16>>1]=280,z[r+s+18>>0]=v,me(w,r+s+19,256),s+=a,u+=1}return c.llseek(n,u*a,0),s}catch(T){if(typeof c>"u"||T.name!=="ErrnoError")throw T;return-T.errno}}function Oa(e,r,t){Z.varargs=t;try{var n=Z.getStreamFromFD(e);switch(r){case 21509:return n.tty?0:-59;case 21505:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var a=n.tty.ops.ioctl_tcgets(n),s=Z.getp();f[s>>2]=a.c_iflag||0,f[s+4>>2]=a.c_oflag||0,f[s+8>>2]=a.c_cflag||0,f[s+12>>2]=a.c_lflag||0;for(var d=0;d<32;d++)z[s+d+17>>0]=a.c_cc[d]||0;return 0}return 0}case 21510:case 21511:case 21512:return n.tty?0:-59;case 21506:case 21507:case 21508:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){for(var s=Z.getp(),u=f[s>>2],h=f[s+4>>2],v=f[s+8>>2],w=f[s+12>>2],F=[],d=0;d<32;d++)F.push(z[s+d+17>>0]);return n.tty.ops.ioctl_tcsets(n.tty,r,{c_iflag:u,c_oflag:h,c_cflag:v,c_lflag:w,c_cc:F})}return 0}case 21519:{if(!n.tty)return-59;var s=Z.getp();return f[s>>2]=0,0}case 21520:return n.tty?-28:-59;case 21531:{var s=Z.getp();return c.ioctl(n,r,s)}case 21523:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var I=n.tty.ops.ioctl_tiocgwinsz(n.tty),s=Z.getp();V[s>>1]=I[0],V[s+2>>1]=I[1]}return 0}case 21524:return n.tty?0:-59;case 21515:return n.tty?0:-59;default:return-28}}catch(T){if(typeof c>"u"||T.name!=="ErrnoError")throw T;return-T.errno}}function Ga(e,r){try{return e=Z.getStr(e),Z.doStat(c.lstat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function za(e,r,t){try{return r=Z.getStr(r),r=Z.calculateAt(e,r),r=ae.normalize(r),r[r.length-1]==="/"&&(r=r.substr(0,r.length-1)),c.mkdir(r,t,0),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function qa(e,r,t,n){try{r=Z.getStr(r);var a=n&256,s=n&4096;return n=n&-6401,r=Z.calculateAt(e,r,s),Z.doStat(a?c.lstat:c.stat,r,t)}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function Va(e,r,t,n){Z.varargs=n;try{r=Z.getStr(r),r=Z.calculateAt(e,r);var a=n?Z.get():0;return c.open(r,t,a).fd}catch(s){if(typeof c>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function Ha(e,r,t,n){try{if(r=Z.getStr(r),r=Z.calculateAt(e,r),n<=0)return-28;var a=c.readlink(r),s=Math.min(n,hr(a)),d=z[t+s];return me(a,t,n+1),z[t+s]=d,s}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Wa(e){try{return e=Z.getStr(e),c.rmdir(e),0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function Xa(e,r){try{return e=Z.getStr(e),Z.doStat(c.stat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function Ka(e,r,t){try{return r=Z.getStr(r),r=Z.calculateAt(e,r),t===0?c.unlink(r):t===512?c.rmdir(r):Ye("Invalid flags passed to unlinkat"),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var Qt=e=>X[e>>2]+f[e+4>>2]*4294967296;function Ya(e,r,t,n){try{if(r=Z.getStr(r),r=Z.calculateAt(e,r,!0),t){var d=Qt(t),u=f[t+8>>2];a=d*1e3+u/(1e3*1e3),t+=16,d=Qt(t),u=f[t+8>>2],s=d*1e3+u/(1e3*1e3)}else var a=Date.now(),s=a;return c.utime(r,a,s),0}catch(h){if(typeof c>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}var Qa=1,Ja=()=>Qa,Za=()=>{throw 1/0},eo=e=>e%4===0&&(e%100!==0||e%400===0),ro=[0,31,60,91,121,152,182,213,244,274,305,335],to=[0,31,59,90,120,151,181,212,243,273,304,334],Jt=e=>{var r=eo(e.getFullYear()),t=r?ro:to,n=t[e.getMonth()]+e.getDate()-1;return n};function no(e,r,t){var n=vr(e,r),a=new Date(n*1e3);f[t>>2]=a.getSeconds(),f[t+4>>2]=a.getMinutes(),f[t+8>>2]=a.getHours(),f[t+12>>2]=a.getDate(),f[t+16>>2]=a.getMonth(),f[t+20>>2]=a.getFullYear()-1900,f[t+24>>2]=a.getDay();var s=Jt(a)|0;f[t+28>>2]=s,f[t+36>>2]=-(a.getTimezoneOffset()*60);var d=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),h=d.getTimezoneOffset(),v=(u!=h&&a.getTimezoneOffset()==Math.min(h,u))|0;f[t+32>>2]=v}var ao=function(e){var r=(()=>{var t=new Date(f[e+20>>2]+1900,f[e+16>>2],f[e+12>>2],f[e+8>>2],f[e+4>>2],f[e>>2],0),n=f[e+32>>2],a=t.getTimezoneOffset(),s=new Date(t.getFullYear(),0,1),d=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=s.getTimezoneOffset(),h=Math.min(u,d);if(n<0)f[e+32>>2]=+(d!=u&&h==a);else if(n>0!=(h==a)){var v=Math.max(u,d),w=n>0?h:v;t.setTime(t.getTime()+(w-a)*6e4)}f[e+24>>2]=t.getDay();var F=Jt(t)|0;f[e+28>>2]=F,f[e>>2]=t.getSeconds(),f[e+4>>2]=t.getMinutes(),f[e+8>>2]=t.getHours(),f[e+12>>2]=t.getDate(),f[e+16>>2]=t.getMonth(),f[e+20>>2]=t.getYear();var I=t.getTime();return isNaN(I)?-1:I/1e3})();return Fn((J=r,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)),r>>>0};function oo(e,r,t,n,a,s,d,u){var h=vr(a,s);try{if(isNaN(h))return 61;var v=Z.getStreamFromFD(n),w=c.mmap(v,e,h,r,t),F=w.ptr;return f[d>>2]=w.allocated,X[u>>2]=F,0}catch(I){if(typeof c>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}function so(e,r,t,n,a,s,d){var u=vr(s,d);try{return isNaN(u)?61:(Z.doMsync(e,Z.getStreamFromFD(a),r,n,u),0)}catch(h){if(typeof c>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function io(e,r,t,n,a,s,d){var u=vr(s,d);try{if(isNaN(u))return 61;var h=Z.getStreamFromFD(a);t&2&&Z.doMsync(e,h,r,n,u),c.munmap(h)}catch(v){if(typeof c>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}var qe=e=>{var r=hr(e)+1,t=Ae(r);return t&&me(e,t,r),t},lo=(e,r,t)=>{var n=new Date().getFullYear(),a=new Date(n,0,1),s=new Date(n,6,1),d=a.getTimezoneOffset(),u=s.getTimezoneOffset(),h=Math.max(d,u);X[e>>2]=h*60,f[r>>2]=+(d!=u);function v(D){var Q=D.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Q?Q[1]:"GMT"}var w=v(a),F=v(s),I=qe(w),T=qe(F);u<d?(X[t>>2]=I,X[t+4>>2]=T):(X[t>>2]=T,X[t+4>>2]=I)},co=()=>{Ye("")},gr=(e,r)=>{if(S.mainLoop.timingMode=e,S.mainLoop.timingValue=r,!S.mainLoop.func)return 1;if(S.mainLoop.running||(S.mainLoop.running=!0),e==0)S.mainLoop.scheduler=function(){var d=Math.max(0,S.mainLoop.tickStartTime+r-Ar())|0;setTimeout(S.mainLoop.runner,d)},S.mainLoop.method="timeout";else if(e==1)S.mainLoop.scheduler=function(){S.requestAnimationFrame(S.mainLoop.runner)},S.mainLoop.method="rAF";else if(e==2){if(typeof S.setImmediate>"u")if(typeof setImmediate>"u"){var t=[],n="setimmediate",a=s=>{(s.data===n||s.data.target===n)&&(s.stopPropagation(),t.shift()())};addEventListener("message",a,!0),S.setImmediate=function(d){t.push(d),postMessage(n,"*")}}else S.setImmediate=setImmediate;S.mainLoop.scheduler=function(){S.setImmediate(S.mainLoop.runner)},S.mainLoop.method="immediate"}return 0},Ar;Ar=()=>performance.now();var Zt=(e,r,t,n,a)=>{K(!S.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),S.mainLoop.func=e,S.mainLoop.arg=n;var s=S.mainLoop.currentlyRunningMainloop;function d(){return!(s<S.mainLoop.currentlyRunningMainloop)}if(S.mainLoop.running=!1,S.mainLoop.runner=function(){var F,I;if(!Y){if(S.mainLoop.queue.length>0){var h=S.mainLoop.queue.shift();if(h.func(h.arg),S.mainLoop.remainingBlockers){var v=S.mainLoop.remainingBlockers,w=v%1==0?v-1:Math.floor(v);h.counted?S.mainLoop.remainingBlockers=w:(w=w+.5,S.mainLoop.remainingBlockers=(8*v+w)/9)}if(S.mainLoop.updateStatus(),!d())return;setTimeout(S.mainLoop.runner,0);return}if(d()){if(S.mainLoop.currentFrameNumber=S.mainLoop.currentFrameNumber+1|0,S.mainLoop.timingMode==1&&S.mainLoop.timingValue>1&&S.mainLoop.currentFrameNumber%S.mainLoop.timingValue!=0){S.mainLoop.scheduler();return}else S.mainLoop.timingMode==0&&(S.mainLoop.tickStartTime=Ar());S.mainLoop.runIter(e),d()&&(typeof SDL=="object"&&((I=(F=SDL.audio)==null?void 0:F.queueNewAudioData)==null||I.call(F)),S.mainLoop.scheduler())}}},a||(r&&r>0?gr(0,1e3/r):gr(1,1),S.mainLoop.scheduler()),t)throw"unwind"},lt=e=>{if(e instanceof Vt||e=="unwind")return te;j(1,e)},uo=0,en=()=>ka||uo>0,fo=e=>{var r;te=e,en()||((r=i.onExit)==null||r.call(i,e),Y=!0),j(e,new Vt(e))},rn=(e,r)=>{te=e,fo(e)},tn=rn,mo=()=>{if(!en())try{tn(te)}catch(e){lt(e)}},ct=e=>{if(!Y)try{e(),mo()}catch(r){lt(r)}},nn=(e,r)=>setTimeout(()=>{ct(e)},r),S={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){S.mainLoop.scheduler=null,S.mainLoop.currentlyRunningMainloop++},resume(){S.mainLoop.currentlyRunningMainloop++;var e=S.mainLoop.timingMode,r=S.mainLoop.timingValue,t=S.mainLoop.func;S.mainLoop.func=null,Zt(t,0,!1,S.mainLoop.arg,!0),gr(e,r),S.mainLoop.scheduler()},updateStatus(){if(i.setStatus){var e=i.statusMessage||"Please wait...",r=S.mainLoop.remainingBlockers,t=S.mainLoop.expectedBlockers;r?r<t?i.setStatus(e+" ("+(t-r)+"/"+t+")"):i.setStatus(e):i.setStatus("")}},runIter(e){var t;if(!Y){if(i.preMainLoop){var r=i.preMainLoop();if(r===!1)return}ct(e),(t=i.postMainLoop)==null||t.call(i)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(S.initted)return;S.initted=!0;var e={};e.canHandle=function(s){return!i.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(s)},e.handle=function(s,d,u,h){var v=new Blob([s],{type:S.getMimetype(d)});v.size!==s.length&&(v=new Blob([new Uint8Array(s).buffer],{type:S.getMimetype(d)}));var w=URL.createObjectURL(v),F=new Image;F.onload=()=>{K(F.complete,`Image ${d} could not be decoded`);var I=document.createElement("canvas");I.width=F.width,I.height=F.height;var T=I.getContext("2d");T.drawImage(F,0,0),URL.revokeObjectURL(w),u==null||u(s)},F.onerror=I=>{B(`Image ${w} could not be decoded`),h==null||h()},F.src=w},st.push(e);var r={};r.canHandle=function(s){return!i.noAudioDecoding&&s.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(s,d,u,h){var v=!1;function w(D){v||(v=!0,u==null||u(s))}var F=new Blob([s],{type:S.getMimetype(d)}),I=URL.createObjectURL(F),T=new Audio;T.addEventListener("canplaythrough",()=>w(),!1),T.onerror=function(Q){if(v)return;B(`warning: browser could not fully decode audio ${d}, trying slower base64 approach`);function ve(ue){for(var we="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ge="=",xe="",Ee=0,Ie=0,be=0;be<ue.length;be++)for(Ee=Ee<<8|ue[be],Ie+=8;Ie>=6;){var km=Ee>>Ie-6&63;Ie-=6,xe+=we[km]}return Ie==2?(xe+=we[(Ee&3)<<4],xe+=ge+ge):Ie==4&&(xe+=we[(Ee&15)<<2],xe+=ge),xe}T.src="data:audio/x-"+d.substr(-3)+";base64,"+ve(s),w()},T.src=I,nn(()=>{w()},1e4)},st.push(r);function t(){S.pointerLock=document.pointerLockElement===i.canvas||document.mozPointerLockElement===i.canvas||document.webkitPointerLockElement===i.canvas||document.msPointerLockElement===i.canvas}var n=i.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),i.elementPointerLock&&n.addEventListener("click",a=>{!S.pointerLock&&i.canvas.requestPointerLock&&(i.canvas.requestPointerLock(),a.preventDefault())},!1))},createContext(e,r,t,n){if(r&&i.ctx&&e==i.canvas)return i.ctx;var a,s;if(r){var d={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var u in n)d[u]=n[u];typeof C<"u"&&(s=C.createContext(e,d),s&&(a=C.getContext(s).GLctx))}else a=e.getContext("2d");return a?(t&&(r||K(typeof b>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),i.ctx=a,r&&C.makeContextCurrent(s),i.useWebGL=r,S.moduleContextCreatedCallbacks.forEach(h=>h()),S.init()),a):null},destroyContext(e,r,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(e,r){S.lockPointer=e,S.resizeCanvas=r,typeof S.lockPointer>"u"&&(S.lockPointer=!0),typeof S.resizeCanvas>"u"&&(S.resizeCanvas=!1);var t=i.canvas;function n(){var d,u;S.isFullscreen=!1;var s=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===s?(t.exitFullscreen=S.exitFullscreen,S.lockPointer&&t.requestPointerLock(),S.isFullscreen=!0,S.resizeCanvas?S.setFullscreenCanvasSize():S.updateCanvasDimensions(t)):(s.parentNode.insertBefore(t,s),s.parentNode.removeChild(s),S.resizeCanvas?S.setWindowedCanvasSize():S.updateCanvasDimensions(t)),(d=i.onFullScreen)==null||d.call(i,S.isFullscreen),(u=i.onFullscreen)==null||u.call(i,S.isFullscreen)}S.fullscreenHandlersInstalled||(S.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?()=>a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(a.webkitRequestFullScreen?()=>a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),a.requestFullscreen()},exitFullscreen(){if(!S.isFullscreen)return!1;var e=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return e.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(e){var r=Date.now();if(S.nextRAF===0)S.nextRAF=r+1e3/60;else for(;r+2>=S.nextRAF;)S.nextRAF+=1e3/60;var t=Math.max(S.nextRAF-r,0);setTimeout(e,t)},requestAnimationFrame(e){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(e);return}var r=S.fakeRequestAnimationFrame;r(e)},safeSetTimeout(e,r){return nn(e,r)},safeRequestAnimationFrame(e){return S.requestAnimationFrame(()=>{ct(e)})},getMimetype(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta(e){var r=0;switch(e.type){case"DOMMouseScroll":r=e.detail/3;break;case"mousewheel":r=e.wheelDelta/120;break;case"wheel":switch(r=e.deltaY,e.deltaMode){case 0:r/=100;break;case 1:r/=3;break;case 2:r*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return r},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(e,r){var t=i.canvas.getBoundingClientRect(),n=i.canvas.width,a=i.canvas.height,s=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,d=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset,u=e-(s+t.left),h=r-(d+t.top);return u=u*(n/t.width),h=h*(a/t.height),{x:u,y:h}},setMouseCoords(e,r){const{x:t,y:n}=S.calculateMouseCoords(e,r);S.mouseMovementX=t-S.mouseX,S.mouseMovementY=n-S.mouseY,S.mouseX=t,S.mouseY=n},calculateMouseEvent(e){if(S.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?S.mouseMovementX=S.mouseMovementY=0:(S.mouseMovementX=S.getMovementX(e),S.mouseMovementY=S.getMovementY(e)),typeof SDL<"u"?(S.mouseX=SDL.mouseX+S.mouseMovementX,S.mouseY=SDL.mouseY+S.mouseMovementY):(S.mouseX+=S.mouseMovementX,S.mouseY+=S.mouseMovementY);else{if(e.type==="touchstart"||e.type==="touchend"||e.type==="touchmove"){var r=e.touch;if(r===void 0)return;var t=S.calculateMouseCoords(r.pageX,r.pageY);if(e.type==="touchstart")S.lastTouches[r.identifier]=t,S.touches[r.identifier]=t;else if(e.type==="touchend"||e.type==="touchmove"){var n=S.touches[r.identifier];n||(n=t),S.lastTouches[r.identifier]=n,S.touches[r.identifier]=t}return}S.setMouseCoords(e.pageX,e.pageY)}},resizeListeners:[],updateResizeListeners(){var e=i.canvas;S.resizeListeners.forEach(r=>r(e.width,e.height))},setCanvasSize(e,r,t){var n=i.canvas;S.updateCanvasDimensions(n,e,r),t||S.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var e=X[SDL.screen>>2];e=e|8388608,f[SDL.screen>>2]=e}S.updateCanvasDimensions(i.canvas),S.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var e=X[SDL.screen>>2];e=e&-8388609,f[SDL.screen>>2]=e}S.updateCanvasDimensions(i.canvas),S.updateResizeListeners()},updateCanvasDimensions(e,r,t){r&&t?(e.widthNative=r,e.heightNative=t):(r=e.widthNative,t=e.heightNative);var n=r,a=t;if(i.forcedAspectRatio&&i.forcedAspectRatio>0&&(n/a<i.forcedAspectRatio?n=Math.round(a*i.forcedAspectRatio):a=Math.round(n/i.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&typeof screen<"u"){var s=Math.min(screen.width/n,screen.height/a);n=Math.round(n*s),a=Math.round(a*s)}S.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=a&&(e.height=a),typeof e.style<"u"&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=r&&(e.width=r),e.height!=t&&(e.height=t),typeof e.style<"u"&&(n!=r||a!=t?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}},N={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode(e){N.errorCode=e},chooseConfig(e,r,t,n,a){if(e!=62e3)return N.setErrorCode(12296),0;if(r)for(;;){var s=f[r>>2];if(s==12321){var d=f[r+4>>2];N.contextAttributes.alpha=d>0}else if(s==12325){var u=f[r+4>>2];N.contextAttributes.depth=u>0}else if(s==12326){var h=f[r+4>>2];N.contextAttributes.stencil=h>0}else if(s==12337){var v=f[r+4>>2];N.contextAttributes.antialias=v>0}else if(s==12338){var v=f[r+4>>2];N.contextAttributes.antialias=v==1}else if(s==12544){var w=f[r+4>>2];N.contextAttributes.lowLatency=w!=12547}else if(s==12344)break;r+=8}return(!t||!n)&&!a?(N.setErrorCode(12300),0):(a&&(f[a>>2]=1),t&&n>0&&(X[t>>2]=62002),N.setErrorCode(12288),1)}},po=e=>e==12448?(N.setErrorCode(12288),1):(N.setErrorCode(12300),0),ho=(e,r,t,n,a)=>N.chooseConfig(e,r,t,n,a),vo=e=>{var r=e.getExtension("ANGLE_instanced_arrays");if(r)return e.vertexAttribDivisor=(t,n)=>r.vertexAttribDivisorANGLE(t,n),e.drawArraysInstanced=(t,n,a,s)=>r.drawArraysInstancedANGLE(t,n,a,s),e.drawElementsInstanced=(t,n,a,s,d)=>r.drawElementsInstancedANGLE(t,n,a,s,d),1},go=e=>{var r=e.getExtension("OES_vertex_array_object");if(r)return e.createVertexArray=()=>r.createVertexArrayOES(),e.deleteVertexArray=t=>r.deleteVertexArrayOES(t),e.bindVertexArray=t=>r.bindVertexArrayOES(t),e.isVertexArray=t=>r.isVertexArrayOES(t),1},xo=e=>{var r=e.getExtension("WEBGL_draw_buffers");if(r)return e.drawBuffers=(t,n)=>r.drawBuffersWEBGL(t,n),1},bo=e=>!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")),an=function(e){var r=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_half_float","EXT_float_blend","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw"];return(e.getSupportedExtensions()||[]).filter(t=>r.includes(t))},C={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(r){C.lastError||(C.lastError=r)},getNewId:e=>{for(var r=C.counter++,t=e.length;t<r;t++)e[t]=null;return r},getSource:(e,r,t,n)=>{for(var a="",s=0;s<r;++s){var d=n?X[n+s*4>>2]:void 0;a+=ke(X[t+s*4>>2],d)}return a},createContext:(e,r)=>{if(!e.getContextSafariWebGL2Fixed){let a=function(s,d){var u=e.getContextSafariWebGL2Fixed(s,d);return s=="webgl"==u instanceof WebGLRenderingContext?u:null};e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=a}var t=e.getContext("webgl",r);if(!t)return 0;var n=C.registerContext(t,r);return n},registerContext:(e,r)=>{var t=C.getNewId(C.contexts),n={handle:t,attributes:r,version:r.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),C.contexts[t]=n,(typeof r.enableExtensionsByDefault>"u"||r.enableExtensionsByDefault)&&C.initExtensions(n),t},makeContextCurrent:e=>{var r;return C.currentContext=C.contexts[e],i.ctx=b=(r=C.currentContext)==null?void 0:r.GLctx,!(e&&!b)},getContext:e=>C.contexts[e],deleteContext:e=>{C.currentContext===C.contexts[e]&&(C.currentContext=null),typeof M=="object"&&M.removeAllHandlersOnTarget(C.contexts[e].GLctx.canvas),C.contexts[e]&&C.contexts[e].GLctx.canvas&&(C.contexts[e].GLctx.canvas.GLctxObject=void 0),C.contexts[e]=null},initExtensions:e=>{if(e||(e=C.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var r=e.GLctx;vo(r),go(r),xo(r),r.disjointTimerQueryExt=r.getExtension("EXT_disjoint_timer_query"),bo(r),an(r).forEach(t=>{!t.includes("lose_context")&&!t.includes("debug")&&r.getExtension(t)})}}},_o=(e,r,t,n)=>{if(e!=62e3)return N.setErrorCode(12296),0;for(var a=1;;){var s=f[n>>2];if(s==12440)a=f[n+4>>2];else{if(s==12344)break;return N.setErrorCode(12292),0}n+=8}return a!=2?(N.setErrorCode(12293),0):(N.contextAttributes.majorVersion=a-1,N.contextAttributes.minorVersion=0,N.context=C.createContext(i.canvas,N.contextAttributes),N.context!=0?(N.setErrorCode(12288),C.makeContextCurrent(N.context),i.useWebGL=!0,S.moduleContextCreatedCallbacks.forEach(function(d){d()}),C.makeContextCurrent(null),62004):(N.setErrorCode(12297),0))},yo=(e,r,t,n)=>e!=62e3?(N.setErrorCode(12296),0):r!=62002?(N.setErrorCode(12293),0):(N.setErrorCode(12288),62006),wo=(e,r)=>e!=62e3?(N.setErrorCode(12296),0):r!=62004?(N.setErrorCode(12294),0):(C.deleteContext(N.context),N.setErrorCode(12288),N.currentContext==r&&(N.currentContext=0),1),So=(e,r)=>e!=62e3?(N.setErrorCode(12296),0):r!=62006?(N.setErrorCode(12301),1):(N.currentReadSurface==r&&(N.currentReadSurface=0),N.currentDrawSurface==r&&(N.currentDrawSurface=0),N.setErrorCode(12288),1),Eo=(e,r,t,n)=>{if(e!=62e3)return N.setErrorCode(12296),0;if(r!=62002)return N.setErrorCode(12293),0;if(!n)return N.setErrorCode(12300),0;switch(N.setErrorCode(12288),t){case 12320:return f[n>>2]=N.contextAttributes.alpha?32:24,1;case 12321:return f[n>>2]=N.contextAttributes.alpha?8:0,1;case 12322:return f[n>>2]=8,1;case 12323:return f[n>>2]=8,1;case 12324:return f[n>>2]=8,1;case 12325:return f[n>>2]=N.contextAttributes.depth?24:0,1;case 12326:return f[n>>2]=N.contextAttributes.stencil?8:0,1;case 12327:return f[n>>2]=12344,1;case 12328:return f[n>>2]=62002,1;case 12329:return f[n>>2]=0,1;case 12330:return f[n>>2]=4096,1;case 12331:return f[n>>2]=16777216,1;case 12332:return f[n>>2]=4096,1;case 12333:return f[n>>2]=0,1;case 12334:return f[n>>2]=0,1;case 12335:return f[n>>2]=12344,1;case 12337:return f[n>>2]=N.contextAttributes.antialias?4:0,1;case 12338:return f[n>>2]=N.contextAttributes.antialias?1:0,1;case 12339:return f[n>>2]=4,1;case 12340:return f[n>>2]=12344,1;case 12341:case 12342:case 12343:return f[n>>2]=-1,1;case 12345:case 12346:return f[n>>2]=0,1;case 12347:return f[n>>2]=0,1;case 12348:return f[n>>2]=1,1;case 12349:case 12350:return f[n>>2]=0,1;case 12351:return f[n>>2]=12430,1;case 12352:return f[n>>2]=4,1;case 12354:return f[n>>2]=0,1;default:return N.setErrorCode(12292),0}},Co=e=>(N.setErrorCode(12288),e!=0&&e!=1?0:62e3),ko=()=>N.errorCode,jo=(e,r,t)=>e!=62e3?(N.setErrorCode(12296),0):(r&&(f[r>>2]=1),t&&(f[t>>2]=4),N.defaultDisplayInitialized=!0,N.setErrorCode(12288),1),Lo=(e,r,t,n)=>e!=62e3?(N.setErrorCode(12296),0):n!=0&&n!=62004?(N.setErrorCode(12294),0):t!=0&&t!=62006||r!=0&&r!=62006?(N.setErrorCode(12301),0):(C.makeContextCurrent(n?N.context:null),N.currentContext=n,N.currentDrawSurface=r,N.currentReadSurface=t,N.setErrorCode(12288),1),Fo=(e,r)=>{if(e!=62e3)return N.setErrorCode(12296),0;if(N.setErrorCode(12288),N.stringCache[r])return N.stringCache[r];var t;switch(r){case 12371:t=qe("Emscripten");break;case 12372:t=qe("1.4 Emscripten EGL");break;case 12373:t=qe("");break;case 12429:t=qe("OpenGL_ES");break;default:return N.setErrorCode(12300),0}return N.stringCache[r]=t,t},Ro=(e,r)=>{if(!N.defaultDisplayInitialized)N.setErrorCode(12289);else if(!i.ctx)N.setErrorCode(12290);else if(i.ctx.isContextLost())N.setErrorCode(12302);else return N.setErrorCode(12288),1;return 0},To=(e,r)=>e!=62e3?(N.setErrorCode(12296),0):(r==0?gr(0,0):gr(1,r),N.setErrorCode(12288),1),Po=e=>e!=62e3?(N.setErrorCode(12296),0):(N.currentContext=0,N.currentReadSurface=0,N.currentDrawSurface=0,N.defaultDisplayInitialized=!1,N.setErrorCode(12288),1),Mo=()=>(N.setErrorCode(12288),1),Ao=Mo,Do=e=>(N.setErrorCode(12288),1),dt=[],on=(e,r)=>{dt.length=0;for(var t;t=q[e++];){var n=t!=105;n&=t!=112,r+=n&&r%8?4:0,dt.push(t==112?X[r>>2]:t==105?f[r>>2]:oe[r>>3]),r+=n?8:4}return dt},Bo=(e,r,t)=>{var n=on(r,t);return qt[e].apply(null,n)},Io=(e,r,t)=>Bo(e,r,t),$o=(e,r,t,n)=>{var a=on(r,t);return qt[e].apply(null,a)},No=(e,r,t)=>$o(e,r,t),Uo=()=>Date.now(),sn=e=>{var r=De(),t=e();return Be(r),t},M={removeAllEventListeners(){for(;M.eventHandlers.length;)M._removeHandler(M.eventHandlers.length-1);M.deferredCalls=[]},inEventHandler:0,deferredCalls:[],deferCall(e,r,t){function n(d,u){if(d.length!=u.length)return!1;for(var h in d)if(d[h]!=u[h])return!1;return!0}for(var a in M.deferredCalls){var s=M.deferredCalls[a];if(s.targetFunction==e&&n(s.argsList,t))return}M.deferredCalls.push({targetFunction:e,precedence:r,argsList:t}),M.deferredCalls.sort((d,u)=>d.precedence<u.precedence)},removeDeferredCalls(e){for(var r=0;r<M.deferredCalls.length;++r)M.deferredCalls[r].targetFunction==e&&(M.deferredCalls.splice(r,1),--r)},canPerformEventHandlerRequests(){return navigator.userActivation?navigator.userActivation.isActive:M.inEventHandler&&M.currentEventHandler.allowsDeferredCalls},runDeferredCalls(){if(M.canPerformEventHandlerRequests())for(var e=0;e<M.deferredCalls.length;++e){var r=M.deferredCalls[e];M.deferredCalls.splice(e,1),--e,r.targetFunction.apply(null,r.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(e,r)=>{for(var t=0;t<M.eventHandlers.length;++t)M.eventHandlers[t].target==e&&(!r||r==M.eventHandlers[t].eventTypeString)&&M._removeHandler(t--)},_removeHandler(e){var r=M.eventHandlers[e];r.target.removeEventListener(r.eventTypeString,r.eventListenerFunc,r.useCapture),M.eventHandlers.splice(e,1)},registerOrRemoveHandler(e){if(!e.target)return-4;if(e.callbackfunc)e.eventListenerFunc=function(t){++M.inEventHandler,M.currentEventHandler=e,M.runDeferredCalls(),e.handlerFunc(t),M.runDeferredCalls(),--M.inEventHandler},e.target.addEventListener(e.eventTypeString,e.eventListenerFunc,e.useCapture),M.eventHandlers.push(e);else for(var r=0;r<M.eventHandlers.length;++r)M.eventHandlers[r].target==e.target&&M.eventHandlers[r].eventTypeString==e.eventTypeString&&M._removeHandler(r--);return 0},getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":(e==null?void 0:e.nodeName)||"":""},fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},Dr={},Oo=e=>e>2?ke(e):e,Br=[0,document,window],Le=e=>{e=Oo(e);var r=Br[e]||document.querySelector(e);return r},ln=Le,Go=(e,r,t)=>{var n=ln(e);if(!n)return-4;f[r>>2]=n.width,f[t>>2]=n.height},ut=e=>{var r=hr(e)+1,t=Gr(r);return me(e,t,r),t},cn=e=>sn(()=>{var r=Gr(8),t=r+4,n=ut(e.id);Go(n,r,t);var a=[f[r>>2],f[t>>2]];return a}),dn=(e,r,t)=>{var n=ln(e);return n?(n.width=r,n.height=t,0):-4},un=(e,r,t)=>{e.controlTransferredOffscreen?sn(()=>{var n=ut(e.id);dn(n,r,t)}):(e.width=r,e.height=t)},zo=e=>{var r=cn(e),t=r[0],n=r[1],a=e.style.width,s=e.style.height,d=e.style.backgroundColor,u=document.body.style.backgroundColor,h=e.style.paddingLeft,v=e.style.paddingRight,w=e.style.paddingTop,F=e.style.paddingBottom,I=e.style.marginLeft,T=e.style.marginRight,D=e.style.marginTop,Q=e.style.marginBottom,ve=document.body.style.margin,ue=document.documentElement.style.overflow,we=document.body.scroll,ge=e.style.imageRendering;function xe(){var Ee=document.fullscreenElement||document.webkitFullscreenElement;Ee||(document.removeEventListener("fullscreenchange",xe),document.removeEventListener("webkitfullscreenchange",xe),un(e,t,n),e.style.width=a,e.style.height=s,e.style.backgroundColor=d,u||(document.body.style.backgroundColor="white"),document.body.style.backgroundColor=u,e.style.paddingLeft=h,e.style.paddingRight=v,e.style.paddingTop=w,e.style.paddingBottom=F,e.style.marginLeft=I,e.style.marginRight=T,e.style.marginTop=D,e.style.marginBottom=Q,document.body.style.margin=ve,document.documentElement.style.overflow=ue,document.body.scroll=we,e.style.imageRendering=ge,e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,t,n),Dr.canvasResizedCallback&&se(Dr.canvasResizedCallback)(37,0,Dr.canvasResizedCallbackUserData))}return document.addEventListener("fullscreenchange",xe),document.addEventListener("webkitfullscreenchange",xe),xe},ft=(e,r,t)=>{e.style.paddingLeft=e.style.paddingRight=t+"px",e.style.paddingTop=e.style.paddingBottom=r+"px"},Ir=e=>Br.indexOf(e)<0?e.getBoundingClientRect():{left:0,top:0},qo=(e,r)=>{var t=zo(e),n=r.softFullscreen?innerWidth:screen.width,a=r.softFullscreen?innerHeight:screen.height,s=Ir(e),d=s.width,u=s.height,h=cn(e),v=h[0],w=h[1];if(r.scaleMode==3)ft(e,(a-u)/2,(n-d)/2),n=d,a=u;else if(r.scaleMode==2)if(n*w<v*a){var F=w*n/v;ft(e,(a-F)/2,0),a=F}else{var I=v*a/w;ft(e,0,(n-I)/2),n=I}e.style.backgroundColor||(e.style.backgroundColor="black"),document.body.style.backgroundColor||(document.body.style.backgroundColor="black"),e.style.width=n+"px",e.style.height=a+"px",r.filteringMode==1&&(e.style.imageRendering="optimizeSpeed",e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated");var T=r.canvasResolutionScaleMode==2?devicePixelRatio:1;if(r.canvasResolutionScaleMode!=0){var D=n*T|0,Q=a*T|0;un(e,D,Q),e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,D,Q)}return t},mt=(e,r)=>{if((r.scaleMode!=0||r.canvasResolutionScaleMode!=0)&&qo(e,r),e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else return M.fullscreenEnabled()?-3:-1;return Dr=r,r.canvasResizedCallback&&se(r.canvasResizedCallback)(37,0,r.canvasResizedCallbackUserData),0},Vo=()=>{if(!M.fullscreenEnabled())return-1;M.removeDeferredCalls(mt);var e=Br[1];if(e.exitFullscreen)e.fullscreenElement&&e.exitFullscreen();else if(e.webkitExitFullscreen)e.webkitFullscreenElement&&e.webkitExitFullscreen();else return-1;return 0},pt=e=>{if(e.requestPointerLock)e.requestPointerLock();else return document.body.requestPointerLock?-3:-1;return 0},Ho=()=>{if(M.removeDeferredCalls(pt),document.exitPointerLock)document.exitPointerLock();else return-1;return 0},Wo=()=>devicePixelRatio,Xo=(e,r,t)=>{if(e=Le(e),!e)return-4;var n=Ir(e);return oe[r>>3]=n.width,oe[t>>3]=n.height,0},fn=(e,r)=>{oe[e>>3]=r.timestamp;for(var t=0;t<r.axes.length;++t)oe[e+t*8+16>>3]=r.axes[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?oe[e+t*8+528>>3]=r.buttons[t].value:oe[e+t*8+528>>3]=r.buttons[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?f[e+t*4+1040>>2]=r.buttons[t].pressed:f[e+t*4+1040>>2]=r.buttons[t]==1;f[e+1296>>2]=r.connected,f[e+1300>>2]=r.index,f[e+8>>2]=r.axes.length,f[e+12>>2]=r.buttons.length,me(r.id,e+1304,64),me(r.mapping,e+1368,64)},Ko=(e,r)=>e<0||e>=M.lastGamepadState.length?-5:M.lastGamepadState[e]?(fn(r,M.lastGamepadState[e]),0):-7,Yo=(e,r)=>{e&&(f[e>>2]=S.mainLoop.timingMode),r&&(f[r>>2]=S.mainLoop.timingValue)},Qo=()=>M.lastGamepadState.length,Jo=(e,r)=>{f[e>>2]=screen.width,f[r>>2]=screen.height};function Zo(e){b.activeTexture(e)}var es=Zo,rs=(e,r)=>{b.attachShader(C.programs[e],C.shaders[r])},ts=rs,ns=(e,r)=>{b.disjointTimerQueryExt.beginQueryEXT(e,C.queries[r])},as=ns,os=(e,r,t)=>{b.bindAttribLocation(C.programs[e],r,ke(t))},ss=os,is=(e,r)=>{b.bindBuffer(e,C.buffers[r])},ls=is,cs=(e,r)=>{b.bindFramebuffer(e,C.framebuffers[r])},ds=cs,us=(e,r)=>{b.bindRenderbuffer(e,C.renderbuffers[r])},fs=us,ms=(e,r)=>{b.bindTexture(e,C.textures[r])},ps=ms,hs=e=>{b.bindVertexArray(C.vaos[e])},vs=hs,gs=vs;function xs(e,r,t,n){b.blendColor(e,r,t,n)}var bs=xs;function _s(e){b.blendEquation(e)}var ys=_s;function ws(e,r){b.blendEquationSeparate(e,r)}var Ss=ws;function Es(e,r){b.blendFunc(e,r)}var Cs=Es;function ks(e,r,t,n){b.blendFuncSeparate(e,r,t,n)}var js=ks,Ls=(e,r,t,n)=>{b.bufferData(e,t?q.subarray(t,t+r):r,n)},Fs=Ls,Rs=(e,r,t,n)=>{b.bufferSubData(e,r,q.subarray(n,n+t))},Ts=Rs;function Ps(e){return b.checkFramebufferStatus(e)}var Ms=Ps;function As(e){b.clear(e)}var Ds=As;function Bs(e,r,t,n){b.clearColor(e,r,t,n)}var Is=Bs;function $s(e){b.clearDepth(e)}var Ns=$s;function Us(e){b.clearStencil(e)}var Os=Us,Gs=(e,r,t,n)=>{b.colorMask(!!e,!!r,!!t,!!n)},zs=Gs,qs=e=>{b.compileShader(C.shaders[e])},Vs=qs,Hs=(e,r,t,n,a,s,d,u)=>{b.compressedTexImage2D(e,r,t,n,a,s,u?q.subarray(u,u+d):null)},Ws=Hs,Xs=(e,r,t,n,a,s,d,u,h)=>{b.compressedTexSubImage2D(e,r,t,n,a,s,d,h?q.subarray(h,h+u):null)},Ks=Xs;function Ys(e,r,t,n,a,s,d,u){b.copyTexImage2D(e,r,t,n,a,s,d,u)}var Qs=Ys;function Js(e,r,t,n,a,s,d,u){b.copyTexSubImage2D(e,r,t,n,a,s,d,u)}var Zs=Js,ei=()=>{var e=C.getNewId(C.programs),r=b.createProgram();return r.name=e,r.maxUniformLength=r.maxAttributeLength=r.maxUniformBlockNameLength=0,r.uniformIdCounter=1,C.programs[e]=r,e},ri=ei,ti=e=>{var r=C.getNewId(C.shaders);return C.shaders[r]=b.createShader(e),r},ni=ti;function ai(e){b.cullFace(e)}var oi=ai,si=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.buffers[n];a&&(b.deleteBuffer(a),a.name=0,C.buffers[n]=null)}},ii=si,li=(e,r)=>{for(var t=0;t<e;++t){var n=f[r+t*4>>2],a=C.framebuffers[n];a&&(b.deleteFramebuffer(a),a.name=0,C.framebuffers[n]=null)}},ci=li,di=e=>{if(e){var r=C.programs[e];if(!r){C.recordError(1281);return}b.deleteProgram(r),r.name=0,C.programs[e]=null}},ui=di,fi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.queries[n];a&&(b.disjointTimerQueryExt.deleteQueryEXT(a),C.queries[n]=null)}},mi=fi,pi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.renderbuffers[n];a&&(b.deleteRenderbuffer(a),a.name=0,C.renderbuffers[n]=null)}},hi=pi,vi=e=>{if(e){var r=C.shaders[e];if(!r){C.recordError(1281);return}b.deleteShader(r),C.shaders[e]=null}},gi=vi,xi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=C.textures[n];a&&(b.deleteTexture(a),a.name=0,C.textures[n]=null)}},bi=xi,_i=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2];b.deleteVertexArray(C.vaos[n]),C.vaos[n]=null}},yi=_i,wi=yi;function Si(e){b.depthFunc(e)}var Ei=Si,Ci=e=>{b.depthMask(!!e)},ki=Ci;function ji(e,r){b.depthRange(e,r)}var Li=ji,Fi=(e,r)=>{b.detachShader(C.programs[e],C.shaders[r])},Ri=Fi;function Ti(e){b.disable(e)}var Pi=Ti,Mi=e=>{b.disableVertexAttribArray(e)},Ai=Mi,Di=(e,r,t)=>{b.drawArrays(e,r,t)},Bi=Di,Ii=(e,r,t,n)=>{b.drawArraysInstanced(e,r,t,n)},$i=Ii,Ni=$i,mn=[],Ui=(e,r)=>{for(var t=mn[e],n=0;n<e;n++)t[n]=f[r+n*4>>2];b.drawBuffers(t)},Oi=Ui,Gi=Oi,zi=(e,r,t,n)=>{b.drawElements(e,r,t,n)},qi=zi,Vi=(e,r,t,n,a)=>{b.drawElementsInstanced(e,r,t,n,a)},Hi=Vi,Wi=Hi;function Xi(e){b.enable(e)}var Ki=Xi,Yi=e=>{b.enableVertexAttribArray(e)},Qi=Yi,Ji=e=>{b.disjointTimerQueryExt.endQueryEXT(e)},Zi=Ji;function el(){b.finish()}var rl=el;function tl(){b.flush()}var nl=tl,al=(e,r,t,n)=>{b.framebufferRenderbuffer(e,r,t,C.renderbuffers[n])},ol=al,sl=(e,r,t,n,a)=>{b.framebufferTexture2D(e,r,t,C.textures[n],a)},il=sl;function ll(e){b.frontFace(e)}var cl=ll,wr=(e,r,t,n)=>{for(var a=0;a<e;a++){var s=b[t](),d=s&&C.getNewId(n);s?(s.name=d,n[d]=s):C.recordError(1282),f[r+a*4>>2]=d}},dl=(e,r)=>{wr(e,r,"createBuffer",C.buffers)},ul=dl,fl=(e,r)=>{wr(e,r,"createFramebuffer",C.framebuffers)},ml=fl,pl=(e,r)=>{for(var t=0;t<e;t++){var n=b.disjointTimerQueryExt.createQueryEXT();if(!n){for(C.recordError(1282);t<e;)f[r+t++*4>>2]=0;return}var a=C.getNewId(C.queries);n.name=a,C.queries[a]=n,f[r+t*4>>2]=a}},hl=pl,vl=(e,r)=>{wr(e,r,"createRenderbuffer",C.renderbuffers)},gl=vl,xl=(e,r)=>{wr(e,r,"createTexture",C.textures)},bl=xl;function _l(e,r){wr(e,r,"createVertexArray",C.vaos)}var yl=_l,wl=yl;function Sl(e){b.generateMipmap(e)}var El=Sl,pn=(e,r,t,n,a,s,d,u)=>{r=C.programs[r];var h=b[e](r,t);if(h){var v=u&&me(h.name,u,n);a&&(f[a>>2]=v),s&&(f[s>>2]=h.size),d&&(f[d>>2]=h.type)}},Cl=(e,r,t,n,a,s,d)=>{pn("getActiveAttrib",e,r,t,n,a,s,d)},kl=Cl,jl=(e,r,t,n,a,s,d)=>{pn("getActiveUniform",e,r,t,n,a,s,d)},Ll=jl,Fl=(e,r,t,n)=>{var a=b.getAttachedShaders(C.programs[e]),s=a.length;s>r&&(s=r),f[t>>2]=s;for(var d=0;d<s;++d){var u=C.shaders.indexOf(a[d]);f[n+d*4>>2]=u}},Rl=Fl,Tl=(e,r)=>b.getAttribLocation(C.programs[e],ke(r)),Pl=Tl,hn=(e,r)=>{X[e>>2]=r;var t=X[e>>2];X[e+4>>2]=(r-t)/4294967296},ht=(e,r,t)=>{if(!r){C.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:t!=0&&t!=1&&C.recordError(1280);return;case 36345:n=0;break;case 34466:var a=b.getParameter(34467);n=a?a.length:0;break}if(n===void 0){var s=b.getParameter(e);switch(typeof s){case"number":n=s;break;case"boolean":n=s?1:0;break;case"string":C.recordError(1280);return;case"object":if(s===null)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:{n=0;break}default:{C.recordError(1280);return}}else if(s instanceof Float32Array||s instanceof Uint32Array||s instanceof Int32Array||s instanceof Array){for(var d=0;d<s.length;++d)switch(t){case 0:f[r+d*4>>2]=s[d];break;case 2:W[r+d*4>>2]=s[d];break;case 4:z[r+d>>0]=s[d]?1:0;break}return}else try{n=s.name|0}catch(u){C.recordError(1280),B(`GL_INVALID_ENUM in glGet${t}v: Unknown object returned from WebGL getParameter(${e})! (error: ${u})`);return}break;default:C.recordError(1280),B(`GL_INVALID_ENUM in glGet${t}v: Native code calling glGet${t}v(${e}) and it returns ${s} of type ${typeof s}!`);return}}switch(t){case 1:hn(r,n);break;case 0:f[r>>2]=n;break;case 2:W[r>>2]=n;break;case 4:z[r>>0]=n?1:0;break}},Ml=(e,r)=>ht(e,r,4),Al=Ml,Dl=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=b.getBufferParameter(e,r)},Bl=Dl,Il=()=>{var e=b.getError()||C.lastError;return C.lastError=0,e},$l=Il,Nl=(e,r)=>ht(e,r,2),Ul=Nl,Ol=(e,r,t,n)=>{var a=b.getFramebufferAttachmentParameter(e,r,t);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=a.name|0),f[n>>2]=a},Gl=Ol,zl=(e,r)=>ht(e,r,0),ql=zl,Vl=(e,r,t,n)=>{var a=b.getProgramInfoLog(C.programs[e]);a===null&&(a="(unknown error)");var s=r>0&&n?me(a,n,r):0;t&&(f[t>>2]=s)},Hl=Vl,Wl=(e,r,t)=>{if(!t){C.recordError(1281);return}if(e>=C.counter){C.recordError(1281);return}if(e=C.programs[e],r==35716){var n=b.getProgramInfoLog(e);n===null&&(n="(unknown error)"),f[t>>2]=n.length+1}else if(r==35719){if(!e.maxUniformLength)for(var a=0;a<b.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,b.getActiveUniform(e,a).name.length+1);f[t>>2]=e.maxUniformLength}else if(r==35722){if(!e.maxAttributeLength)for(var a=0;a<b.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,b.getActiveAttrib(e,a).name.length+1);f[t>>2]=e.maxAttributeLength}else if(r==35381){if(!e.maxUniformBlockNameLength)for(var a=0;a<b.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,b.getActiveUniformBlockName(e,a).length+1);f[t>>2]=e.maxUniformBlockNameLength}else f[t>>2]=b.getProgramParameter(e,r)},Xl=Wl,vn=(e,r,t)=>{if(!t){C.recordError(1281);return}var n=C.queries[e],a;a=b.disjointTimerQueryExt.getQueryObjectEXT(n,r);var s;typeof a=="boolean"?s=a?1:0:s=a,hn(t,s)},Kl=vn,gn=(e,r,t)=>{if(!t){C.recordError(1281);return}var n=C.queries[e],a=b.disjointTimerQueryExt.getQueryObjectEXT(n,r),s;typeof a=="boolean"?s=a?1:0:s=a,f[t>>2]=s},Yl=gn,Ql=vn,Jl=Ql,Zl=gn,ec=Zl,rc=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=b.disjointTimerQueryExt.getQueryEXT(e,r)},tc=rc,nc=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=b.getRenderbufferParameter(e,r)},ac=nc,oc=(e,r,t,n)=>{var a=b.getShaderInfoLog(C.shaders[e]);a===null&&(a="(unknown error)");var s=r>0&&n?me(a,n,r):0;t&&(f[t>>2]=s)},sc=oc,ic=(e,r,t,n)=>{var a=b.getShaderPrecisionFormat(e,r);f[t>>2]=a.rangeMin,f[t+4>>2]=a.rangeMax,f[n>>2]=a.precision},lc=ic,cc=(e,r,t,n)=>{var a=b.getShaderSource(C.shaders[e]);if(a){var s=r>0&&n?me(a,n,r):0;t&&(f[t>>2]=s)}},dc=cc,uc=(e,r,t)=>{if(!t){C.recordError(1281);return}if(r==35716){var n=b.getShaderInfoLog(C.shaders[e]);n===null&&(n="(unknown error)");var a=n?n.length+1:0;f[t>>2]=a}else if(r==35720){var s=b.getShaderSource(C.shaders[e]),d=s?s.length+1:0;f[t>>2]=d}else f[t>>2]=b.getShaderParameter(C.shaders[e],r)},fc=uc,mc=function(){var r=an(b);return r=r.concat(r.map(t=>"GL_"+t)),r},pc=e=>{var r=C.stringCache[e];if(!r){switch(e){case 7939:r=qe(mc().join(" "));break;case 7936:case 7937:case 37445:case 37446:var t=b.getParameter(e);t||C.recordError(1280),r=t?qe(t):0;break;case 7938:var n=b.getParameter(7938);n=`OpenGL ES 2.0 (${n})`,r=qe(n);break;case 35724:var a=b.getParameter(35724),s=/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/,d=a.match(s);d!==null&&(d[1].length==3&&(d[1]=d[1]+"0"),a=`OpenGL ES GLSL ES ${d[1]} (${a})`),r=qe(a);break;default:C.recordError(1280)}C.stringCache[e]=r}return r},hc=pc,vc=(e,r,t)=>{if(!t){C.recordError(1281);return}W[t>>2]=b.getTexParameter(e,r)},gc=vc,xc=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=b.getTexParameter(e,r)},bc=xc,_c=e=>parseInt(e),xn=e=>e.slice(-1)=="]"&&e.lastIndexOf("["),bn=e=>{var r=e.uniformLocsById,t=e.uniformSizeAndIdsByName,n,a;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},n=0;n<b.getProgramParameter(e,35718);++n){var s=b.getActiveUniform(e,n),d=s.name,u=s.size,h=xn(d),v=h>0?d.slice(0,h):d,w=e.uniformIdCounter;for(e.uniformIdCounter+=u,t[v]=[u,w],a=0;a<u;++a)r[w]=a,e.uniformArrayNamesById[w++]=v}},yc=(e,r)=>{if(r=ke(r),e=C.programs[e]){bn(e);var t=e.uniformLocsById,n=0,a=r,s=xn(r);s>0&&(n=_c(r.slice(s+1))>>>0,a=r.slice(0,s));var d=e.uniformSizeAndIdsByName[a];if(d&&n<d[0]&&(n+=d[1],t[n]=t[n]||b.getUniformLocation(e,r)))return n}else C.recordError(1281);return-1},wc=yc,ye=e=>{var r=b.currentProgram;if(r){var t=r.uniformLocsById[e];return typeof t=="number"&&(r.uniformLocsById[e]=t=b.getUniformLocation(r,r.uniformArrayNamesById[e]+(t>0?`[${t}]`:""))),t}else C.recordError(1282)},_n=(e,r,t,n)=>{if(!t){C.recordError(1281);return}e=C.programs[e],bn(e);var a=b.getUniform(e,ye(r));if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:W[t>>2]=a;break}else for(var s=0;s<a.length;s++)switch(n){case 0:f[t+s*4>>2]=a[s];break;case 2:W[t+s*4>>2]=a[s];break}},Sc=(e,r,t)=>{_n(e,r,t,2)},Ec=Sc,Cc=(e,r,t)=>{_n(e,r,t,0)},kc=Cc,jc=(e,r,t)=>{if(!t){C.recordError(1281);return}f[t>>2]=b.getVertexAttribOffset(e,r)},Lc=jc,yn=(e,r,t,n)=>{if(!t){C.recordError(1281);return}var a=b.getVertexAttrib(e,r);if(r==34975)f[t>>2]=a&&a.name;else if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:W[t>>2]=a;break;case 5:f[t>>2]=Math.fround(a);break}else for(var s=0;s<a.length;s++)switch(n){case 0:f[t+s*4>>2]=a[s];break;case 2:W[t+s*4>>2]=a[s];break;case 5:f[t+s*4>>2]=Math.fround(a[s]);break}},Fc=(e,r,t)=>{yn(e,r,t,2)},Rc=Fc,Tc=(e,r,t)=>{yn(e,r,t,5)},Pc=Tc;function Mc(e,r){b.hint(e,r)}var Ac=Mc,Dc=e=>{var r=C.buffers[e];return r?b.isBuffer(r):0},Bc=Dc;function Ic(e){return b.isEnabled(e)}var $c=Ic,Nc=e=>{var r=C.framebuffers[e];return r?b.isFramebuffer(r):0},Uc=Nc,Oc=e=>(e=C.programs[e],e?b.isProgram(e):0),Gc=Oc,zc=e=>{var r=C.queries[e];return r?b.disjointTimerQueryExt.isQueryEXT(r):0},qc=zc,Vc=e=>{var r=C.renderbuffers[e];return r?b.isRenderbuffer(r):0},Hc=Vc,Wc=e=>{var r=C.shaders[e];return r?b.isShader(r):0},Xc=Wc,Kc=e=>{var r=C.textures[e];return r?b.isTexture(r):0},Yc=Kc,Qc=e=>{var r=C.vaos[e];return r?b.isVertexArray(r):0},Jc=Qc,Zc=Jc;function ed(e){b.lineWidth(e)}var rd=ed,td=e=>{e=C.programs[e],b.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},nd=td,ad=(e,r)=>{e==3317&&(C.unpackAlignment=r),b.pixelStorei(e,r)},od=ad;function sd(e,r){b.polygonOffset(e,r)}var id=sd,ld=(e,r)=>{b.disjointTimerQueryExt.queryCounterEXT(C.queries[e],r)},cd=ld,dd=(e,r,t,n)=>{function a(u,h){return u+h-1&-h}var s=e*t,d=a(s,n);return r*d},ud=e=>{var r={5:3,6:4,8:2,29502:3,29504:4};return r[e-6402]||1},fd=e=>(e-=5120,e==1?q:e==4?f:e==6?W:e==5||e==28922?X:O),md=e=>31-Math.clz32(e.BYTES_PER_ELEMENT),vt=(e,r,t,n,a,s)=>{var d=fd(e),u=md(d),h=1<<u,v=ud(r)*h,w=dd(t,n,v,C.unpackAlignment);return d.subarray(a>>u,a+w>>u)},pd=(e,r,t,n,a,s,d)=>{var u=vt(s,a,t,n,d);if(!u){C.recordError(1280);return}b.readPixels(e,r,t,n,a,s,u)},hd=pd,vd=()=>{},gd=vd;function xd(e,r,t,n){b.renderbufferStorage(e,r,t,n)}var bd=xd,_d=(e,r)=>{b.sampleCoverage(e,!!r)},yd=_d;function wd(e,r,t,n){b.scissor(e,r,t,n)}var Sd=wd,Ed=(e,r,t,n,a)=>{C.recordError(1280)},Cd=Ed,kd=(e,r,t,n)=>{var a=C.getSource(e,r,t,n);b.shaderSource(C.shaders[e],a)},jd=kd;function Ld(e,r,t){b.stencilFunc(e,r,t)}var Fd=Ld;function Rd(e,r,t,n){b.stencilFuncSeparate(e,r,t,n)}var Td=Rd;function Pd(e){b.stencilMask(e)}var Md=Pd;function Ad(e,r){b.stencilMaskSeparate(e,r)}var Dd=Ad;function Bd(e,r,t){b.stencilOp(e,r,t)}var Id=Bd;function $d(e,r,t,n){b.stencilOpSeparate(e,r,t,n)}var Nd=$d,Ud=(e,r,t,n,a,s,d,u,h)=>{b.texImage2D(e,r,t,n,a,s,d,u,h?vt(u,d,n,a,h):null)},Od=Ud;function Gd(e,r,t){b.texParameterf(e,r,t)}var zd=Gd,qd=(e,r,t)=>{var n=W[t>>2];b.texParameterf(e,r,n)},Vd=qd;function Hd(e,r,t){b.texParameteri(e,r,t)}var Wd=Hd,Xd=(e,r,t)=>{var n=f[t>>2];b.texParameteri(e,r,n)},Kd=Xd,Yd=(e,r,t,n,a,s,d,u,h)=>{var v=null;h&&(v=vt(u,d,a,s,h)),b.texSubImage2D(e,r,t,n,a,s,d,u,v)},Qd=Yd,Jd=(e,r)=>{b.uniform1f(ye(e),r)},Zd=Jd,Qe=[],eu=(e,r,t)=>{if(r<=288)for(var n=Qe[r-1],a=0;a<r;++a)n[a]=W[t+4*a>>2];else var n=W.subarray(t>>2,t+r*4>>2);b.uniform1fv(ye(e),n)},ru=eu,tu=(e,r)=>{b.uniform1i(ye(e),r)},nu=tu,Sr=[],au=(e,r,t)=>{if(r<=288)for(var n=Sr[r-1],a=0;a<r;++a)n[a]=f[t+4*a>>2];else var n=f.subarray(t>>2,t+r*4>>2);b.uniform1iv(ye(e),n)},ou=au,su=(e,r,t)=>{b.uniform2f(ye(e),r,t)},iu=su,lu=(e,r,t)=>{if(r<=144)for(var n=Qe[2*r-1],a=0;a<2*r;a+=2)n[a]=W[t+4*a>>2],n[a+1]=W[t+(4*a+4)>>2];else var n=W.subarray(t>>2,t+r*8>>2);b.uniform2fv(ye(e),n)},cu=lu,du=(e,r,t)=>{b.uniform2i(ye(e),r,t)},uu=du,fu=(e,r,t)=>{if(r<=144)for(var n=Sr[2*r-1],a=0;a<2*r;a+=2)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2];else var n=f.subarray(t>>2,t+r*8>>2);b.uniform2iv(ye(e),n)},mu=fu,pu=(e,r,t,n)=>{b.uniform3f(ye(e),r,t,n)},hu=pu,vu=(e,r,t)=>{if(r<=96)for(var n=Qe[3*r-1],a=0;a<3*r;a+=3)n[a]=W[t+4*a>>2],n[a+1]=W[t+(4*a+4)>>2],n[a+2]=W[t+(4*a+8)>>2];else var n=W.subarray(t>>2,t+r*12>>2);b.uniform3fv(ye(e),n)},gu=vu,xu=(e,r,t,n)=>{b.uniform3i(ye(e),r,t,n)},bu=xu,_u=(e,r,t)=>{if(r<=96)for(var n=Sr[3*r-1],a=0;a<3*r;a+=3)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2];else var n=f.subarray(t>>2,t+r*12>>2);b.uniform3iv(ye(e),n)},yu=_u,wu=(e,r,t,n,a)=>{b.uniform4f(ye(e),r,t,n,a)},Su=wu,Eu=(e,r,t)=>{if(r<=72){var n=Qe[4*r-1],a=W;t>>=2;for(var s=0;s<4*r;s+=4){var d=t+s;n[s]=a[d],n[s+1]=a[d+1],n[s+2]=a[d+2],n[s+3]=a[d+3]}}else var n=W.subarray(t>>2,t+r*16>>2);b.uniform4fv(ye(e),n)},Cu=Eu,ku=(e,r,t,n,a)=>{b.uniform4i(ye(e),r,t,n,a)},ju=ku,Lu=(e,r,t)=>{if(r<=72)for(var n=Sr[4*r-1],a=0;a<4*r;a+=4)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2],n[a+3]=f[t+(4*a+12)>>2];else var n=f.subarray(t>>2,t+r*16>>2);b.uniform4iv(ye(e),n)},Fu=Lu,Ru=(e,r,t,n)=>{if(r<=72)for(var a=Qe[4*r-1],s=0;s<4*r;s+=4)a[s]=W[n+4*s>>2],a[s+1]=W[n+(4*s+4)>>2],a[s+2]=W[n+(4*s+8)>>2],a[s+3]=W[n+(4*s+12)>>2];else var a=W.subarray(n>>2,n+r*16>>2);b.uniformMatrix2fv(ye(e),!!t,a)},Tu=Ru,Pu=(e,r,t,n)=>{if(r<=32)for(var a=Qe[9*r-1],s=0;s<9*r;s+=9)a[s]=W[n+4*s>>2],a[s+1]=W[n+(4*s+4)>>2],a[s+2]=W[n+(4*s+8)>>2],a[s+3]=W[n+(4*s+12)>>2],a[s+4]=W[n+(4*s+16)>>2],a[s+5]=W[n+(4*s+20)>>2],a[s+6]=W[n+(4*s+24)>>2],a[s+7]=W[n+(4*s+28)>>2],a[s+8]=W[n+(4*s+32)>>2];else var a=W.subarray(n>>2,n+r*36>>2);b.uniformMatrix3fv(ye(e),!!t,a)},Mu=Pu,Au=(e,r,t,n)=>{if(r<=18){var a=Qe[16*r-1],s=W;n>>=2;for(var d=0;d<16*r;d+=16){var u=n+d;a[d]=s[u],a[d+1]=s[u+1],a[d+2]=s[u+2],a[d+3]=s[u+3],a[d+4]=s[u+4],a[d+5]=s[u+5],a[d+6]=s[u+6],a[d+7]=s[u+7],a[d+8]=s[u+8],a[d+9]=s[u+9],a[d+10]=s[u+10],a[d+11]=s[u+11],a[d+12]=s[u+12],a[d+13]=s[u+13],a[d+14]=s[u+14],a[d+15]=s[u+15]}}else var a=W.subarray(n>>2,n+r*64>>2);b.uniformMatrix4fv(ye(e),!!t,a)},Du=Au,Bu=e=>{e=C.programs[e],b.useProgram(e),b.currentProgram=e},Iu=Bu,$u=e=>{b.validateProgram(C.programs[e])},Nu=$u;function Uu(e,r){b.vertexAttrib1f(e,r)}var Ou=Uu,Gu=(e,r)=>{b.vertexAttrib1f(e,W[r>>2])},zu=Gu;function qu(e,r,t){b.vertexAttrib2f(e,r,t)}var Vu=qu,Hu=(e,r)=>{b.vertexAttrib2f(e,W[r>>2],W[r+4>>2])},Wu=Hu;function Xu(e,r,t,n){b.vertexAttrib3f(e,r,t,n)}var Ku=Xu,Yu=(e,r)=>{b.vertexAttrib3f(e,W[r>>2],W[r+4>>2],W[r+8>>2])},Qu=Yu;function Ju(e,r,t,n,a){b.vertexAttrib4f(e,r,t,n,a)}var Zu=Ju,ef=(e,r)=>{b.vertexAttrib4f(e,W[r>>2],W[r+4>>2],W[r+8>>2],W[r+12>>2])},rf=ef,tf=(e,r)=>{b.vertexAttribDivisor(e,r)},nf=tf,af=nf,of=(e,r,t,n,a,s)=>{b.vertexAttribPointer(e,r,t,!!n,a,s)},sf=of;function lf(e,r,t,n){b.viewport(e,r,t,n)}var cf=lf,df=()=>0,uf=(e,r,t)=>q.copyWithin(e,r,r+t),ff=()=>{S.mainLoop.pause()},mf=(e,r)=>{if(!M.fullscreenEnabled())return-1;if(e=Le(e),!e)return-4;if(!e.requestFullscreen&&!e.webkitRequestFullscreen)return-3;var t=M.canPerformEventHandlerRequests();return t?mt(e,r):r.deferUntilInEventHandler?(M.deferCall(mt,1,[e,r]),1):-2},pf=(e,r,t)=>{var n={scaleMode:f[t>>2],canvasResolutionScaleMode:f[t+4>>2],filteringMode:f[t+8>>2],deferUntilInEventHandler:r,canvasResizedCallback:f[t+12>>2],canvasResizedCallbackUserData:f[t+16>>2]};return mf(e,n)},hf=(e,r)=>{if(e=Le(e),!e)return-4;if(!e.requestPointerLock)return-1;var t=M.canPerformEventHandlerRequests();return t?pt(e):r?(M.deferCall(pt,2,[e]),1):-2},vf=()=>2147483648,gf=e=>{var r=G.buffer,t=(e-r.byteLength+65535)/65536;try{return G.grow(t),ne(),1}catch{}},xf=e=>{var r=q.length;e>>>=0;var t=vf();if(e>t)return!1;for(var n=(h,v)=>h+(v-h%v)%v,a=1;a<=4;a*=2){var s=r*(1+.2/a);s=Math.min(s,e+100663296);var d=Math.min(t,n(Math.max(e,s),65536)),u=gf(d);if(u)return!0}return!1},bf=()=>{S.mainLoop.resume()},gt=()=>{try{if(navigator.getGamepads)return(M.lastGamepadState=navigator.getGamepads())?0:-1}catch{navigator.getGamepads=null}return-1},_f=(e,r,t,n,a,s)=>{var d=(h=event)=>{var v=se(n)(a,0,r);if(v&&(v=ke(v)),v)return h.preventDefault(),h.returnValue=v,v},u={target:Le(e),eventTypeString:s,callbackfunc:n,handlerFunc:d,useCapture:t};return M.registerOrRemoveHandler(u)},yf=(e,r,t)=>typeof onbeforeunload>"u"?-1:t!==1?-5:_f(2,e,!0,r,28,"beforeunload"),wn=(e,r,t,n,a,s,d)=>{M.focusEvent||(M.focusEvent=Ae(256));var u=(v=event)=>{var w=M.getNodeNameForTarget(v.target),F=v.target.id?v.target.id:"",I=M.focusEvent;me(w,I+0,128),me(F,I+128,128),se(n)(a,I,r)&&v.preventDefault()},h={target:Le(e),eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},wf=(e,r,t,n,a)=>wn(e,r,t,n,12,"blur"),Sf=(e,r,t)=>(e=Le(e),e?(e.style.width=r+"px",e.style.height=t+"px",0):-4),Ef=(e,r,t,n,a)=>wn(e,r,t,n,13,"focus"),Cf=e=>{var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=!!r;f[e>>2]=t,f[e+4>>2]=M.fullscreenEnabled();var n=t?r:M.previousFullscreenElement,a=M.getNodeNameForTarget(n),s=(n==null?void 0:n.id)||"";me(a,e+8,128),me(s,e+136,128),f[e+264>>2]=n?n.clientWidth:0,f[e+268>>2]=n?n.clientHeight:0,f[e+272>>2]=screen.width,f[e+276>>2]=screen.height,t&&(M.previousFullscreenElement=r)},Sn=(e,r,t,n,a,s,d)=>{M.fullscreenChangeEvent||(M.fullscreenChangeEvent=Ae(280));var u=(v=event)=>{var w=M.fullscreenChangeEvent;Cf(w),se(n)(a,w,r)&&v.preventDefault()},h={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},kf=(e,r,t,n,a)=>M.fullscreenEnabled()?(e=Le(e),e?(Sn(e,r,t,n,19,"webkitfullscreenchange"),Sn(e,r,t,n,19,"fullscreenchange")):-4):-1,En=(e,r,t,n,a,s,d)=>{M.gamepadEvent||(M.gamepadEvent=Ae(1432));var u=(v=event)=>{var w=M.gamepadEvent;fn(w,v.gamepad),se(n)(a,w,r)&&v.preventDefault()},h={target:Le(e),allowsDeferredCalls:!0,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},jf=(e,r,t,n)=>gt()?-1:En(2,e,r,t,26,"gamepadconnected"),Lf=(e,r,t,n)=>gt()?-1:En(2,e,r,t,27,"gamepaddisconnected"),xt=(e,r,t,n,a,s,d)=>{M.keyEvent||(M.keyEvent=Ae(176));var u=v=>{var w=M.keyEvent;oe[w>>3]=v.timeStamp;var F=w>>2;f[F+2]=v.location,f[F+3]=v.ctrlKey,f[F+4]=v.shiftKey,f[F+5]=v.altKey,f[F+6]=v.metaKey,f[F+7]=v.repeat,f[F+8]=v.charCode,f[F+9]=v.keyCode,f[F+10]=v.which,me(v.key||"",w+44,32),me(v.code||"",w+76,32),me(v.char||"",w+108,32),me(v.locale||"",w+140,32),se(n)(a,w,r)&&v.preventDefault()},h={target:Le(e),eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Ff=(e,r,t,n,a)=>xt(e,r,t,n,2,"keydown"),Rf=(e,r,t,n,a)=>xt(e,r,t,n,1,"keypress"),Tf=(e,r,t,n,a)=>xt(e,r,t,n,3,"keyup"),Pf=(e,r,t)=>{var n=se(e);Zt(n,r,t)},Cn=(e,r,t)=>{oe[e>>3]=r.timeStamp;var n=e>>2;f[n+2]=r.screenX,f[n+3]=r.screenY,f[n+4]=r.clientX,f[n+5]=r.clientY,f[n+6]=r.ctrlKey,f[n+7]=r.shiftKey,f[n+8]=r.altKey,f[n+9]=r.metaKey,V[n*2+20]=r.button,V[n*2+21]=r.buttons,f[n+11]=r.movementX,f[n+12]=r.movementY;var a=Ir(t);f[n+13]=r.clientX-a.left,f[n+14]=r.clientY-a.top},Er=(e,r,t,n,a,s,d)=>{M.mouseEvent||(M.mouseEvent=Ae(72)),e=Le(e);var u=(v=event)=>{Cn(M.mouseEvent,v,e),se(n)(a,M.mouseEvent,r)&&v.preventDefault()},h={target:e,allowsDeferredCalls:s!="mousemove"&&s!="mouseenter"&&s!="mouseleave",eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Mf=(e,r,t,n,a)=>Er(e,r,t,n,5,"mousedown"),Af=(e,r,t,n,a)=>Er(e,r,t,n,33,"mouseenter"),Df=(e,r,t,n,a)=>Er(e,r,t,n,34,"mouseleave"),Bf=(e,r,t,n,a)=>Er(e,r,t,n,8,"mousemove"),If=(e,r,t,n,a)=>Er(e,r,t,n,6,"mouseup"),$f=e=>{var r=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement,t=!!r;f[e>>2]=t;var n=M.getNodeNameForTarget(r),a=(r==null?void 0:r.id)||"";me(n,e+4,128),me(a,e+132,128)},$r=(e,r,t,n,a,s,d)=>{M.pointerlockChangeEvent||(M.pointerlockChangeEvent=Ae(260));var u=(v=event)=>{var w=M.pointerlockChangeEvent;$f(w),se(n)(a,w,r)&&v.preventDefault()},h={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Nf=(e,r,t,n,a)=>!document||!document.body||!document.body.requestPointerLock&&!document.body.mozRequestPointerLock&&!document.body.webkitRequestPointerLock&&!document.body.msRequestPointerLock?-1:(e=Le(e),e?($r(e,r,t,n,20,"mozpointerlockchange"),$r(e,r,t,n,20,"webkitpointerlockchange"),$r(e,r,t,n,20,"mspointerlockchange"),$r(e,r,t,n,20,"pointerlockchange")):-4),Uf=(e,r,t,n,a,s,d)=>{M.uiEvent||(M.uiEvent=Ae(36)),e=Le(e);var u=(v=event)=>{if(v.target==e){var w=document.body;if(w){var F=M.uiEvent;f[F>>2]=v.detail,f[F+4>>2]=w.clientWidth,f[F+8>>2]=w.clientHeight,f[F+12>>2]=innerWidth,f[F+16>>2]=innerHeight,f[F+20>>2]=outerWidth,f[F+24>>2]=outerHeight,f[F+28>>2]=pageXOffset,f[F+32>>2]=pageYOffset,se(n)(a,F,r)&&v.preventDefault()}}},h={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Of=(e,r,t,n,a)=>Uf(e,r,t,n,10,"resize"),Nr=(e,r,t,n,a,s,d)=>{M.touchEvent||(M.touchEvent=Ae(1696)),e=Le(e);var u=v=>{for(var w,F={},I=v.touches,T=0;T<I.length;++T)w=I[T],w.isChanged=w.onTarget=0,F[w.identifier]=w;for(var T=0;T<v.changedTouches.length;++T)w=v.changedTouches[T],w.isChanged=1,F[w.identifier]=w;for(var T=0;T<v.targetTouches.length;++T)F[v.targetTouches[T].identifier].onTarget=1;var D=M.touchEvent;oe[D>>3]=v.timeStamp;var Q=D>>2;f[Q+3]=v.ctrlKey,f[Q+4]=v.shiftKey,f[Q+5]=v.altKey,f[Q+6]=v.metaKey,Q+=7;var ve=Ir(e),ue=0;for(var T in F)if(w=F[T],f[Q+0]=w.identifier,f[Q+1]=w.screenX,f[Q+2]=w.screenY,f[Q+3]=w.clientX,f[Q+4]=w.clientY,f[Q+5]=w.pageX,f[Q+6]=w.pageY,f[Q+7]=w.isChanged,f[Q+8]=w.onTarget,f[Q+9]=w.clientX-ve.left,f[Q+10]=w.clientY-ve.top,Q+=13,++ue>31)break;f[D+8>>2]=ue,se(n)(a,D,r)&&v.preventDefault()},h={target:e,allowsDeferredCalls:s=="touchstart"||s=="touchend",eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Gf=(e,r,t,n,a)=>Nr(e,r,t,n,25,"touchcancel"),zf=(e,r,t,n,a)=>Nr(e,r,t,n,23,"touchend"),qf=(e,r,t,n,a)=>Nr(e,r,t,n,24,"touchmove"),Vf=(e,r,t,n,a)=>Nr(e,r,t,n,22,"touchstart"),Hf=e=>{var r=["hidden","visible","prerender","unloaded"],t=r.indexOf(document.visibilityState);f[e>>2]=document.hidden,f[e+4>>2]=t},Wf=(e,r,t,n,a,s,d)=>{M.visibilityChangeEvent||(M.visibilityChangeEvent=Ae(8));var u=(v=event)=>{var w=M.visibilityChangeEvent;Hf(w),se(n)(a,w,r)&&v.preventDefault()},h={target:e,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Xf=(e,r,t,n)=>Wf(Br[1],e,r,t,21,"visibilitychange"),Kf=(e,r,t,n,a,s,d)=>{M.wheelEvent||(M.wheelEvent=Ae(104));var u=(v=event)=>{var w=M.wheelEvent;Cn(w,v,e),oe[w+72>>3]=v.deltaX,oe[w+80>>3]=v.deltaY,oe[w+88>>3]=v.deltaZ,f[w+96>>2]=v.deltaMode,se(n)(a,w,r)&&v.preventDefault()},h={target:e,allowsDeferredCalls:!0,eventTypeString:s,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Yf=(e,r,t,n,a)=>(e=Le(e),e?typeof e.onwheel<"u"?Kf(e,r,t,n,9,"wheel"):-1:-4),Qf=e=>document.title=ke(e),Jf=()=>{throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},bt={},Zf=()=>_||"./this.program",Cr=()=>{if(!Cr.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Zf()};for(var t in bt)bt[t]===void 0?delete r[t]:r[t]=bt[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);Cr.strings=n}return Cr.strings},em=(e,r)=>{for(var t=0;t<e.length;++t)z[r++>>0]=e.charCodeAt(t);z[r>>0]=0},rm=(e,r)=>{var t=0;return Cr().forEach((n,a)=>{var s=r+t;X[e+a*4>>2]=s,em(n,s),t+=n.length+1}),0},tm=(e,r)=>{var t=Cr();X[e>>2]=t.length;var n=0;return t.forEach(a=>n+=a.length+1),X[r>>2]=n,0};function nm(e){try{var r=Z.getStreamFromFD(e);return c.close(r),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return t.errno}}var am=(e,r,t,n)=>{for(var a=0,s=0;s<t;s++){var d=X[r>>2],u=X[r+4>>2];r+=8;var h=c.read(e,z,d,u,n);if(h<0)return-1;if(a+=h,h<u)break}return a};function om(e,r,t,n){try{var a=Z.getStreamFromFD(e),s=am(a,r,t);return X[n>>2]=s,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}function sm(e,r,t,n,a){var s=vr(r,t);try{if(isNaN(s))return 61;var d=Z.getStreamFromFD(e);return c.llseek(d,s,n),le=[d.position>>>0,(J=d.position,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[a>>2]=le[0],f[a+4>>2]=le[1],d.getdents&&s===0&&n===0&&(d.getdents=null),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function im(e){var t;try{var r=Z.getStreamFromFD(e);return(t=r.stream_ops)!=null&&t.fsync?r.stream_ops.fsync(r):0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return n.errno}}var lm=(e,r,t,n)=>{for(var a=0,s=0;s<t;s++){var d=X[r>>2],u=X[r+4>>2];r+=8;var h=c.write(e,z,d,u,n);if(h<0)return-1;a+=h}return a};function cm(e,r,t,n){try{var a=Z.getStreamFromFD(e),s=lm(a,r,t);return X[n>>2]=s,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var kn=e=>{var r=i["_"+e];return r},dm=(e,r)=>{z.set(e,r)},um=(e,r,t,n,a)=>{var s={string:D=>{var Q=0;return D!=null&&D!==0&&(Q=ut(D)),Q},array:D=>{var Q=Gr(D.length);return dm(D,Q),Q}};function d(D){return r==="string"?ke(D):r==="boolean"?!!D:D}var u=kn(e),h=[],v=0;if(n)for(var w=0;w<n.length;w++){var F=s[t[w]];F?(v===0&&(v=De()),h[w]=F(n[w])):h[w]=n[w]}var I=u.apply(null,h);function T(D){return v!==0&&Be(v),d(D)}return I=T(I),I},de=(e,r,t,n)=>{var a=!t||t.every(d=>d==="number"||d==="boolean"),s=r!=="string";return s&&a&&!n?kn(e):function(){return um(e,r,t,arguments)}},jn=function(e,r,t,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=c.nextInode++,this.name=r,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},Ur=365,Or=146;Object.defineProperties(jn.prototype,{read:{get:function(){return(this.mode&Ur)===Ur},set:function(e){e?this.mode|=Ur:this.mode&=~Ur}},write:{get:function(){return(this.mode&Or)===Or},set:function(e){e?this.mode|=Or:this.mode&=~Or}},isFolder:{get:function(){return c.isDir(this.mode)}},isDevice:{get:function(){return c.isChrdev(this.mode)}}}),c.FSNode=jn,c.createPreloadedFile=Aa,c.staticInit(),i.requestFullscreen=S.requestFullscreen,i.requestAnimationFrame=S.requestAnimationFrame,i.setCanvasSize=S.setCanvasSize,i.pauseMainLoop=S.mainLoop.pause,i.resumeMainLoop=S.mainLoop.resume,i.getUserMedia=S.getUserMedia,i.createContext=S.createContext;for(var b,Me=0;Me<32;++Me)mn.push(new Array(Me));for(var fm=new Float32Array(288),Me=0;Me<288;++Me)Qe[Me]=fm.subarray(0,Me+1);for(var mm=new Int32Array(288),Me=0;Me<288;++Me)Sr[Me]=mm.subarray(0,Me+1);var pm={Q:Ba,rb:Ia,ab:$a,mb:Na,ib:Ua,sb:Oa,ob:Ga,jb:za,pb:qa,S:Va,hb:Ha,fb:Wa,qb:Xa,gb:Ka,db:Ya,tb:Ja,bb:Za,Za:no,_a:ao,Wa:oo,Xa:so,Ya:io,eb:lo,a:co,Qa:po,Ua:ho,Ga:_o,Ja:yo,Ha:wo,Ka:So,Va:Eo,O:Co,Fa:ko,Ra:jo,La:Lo,Ea:Fo,Ma:Ro,Na:To,Ta:Po,Pa:Ao,Oa:Do,i:Io,b:No,T:Uo,ya:Vo,Ca:Ho,h:Wo,e:Xo,V:Ko,X:Yo,l:Ar,Ub:Qo,Da:Jo,ea:es,da:ts,ua:as,ca:ss,ba:ls,aa:ds,$:fs,_:ps,ma:gs,Zd:bs,Yd:ys,Xd:Ss,Wd:Cs,Vd:js,Ud:Fs,Td:Ts,Sd:Ms,Rd:Ds,Qd:Is,Pd:Ns,Od:Os,Nd:zs,Md:Vs,Ld:Ws,Kd:Ks,Jd:Qs,Id:Zs,Hd:ri,Gd:ni,Fd:oi,Ed:ii,Dd:ci,Cd:ui,wa:mi,Bd:hi,Ad:gi,zd:bi,la:wi,yd:Ei,xd:ki,wd:Li,vd:Ri,ud:Pi,td:Ai,sd:Bi,ha:Ni,ia:Gi,rd:qi,ga:Wi,qd:Ki,pd:Qi,ta:Zi,od:rl,nd:nl,md:ol,kd:il,jd:cl,id:ul,gd:ml,xa:hl,fd:gl,ed:bl,ka:wl,hd:El,dd:kl,cd:Ll,bd:Rl,ad:Pl,$c:Al,_c:Bl,Zc:$l,Yc:Ul,Xc:Gl,Wc:ql,Uc:Hl,Vc:Xl,oa:Kl,qa:Yl,na:Jl,pa:ec,ra:tc,Tc:ac,Rc:sc,Qc:lc,Pc:dc,Sc:fc,Oc:hc,Nc:gc,Mc:bc,Jc:wc,Lc:Ec,Kc:kc,Fc:Lc,Hc:Rc,Gc:Pc,Ec:Ac,Dc:Bc,Cc:$c,Bc:Uc,Ac:Gc,va:qc,zc:Hc,yc:Xc,wc:Yc,ja:Zc,vc:rd,uc:nd,tc:od,sc:id,sa:cd,rc:hd,qc:gd,pc:bd,oc:yd,nc:Sd,mc:Cd,lc:jd,kc:Fd,jc:Td,ic:Md,hc:Dd,gc:Id,fc:Nd,ec:Od,dc:zd,cc:Vd,bc:Wd,ac:Kd,$b:Qd,_b:Zd,Zb:ru,Yb:nu,Xb:ou,Wb:iu,Vb:cu,Tb:uu,Sb:mu,Rb:hu,Qb:gu,Pb:bu,Ob:yu,Nb:Su,Mb:Cu,Lb:ju,Kb:Fu,Jb:Tu,Ib:Mu,Hb:Du,Gb:Iu,Fb:Nu,Eb:Ou,Db:zu,Cb:Vu,Bb:Wu,Ab:Ku,zb:Qu,yb:Zu,xb:rf,fa:af,wb:sf,vb:cf,o:df,ub:uf,q:ff,za:pf,N:hf,cb:xf,M:bf,W:gt,s:yf,E:wf,g:dn,m:Sf,F:Ef,v:kf,U:jf,R:Lf,y:Ff,w:Rf,x:Tf,Ba:Pf,Sa:gr,K:Mf,I:Af,H:Df,L:Bf,J:If,z:Nf,u:Of,A:Gf,C:zf,B:qf,D:Vf,t:Xf,G:Yf,Aa:Qf,n:Jf,kb:rm,lb:tm,Ia:tn,j:nm,P:om,$a:sm,nb:im,p:cm,Z:bm,Y:wm,c:vm,r:hm,Ic:Sm,d:gm,k:ym,f:xm,xc:Em,ld:_m},re=wa();i._screenshot=e=>(i._screenshot=re.ae)(e),i._buttonPress=e=>(i._buttonPress=re.be)(e),i._buttonUnpress=e=>(i._buttonUnpress=re.ce)(e),i._setVolume=e=>(i._setVolume=re.de)(e),i._getVolume=()=>(i._getVolume=re.ee)(),i._getMainLoopTimingMode=()=>(i._getMainLoopTimingMode=re.fe)(),i._getMainLoopTimingValue=()=>(i._getMainLoopTimingValue=re.ge)(),i._setMainLoopTiming=(e,r)=>(i._setMainLoopTiming=re.he)(e,r),i._setFastForwardMultiplier=e=>(i._setFastForwardMultiplier=re.ie)(e),i._getFastForwardMultiplier=()=>(i._getFastForwardMultiplier=re.je)(),i._quitGame=()=>(i._quitGame=re.ke)(),i._quitMgba=()=>(i._quitMgba=re.le)(),i._quickReload=()=>(i._quickReload=re.me)(),i._pauseGame=()=>(i._pauseGame=re.ne)(),i._resumeGame=()=>(i._resumeGame=re.oe)(),i._setEventEnable=e=>(i._setEventEnable=re.pe)(e),i._bindKey=(e,r)=>(i._bindKey=re.qe)(e,r),i._saveState=e=>(i._saveState=re.re)(e),i._loadState=e=>(i._loadState=re.se)(e),i._autoLoadCheats=()=>(i._autoLoadCheats=re.te)(),i._loadGame=e=>(i._loadGame=re.ue)(e),i._saveStateSlot=(e,r)=>(i._saveStateSlot=re.ve)(e,r),i._loadStateSlot=(e,r)=>(i._loadStateSlot=re.we)(e,r),i._setupConstants=()=>(i._setupConstants=re.xe)();var Ln=i._main=(e,r)=>(Ln=i._main=re.ye)(e,r),Ae=e=>(Ae=re.Ae)(e),Fn=e=>(Fn=re.Be)(e),Rn=(e,r)=>(Rn=re.Ce)(e,r),Ge=(e,r)=>(Ge=re.De)(e,r),De=()=>(De=re.Ee)(),Be=e=>(Be=re.Fe)(e),Gr=e=>(Gr=re.Ge)(e);i.dynCall_ji=(e,r)=>(i.dynCall_ji=re.He)(e,r),i.dynCall_jiji=(e,r,t,n,a)=>(i.dynCall_jiji=re.Ie)(e,r,t,n,a),i.dynCall_iiiji=(e,r,t,n,a,s)=>(i.dynCall_iiiji=re.Je)(e,r,t,n,a,s),i.dynCall_jii=(e,r,t)=>(i.dynCall_jii=re.Ke)(e,r,t),i._GBAInputInfo=109920,i._binaryName=186992,i._projectName=186996,i._projectVersion=187e3,i._gitCommit=186976,i._gitCommitShort=186980,i._gitBranch=186984,i._gitRevision=186988,i._GBIORegisterNames=49376,i._GBSavestateMagic=64640,i._GBSavestateVersion=64644,i._GBA_LUX_LEVELS=93136,i._GBAVideoObjSizes=138416,i._GBASavestateMagic=138208,i._GBASavestateVersion=138212;function hm(e,r,t,n,a){var s=De();try{return se(e)(r,t,n,a)}catch(d){if(Be(s),d!==d+0)throw d;Ge(1,0)}}function vm(e,r,t,n){var a=De();try{return se(e)(r,t,n)}catch(s){if(Be(a),s!==s+0)throw s;Ge(1,0)}}function gm(e,r,t){var n=De();try{se(e)(r,t)}catch(a){if(Be(n),a!==a+0)throw a;Ge(1,0)}}function xm(e,r,t,n,a){var s=De();try{se(e)(r,t,n,a)}catch(d){if(Be(s),d!==d+0)throw d;Ge(1,0)}}function bm(e,r){var t=De();try{return se(e)(r)}catch(n){if(Be(t),n!==n+0)throw n;Ge(1,0)}}function _m(e,r,t,n,a,s,d,u,h,v){var w=De();try{se(e)(r,t,n,a,s,d,u,h,v)}catch(F){if(Be(w),F!==F+0)throw F;Ge(1,0)}}function ym(e,r,t,n){var a=De();try{se(e)(r,t,n)}catch(s){if(Be(a),s!==s+0)throw s;Ge(1,0)}}function wm(e,r,t){var n=De();try{return se(e)(r,t)}catch(a){if(Be(n),a!==a+0)throw a;Ge(1,0)}}function Sm(e,r){var t=De();try{se(e)(r)}catch(n){if(Be(t),n!==n+0)throw n;Ge(1,0)}}function Em(e,r,t,n,a,s){var d=De();try{se(e)(r,t,n,a,s)}catch(u){if(Be(d),u!==u+0)throw u;Ge(1,0)}}i.cwrap=de,i.FS=c;var zr;mr=function e(){zr||Tn(),zr||(mr=e)};function Cm(){var e=Ln,r=0,t=0;try{var n=e(r,t);return rn(n,!0),n}catch(a){return lt(a)}}function Tn(){if(Se>0||(rr(),Se>0))return;function e(){zr||(zr=!0,i.calledRun=!0,!Y&&(tr(),fr(),p(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),Pn&&Cm(),Fr()))}i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),e()},1)):e()}if(i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();var Pn=!0;return i.noInitialRun&&(Pn=!1),Tn(),m.ready}})();const kp=l=>{const[m,i]=P.useState(null);return P.useEffect(()=>{(async()=>{if(l){const x=await Cp({canvas:l}),y=x.version.projectName+" "+x.version.projectVersion;console.log(y),await x.FSInit();const g=Ep(x);i(g)}})()},[l]),m},Mt=P.createContext(null);Mt.displayName="EmulatorContext";const jp=({children:l})=>{const[m,i]=P.useState(null),p=kp(m);return o.jsx(Mt.Provider,{value:{emulator:p,canvas:m,setCanvas:i},children:l})},At=P.createContext(null);At.displayName="ResizeContext";const Lp=({children:l})=>{const[m,i]=P.useState(!1);return o.jsx(At.Provider,{value:{areItemsResizable:m,setAreItemsResizable:i},children:l})},Dt=P.createContext(null);Dt.displayName="RunningContext";const Fp=({children:l})=>{const[m,i]=P.useState(!1);return o.jsx(Dt.Provider,{value:{isRunning:m,setIsRunning:i},children:l})},Rp="componentLayouts",Tp=()=>{const[l,m]=je(Rp,{}),i=P.useCallback(()=>m({}),[m]),p=P.useMemo(()=>!!Object.values(l).some(x=>!!(x!=null&&x.position)||!!(x!=null&&x.size)),[l]);return{layouts:l,setLayouts:m,hasSetLayout:p,clearLayouts:i}},Bt=P.createContext(null);Bt.displayName="LayoutContext";const Pp=({children:l})=>{const{layouts:m,setLayouts:i,hasSetLayout:p,clearLayouts:x}=Tp(),y=P.useCallback((g,_)=>i(j=>({...j,[g]:{...j==null?void 0:j[g],..._}})),[i]);return P.useEffect(()=>{p||x()},[]),o.jsx(Bt.Provider,{value:{layouts:m,hasSetLayout:p,clearLayouts:x,setLayout:y},children:l})},It=P.createContext(null);It.displayName="ModalContext";const Mp=({children:l})=>{const[m,i]=P.useState(null),[p,x]=P.useState(!1);return o.jsx(It.Provider,{value:{modalContent:m,setModalContent:i,isModalOpen:p,setIsModalOpen:x},children:l})},ur=l=>{const m=l.displayName,i=P.useContext(l);if(!i)throw new Error(`${m??"This context"} must be loaded under the matching ${m?`${m}.Provider`:"Provider"}`);return i},oa=()=>ur(Tt),_r=()=>ur(Bt),Ce=()=>ur(It),pe=()=>ur(Mt),Jr=()=>ur(Pt),sa=()=>ur(At),er=()=>ur(Dt),Ap=({isPaused:l})=>{const m=Lm(),{emulator:i}=pe(),{isRunning:p}=er(),[x,y]=P.useState(!1),g=p&&!l;P.useEffect(()=>{g&&(!m&&!x?(i==null||i.pause(),y(!0)):m&&x&&(i==null||i.resume(),y(!1)))},[i,m,g,x])},Dp=l=>{const m=l.getContext("webgl");m==null||m.clearColor(0,0,0,1),m==null||m.clear(m==null?void 0:m.COLOR_BUFFER_BIT)},Bp=l=>{const m=l.getContext("2d"),i=40,p=50;let x=0;if(!m)return;const y=l.width,g=l.height,_=y/2,j=g/2,k=m.getImageData(0,0,y,g),E=setInterval(()=>{x++;for(let L=0;L<g;++L)for(let R=0;R<y;++R){const $=Math.abs(R-_),U=Math.abs(L-j)*.8,B=(_-x-$)/_,H=(j-x-(L&1)*10-U+Math.pow($,1/2))/j;k.data[(R+L*y)*4+3]*=Math.pow(B,1/3)*Math.pow(H,1/2)}m.putImageData(k,0,0),x>i&&(clearInterval(E),l.remove())},p)},Ip=(l,m)=>{if(!l||!m)return;const i=document.createElement("canvas"),p=i.getContext("2d"),x=URL.createObjectURL(m);i.className=l.className,i.height=l.height,i.width=l.width,i.style.backgroundColor=l.style.backgroundColor,i.style.height=`${l.clientHeight}px`,i.style.imageRendering=l.style.imageRendering,i.style.margin=l.style.margin,i.style.objectFit=l.style.objectFit,i.style.width=`${l.clientWidth}px`,i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.right="0";const y=new Image;y.onload=()=>{var g;p==null||p.drawImage(y,0,0),(g=l.parentElement)==null||g.appendChild(i),Dp(l),Bp(i)},y.src=x},$p=l=>{if(!l)return null;const m="fade-copy.png",i=(l==null?void 0:l.filePaths().screenshotsPath)+"/"+m;if(!l.screenshot(m))return null;const x=l.getFile(i);return l==null||l.deleteFile(i),new Blob([x],{type:"image/png"})},Np=()=>{const{canvas:l,emulator:m}=pe(),{isRunning:i,setIsRunning:p}=er();return P.useCallback(()=>{i&&(Ip(l,$p(m)),m==null||m.quitGame()),p(!1)},[l,m,i,p])},$t="completedProductTour",Up={locale:{skip:o.jsx("strong",{"aria-label":"Skip",children:"Skip"})},placement:"auto",placementBeacon:"right-end",spotlightPadding:10},ze=({completedProductTourStepName:l,steps:m,allowScrolling:i=!0,isNotInModal:p=!1,millisecondDelay:x=500,renderWithoutDelay:y=!1,skipIfIntroSkipped:g=!0,skipRenderCondition:_=!1,zIndex:j=500})=>{const[k,E]=je($t),{isModalOpen:L}=Ce(),[R,$]=P.useState(y);if(kt(()=>{$(!0)},y?null:x),!R||k!=null&&k[l]||g&&(k==null?void 0:k.hasCompletedProductTourIntro)===_t.SKIPPED||!(k!=null&&k.hasCompletedProductTourIntro)||!p&&!L||_)return null;const U=m.map(B=>({...Up,...B}));return o.jsx(up,{continuous:!0,disableScrollParentFix:i,hideCloseButton:!0,showProgress:!0,showSkipButton:!0,steps:U,styles:{options:{zIndex:j}},callback:({status:B})=>{[_t.FINISHED,_t.SKIPPED].includes(B)&&E(H=>({...H,[l]:B}))}})},Op=A.button`
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
  padding: inherit;
`,Lr=Yr.forwardRef(({children:l,...m},i)=>o.jsx(Op,{ref:i,...m,children:l})),br=({variation:l})=>{const m=Te(),i=function(){switch(l){case"topLeft":return"-45deg";case"topRight":return"45deg";case"bottomLeft":return"45deg";case"bottomRight":return"-45deg";default:return"0deg"}}();return o.jsx(Fm,{"data-testid":"gripper-handle",color:m.gbaThemeBlue,style:{transform:`rotate(${i})`}})},Gp=A.ul`
  background-color: ${({theme:l})=>l.panelBlueGray};
  list-style: none;
  padding: 10px;
  margin: 0;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-template-areas:
    '. . . .'
    'volume volume fastForward fastForward';

  ${({$controlled:l,$isLargerThanPhone:m})=>(l||m)&&`
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
  `}
`,zp=A.li`
  display: contents;
`,ia=Rm`
  cursor: pointer;
  background-color: ${({theme:l})=>l.panelControlGray};
  border-radius: 0.25rem;
  min-width: 40px;
  min-height: 40px;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:l})=>l.pureBlack};
  width: ${({$controlled:l})=>l?"auto":"100%"};

  ${({$controlled:l,theme:m})=>!l&&`
    @media ${m.isLargerThanPhone} {
      width: auto;
    }
  `}
`,qp=A(Lr).attrs({className:"noDrag"})`
  ${ia}

  border: none;
  flex-grow: 1;
  margin: 0;
  padding: 0;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  &:active {
    color: ${({theme:l})=>l.gbaThemeBlue};
  }
`,Vp=A.li`
  ${ia}
  grid-area: ${({$gridArea:l})=>l};
  max-height: 40px;
`,Hp=A(fp)`
  flex-grow: 1;

  > .MuiSlider-markActive {
    opacity: 1;
    background-color: currentColor;
  }
`,qr=({ariaLabel:l,children:m,controlled:i,id:p,onClick:x})=>o.jsx(zp,{children:o.jsx(qp,{"aria-label":l,id:p,onClick:x,$controlled:i,children:m})}),Vr=({icon:l,...m})=>{const i=Te();return o.jsx(Ze,{size:"small",sx:{padding:0,color:i.pureBlack,"&:active":{color:i.gbaThemeBlue}},...m,children:l})},Nn=({controlled:l,gridArea:m,id:i,maxIcon:p,minIcon:x,...y})=>o.jsxs(Vp,{id:i,$gridArea:m,$controlled:l,children:[x,o.jsx(Hp,{marks:!0,sx:{width:"85px",margin:"0 10px",maxHeight:"40px"},valueLabelDisplay:"auto",...y}),p]}),Wp=()=>{var tr,fr,Fr,Rr;const{emulator:l}=pe(),{isRunning:m}=er(),{areItemsDraggable:i,setAreItemsDraggable:p}=Jr(),{areItemsResizable:x,setAreItemsResizable:y}=sa(),{layouts:g,setLayout:_}=_r(),j=Te(),k=ir(j.isLargerThanPhone),[E,L]=P.useState(!1),[R,$]=P.useState(!1),U=P.useId(),B=Np(),[H,G]=je(ra,1),[Y,te]=je(aa,1);Ap({isPaused:E});const K=P.useCallback(fe=>{var Pe,Se;!((Pe=g==null?void 0:g.controlPanel)!=null&&Pe.initialBounds)&&fe&&_("controlPanel",{initialBounds:(Se=fe.resizableElement.current)==null?void 0:Se.getBoundingClientRect()})},[_,g]),z=(tr=g==null?void 0:g.screen)==null?void 0:tr.initialBounds;if(!z)return null;const q=k?5:0,V=!!((fr=g==null?void 0:g.controlPanel)!=null&&fr.size)||R,O=()=>{m&&(E?l==null||l.resume():l==null||l.pause(),L(fe=>!fe))},f=fe=>{l==null||l.setVolume(fe),G(fe)},X=fe=>{var Se;const Pe=Number((Se=fe.target)==null?void 0:Se.value);f(Pe)},W=fe=>{l==null||l.setFastForwardMultiplier(fe),te(fe)},oe=fe=>{var Se;const Pe=Number((Se=fe.target)==null?void 0:Se.value);l==null||l.setFastForwardMultiplier(Pe),te(Pe)},ne=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the control panel to quickly perform in game actions and reposition controls."}),o.jsx("p",{children:"Click next to take a tour of the controls!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(U)}`},{content:o.jsx("p",{children:"Use the this button to pause and resume your game if it is running."}),placementBeacon:"bottom",target:`#${CSS.escape(`${U}--play`)}`},{content:o.jsx("p",{children:"Use this button to quit your current game."}),placementBeacon:"bottom",target:`#${CSS.escape(`${U}--quit-game`)}`},{content:o.jsx("p",{children:"Use this button to enable dragging and repositioning of the screen, controls, and control panel."}),placement:k?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${U}--drag`)}`},{content:o.jsx("p",{children:"Use this button to resize the screen and control panel."}),placement:k?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${U}--resize`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the emulator volume."}),o.jsx("p",{children:"Your volume setting will be saved between refreshes!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(`${U}--volume-slider`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the fast forward speed."}),o.jsx("p",{children:"Your fast forward setting will be saved between refreshes!"})]}),placement:k?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${U}--fast-forward`)}`}],_e={x:Math.floor(z.left),y:Math.floor(z.bottom+q)},he={width:k?"auto":"100dvw",height:"auto"},Ne=((Fr=g==null?void 0:g.controlPanel)==null?void 0:Fr.position)??_e,Xe=((Rr=g==null?void 0:g.controlPanel)==null?void 0:Rr.size)??he,rr={onFocus:l==null?void 0:l.disableKeyboardInput,onBlur:l==null?void 0:l.enableKeyboardInput,onClick:l==null?void 0:l.enableKeyboardInput};return o.jsxs(o.Fragment,{children:[o.jsx(Xn,{"data-testid":"control-panel-wrapper",id:U,disableDragging:!i,enableResizing:x,resizeHandleComponent:{bottomRight:o.jsx(br,{variation:"bottomRight"}),bottomLeft:o.jsx(br,{variation:"bottomLeft"})},resizeHandleStyles:{bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"}},ref:K,cancel:".noDrag",position:Ne,size:Xe,onDragStop:(fe,Pe)=>{_("controlPanel",{position:{x:Pe.x,y:Pe.y}})},onResizeStart:()=>$(!0),onResizeStop:(fe,Pe,Se,mr,Ut)=>{_("controlPanel",{size:{width:Se.clientWidth,height:Se.clientHeight},position:{...Ut}}),$(!1)},default:{..._e,...he},children:o.jsx(Gp,{$controlled:V,$isLargerThanPhone:k,children:o.jsxs(Kn.Provider,{value:{size:"2em"},children:[o.jsx(qr,{id:`${U}--play`,ariaLabel:E||!m?"Play":"Pause",onClick:O,controlled:V,children:E||!m?o.jsx(Yn,{}):o.jsx(Tm,{})}),o.jsx(qr,{id:`${U}--quit-game`,ariaLabel:"Quit Game",onClick:()=>{B(),L(!1)},controlled:V,children:o.jsx(Pm,{})}),o.jsx(qr,{id:`${U}--drag`,ariaLabel:i?"Anchor Items":"Drag Items",onClick:()=>{p(fe=>!fe)},controlled:V,children:i?o.jsx(Mn,{color:j.gbaThemeBlue}):o.jsx(Mn,{})}),o.jsx(qr,{id:`${U}--resize`,ariaLabel:x?"Stop Resizing Items":"Resize Items",onClick:()=>{y(fe=>!fe)},controlled:V,children:x?o.jsx(An,{color:j.gbaThemeBlue}):o.jsx(An,{})}),o.jsx(Nn,{id:`${U}--volume-slider`,"aria-label":"Volume Slider",gridArea:"volume",controlled:V,value:H,step:.1,min:0,max:1,minIcon:o.jsx(Vr,{"aria-label":"Mute Volume",icon:o.jsx(Mm,{style:{maxHeight:"100%"}}),onClick:()=>f(0)}),maxIcon:o.jsx(Vr,{"aria-label":"Max Volume",icon:o.jsx(Am,{style:{maxHeight:"100%"}}),onClick:()=>f(1)}),valueLabelFormat:`${H*100}`,onChange:X,...rr}),o.jsx(Nn,{id:`${U}--fast-forward`,"aria-label":"Fast Forward Slider",gridArea:"fastForward",controlled:V,value:Y,step:1,min:1,max:5,minIcon:o.jsx(Vr,{"aria-label":"Regular Speed",icon:o.jsx(Dm,{style:{maxHeight:"100%"}}),onClick:()=>W(1)}),maxIcon:o.jsx(Vr,{"aria-label":"Max Fast Forward",icon:o.jsx(Bm,{style:{maxHeight:"100%"}}),onClick:()=>W(5)}),valueLabelFormat:`x${Y}`,onChange:oe,...rr})]})})}),o.jsx(ze,{steps:ne,completedProductTourStepName:"hasCompletedControlPanelTour",zIndex:k?160:0,renderWithoutDelay:!0,isNotInModal:!0})]})},la="currentSaveStateSlot",ca="areVirtualControlsEnabled",Xp=A.section`
  position: absolute;
  background-color: red;
  border-radius: 50%;
  width: 12rem;
  height: 12rem;
  background: ${({theme:l})=>l.pureBlack};
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};
  border-width: 2px;
  z-index: 12;

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `};
`,Kp=A.div`
  position: absolute;
  height: 4rem;
  width: 4rem;
  border: 2px solid ${({theme:l})=>l.gbaThemeBlue};
  border-radius: 50%;
  background-color: ${({theme:l})=>l.pureBlack};
  transition: ${({$isControlled:l=!1})=>l?"transform 0.3s ease-in-out":"none"};

  &:before {
    position: absolute;
    content: '';
    top: -0.8rem;
    left: -0.8rem;
    right: -0.8rem;
    bottom: -0.8rem;
    border: 0.8rem solid ${({theme:l})=>l.gbaThemeBlue}50;
    border-radius: 50%;
  }
`,Zr=A.div`
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
`,Yp=A(Zr)`
  border-width: 0 15px 25px 15px;
  border-color: transparent transparent ${({theme:l})=>l.pureWhite}
    transparent;
  top: 10px;
`,Qp=A(Zr)`
  border-width: 25px 15px 0 15px;
  border-color: ${({theme:l})=>l.pureWhite} transparent transparent
    transparent;
  bottom: 10px;
`,Jp=A(Zr)`
  border-width: 15px 25px 15px 0;
  border-color: transparent ${({theme:l})=>l.pureWhite} transparent
    transparent;
  left: 10px;
`,Zp=A(Zr)`
  border-width: 15px 0 15px 25px;
  border-color: transparent transparent transparent
    ${({theme:l})=>l.pureWhite};
  right: 10px;
`,eh=({initialPosition:l})=>{var K;const{emulator:m}=pe(),{areItemsDraggable:i}=Jr(),{layouts:p,setLayout:x}=_r(),[y,g]=P.useState({x:0,y:0}),[_,j]=P.useState(!0),k=P.useRef(null),E=P.useRef(null),[L,R]=P.useState({});P.useEffect(()=>{Object.keys(L).forEach(z=>{L[z]?m==null||m.simulateKeyDown(z):m==null||m.simulateKeyUp(z)})},[L,m]);const $=P.useCallback((z,q)=>R(V=>({...V,[z]:q})),[]),U=P.useCallback(z=>R(q=>Object.fromEntries(Object.entries(q).map(([V,O])=>[V,O===z?void 0:O]))),[]),B=({x:z,y:q})=>{const V=z*Math.cos(Math.PI/4)-q*Math.sin(Math.PI/4),O=z*Math.sin(Math.PI/4)+q*Math.cos(Math.PI/4);return V>=0&&O>=0?"RIGHT":V<0&&O>=0?"DOWN":V<0&&O<0?"LEFT":V>=0&&O<0?"UP":null},H=P.useCallback(z=>{if(!k.current||!E.current)return;const q=k.current.getBoundingClientRect(),V=E.current.getBoundingClientRect(),O=Math.max(-q.width/2+V.width/2,Math.min(z.clientX-q.left-q.width/2,q.width/2-V.width/2)),f=Math.max(-q.height/2+V.height/2,Math.min(z.clientY-q.top-q.height/2,q.height/2-V.height/2));i||g({x:O,y:f});const X=B({x:O,y:f});X&&!L[X]&&(U(z.pointerId),$(X,z.pointerId))},[i,L,$,U]),G=P.useCallback(z=>{if(j(!1),!k.current)return;const q=k.current.getBoundingClientRect(),V=z.clientX-q.left-q.width/2,O=z.clientY-q.top-q.width/2;i||g({x:V,y:O});const f=B({x:V,y:O});f&&$(f,z.pointerId)},[i,$]),Y=z=>{j(!0),g({x:0,y:0}),U(z.pointerId)},te=((K=p==null?void 0:p.oPad)==null?void 0:K.position)??{x:0,y:0};return o.jsx(St,{nodeRef:k,disabled:!i,position:te,onStop:(z,q)=>x("oPad",{position:{x:q.x,y:q.y}}),children:o.jsxs(Xp,{"aria-label":"O-Pad",ref:k,$initialPosition:l,$areItemsDraggable:i,onPointerDown:G,onPointerMove:H,onPointerUp:Y,onPointerCancel:Y,onPointerOut:Y,onPointerLeave:Y,children:[o.jsx(St,{disabled:!0,nodeRef:E,position:y,children:o.jsx(Kp,{ref:E,$isControlled:_})}),o.jsx(Jp,{}),o.jsx(Zp,{}),o.jsx(Yp,{}),o.jsx(Qp,{})]})})},da=A(Lr)`
  background-color: ${({theme:l})=>l.darkGray};
  border-style: solid;
  border-color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  cursor: pointer;
  box-sizing: content-box;
  border-width: 2px;
`,rh=A(da)`
  width: ${({$diameter:l=60})=>l}px;
  height: ${({$diameter:l=60})=>l}px;
  border-radius: 100px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,th=A(da)`
  border-radius: 16px;
  width: fit-content;
  min-width: 85px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,nh=({isRectangular:l=!1,width:m=60,children:i,keyId:p,inputName:x,onClick:y,initialPosition:g,initialOffset:_,enabled:j=!1,ariaLabel:k})=>{var te;const{emulator:E}=pe(),{areItemsDraggable:L}=Jr(),{layouts:R,setLayout:$}=_r(),U=P.useRef(null);if(!j)return null;const B=y?{onClick:y}:{},H=p?{onPointerDown:()=>{E==null||E.simulateKeyDown(p)},onPointerUp:()=>{E==null||E.simulateKeyUp(p)},onPointerLeave:()=>{E==null||E.simulateKeyUp(p)},onPointerOut:()=>{E==null||E.simulateKeyUp(p)},onPointerCancel:()=>{E==null||E.simulateKeyUp(p)}}:{},G=p?{onKeyDown:K=>{(K.code=="Space"||K.key==" ")&&(E==null||E.simulateKeyDown(p))},onKeyUp:K=>{(K.code=="Space"||K.key==" ")&&(E==null||E.simulateKeyUp(p))}}:{},Y=((te=R==null?void 0:R[x])==null?void 0:te.position)??{x:0,y:0};return o.jsx(St,{nodeRef:U,positionOffset:_,position:Y,disabled:!L,onStop:(K,z)=>$(x,{position:{x:z.x,y:z.y}}),children:l?o.jsx(th,{ref:U,$initialPosition:g,$areItemsDraggable:L,"aria-label":k,...H,...B,...G,children:i}):o.jsx(rh,{ref:U,$initialPosition:g,$diameter:m,$areItemsDraggable:L,"aria-label":k,...H,...B,...G,children:i})})},et=()=>{const{emulator:l}=pe(),{setIsRunning:m}=er(),[,i]=je(na),[p]=je(ta),[x]=je(ra,1),[y]=je(aa,1);return P.useCallback(_=>{const j=l==null?void 0:l.run(_);return m(!!j),i(_),l==null||l.setVolume(x),j&&(p&&(l==null||l.remapKeyBindings(p)),y>1&&!(l!=null&&l.isFastForwardEnabled())&&(l==null||l.setFastForwardMultiplier(y))),!!j},[x,p,l,y,m,i])},ua=()=>{const l=et(),{isRunning:m,setIsRunning:i}=er(),{emulator:p}=pe(),[x]=je(na);return P.useCallback(()=>{if(m)p==null||p.quickReload();else if(p!=null&&p.getCurrentGameName()){const g=l(p.filePaths().gamePath+"/"+p.getCurrentGameName());i(!!g)}else if(x){const g=l(x);i(!!g)}},[p,m,i,l,x])},fa=A.div`
  text-align: center;
`,kr=A.p`
  text-align: center;
  margin: 0;
`,ma=A.h3`
  margin: 0;
`,pa=A.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,ha=A.div`
  padding: 1rem;
  overflow-y: auto;
`,va=A.div`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
  border-top: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,Ue=({children:l})=>o.jsx(ha,{children:l}),Oe=({children:l})=>o.jsx(va,{"data-testid":"modal-footer:wrapper",children:l}),ah=A.button`
  width: 1em;
  height: 1em;
  padding: 1rem;
  margin: 0 0 0 auto;
  cursor: pointer;
  color: ${({theme:l})=>l.pureBlack};
  border: 0;
  border-radius: 0.25rem;
  opacity: 0.5;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    opacity: 1;
  }

  &:hover {
    opacity: 0.75;
  }

  background: transparent
    url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e")
    center/1em auto no-repeat;
`,Re=({title:l,showExitIndicator:m=!0})=>{const{setIsModalOpen:i}=Ce();return o.jsxs(pa,{children:[o.jsx(ma,{id:"modalHeader",children:l}),m&&o.jsx(ah,{"aria-label":"Close",onClick:()=>i(!1)})]})},oh=()=>{const{accessToken:m}=oa(),i=P.useCallback(async _=>{const j="undefined/api/save/upload",k=new FormData;k.append("save",(_==null?void 0:_.saveFile)??"");const E={method:"POST",headers:{Authorization:`Bearer ${m}`},body:k},L=await fetch(j,E);if(!L.ok)throw new Error(`Received unexpected status code: ${L.status}`);return L},[void 0,m]),{data:p,isLoading:x,error:y,execute:g}=jr({fetchFn:i,clearDataOnLoad:!0});return{data:p,isLoading:x,error:y,execute:g}},sh=A.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,ih=A.p`
  margin: 0;
  color: ${({theme:l})=>l.errorRed};
`,lr=({icon:l,text:m,className:i})=>o.jsxs(sh,{"data-testid":"error-with-icon",className:i,children:[l,o.jsx(ih,{children:m})]}),lh=({errorColor:l,loadingColor:m,respStatus:i,isLoading:p,hasError:x})=>{const y=()=>o.jsx(jt,{"data-testid":"upload-save-spinner",color:m,cssOverride:{margin:"0 auto"}});let g=null;return p?g=y:x?g=()=>o.jsx(lr,{icon:o.jsx(sr,{style:{color:l}}),text:"Save file upload has failed"}):i===200?g=()=>o.jsx(kr,{children:"Save file upload was successful!"}):g=()=>o.jsx(kr,{children:"Are you sure you want to upload your current save file to the server?"}),o.jsx(Ue,{children:o.jsx(g,{})})},ch=()=>{const l=Te(),{setIsModalOpen:m}=Ce(),{emulator:i}=pe(),p=P.useId(),{data:x,isLoading:y,error:g,execute:_}=oh(),j=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to upload your current save file to the server."}),o.jsx("p",{children:"Remember to save in game before uploading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Send Save to Server"}),o.jsx(lh,{errorColor:l.errorRed,loadingColor:l.gbaThemeBlue,isLoading:y,hasError:!!g,respStatus:x==null?void 0:x.status}),o.jsxs(Oe,{children:[o.jsx(ie,{id:p,variant:"contained",onClick:()=>{const k=i==null?void 0:i.getCurrentSave(),E=i==null?void 0:i.getCurrentSaveName();if(k&&E){const L=new Blob([k]),R=new File([L],E);_({saveFile:R})}},children:"Upload"}),o.jsx(ie,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(ze,{steps:j,completedProductTourStepName:"hasCompletedUploadSaveToServerTour"})]})},Un=A.p`
  text-align: center;
  vertical-align: middle;
  line-height: 54px;
  color: ${({theme:l})=>l.pureWhite};
  margin: 0;
  font-size: 1.5em;
`,Hr=A.p`
  color: ${({theme:l})=>l.pureWhite};
  margin: 4px 5px;
`,dh=l=>l.replace("-"," ").replace(/\w\S*/g,m=>m.charAt(0).toUpperCase()+m.substring(1).toLowerCase()),uh=()=>{var V;const l=Te(),m=ir(l.isLargerThanPhone),i=ir(l.isMobileWithUrlBar),{emulator:p}=pe(),{isRunning:x}=er(),{isAuthenticated:y}=oa(),{setModalContent:g,setIsModalOpen:_}=Ce(),{layouts:j}=_r(),k=P.useId(),E=ua(),[L]=je(la,0),[R]=je(ca),$=(V=j==null?void 0:j.controlPanel)==null?void 0:V.initialBounds;if(!$)return null;const U=O=>O===void 0&&!m||!!O,B=U(R==null?void 0:R.OpadAndButtons),H=(R==null?void 0:R.NotificationsEnabled)??!0,G=$.bottom,Y=$.left,te={"a-button":{defaultMobile:{top:`calc(${G}px + 12%)`,left:"calc(100dvw - 25px)"},mobileWithUrlBar:{top:`calc(${G}px + 10%)`},largerThanPhone:{top:`calc(${G}px + 35px - 3%)`,left:`calc(${Y}px + 450px)`}},"b-button":{defaultMobile:{top:`calc(${G}px + 15%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${G}px + 13%)`},largerThanPhone:{top:`calc(${G}px + 35px)`,left:`calc(${Y}px + 375px)`}},"start-button":{defaultMobile:{top:"88dvh",left:"25dvw"},mobileWithUrlBar:{top:"92dvh",left:"50dvw"},largerThanPhone:{top:`calc(${G}px + 60px)`,left:`${Y}px`}},"select-button":{defaultMobile:{top:"88dvh",left:"55dvw"},mobileWithUrlBar:{top:"92dvh",left:"75dvw"},largerThanPhone:{top:`calc(${G}px + 60px)`,left:`calc(${Y}px + 103px)`}},"l-button":{defaultMobile:{top:`${G+15}px`,left:"15px"},largerThanPhone:{top:`calc(${G}px + 15px)`,left:`${Y}px`}},"r-button":{defaultMobile:{top:`${G+15}px`,left:"calc(100dvw - 15px)"},largerThanPhone:{top:`calc(${G}px + 15px)`,left:`calc(${Y}px + 190px)`}},"quickreload-button":{defaultMobile:{top:`${G+10}px`,left:"135px"},largerThanPhone:{top:`calc(${G}px + 10px)`,left:`calc(${Y}px + 205px)`}},"uploadsave-button":{defaultMobile:{top:`${G+10}px`,left:"calc(100dvw - 135px)"},largerThanPhone:{top:`calc(${G}px + 10px)`,left:`calc(${Y}px + 300px)`}},"loadstate-button":{defaultMobile:{top:`calc(${G}px + 25%)`,left:"calc(100dvw - 40px)"},mobileWithUrlBar:{top:`calc(${G}px + 23%)`},largerThanPhone:{top:`calc(${G}px + 60px)`,left:`calc(${Y}px + 248px)`}},"savestate-button":{defaultMobile:{top:`calc(${G}px + 27%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${G}px + 25%)`},largerThanPhone:{top:`calc(${G}px + 60px)`,left:`calc(${Y}px + 300px)`}},"o-pad":{defaultMobile:{top:`calc(${G}px + 11%)`,left:"10px"},largerThanPhone:{top:`calc(${G}px + 10px)`,left:`calc(${Y}px + 450px)`}}},K=O=>{var X,W,oe,ne;let f;return i&&((X=te[O])!=null&&X.mobileWithUrlBar)?f=(W=te[O])==null?void 0:W.mobileWithUrlBar:m&&((oe=te[O])!=null&&oe.largerThanPhone)&&(f=(ne=te[O])==null?void 0:ne.largerThanPhone),{...te[O].defaultMobile,...f}},z=(O,f,X)=>{H&&Je[O?"success":"error"](O?f:X,{id:k})},q=[{keyId:"A",children:o.jsx(Un,{children:"A"}),initialPosition:K("a-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"a-button",enabled:B},{keyId:"B",children:o.jsx(Un,{children:"B"}),initialPosition:K("b-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"b-button",enabled:B},{keyId:"START",isRectangular:!0,children:o.jsx(Hr,{children:"Start"}),initialPosition:K("start-button"),keyName:"start-button",enabled:B},{keyId:"SELECT",isRectangular:!0,children:o.jsx(Hr,{children:"Select"}),initialPosition:K("select-button"),keyName:"select-button",enabled:B},{keyId:"L",isRectangular:!0,children:o.jsx(Hr,{children:"L"}),initialPosition:K("l-button"),keyName:"l-button",enabled:B},{keyId:"R",isRectangular:!0,children:o.jsx(Hr,{children:"R"}),initialPosition:K("r-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"r-button",enabled:B},{children:o.jsx(Im,{}),onClick:()=>{E(),!(p!=null&&p.getCurrentGameName())&&H&&Je.error("Load a game to quick reload",{id:k})},width:40,initialPosition:K("quickreload-button"),keyName:"quickreload-button",enabled:U(R==null?void 0:R.QuickReload)},{children:o.jsx($m,{}),onClick:()=>{y()&&x?(g(o.jsx(ch,{})),_(!0)):H&&Je.error("Please log in and load a game",{id:k})},width:40,initialPosition:K("uploadsave-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"uploadsave-button",enabled:U(R==null?void 0:R.SendSaveToServer)},{children:o.jsx(Nm,{}),onClick:()=>{const O=p==null?void 0:p.loadSaveState(L);z(!!O,`Loaded slot: ${L}`,`Failed to load slot: ${L}`)},width:40,initialPosition:K("loadstate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"loadstate-button",enabled:U(R==null?void 0:R.LoadState)},{children:o.jsx(Um,{}),onClick:()=>{const O=p==null?void 0:p.createSaveState(L);z(!!O,`Saved slot: ${L}`,`Failed to save slot: ${L}`)},width:40,initialPosition:K("savestate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"savestate-button",enabled:U(R==null?void 0:R.SaveState)}];return o.jsxs(Kn.Provider,{value:{color:l.pureWhite,size:"2em"},children:[B&&o.jsx(eh,{initialPosition:K("o-pad")}),q.map(O=>o.jsx(nh,{ariaLabel:dh(O.keyName),inputName:O.keyName,...O},O.keyName))]})},fh={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:400},content:{width:"calc(100dvw - 20px)",height:"fit-content",margin:"25px auto auto auto",backgroundColor:"#fff",inset:"10px",maxWidth:"500px",padding:"0",maxHeight:"90dvh",display:"flex",touchAction:"none",flexDirection:"column",userSelect:"text"}},mh=()=>{const{modalContent:l,isModalOpen:m,setIsModalOpen:i}=Ce(),{emulator:p}=pe();return o.jsx(Om,{appElement:document.getElementById("root")||void 0,closeTimeoutMS:400,isOpen:m,style:fh,onRequestClose:()=>i(!1),onAfterOpen:p==null?void 0:p.disableKeyboardInput,onAfterClose:p==null?void 0:p.enableKeyboardInput,aria:{labelledby:"modalHeader"},children:l})},cr=250,ph=A.li`
  color: ${({theme:l})=>l.gbaThemeBlue};
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}
`,hh=A(Lr)`
  background-color: unset;
  border: none;
  color: inherit;
  cursor: pointer;
  height: 100%;
  padding: 0.5rem 1rem;
  text-align: inherit;
  width: 100%;

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,vh=A.span`
  margin-left: 0.5rem;
`,gh=A.ul`
  padding-left: 2rem;
`,On=({title:l,icon:m,children:i,$isExpanded:p=!1,$disabled:x=!1})=>{const[y,g]=P.useState(p?"auto":0);return P.useEffect(()=>{g(p?"auto":0)},[p]),o.jsxs(ph,{$disabled:x,children:[o.jsxs(hh,{disabled:x,onClick:()=>{g(y===0?"auto":0)},children:[m,o.jsx(vh,{children:l})]}),o.jsx(Gm,{duration:350,easing:"ease-in-out",height:y,children:o.jsx(gh,{children:i})})]})},xh=A.li`
  cursor: pointer;
  color: ${({theme:l})=>l.gbaThemeBlue};
  list-style-type: none;
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,bh=A(Lr)`
  background-color: unset;
  border: none;
  color: inherit;
  height: 100%;
  margin: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};

  text-align: inherit;
  width: 100%;
  cursor: pointer;
`,_h=A.span`
  margin-left: 0.5rem;
`,yh=A.a`
  display: block;
  text-decoration: none;
  color: unset;
  outline-offset: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};
`,Fe=({title:l,icon:m,onClick:i=void 0,$link:p=void 0,$disabled:x=!1,$withPadding:y=!1})=>{const g=o.jsxs(o.Fragment,{children:[m,o.jsx(_h,{children:l})]});return o.jsx(xh,{$disabled:x,children:p?o.jsx(yh,{href:p,$withPadding:y,target:"_blank",children:g}):o.jsx(bh,{disabled:x,onClick:i,$withPadding:y,children:g})})},wh=()=>{const{setIsModalOpen:l}=Ce(),[,m]=je($t);return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"About"}),o.jsxs(Ue,{children:[o.jsx("p",{children:"Gbajs3 is a full featured Game Boy Advance emulator meant to operate online and offline in the browser."}),o.jsx("p",{children:"We currently support the mGBA core through the use of webassembly."}),o.jsx("p",{children:"Getting Started:"}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Using the ",o.jsx("i",{children:"Pre Game Actions"})," menu, upload a sav file if you have one available"]}),o.jsxs("li",{children:["Then, load a rom of your choice through the ",o.jsx("i",{children:"Upload Rom"})," or"," ",o.jsx("i",{children:"Load Local Rom"})," menu items"]}),o.jsx("li",{children:"Enjoy, your game will boot!"})]})]}),o.jsxs(Oe,{children:[o.jsx(ie,{variant:"contained",onClick:()=>{m({}),l(!1)},children:"Take a tour"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},ga=Lt`
  100% {
    stroke-dashoffset: 0;
  }
`,Sh=Lt`
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
`,Eh=Lt`
  100% {
    box-shadow: inset 0 0 0 100vh var(--checkmark-fill-color);
  }
`,Ch=A.svg`
  position: absolute;
  width: 24px;
  height: 24px;

  display: block;
  margin-left: auto;
  margin-right: auto;
  border-radius: 50%;
  stroke: ${({theme:l})=>l.pureWhite};
  stroke-width: 5;
  stroke-miterlimit: 10;
  animation: ${Eh} 0.2s ease-in-out 0.2s forwards,
    ${Sh} 0.12s ease-in-out 0.45s both;
`,kh=A.circle`
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 5;
  stroke-miterlimit: 10;
  stroke: ${({theme:l})=>l.checkMarkGreen};
  fill: none;
  animation: ${ga} 0.3s cubic-bezier(0.65, 0, 0.45, 1) forwards;
`,jh=A.path`
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: ${ga} 0.15s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
`,Lh=A.span`
  ${({$isSuccessCheckVisible:l=!1})=>l&&"visibility: hidden;"}
`,yr=({copy:l,msDuration:m=1100,onClick:i,showSuccess:p=!0,...x})=>{const y=P.useId(),[g,_]=P.useState(!1),j=!!p&&g;return kt(()=>_(!1),j?m:null),o.jsxs(ie,{onClick:k=>{_(!0),i==null||i(k)},variant:"contained",...x,children:[j&&o.jsxs(Ch,{role:"graphics-symbol","aria-labelledby":y,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52",children:[o.jsx("title",{id:y,children:"Circle Check"}),o.jsx(kh,{cx:"26",cy:"26",r:"25",fill:"none"}),o.jsx(jh,{fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),o.jsx(Lh,{$isSuccessCheckVisible:j,children:l})]})},xr=Yr.forwardRef(({id:l,label:m,watcher:i,...p},x)=>o.jsx(Zn,{"data-testid":"managed-checkbox:label",id:l,control:o.jsx(mp,{ref:x,checked:!!i,...p}),label:m,style:{margin:0}})),Fh=A.ul`
  list-style: none;
  display: ${({$shouldHide:l=!1})=>l?"none":"flex"};
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  margin: 0;
  max-width: 100%;
`,Rh=A.li`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding-bottom: 10px;
  width: 100%;
`,Th=A(zm)`
  min-height: 40px;
  min-width: 40px;
`,Ph=A(Qn)`
  width: 25px;
  height: 25px;
`,Gn=A.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: ${({$fullWidth:l=!1})=>l?"100%":"auto"};

  @media ${({theme:l})=>l.isLargerThanPhone} {
    flex-direction: row;
  }
`,Mh=A.div`
  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: space-between;
`,Ah=A.p`
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
  margin-top: ${({$withMargin:l=!1})=>l?"5px":"0"};
`,Dh=()=>{var q;const l=Te(),m=ir(l.isLargerThanPhone),{setIsModalOpen:i}=Ce(),{emulator:p}=pe(),[x,y]=P.useState(!1),g=P.useId(),_={desc:"",code:"",enable:!1},[j,k]=P.useMemo(()=>{const V=p==null?void 0:p.getCurrentCheatsFile(),O=new TextDecoder().decode(V);return[O,p==null?void 0:p.parseCheatsString(O)]},[p]),{register:E,control:L,handleSubmit:R,watch:$,setValue:U,formState:{errors:B,isSubmitSuccessful:H}}=dr({defaultValues:{rawCheats:j,cheats:k!=null&&k.length?k:[_]}}),{fields:G,append:Y,remove:te}=qm({control:L,name:"cheats"}),K=P.useCallback(()=>{const V=p==null?void 0:p.getCurrentCheatsFile(),O=new TextDecoder().decode(V),f=(p==null?void 0:p.parseCheatsString(O))??[];x?U("cheats",f):U("rawCheats",O)},[p,U,x]),z=[{content:o.jsx("p",{children:"Use this form to enter, add, and delete cheats."}),target:`#${CSS.escape(`${g}--cheats-form`)}`},{content:o.jsx("p",{children:"This form field is for the name of the cheat."}),target:`#${CSS.escape(`${g}--name`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Put your cheat code into this field."}),o.jsx("p",{children:"Remember to separate multi-line cheats with the '+' character!"})]}),target:`#${CSS.escape(`${g}--cheat-code`)}`},{content:o.jsx("p",{children:"Use the checkbox to enable/disable a cheat."}),placement:"right",target:`#${CSS.escape(`${g}--enabled`)}`},{content:o.jsx("p",{children:"Use the trash button to remove a cheat entirely."}),placement:"right",target:`#${CSS.escape(`${g}--remove`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new cheat."]}),target:`#${CSS.escape(`${g}--add-cheat`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Submit"})," button to save your cheats, and convert them to libretro format."]}),target:`#${CSS.escape(`${g}--submit-button`)}`},{content:o.jsx("p",{children:"Use this button to toggle between viewing parsed cheats or raw cheats in libretro file format."}),placement:"right",target:`#${CSS.escape(`${g}--toggle-raw-cheats`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Manage Cheats"}),o.jsx(Ue,{children:o.jsxs("form",{"aria-label":"Cheats Form",id:`${g}--cheats-form`,onSubmit:R(V=>{const O=x?new File([new Blob([V.rawCheats],{type:"text/plain"})],(p==null?void 0:p.getCurrentCheatsFileName())??"unknown.cheats"):p==null?void 0:p.parsedCheatsToFile(V.cheats);O&&(p==null||p.uploadCheats(O,()=>{p.autoLoadCheats(),K()}))}),children:[o.jsx(or,{error:!!(B!=null&&B.rawCheats),label:"Raw Libretro Cheats",InputLabelProps:{shrink:!0},multiline:!0,fullWidth:!0,minRows:6,variant:"outlined",InputProps:{sx:{textarea:{whiteSpace:"pre",overflowX:"auto !important"}}},helperText:(q=B==null?void 0:B.rawCheats)==null?void 0:q.message,style:{display:x?"block":"none"},...E("rawCheats")}),o.jsx(Fh,{$shouldHide:x,children:G.map((V,O)=>{var X,W,oe,ne,_e,he,Ne,Xe,rr,tr;const f=fr=>O===0?fr:void 0;return o.jsxs(Rh,{children:[o.jsxs(Gn,{$fullWidth:!0,children:[o.jsx(or,{id:f(`${g}--name`),label:"Name",error:!!((W=(X=B==null?void 0:B.cheats)==null?void 0:X[O])!=null&&W.desc),size:"small",autoComplete:"Name",style:m?{maxWidth:100}:void 0,helperText:(_e=(ne=(oe=B==null?void 0:B.cheats)==null?void 0:oe[O])==null?void 0:ne.desc)==null?void 0:_e.message,...E(`cheats.${O}.desc`,{required:{value:!0,message:"required"}})}),o.jsx(or,{id:f(`${g}--cheat-code`),label:"Cheat Code",error:!!((Ne=(he=B==null?void 0:B.cheats)==null?void 0:he[O])!=null&&Ne.code),size:"small",autoComplete:"Code",helperText:(tr=(rr=(Xe=B==null?void 0:B.cheats)==null?void 0:Xe[O])==null?void 0:rr.code)==null?void 0:tr.message,...E(`cheats.${O}.code`,{required:{value:!0,message:"required"}})})]}),o.jsxs(Gn,{children:[o.jsx(xr,{id:f(`${g}--enabled`),label:"Enabled",watcher:$(`cheats.${O}.enable`),...E(`cheats.${O}.enable`)}),o.jsx(Ze,{"aria-label":"Delete",id:f(`${g}--remove`),sx:{padding:0,marginRight:"auto","&:hover":{borderRadius:"10px"},"&:focus":{borderRadius:"10px"},"& .MuiTouchRipple-root .MuiTouchRipple-child":{borderRadius:"10px"}},onClick:()=>te(O),children:o.jsx(Th,{})})]})]},V.id)})}),o.jsxs(Mh,{children:[o.jsx(Ze,{"aria-label":"Create new cheat",id:`${g}--add-cheat`,sx:{padding:0,display:x?"none":"flex"},onClick:()=>Y(_),children:o.jsx(Ph,{})}),o.jsx(Ah,{$withMargin:x,children:"Join multi-line codes with '+'"})]})]})}),o.jsxs(Oe,{children:[o.jsx(yr,{copy:"Submit",form:`${g}--cheats-form`,id:`${g}--submit-button`,showSuccess:H,type:"submit"}),o.jsx(ie,{id:`${g}--toggle-raw-cheats`,color:"info",variant:"contained",onClick:()=>y(V=>!V),children:x?"Parsed":"Raw"}),o.jsx(ie,{variant:"outlined",onClick:()=>i(!1),children:"Close"})]}),o.jsx(ze,{steps:z,completedProductTourStepName:"hasCompletedCheatsTour"})]})},Bh=A.form`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,Ih=({id:l,onAfterSubmit:m})=>{const{emulator:i}=pe(),{isRunning:p}=er(),{handleSubmit:x,setValue:y,control:g,formState:{errors:_}}=dr(),j=i==null?void 0:i.defaultKeyBindings(),[k,E]=je(ta),L=$=>{const U=Object.entries($).filter(([,B])=>!!B).map(([,B])=>B);p&&(i==null||i.remapKeyBindings(U)),E(U),m()},R=k??j;return o.jsx(Bh,{"aria-label":"Key Bindings Form",id:l,onSubmit:x(L),children:R==null?void 0:R.map($=>o.jsx(Qr,{control:g,name:$.gbaInput,defaultValue:$,rules:{validate:{noSpace:U=>U.key!==" "||"Space is reserved for accessibility requirements",noTab:U=>{var B;return((B=U.key)==null?void 0:B.toLowerCase())!=="tab"||"Tab is reserved for accessibility requirements"}}},render:({field:{value:U}})=>{var B;return o.jsx(or,{variant:"outlined",label:U.gbaInput,value:U.key,onKeyDown:H=>{H.key.toLowerCase()!=="tab"&&(y(U.gbaInput,{gbaInput:U.gbaInput,key:H.key,location:H.location}),H.preventDefault())},error:!!_[$.gbaInput],helperText:(B=_==null?void 0:_[$.gbaInput])==null?void 0:B.message})}},`gba_input_${$.gbaInput.toLowerCase()}`))})},$h=Yr.forwardRef(({id:l,label:m,watcher:i,...p},x)=>o.jsx(Zn,{"data-testid":"managed-switch:label",id:l,control:o.jsx(pp,{ref:x,checked:!!i,...p}),label:m,style:{margin:0}})),Nh=A.form`
  display: flex;
  flex-direction: column;
`,Uh=({id:l,onAfterSubmit:m})=>{const[i,p]=je(ca),x=Te(),y=ir(x.isLargerThanPhone),g=L=>L===void 0&&!y||!!L,{register:_,handleSubmit:j,watch:k}=dr({values:i??{OpadAndButtons:g(void 0),SaveState:g(void 0),LoadState:g(void 0),QuickReload:g(void 0),SendSaveToServer:g(void 0),NotificationsEnabled:!0},resetOptions:{keepDirtyValues:!0}}),E=async L=>{p(R=>({...R,...L})),m()};return o.jsxs(Nh,{"aria-label":"Virtual Controls Form",id:l,onSubmit:j(E),children:[o.jsx(xr,{label:"Virtual D-pad/Buttons",watcher:k("OpadAndButtons"),..._("OpadAndButtons")}),o.jsx(xr,{label:"Save State",watcher:k("SaveState"),..._("SaveState")}),o.jsx(xr,{label:"Load State",watcher:k("LoadState"),..._("LoadState")}),o.jsx(xr,{label:"Quick Reload",watcher:k("QuickReload"),..._("QuickReload")}),o.jsx(xr,{label:"Send save to server",watcher:k("SendSaveToServer"),..._("SendSaveToServer")}),o.jsx($h,{label:"Enable Notifications",watcher:k("NotificationsEnabled"),..._("NotificationsEnabled")})]})},Oh=A(hp)`
  border-bottom: 1px solid;
  border-color: rgba(0, 0, 0, 0.12);
`,Gh=A.div`
  padding: 24px;
`,Ct=l=>({id:`control-tab-${l}`,"aria-controls":`tabpanel-${l}`}),zn=({children:l,index:m,value:i})=>o.jsx("div",{role:"tabpanel",hidden:i!==m,id:`tabpanel-${m}`,"aria-labelledby":`tab-${m}`,children:i===m&&o.jsx(Gh,{children:l})}),zh=({setFormId:l,virtualControlsFormId:m,keyBindingsFormId:i,resetPositionsButtonId:p,setIsSuccessfulSubmit:x})=>{const{clearLayouts:y}=_r(),[g,_]=P.useState(0),j=(E,L)=>{_(L),l(L===0?m:i),x(!1)},k=()=>x(!0);return o.jsxs(o.Fragment,{children:[o.jsxs(Oh,{value:g,onChange:j,"aria-label":"Control tabs",children:[o.jsx($n,{label:"Virtual Controls",...Ct(0)}),o.jsx($n,{label:"Key Bindings",...Ct(1)})]}),o.jsxs(zn,{value:g,index:0,children:[o.jsx(Uh,{id:m,onAfterSubmit:k}),o.jsx(ie,{id:p,sx:{marginTop:"10px"},onClick:y,children:"Reset All Positions"})]}),o.jsx(zn,{value:g,index:1,children:o.jsx(Ih,{id:i,onAfterSubmit:k})})]})},qh=()=>{const{setIsModalOpen:l}=Ce(),m=P.useId(),[i,p]=P.useState(`${m}--virtual-controls-form`),[x,y]=P.useState(!1),g=[{content:o.jsx("p",{children:"Select which virtual controls you wish to enable in this form tab."}),target:`#${CSS.escape(`${m}--virtual-controls-form`)}`},{content:o.jsx("p",{children:"Use this button to reset the positions of the screen, control panel, and all virtual controls."}),target:`#${CSS.escape(`${m}--reset-positions-button`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the tab panel to change which form you are seeing."}),o.jsxs("p",{children:["Select the ",o.jsx("i",{children:"KEY BINDINGS"})," tab above, then click next!"]})]}),placement:"right",target:`#${CSS.escape(Ct(1).id)}`,disableBeacon:!0,disableOverlayClose:!0,hideCloseButton:!1,spotlightClicks:!0},{content:o.jsx("p",{children:"Remap keybindings by selecting a form field and typing your desired input."}),placement:"top-end",target:`#${CSS.escape(`${m}--key-bindings-form`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Save Changes"})," button to persist changes from the current form tab."]}),target:`#${CSS.escape(`${m}--save-changes-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Controls"}),o.jsx(Ue,{children:o.jsx(zh,{setFormId:p,virtualControlsFormId:`${m}--virtual-controls-form`,keyBindingsFormId:`${m}--key-bindings-form`,resetPositionsButtonId:`${m}--reset-positions-button`,setIsSuccessfulSubmit:y})}),o.jsxs(Oe,{children:[o.jsx(yr,{copy:"Save Changes",form:i,id:`${m}--save-changes-button`,type:"submit",showSuccess:x}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(ze,{steps:g,completedProductTourStepName:"hasCompletedControlsTour"})]})},Vh=()=>{const l=Te(),{setIsModalOpen:m}=Ce(),{emulator:i}=pe(),p=P.useId(),[x,y]=P.useState(!1),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to download your current save file."}),o.jsx("p",{children:"Remember to save in game before downloading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Download Save"}),o.jsx(Ue,{children:x?o.jsx(lr,{icon:o.jsx(sr,{style:{color:l.errorRed}}),text:"Load a rom to download its save file"}):o.jsx(kr,{children:"Remember to save in game before downloading your save file!"})}),o.jsxs(Oe,{children:[o.jsx(ie,{id:p,variant:"contained",onClick:()=>{const _=i==null?void 0:i.getCurrentSave(),j=i==null?void 0:i.getCurrentSaveName();if(_&&j){const k=new Blob([_],{type:"data:application/octet-stream"}),E=document.createElement("a");E.download=j,E.href=URL.createObjectURL(k),E.click(),E.remove()}else y(!0)},children:"Download"}),o.jsx(ie,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(ze,{steps:g,completedProductTourStepName:"hasCompletedDownloadSaveTour"})]})},Hh=l=>o.jsx(Rt,{"data-testid":"action-box:minus",className:"minus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})}),Wh=l=>o.jsx(Rt,{"data-testid":"action-box:plus",className:"plus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})}),Xh=l=>o.jsx(Rt,{"data-testid":"action-box:close",className:"close",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})}),Kh=vp(l=>o.jsx(gp,{...l}))(({theme:l})=>({marginTop:5,[`& .${yt.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${yt.groupTransition}`]:{marginLeft:15,paddingLeft:10,borderLeft:`1px dashed ${xp(l.palette.text.primary,.4)}`},[`& .${yt.content}`]:{width:"auto",alignItems:"baseline"}})),Yh=A.div`
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: space-between;

  > p {
    margin: 0;
    word-wrap: break-word;
    max-width: 100%;
  }
`,Qh=A.div`
  display: flex;
  gap: 15px;
`,Jh=({id:l,allFiles:m,deleteFile:i,downloadFile:p})=>{if(!m)return null;const x=y=>{const g=y.path.split("/").pop(),_=o.jsxs(Yh,{children:[o.jsx("p",{children:g}),o.jsxs(Qh,{children:[o.jsx(Ze,{"aria-label":`Download ${g}`,sx:{padding:0,margin:0},onClick:()=>p(y.path),children:o.jsx(Jn,{})}),o.jsx(Ze,{"aria-label":`Delete ${g}`,sx:{padding:0},onClick:()=>i(y.path),children:o.jsx(Ft,{})})]})]});return o.jsx(Kh,{itemId:y.path,label:y.isDir?g:_,children:y.isDir&&y.children?y.children.map(j=>x(j)):null},y.path)};return o.jsx(bp,{id:l,"aria-label":"File System",defaultExpandedItems:[m.path],slots:{collapseIcon:Hh,endIcon:Xh,expandIcon:Wh},sx:{minHeight:264},children:x(m)})},Zh=()=>{const{setIsModalOpen:l}=Ce(),{emulator:m}=pe(),[i,p]=P.useState(),x=P.useId(),y=P.useCallback(k=>{m==null||m.deleteFile(k),p(m==null?void 0:m.listAllFiles())},[m]),g=k=>{const E=k.split("/").pop(),L=m==null?void 0:m.getFile(k);if(L&&E){const R=new Blob([L],{type:"data:application/octet-stream"}),$=document.createElement("a");$.download=E,$.href=URL.createObjectURL(R),$.click(),$.remove()}},_=i??(m==null?void 0:m.listAllFiles()),j=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to view your current file tree, download files, and delete files from the tree."}),o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," and ",o.jsx("i",{children:"minus"})," icons to open and close file tree branches!"]})]}),target:`#${CSS.escape(`${x}--emulator-fs`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"SAVE FILE SYSTEM"})," button to persist all of your files to your device!"]}),target:`#${CSS.escape(`${x}--save-file-system-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"File System"}),o.jsx(Ue,{children:o.jsx(Jh,{id:`${x}--emulator-fs`,allFiles:_,deleteFile:y,downloadFile:g})}),o.jsxs(Oe,{children:[o.jsx(yr,{copy:"Save File System",id:`${x}--save-file-system-button`,onClick:m==null?void 0:m.fsSync}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(ze,{steps:j,completedProductTourStepName:"hasCompletedFileSystemTour"})]})},Wr=A.button`
  padding: 0.5rem 1rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  text-decoration: none;
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Xr=A.li`
  cursor: pointer;
`,ev=A.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Xr}:first-child > ${Wr} {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Xr}:last-child > ${Wr} {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Xr}:not(:first-child) > ${Wr} {
    border-top-width: 0;
  }
`,rv=()=>{var _,j,k;const{setIsModalOpen:l}=Ce(),{emulator:m}=pe(),i=P.useId(),p=et(),x=[".",".."],y=(j=(_=m==null?void 0:m.listRoms)==null?void 0:_.call(m))==null?void 0:j.filter(E=>!x.includes(E)),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to load local roms that have been saved to your device."}),o.jsx("p",{children:"Tap the name of your rom file and your game will boot!"}),o.jsxs("p",{children:["To persist roms and other files, use the ",o.jsx("i",{children:"File System"})," menu item."]})]}),target:`#${CSS.escape(i)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Load Local Rom"}),o.jsx(Ue,{children:o.jsxs(ev,{id:i,children:[(k=y==null?void 0:y.map)==null?void 0:k.call(y,(E,L)=>o.jsx(Xr,{children:o.jsx(Wr,{onClick:()=>{p((m==null?void 0:m.filePaths().gamePath)+"/"+E),l(!1)},children:E})},`${E}_${L}`)),!(y!=null&&y.length)&&o.jsx("li",{children:o.jsx(kr,{children:"No local roms, load a game and save your file system"})})]})}),o.jsx(Oe,{children:o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})}),o.jsx(ze,{steps:g,completedProductTourStepName:"hasCompletedLoadLocalRomTour"})]})},tv=A.button`
  padding: 0.5rem 0.5rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: none;
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Kr=A.li`
  cursor: pointer;
  display: grid;
  grid-template-columns: auto 32px;
  gap: 10px;

  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
`,nv=A.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Kr}:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Kr}:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Kr}:not(:first-child) {
    border-top-width: 0;
  }
`,av=A(Qn)`
  width: 25px;
  height: 25px;
`,ov=A(Ft)`
  height: 100%;
  width: 20px;
`,sv=A.form`
  display: flex;
  justify-content: space-between;
  gap: 16px;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  margin-bottom: 16px;
  padding-bottom: 16px;
`,iv=()=>{var te,K,z;const l=Te(),{setIsModalOpen:m}=Ce(),{emulator:i}=pe(),[p,x]=P.useState(),[y,g]=P.useState(null),[_,j]=je(la,0),k=P.useId(),{register:E,handleSubmit:L,setValue:R,formState:{errors:$,isSubmitSuccessful:U}}=dr({defaultValues:{saveStateSlot:_}}),B=P.useCallback(()=>{var V;const q=(V=i==null?void 0:i.listSaveStates())==null?void 0:V.filter(O=>O!=="."&&O!=="..");x(q)},[i]);P.useEffect(()=>{R("saveStateSlot",_)},[_,R]);const H=async q=>{j(q.saveStateSlot)},G=p??((te=i==null?void 0:i.listSaveStates())==null?void 0:te.filter(q=>q!=="."&&q!=="..")),Y=[{content:o.jsx("p",{children:"Use this input and button to manually update the current save state slot in use."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${k}--save-state-slot-form`)}`},{content:o.jsx("p",{children:"Tap a row to load a save state, or use the trash can icon to delete a save state."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${k}--save-state-list`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new save state. This will automatically increase the current save state number!"]}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${k}--add-state-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Manage Save States"}),o.jsxs(Ue,{children:[o.jsxs(sv,{id:`${k}--save-state-slot-form`,onSubmit:L(H),children:[o.jsx(or,{label:"Current Save State Slot",type:"number",InputLabelProps:{shrink:!0},size:"small",error:!!($!=null&&$.saveStateSlot),helperText:(K=$==null?void 0:$.saveStateSlot)==null?void 0:K.message,...E("saveStateSlot",{required:{value:!0,message:"Slot is required"},min:{value:0,message:"Slot must be >= 0"},valueAsNumber:!0})}),o.jsx(yr,{copy:"Update Slot",showSuccess:U,size:"small",type:"submit",sx:{maxHeight:"40px"}})]}),o.jsxs(nv,{id:`${k}--save-state-list`,children:[(z=G==null?void 0:G.map)==null?void 0:z.call(G,(q,V)=>o.jsxs(Kr,{children:[o.jsx(tv,{onClick:()=>{const O=q.split(".").pop(),f=O==null?void 0:O.replace("ss","");if(f){const X=parseInt(f);(i==null?void 0:i.loadSaveState(X))?(j(X),g(null)):g("Failed to load save state")}},children:q}),o.jsx(Ze,{"aria-label":`Delete ${q}`,sx:{padding:0},onClick:()=>{const O=q.split(".").pop(),f=O==null?void 0:O.replace("ss","");if(f){const X=parseInt(f);i==null||i.deleteSaveState(X),B()}},children:o.jsx(ov,{})})]},`${q}_${V}`)),!(G!=null&&G.length)&&o.jsx("li",{children:o.jsx(kr,{children:"No save states"})})]}),o.jsx(Ze,{id:`${k}--add-state-button`,"aria-label":"Create new save state",sx:{padding:0},onClick:()=>{(i==null?void 0:i.createSaveState(_+1))?(B(),j(V=>V+1),g(null)):g("Failed to create save state")},children:o.jsx(av,{})}),y&&o.jsx(lr,{icon:o.jsx(sr,{style:{color:l.errorRed}}),text:y})]}),o.jsx(Oe,{children:o.jsx(ie,{variant:"outlined",onClick:()=>m(!1),children:"Close"})}),o.jsx(ze,{steps:Y,completedProductTourStepName:"hasCompletedSaveStatesTour"})]})},lv=A.div`
  cursor: pointer;
  border-color: ${({theme:l})=>l.blackRussian};
  background-color: ${({$isDragActive:l=!1,theme:m})=>l?m.arcticAirBlue:m.aliceBlue2};
  border-width: 1px;
  border-style: dashed;
  padding: 0.5rem;
  text-align: center;
`,cv=A(Et)`
  height: 60px;
  width: auto;
`,dv=A.div`
  padding-top: 3px;
`,uv=A.ul`
  display: flex;
  flex-direction: column;
  gap: 10px;
  list-style: none;
  margin: 0;
  max-width: 100%;
  padding: 10px 5px 5px 5px;

  > p {
    margin: 0;
  }
`,fv=A.li`
  align-items: center;
  display: flex;
  gap: 10px;
  justify-content: space-between;

  > p {
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
`,mv=A.div`
  display: flex;
  gap: 15px;
`,pv=({fileNames:l,onDeleteFile:m})=>o.jsxs(uv,{children:[o.jsxs("p",{children:["File",l.length>1&&"s"," to upload:"]}),l.map((i,p)=>o.jsxs(fv,{children:[o.jsx("p",{children:i}),o.jsx(mv,{children:o.jsx(Ze,{"aria-label":`Delete ${i}`,sx:{padding:0},onClick:()=>m(i),children:o.jsx(Ft,{})})})]},`${i}_${p}`))]}),hv=(l,m)=>{const i=`.${l.name.split(".").pop()}`;return m.some(p=>typeof p=="string"?p===i:!!p.regex.exec(i))},wt=l=>typeof l=="string"?l:l.displayText,vv=(l,m)=>{if(!l.length)return;const i=m?"At least one":"One";let p=`${i} `+l.slice(0,-1).map(wt).join(", ")+`, or ${wt(l.slice(-1)[0])} file is required`;return l.length==1&&(p=`${i} ${wt(l[0])} file is required`),x=>!(x instanceof File)||x&&hv(x,l)?null:{message:p,code:Hm.FileInvalidType}},Nt=({ariaLabel:l,children:m,error:i,hideAcceptedFiles:p,hideErrors:x,id:y,multiple:g=!1,name:_,onDrop:j,validFileExtensions:k})=>{const E=Te(),[L,R]=P.useState([]),{getRootProps:$,getInputProps:U,isDragActive:B,fileRejections:H}=Vm({multiple:g,onDrop:K=>{R(K),j(K)},validator:vv(k,g)}),G=i?[i]:H.length&&L.length?["Some files were rejected"]:[...new Set(H.flatMap(K=>K.errors).map(K=>K.message))],Y=K=>{const z=L.filter(q=>q.name!==K);R(z),j(z)},te=L.map(K=>K.name);return o.jsxs(o.Fragment,{children:[o.jsxs(lv,{...$({id:y,$isDragActive:B,"aria-label":l}),children:[o.jsx("input",{"data-testid":"hidden-file-input",...U({name:_})}),o.jsx(cv,{}),m]}),!!te.length&&!p&&o.jsx(pv,{fileNames:te,onDeleteFile:Y}),!!G.length&&!x&&o.jsx(dv,{children:G.map(K=>o.jsx(lr,{icon:o.jsx(sr,{style:{color:E.errorRed}}),text:K},K))})]})},gv=[".cheats"],xv=()=>{const{setIsModalOpen:l}=Ce(),{emulator:m}=pe(),{reset:i,handleSubmit:p,setValue:x,formState:{isSubmitSuccessful:y},control:g}=dr(),_=P.useId(),j=P.useCallback(L=>{i(),x("cheatFiles",L,{shouldValidate:!0})},[i,x]),k=({cheatFiles:L})=>{L.forEach(R=>m==null?void 0:m.uploadCheats(R)),i()},E=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your cheat files, or click to select files."}),o.jsx("p",{children:"Cheat files should be in libretro format and have the extension '.cheats'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${_}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Cheats"}),o.jsx(Ue,{children:o.jsxs("form",{id:_,"aria-label":"Upload Cheats Form",onSubmit:p(k),children:[o.jsx(Qr,{control:g,name:"cheatFiles",rules:{validate:L=>(L==null?void 0:L.length)>0||"At least one .cheats file is required"},render:({field:{name:L,value:R},fieldState:{error:$}})=>o.jsx(Nt,{ariaLabel:"Upload Cheats",id:`${_}--drag-and-drop`,onDrop:j,name:L,validFileExtensions:gv,error:$==null?void 0:$.message,hideAcceptedFiles:!(R!=null&&R.length),hideErrors:y,multiple:!0,children:o.jsxs("p",{children:["Drag and drop cheat files here,",o.jsx("br",{}),"or click to upload files"]})})}),y&&o.jsx(fa,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Oe,{children:[o.jsx(yr,{copy:"Upload",form:_,showSuccess:y,type:"submit"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(ze,{steps:E,completedProductTourStepName:"hasCompletedUploadCheatsTour"})]})},bv=()=>{const l=P.useCallback(async y=>{var R,$,U;const g={method:"GET"};if(!y)return;const _=await fetch(y.url,g),j=(U=($=(R=_.headers.get("Content-Disposition"))==null?void 0:R.split(";").pop())==null?void 0:$.split("=").pop())==null?void 0:U.replace(/"/g,""),k=decodeURIComponent(y.url.pathname.split("/").pop()??"unknown_external.gba");if(!_.ok)throw new Error(`Received unexpected status code: ${_.status}`);const E=await _.blob();return new File([E],j??k)},[]),{data:m,isLoading:i,error:p,execute:x}=jr({fetchFn:l,clearDataOnLoad:!0});return{data:m,isLoading:i,error:p,execute:x}},_v=A.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,yv=A.p`
  word-wrap: break-word;
  max-width: 100%;
`,qn=[".gba",".gbc",".gb",".zip",".7z"],wv=({isLoading:l,currentRomURL:m,children:i,indicator:p})=>l?o.jsxs(_v,{children:[o.jsxs(yv,{children:["Loading rom from url:",o.jsx("br",{}),m]}),p]}):i,Sv=()=>{var V,O;const l=Te(),{setIsModalOpen:m}=Ce(),{emulator:i}=pe(),{register:p,handleSubmit:x,setValue:y,reset:g,formState:{errors:_},watch:j,control:k}=dr(),[E,L]=P.useState(null),{data:R,isLoading:$,error:U,execute:B}=bv(),H=P.useId(),G=et(),Y=!$&&!!R&&!!E;P.useEffect(()=>{if(Y){const f=()=>{G((i==null?void 0:i.filePaths().gamePath)+"/"+R.name)&&m(!1)};i==null||i.uploadRom(R,f),L(null)}},[Y,R,i,m,G]);const te=P.useCallback(f=>{g(),y("romFile",f[0],{shouldValidate:!0})},[g,y]),K=async({romFile:f,romURL:X})=>{if(X){L(X),await B({url:new URL(X)});return}const W=()=>{G((i==null?void 0:i.filePaths().gamePath)+"/"+f.name)&&m(!1)};i==null||i.uploadRom(f,W)},z=!!j("romFile"),q=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your rom or zipped rom file, or click to select a file."}),o.jsxs("p",{children:["Rom files should have an extension of:"," ",qn.map(f=>`'${f}'`).join(", "),"."]}),o.jsx("p",{children:"You may drop or select one rom at a time, once uploaded your game will boot!"})]}),target:`#${CSS.escape(`${H}--drag-and-drop`)}`},{content:o.jsx("p",{children:"Alternatively, you may load a rom file from an external URL."}),target:`#${CSS.escape(`${H}--rom-url`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Rom"}),o.jsx(Ue,{children:o.jsx(wv,{isLoading:$,currentRomURL:E,indicator:o.jsx(jt,{color:l.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),children:o.jsxs("form",{id:H,"aria-label":"Upload Rom Form",onSubmit:x(K),children:[o.jsx(Qr,{control:k,name:"romFile",rules:{validate:(f,X)=>!!X.romURL||!!f||"A rom file or URL is required"},render:({field:{name:f},fieldState:{error:X}})=>o.jsx(Nt,{ariaLabel:"Upload Rom",id:`${H}--drag-and-drop`,onDrop:te,name:f,validFileExtensions:qn,hideErrors:!!X,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})}),!z&&o.jsxs(o.Fragment,{children:[o.jsx(ea,{sx:{padding:"10px 0"},children:"or"}),o.jsx(or,{id:`${H}--rom-url`,error:!!(_!=null&&_.romURL),label:"Upload from a URL",size:"small",autoComplete:"romURL",variant:"filled",helperText:(V=_==null?void 0:_.romURL)==null?void 0:V.message,"aria-label":"Upload Rom From URL",fullWidth:!0,...p("romURL",{validate:(f,X)=>{if(!f)return!0;if(X.romFile)return"Cannot specify both a file and a URL";try{return new URL(f),!0}catch{return"Invalid URL"}}})}),!!U&&o.jsx(lr,{icon:o.jsx(sr,{style:{color:l.errorRed}}),text:"Loading rom from URL has failed"})]}),((O=_.romFile)==null?void 0:O.message)&&o.jsx(lr,{icon:o.jsx(sr,{style:{color:l.errorRed}}),text:_.romFile.message})]})})}),o.jsxs(Oe,{children:[o.jsx(ie,{form:H,type:"submit",variant:"contained",children:"Upload"}),o.jsx(ie,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(ze,{steps:q,completedProductTourStepName:"hasCompletedUploadRomTour"})]})},Ev=[".sav",{regex:/\.ss[0-9]+/,displayText:".ss"}],Cv=()=>{const{setIsModalOpen:l}=Ce(),{emulator:m}=pe(),{reset:i,handleSubmit:p,setValue:x,formState:{isSubmitSuccessful:y},control:g}=dr(),_=P.useId(),j=P.useCallback(L=>{i(),x("saveFiles",L,{shouldValidate:!0})},[i,x]),k=({saveFiles:L})=>{L.forEach(R=>m==null?void 0:m.uploadSaveOrSaveState(R)),i()},E=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your save or save state files, or click to select files."}),o.jsx("p",{children:"The name of your files must match the name of your rom."}),o.jsx("p",{children:"Save and save state files should have an extension '.sav' or start with '.ss'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${_}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Re,{title:"Upload Saves"}),o.jsx(Ue,{children:o.jsxs("form",{id:_,"aria-label":"Upload Saves Form",onSubmit:p(k),children:[o.jsx(Qr,{control:g,name:"saveFiles",rules:{validate:L=>(L==null?void 0:L.length)>0||"At least one .sav, or .ss file is required"},render:({field:{name:L,value:R},fieldState:{error:$}})=>o.jsx(Nt,{ariaLabel:"Upload Saves",id:`${_}--drag-and-drop`,onDrop:j,name:L,validFileExtensions:Ev,error:$==null?void 0:$.message,hideAcceptedFiles:!(R!=null&&R.length),hideErrors:y,multiple:!0,children:o.jsx("p",{children:"Drag and drop save or save state files here, or click to upload files"})})}),y&&o.jsx(fa,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(Oe,{children:[o.jsx(yr,{copy:"Upload",form:_,showSuccess:y,type:"submit"}),o.jsx(ie,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(ze,{steps:E,completedProductTourStepName:"hasCompletedUploadSavesTour"})]})},kv=()=>{const[l,m]=P.useState(0),i=P.useCallback(_=>_?new Promise((j,k)=>{const E=new XMLHttpRequest;E.open("GET",_.url,!0),E.responseType="arraybuffer",E.overrideMimeType("text/plain; charset=x-user-defined"),E.onprogress=function(L){if(L.lengthComputable){const R=L.loaded/L.total*100;m(R)}},E.onload=()=>{var L,R;if(E.status>=200&&E.status<300){const $=E.getResponseHeader("Content-Disposition"),U=(R=(L=$==null?void 0:$.split(";").pop())==null?void 0:L.split("=").pop())==null?void 0:R.replace(/"/g,""),B=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.gba"),H=new File([E.response],_.fullName??U??B);if(_.patchFile!=null&&_.patchFile!=""){console.log("applying bps patch to file: "+_.patchFile);const G=new XMLHttpRequest;G.open("GET",_.patchFile,!0),G.responseType="arraybuffer",G.overrideMimeType("text/plain; charset=x-user-defined"),G.onload=()=>{const Y=new Uint8Array(G.response),{instructions:te,checksum:K}=Wm(Y);console.log(K);const z=new Uint8Array(E.response),q=Xm(te,z),V=new File([q],_.fullName??U??B);j(V)},G.onerror=()=>{console.error("Request for patch file failed"),k(new Error("Network error occurred: Patch File"))},G.send(null)}else console.log("resolved file"),j(H)}else console.error("Request failed2"),k(new Error(`Received unexpected status code: ${E.status}`))},E.onerror=()=>{console.error("Request failed"),k(new Error("Network error occurred"))},E.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:x,error:y,execute:g}=jr({fetchFn:i,clearDataOnLoad:!0});return{data:p,isLoading:x,error:y,execute:g,progress:l}},jv=()=>{const[l,m]=P.useState(0),i=P.useCallback(_=>_?new Promise((j,k)=>{console.log(_.fullName);const E=new XMLHttpRequest;E.open("GET",_.url,!0),E.responseType="arraybuffer",E.overrideMimeType("text/plain; charset=x-user-defined"),E.onprogress=function(L){if(L.lengthComputable){const R=L.loaded/L.total*100;m(R)}},E.onload=()=>{var L,R;if(E.status>=200&&E.status<300){const $=E.getResponseHeader("Content-Disposition"),U=(R=(L=$==null?void 0:$.split(";").pop())==null?void 0:L.split("=").pop())==null?void 0:R.replace(/"/g,""),B=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.sav"),H=new File([E.response],_.fullName??U??B);j(H)}else k(new Error(`Received unexpected status code: ${E.status}`))},E.onerror=()=>{console.error("Request failed"),k(new Error("Network error occurred"))},E.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:x,error:y,execute:g}=jr({fetchFn:i,clearDataOnLoad:!0});return{data:p,isLoading:x,error:y,execute:g,progress:l}},xa=l=>(console.log("Save Type: "+l),l[0]=="N"?0:l[0]=="E"?1:l[0]=="S"?3:l[0]=="F"&&l[5]=="1"?5:l[0]=="F"?4:l[0]=="R"&&l[11]=="1"?55:(console.log("Invalid Save Type"),-1)),Lv=(l,m)=>{let i=Number(m.cartSize/1024/1024),p="";return i==1?p=l.checksum_1MB:i==2?p=l.checksum_2MB:i==4?p=l.checksum_4MB:i==8?p=l.checksum_8MB:i==16&&(p=l.checksum_16MB),p.toUpperCase()},Fv=l=>new Promise(m=>setTimeout(m,l)),Rv=async l=>{let m,i,p;try{if(m=await(await fetch(`${l}/get_game_info`,{method:"GET",headers:{"Access-Control-Request-Private-Network":"true"}})).json(),i=await(await fetch(`./information_rom/${m.cartID}.json`)).json(),p=Lv(m,i),p!=i.checksum1000){console.log("Checksums do not match. Trying to get a different one...");try{const g=await fetch(`./information_rom/${p}-${m.cartID}.json`);if(!g.ok||g.status!=200)throw new Error(`HTTP error! Status: ${g.status}`);let _=await g.json();_&&Object.keys(_).length>0?(console.log("Additional Data exists"),i=_):console.log("Additional Data does not exist or is empty")}catch(g){console.error("An error occurred while fetching additional data: ",g)}}return[m,i,p]}catch(x){console.error("Error fetching game information:",x)}finally{return[m,i,""]}},Tv=A.form`
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100dvw;
  max-width: fill-available;
  max-width: stretch;
  max-width: -webkit-fill-available;
  max-width: -moz-available;
`,Pv=A.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,He=A.p`
  margin: 0;
  font-size: 16px;
`,We=A.strong`
`,$e=A.option`
`,Vn=A.select`
`,Mv=A.img`
  max-width: 75%;
  height: auto;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid black;
`,Av=A.div`
display: flex;
flex-direction: column;
align-items: center;
text-align: center;
margin: 0px auto;
padding: 0px;
max-width: 600px;
`,Dv=A.div`
display: flex;
gap: 10px;
width: 100%;
`,Bv=A.p`
  word-wrap: break-word;
  max-width: 100%;
`,Iv=A.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,$v=({isLoading:l,children:m,indicator:i,progress:p})=>l?o.jsxs(Pv,{children:[o.jsx(Bv,{children:"Dumping Rom from cartridge..."}),i,o.jsx(Iv,{progress:p,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(p),"%"]})})]}):m,Hn=({additionalData:l,setAdditionalData:m,gameData:i,setGameData:p,esp32IP:x,setEsp32IP:y})=>{const g=Te(),{setIsModalOpen:_}=Ce(),{emulator:j}=pe(),{data:k,isLoading:E,error:L,execute:R,progress:$}=kv(),{data:U,execute:B}=jv(),H=et(),[G,Y]=P.useState(!1),te=!E&&!!k,[K,z]=P.useState(null),q=ne=>{const{name:_e,value:he}=ne.target;m(Ne=>({...Ne,[_e]:he}))};P.useEffect(()=>{if(te){const ne=()=>{H((j==null?void 0:j.filePaths().gamePath)+"/"+k.name)&&_(!1)};j==null||j.uploadRom(k,ne)}},[te,k,j,_,H]);const V=async()=>{try{Y(!0);const[ne,_e,he]=await Rv([x]);p(ne),m(_e),z(he),Y(!1)}catch(ne){console.error("Error fetching game info:",ne)}};P.useEffect(()=>{U!=null&&(j==null||j.uploadSaveOrSaveState(U))},[U,j]),P.useEffect(()=>{G||V()},[]);const O=()=>l.fullName+"_"+i.cartID+"_"+K,f=async()=>{let ne=O()+".sav";await oe(l.saveType,ne),await Fv(300),console.log("save loaded"),await W()},X=async ne=>{var he;let _e=(he=j==null?void 0:j.listRoms)==null?void 0:he.call(j);return console.log(_e),_e&&_e.includes(ne)?(console.log("rom exists locally"),H((j==null?void 0:j.filePaths().gamePath)+"/"+ne),_(!1),!0):!1},W=async()=>{let ne=O()+".gba";if(!await X(ne)){let he=l.cartSize,Ne=`${x}/get_current_game.gba?cartSize=${he}&saveType=4`;await R({url:new URL(Ne),fullName:ne,patchFile:l.patchFile})}},oe=async(ne,_e)=>{try{console.log(ne);var he=xa(ne);if(he==-1){console.log("Invalid Save Type");return}console.log(he);var Ne=`${x}/get_current_save?saveType=${he}`;await B({url:new URL(Ne),fullName:_e})}catch(Xe){console.error("Error fetching save:",Xe)}finally{}};return o.jsxs(o.Fragment,{children:[i&&l?o.jsx(Re,{title:l.fullName}):i&&!l?o.jsx(Re,{title:i.romName}):!i&&l?o.jsx(Re,{title:l.fullName}):o.jsx(Re,{title:"No Response from Cart Reader"}),o.jsx(Ue,{children:o.jsxs($v,{isLoading:E,indicator:o.jsx(jt,{color:g.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:$,children:[!!L&&o.jsx(lr,{icon:o.jsx(sr,{style:{color:g.errorRed}}),text:"Loading rom from URL has failed"}),i&&l&&o.jsxs(Av,{id:"game-info",children:[o.jsx(Mv,{id:"cover-image",src:l.coverImage.startsWith("/")?`.${l.coverImage}`:l.coverImage,alt:`${l.fullName} Cover`}),o.jsxs(He,{children:[o.jsx(We,{children:"Full Name:"})," ",l.fullName]}),o.jsxs(He,{children:[o.jsx(We,{children:"ROM Name:"})," ",i.romName]}),o.jsxs(He,{children:[o.jsx(We,{children:"Cart Size (MB):"}),o.jsxs(Vn,{name:"cartSize",value:l.cartSize/1024/1024,onChange:q,children:[o.jsxs($e,{value:l.cartSize,children:[(l.cartSize/1024/1024).toFixed(2),"MB"]},(l.cartSize/1024/1024).toFixed(2)),[1,2,4,8,16,32,64].map(ne=>o.jsxs($e,{value:ne*1024*1024,children:[ne,"MB"]},ne))]})]}),o.jsxs(He,{children:[o.jsx(We,{children:"Save Type:"}),o.jsxs(Vn,{name:"saveType",value:l.saveType,onChange:q,children:[o.jsx($e,{value:"FLASH1M_V102",children:"FLASH1M_V102"}),o.jsx($e,{value:"FLASH1M_V103",children:"FLASH1M_V103"}),o.jsx($e,{value:"FLASH_V124",children:"FLASH_V124"}),o.jsx($e,{value:"FLASH_V126",children:"FLASH_V126"}),o.jsx($e,{value:"FLASH_ECLA",children:"FLASH_ECLA"}),o.jsx($e,{value:"EEPROM_V122",children:"EEPROM_V122"}),o.jsx($e,{value:"EEPROM_V124",children:"EEPROM_V124"}),o.jsx($e,{value:"SRAM_V112",children:"SRAM_V112"}),o.jsx($e,{value:"SRAM_V113",children:"SRAM_V113"}),o.jsx($e,{value:"REPRO_FLASH1M",children:"REPRO_FLASH1M"}),o.jsx($e,{value:"NONE",children:"NONE"})]})]}),o.jsxs(He,{children:[o.jsx(We,{children:"Cart ID:"})," ",i.cartID]}),o.jsxs(He,{children:[o.jsx(We,{children:"ROM Version:"})," ",i.romVersion]}),o.jsxs(He,{children:[o.jsx(We,{children:"Checksum:"})," ",i.checksumStr]}),o.jsxs(He,{children:[o.jsx(We,{children:"Publisher:"})," ",l.publisher]}),o.jsxs(He,{children:[o.jsx(We,{children:"Release Date:"})," ",l.releaseDate]}),l.patchFile!=null&&l.patchFile.length>0&&o.jsxs(He,{children:[o.jsx(We,{children:"BPS Patch File:"})," ",l.patchFile]})]}),i&&l&&o.jsx(ea,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"}),o.jsxs(Tv,{"aria-label":"Login Form",children:[o.jsx(or,{label:"ESP32 IP Address",autoComplete:"esp32IPInputField",variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px"},defaultValue:x,onChange:ne=>{y(ne.target.value)}}),o.jsxs(ie,{variant:"outlined",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"8px"},onClick:()=>{V()},children:[o.jsx(Km,{style:{fontSize:"18px"}})," ","Refresh"]})]})]})}),o.jsx(Oe,{children:o.jsxs(Dv,{children:[o.jsxs(ie,{variant:"contained",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>f(),children:[o.jsx(Ym,{style:{fontSize:"30px",marginRight:"10px"}})," ","Start Game",o.jsx("br",{}),"With Save"]}),o.jsxs(ie,{variant:"outlined",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>W(),children:[o.jsx(Yn,{style:{fontSize:"40px"}})," ","Start Game"]}),o.jsx(ie,{variant:"outlined",style:{padding:"10px 20px 10px 20px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>_(!1),children:"Close"})]})})]})},Nv=A.div`
  width: ${cr}px;
  height: 100dvh;
  position: fixed;
  background-color: ${({theme:l})=>l.mediumBlack};
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  z-index: 150;
  overflow-y: auto;
  text-align: left;
  left: 0;
  top: 0;
  touch-action: none;

  ${({$isExpanded:l=!1})=>!l&&`left: -${cr+5}px;
    `}

  &::-webkit-scrollbar {
    display: none;
  }
`,Uv=A.h2`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0.5rem 1rem;
  font-size: calc(1.3rem + 0.6vw);
  font-weight: 500;
  line-height: 1.2;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;

  &:hover {
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Ov=A.ul`
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
  margin-top: 0;
  list-style: none;
  padding: 0;
`,Gv=A(Lr)`
  background-color: ${({theme:l})=>l.mediumBlack};
  color: ${({theme:l})=>l.pureWhite};
  z-index: 200;
  position: fixed;
  left: ${cr-6}px;
  top: 12px;
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  cursor: pointer;
  padding: 0.375rem 0.75rem;
  border-radius: 0.25rem;
  border: none;
  min-height: 36px;
  min-width: 40px;

  ${({$isExpanded:l=!1})=>!l&&`left: -8px;
    `}

  &:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
`,zv=A.button`
  position: absolute;
  width: calc(100dvw - ${cr}px);
  left: ${cr}px;
  height: 99%;
  background: 0 0;
  z-index: 140;
  border: none;
`,qv=()=>{const[l,m]=P.useState(!0),{setModalContent:i,setIsModalOpen:p}=Ce(),{canvas:x,emulator:y}=pe(),{isRunning:g}=er(),_=Te(),j=ir(_.isLargerThanPhone),k=P.useId(),E=ua(),[L,R]=P.useState(null),[$,U]=P.useState(null),B="https://192.168.1.3",[H,G]=P.useState(B);return P.useEffect(()=>{const Y=setTimeout(()=>{console.log("run12"),i(o.jsx(Hn,{additionalData:L,setAdditionalData:R,gameData:$,setGameData:U,esp32IP:H,setEsp32IP:G})),p(!0)},500);return()=>clearTimeout(Y)},[L,$,H]),o.jsxs(o.Fragment,{children:[o.jsx(Gv,{id:"menu-btn",$isExpanded:l,onClick:()=>m(Y=>!Y),"aria-label":"Menu Toggle",children:o.jsx(Qm,{})}),o.jsxs(Nv,{"data-testid":"menu-wrapper",id:"menu-wrapper",$isExpanded:l,children:[o.jsx(Uv,{id:k,children:"Menu"}),o.jsxs(Ov,{"aria-labelledby":k,children:[o.jsx(Fe,{title:"My Cartridge",icon:o.jsx(Dn,{}),$withPadding:!0,onClick:()=>{i(o.jsx(Hn,{additionalData:L,setAdditionalData:R,gameData:$,setGameData:U,esp32IP:H,setEsp32IP:G})),p(!0)}}),o.jsx(Fe,{title:"About",icon:o.jsx(Jm,{}),$withPadding:!0,onClick:()=>{i(o.jsx(wh,{})),p(!0)}}),o.jsxs(On,{title:"Pre Game Actions",$disabled:g,$isExpanded:!g,icon:o.jsx(Zm,{}),children:[o.jsx(Fe,{title:"Upload Saves",$disabled:g,icon:o.jsx(Et,{}),onClick:()=>{i(o.jsx(Cv,{})),p(!0)}}),o.jsx(Fe,{title:"Upload Cheats",$disabled:g,icon:o.jsx(Et,{}),onClick:()=>{i(o.jsx(xv,{})),p(!0)}}),o.jsx(Fe,{title:"Upload Rom",$disabled:g,icon:o.jsx(Bn,{}),onClick:()=>{i(o.jsx(Sv,{})),p(!0)}}),o.jsx(Fe,{title:"Load Local Rom",$disabled:g,icon:o.jsx(Bn,{}),onClick:()=>{i(o.jsx(rv,{})),p(!0)}})]}),o.jsxs(On,{title:"In Game Actions",$disabled:!g,$isExpanded:g,icon:o.jsx(ep,{}),children:[o.jsx(Fe,{title:"Save to Cartridge",$disabled:!g,icon:o.jsx(In,{}),onClick:()=>{const Y=y==null?void 0:y.getCurrentSave(),te=y==null?void 0:y.getCurrentSaveName();if(Y&&te){const z=new XMLHttpRequest;if(!L){console.log("No save type information.");return}var K=xa(L.saveType);if(K==-1){console.log("Invalid Save Type");return}console.log(K);const q=new Promise((V,O)=>{z.open("POST",`${H}/upload_save_file?saveType=${K}`,!0),z.onload=()=>{z.status>=200&&z.status<300?V("Uploaded save to cartridge"):O("Failed to upload save to cartridge")},z.onerror=()=>O("Failed to upload save to cartridge"),z.send(Y)});Je.promise(q,{loading:"Uploading save to cartridge...",success:V=>`${V}`,error:V=>`${V}`})}else Je.error("Current save not available")}}),o.jsx(Fe,{title:"Screenshot",$disabled:!g,icon:o.jsx(In,{}),onClick:()=>{y!=null&&y.screenshot()?Je.success("Screenshot saved successfully"):Je.error("Screenshot has failed")}}),o.jsx(Fe,{title:"Full Screen",$disabled:!g,icon:o.jsx(rp,{}),onClick:()=>{x==null||x.requestFullscreen().catch(()=>{Je.error("Full screen request has failed")})}}),o.jsx(Fe,{title:"Download Save",$disabled:!g,icon:o.jsx(Jn,{}),onClick:()=>{i(o.jsx(Vh,{})),p(!0)}}),o.jsx(Fe,{title:"Quick Reload",$disabled:!g,icon:o.jsx(tp,{}),onClick:E}),o.jsx(Fe,{title:"Manage Save States",$disabled:!g,icon:o.jsx(np,{}),onClick:()=>{i(o.jsx(iv,{})),p(!0)}}),o.jsx(Fe,{title:"Manage Cheats",$disabled:!g,icon:o.jsx(ap,{}),onClick:()=>{i(o.jsx(Dh,{})),p(!0)}})]}),o.jsx(Fe,{title:"Controls",icon:o.jsx(Dn,{}),$withPadding:!0,onClick:()=>{i(o.jsx(qh,{})),p(!0)}}),o.jsx(Fe,{title:"File System",icon:o.jsx(op,{}),$withPadding:!0,onClick:()=>{i(o.jsx(Zh,{})),p(!0)}})]})]}),l&&!j&&o.jsx(zv,{"aria-label":"Menu Dismiss",onClick:()=>{m(!1)}})]})};A.ul`
  text-align: left;
`;const Vv=()=>!0,Hv=()=>{const[l]=je($t);return l!=null&&l.hasCompletedProductTourIntro?o.jsx(sp,{}):null},Wv=240,Xv=160,Kv=A.canvas`
  background-color: ${({theme:l})=>l.pureBlack};
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -moz-crisp-edges;
  image-rendering: -o-crisp-edges;
  width: 100%;
  height: 100%;
  display: block;
  margin: 0 auto;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`,Yv=A(Xn)`
  background-color: ${({theme:l})=>l.pureBlack};
  border: solid 1px ${({theme:l})=>l.pureBlack};
  overflow: visible;
  width: 100dvw;
  height: calc(100dvw * 2 / 3);

  @media ${({theme:l})=>l.isLargerThanPhone} {
    width: min(
      calc(100dvw - ${cr+35}px),
      calc(85dvh * 3 / 2)
    );
    height: 85dvh;
  }
`,Qv={width:"",height:""},Jv=()=>{var U,B;const l=Te(),m=ir(l.isLargerThanPhone),{setCanvas:i}=pe(),{areItemsDraggable:p}=Jr(),{areItemsResizable:x}=sa(),{layouts:y,setLayout:g,hasSetLayout:_}=_r(),j=m?cr+10:0,k=m?15:0,E=P.useCallback(H=>{var G,Y,te,K,z,q,V,O;_||((te=(Y=(G=H==null?void 0:H.resizableElement)==null?void 0:G.current)==null?void 0:Y.style)==null||te.removeProperty("width"),(q=(z=(K=H==null?void 0:H.resizableElement)==null?void 0:K.current)==null?void 0:z.style)==null||q.removeProperty("height")),!((V=y==null?void 0:y.screen)!=null&&V.initialBounds)&&H&&g("screen",{initialBounds:(O=H.resizableElement.current)==null?void 0:O.getBoundingClientRect()})},[_,y,g]),L=P.useCallback(H=>i(H),[i]),R=((U=y==null?void 0:y.screen)==null?void 0:U.position)??{x:j,y:k},$=((B=y==null?void 0:y.screen)==null?void 0:B.size)??Qv;return o.jsx(Yv,{"data-testid":"screen-wrapper",disableDragging:!p,ref:E,enableResizing:x,resizeHandleComponent:{topRight:o.jsx(br,{variation:"topRight"}),bottomRight:o.jsx(br,{variation:"bottomRight"}),bottomLeft:o.jsx(br,{variation:"bottomLeft"}),topLeft:o.jsx(br,{variation:"topLeft"})},resizeHandleStyles:{topRight:{marginTop:"15px",marginRight:"15px"},bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"},topLeft:{marginTop:"15px",marginLeft:"15px"}},position:R,size:$,onDragStop:(H,G)=>{g("screen",{position:{x:G.x,y:G.y}})},onResizeStop:(H,G,Y,te,K)=>{g("screen",{size:{width:Y.clientWidth,height:Y.clientHeight},position:{...K}})},children:o.jsx(Kv,{"data-testid":"screen-wrapper:render-canvas",ref:L,width:Wv,height:Xv})})},Zv=A.div`
  background-color: #fff;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  height: fit-content;
  inset: 10px;
  margin: 25px auto auto;
  padding-top: 25px;
  max-height: 80%;
  max-width: calc(100dvw - 20px);
  padding: 0;
  touch-action: none;
  user-select: text;
  width: fit-content;

  @media ${({theme:l})=>l.isLargerThanPhone} {
    max-width: 600px;
  }
`,eg=A.div`
  background-color: rgba(0, 0, 0, 0.5);
  width: 100dvw;
  height: 100dvh;
  position: absolute;
`,rg=A(pa)`
  justify-content: center;
`,tg=A(ha)`
  padding: 1em 1em 0 1em;
`,ng=A.img`
  object-fit: contain;
  max-width: 100%;
`,ag=A(va)`
  justify-content: center;
  flex-wrap: wrap;
`,og=A.div`
  position: relative;
`,sg=A.a`
  font-size: 5px;
  position: absolute;
  right: 15%;
  bottom: 6%;
`,Wn=()=>o.jsx("span",{children:"→"}),ig=({error:l,resetErrorBoundary:m})=>o.jsx(eg,{children:o.jsxs(Zv,{role:"alert",children:[o.jsx(rg,{children:o.jsx(ma,{children:"An irrecoverable error occurred"})}),o.jsxs(tg,{children:[o.jsxs(og,{children:[o.jsx(ng,{src:"/img/error-512x512.png",alt:"GameBoy Advance with error icon"}),o.jsx(sg,{target:"_blank",href:"https://www.freepik.com/free-vector/editable-text-effect-error-3d-hack-virus-font-style_21408324.htm",children:"Font by NACreative"})]}),o.jsx("pre",{style:{color:"red"},children:l.message}),o.jsx("p",{children:"Please use the buttons below to copy the stack trace and create an issue, this helps a lot with error reporting!"})]}),o.jsxs(ag,{children:[o.jsx(ie,{color:"info",variant:"contained",onClick:()=>{navigator.clipboard.writeText(l.stack??"No stack available")},children:"Copy trace"}),o.jsx(Wn,{}),o.jsx(ie,{color:"success",variant:"contained",href:"https://github.com/thenick775/gbajs3/issues",target:"_blank",children:"Create issue"}),o.jsx(Wn,{}),o.jsx(ie,{color:"secondary",variant:"contained",onClick:m,children:"Dismiss and reset"})]})]})}),lg=({children:l})=>o.jsx(ip,{fallbackRender:ig,children:l}),cg=()=>{const l=Te();return o.jsx(lp,{toastOptions:{success:{duration:1e3},error:{duration:1500},style:{background:l.darkCharcoal,color:l.pureWhite}}})},dg=({children:l})=>o.jsx(jp,{children:o.jsx(Fp,{children:o.jsx(wp,{children:o.jsx(Lp,{children:l})})})}),ug={isLargerThanPhone:"only screen and (min-width: 600px)",isMobileLandscape:"only screen and (max-height: 1000px) and (max-width: 1000px) and (orientation: landscape)",isMobilePortrait:"only screen and (max-width: 1000px) and (orientation: portrait)",isMobileWithUrlBar:"only screen and (max-height: 700px) and (orientation: portrait)",aliceBlue1:"#f8f9fa",aliceBlue2:"#edf2f7",arcticAirBlue:"#cad8e5",blackRussian:"#1a202c",blueCharcoal:"#212529",checkMarkGreen:"#7ac142",darkCharcoal:"#333",darkGrayBlue:"#495057",disabledGray:"#6c757d",errorRed:"#d32f2f",gbaThemeBlue:"#0d6efd",mediumBlack:"#100901",menuHighlight:"#ffffff26",menuHover:"#0a58ca",pattensBlue:"#dee2e6",pureBlack:"#000",pureWhite:"#fff",darkGray:"#111",panelControlGray:"#a9a9a9",panelBlueGray:"#4f555a"},fg=()=>o.jsx(cp,{theme:ug,children:o.jsxs(lg,{children:[o.jsx(Vv,{}),o.jsx(cg,{}),o.jsx(Hv,{}),o.jsx(yp,{children:o.jsx(dg,{children:o.jsx(Pp,{children:o.jsxs(Mp,{children:[o.jsx(qv,{}),o.jsx(Jv,{}),o.jsx(Wp,{}),o.jsx(uh,{}),o.jsx(mh,{})]})})})})]})});dp.createRoot(document.getElementById("root")).render(o.jsx(Yr.StrictMode,{children:o.jsx(fg,{})}));
