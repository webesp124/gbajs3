import{r as R,z as Km,A as It,j as o,B as ke,D as Ym,E as N,q as rt,F as Pe,H as Qm,I as aa,J as oa,K as sa,L as Jm,M as Zm,N as ep,O as Wn,Q as Xn,S as rp,U as tp,V as np,W as ap,X as Tt,Y as Ge,Z as Sr,$ as Bt,a0 as op,a1 as sp,a2 as ip,a3 as lp,a4 as cp,a5 as dp,a6 as $t,a7 as up,a8 as ia,a9 as Cr,aa as fp,ab as la,ac as ca,ad as Nt,ae as mp,af as pp,ag as hp,ah as vp,ai as gp,aj as xp,ak as bp,al as _p,am as yp,an as wp,ao as Sp,ap as Et,aq as Cp,ar as Ep,as as kp,at as jp,au as Fp,av as Lp,aw as Rp,ax as Tp,ay as Pp,az as Mp,aA as Ap,aB as Dp,aC as Ip,aD as Bp,aE as $p,aF as Np,aG as Up,aH as Op,aI as zp,aJ as Gp,aK as qp,aL as Hp}from"./vendor-BYW-vDlu.js";import{S as kt,c as Vp}from"./vendor_react-joyride-DtOvQGT_.js";import{u as mr,S as Wp,I as or,B as pe,F as da,C as Mr,T as fr,a as Xp,b as Kp,c as Kn,d as Ut,s as Yp,e as Qp,t as jt,f as Jp,g as Zp,h as eh,i as Ot,j as zt,k as ua,l as Ce,m as ne,n as Gt,o as Pt,M as Qr,D as wr,p as rh,q as th,r as nh}from"./vendor_@mui-CsnGiSH8.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))p(v);new MutationObserver(v=>{for(const x of v)if(x.type==="childList")for(const g of x.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&p(g)}).observe(document,{childList:!0,subtree:!0});function s(v){const x={};return v.integrity&&(x.integrity=v.integrity),v.referrerPolicy&&(x.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?x.credentials="include":v.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function p(v){if(v.ep)return;v.ep=!0;const x=s(v);fetch(v.href,x)}})();const fa="currentEmulatorVolume",ma="currentEmulatorKeyBindings",pa="currentGameName",ha="currentFastForward",qt="currentCoreCallbacks",Ar=({fetchFn:l,loadOnMount:m=!1,clearDataOnLoad:s=!1})=>{const[p,v]=R.useState(null),[x,g]=R.useState(null),[_,j]=R.useState(!1),w=()=>g(null),C=R.useCallback(async F=>{j(!0),g(null),s&&v(null);try{const T=await l(F);v(T),j(!1)}catch(T){g(T),j(!1)}},[s,l]);return R.useEffect(()=>{m&&l&&C()},[]),{data:p,isLoading:_,error:x,clearError:w,execute:C}},ah=({loadOnMount:l=!1}={})=>{const s=R.useCallback(async()=>(await fetch("undefined/api/tokens/refresh",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json(),[void 0]),{data:p,isLoading:v,error:x,clearError:g,execute:_}=Ar({fetchFn:s,clearDataOnLoad:!0,loadOnMount:l});return{data:p,isLoading:v,error:x,clearError:g,execute:_}},Ht=R.createContext(null);Ht.displayName="AuthContext";const oh=({children:l})=>{const[p,v]=R.useState(null),[x,g]=R.useState(null),{data:_,isLoading:j,execute:w,error:C,clearError:F}=ah({loadOnMount:!1}),T=!j&&!!_;R.useEffect(()=>{T&&(v(_),g("refresh"))},[T,_]);const W=R.useCallback(()=>{if(p){const{exp:A}=Km(p);if(A&&Date.now()<=A*1e3)return!0}return!1},[p]),G=W()&&!_&&x!=="refresh";return R.useEffect(()=>{G&&F()},[G,F]),It(async()=>{await w()},W()&&!C?24e4:null),o.jsx(Ht.Provider,{value:{accessToken:p,setAccessToken:v,setAccessTokenSource:g,isAuthenticated:W},children:l})},Vt=R.createContext(null);Vt.displayName="DragContext";const sh=({children:l})=>{const[m,s]=R.useState(!1);return o.jsx(Vt.Provider,{value:{areItemsDraggable:m,setAreItemsDraggable:s},children:l})},We=0,ih=3,lh=l=>{const m=l.filePaths(),s=(_,j)=>{var C,F;let w=(C=_==null?void 0:_.split("/"))==null?void 0:C.pop();if(j){const T="."+((F=w==null?void 0:w.split("."))==null?void 0:F.pop());w=w==null?void 0:w.replace(T,j)}return w},p=()=>{const _={path:m.root,isDir:!0,children:[]},j=[".",".."],w=({path:C,children:F})=>{for(const T of l.FS.readdir(C)){if(j.includes(T))continue;const W=`${C}/${T}`,{mode:G}=l.FS.lookupPath(W,{}).node,A={path:W,isDir:l.FS.isDir(G),children:[]};F==null||F.push(A),A.isDir&&w(A)}};return w(_),_},v=_=>{var T;const j=_.split(`
`),w=["cheats = ",""];if(!((T=j==null?void 0:j[0])!=null&&T.match("^cheats = [0-9]+$")))return[];const C={},F={desc:"desc",code:"code",enable:"enable"};for(const W of j){if(w.includes(W))continue;const G=W.match(/^cheat([0-9]+)_([a-zA-Z]+)\s*=\s*"?([a-zA-Z0-9\s+:_]+)"?$/);if(G){const[,A,O,V]=G,K=F[O];C[A]=C[A]||{desc:"",code:"",enable:!1},K&&(C[A][K]=K===F.enable?V.toLowerCase()==="true":V)}}return Object.values(C)},x=_=>{const j=_.map((F,T)=>`cheat${T}_desc = "${F.desc}"
cheat${T}_enable = ${F.enable}
cheat${T}_code = "${F.code}"
`),w=`cheats = ${j==null?void 0:j.length}

`,C=s(l.gameName,".cheats");if(j!=null&&j.length&&C){const F=w+j.join(`
`),T=new Blob([F],{type:"text/plain"});return new File([T],C)}return null},g=({key:_,location:j})=>{let w=j===ih?`Keypad ${_}`:_;return w.toLowerCase().includes("enter")&&(w=w.replace(/enter/gi,"Return")),w.toLowerCase().includes("arrow")&&(w=w.replace(/arrow/gi,"")),w};return{addCoreCallbacks:l.addCoreCallbacks,autoLoadCheats:l.autoLoadCheats,createSaveState:l.saveState,defaultKeyBindings:()=>[{gbaInput:"A",key:"X",location:We},{gbaInput:"B",key:"Z",location:We},{gbaInput:"L",key:"A",location:We},{gbaInput:"R",key:"S",location:We},{gbaInput:"Start",key:"Enter",location:We},{gbaInput:"Select",key:"Backspace",location:We},{gbaInput:"Up",key:"ArrowUp",location:We},{gbaInput:"Down",key:"ArrowDown",location:We},{gbaInput:"Left",key:"ArrowLeft",location:We},{gbaInput:"Right",key:"ArrowRight",location:We}],loadSaveState:l.loadState,listSaveStates:()=>l.FS.readdir(m.saveStatePath),listRoms:()=>l.FS.readdir(m.gamePath),listSaves:()=>l.FS.readdir(m.savePath),getStatSaves:_=>l.FS.stat("/data/saves/"+_),getStatRoms:_=>l.FS.stat("/data/games/"+_),setVolume:async _=>{(l.SDL2.audioContext.state==="suspended"||l.SDL2.audioContext.state==="interrupted")&&await l.SDL2.audioContext.resume(),l.setVolume(_)},getVolume:l.getVolume,enableKeyboardInput:()=>l.toggleInput(!0),disableKeyboardInput:()=>l.toggleInput(!1),simulateKeyDown:l.buttonPress,simulateKeyUp:l.buttonUnpress,setFastForwardMultiplier:l.setFastForwardMultiplier,isFastForwardEnabled:()=>l.getFastForwardMultiplier()>1,run:l.loadGame,getCurrentRom:()=>l.gameName?l.FS.readFile(l.gameName):null,getCurrentGameName:()=>s(l.gameName),setCurrentGameName:_=>{_&&!l.gameName&&(l.gameName=_)},getCurrentSave:()=>l.saveName?l.getSave():null,getCurrentSaveName:()=>s(l.saveName),getFile:_=>l.FS.readFile(_),uploadCheats:l.uploadCheats,uploadRom:l.uploadRom,uploadSaveOrSaveState:l.uploadSaveOrSaveState,deleteSaveState:_=>{const j=s(l.saveName,".ss"+_),w=`${m.saveStatePath}/${j}`;l.FS.unlink(w)},deleteFile:l.FS.unlink,pause:l.pauseGame,resume:l.resumeGame,quitGame:l.quitGame,quitEmulator:l.quitMgba,quickReload:l.quickReload,getCurrentCheatsFile:()=>{const _=s(l.gameName,".cheats"),j=`${m.cheatsPath}/${_}`;return l.FS.analyzePath(j).exists?l.FS.readFile(j):new Uint8Array},getCurrentCheatsFileName:()=>s(l.gameName,".cheats"),screenshot:l.screenshot,remapKeyBindings:_=>_.forEach(j=>l.bindKey(g(j),j.gbaInput)),filePaths:l.filePaths,fsSync:l.FSSync,listAllFiles:p,parseCheatsString:v,parsedCheatsToFile:x}};var ch=(()=>{var l=import.meta.url;return function(m={}){var s=m,p,v;s.ready=new Promise((e,r)=>{p=e,v=r}),s.loadGame=e=>{if(de("loadGame","number",["string"])(e)){const t=e.split(".");t.pop();const n=t.join(".")+".sav";return s.gameName=e,s.saveName=n.replace("/data/games/","/data/saves/"),!0}return!1},s.getSave=()=>c.readFile(s.saveName),s.listRoms=()=>c.readdir("/data/games/"),s.listSaves=()=>c.readdir("/data/saves/"),s.FSInit=()=>new Promise((e,r)=>{c.mkdir("/data"),c.mount(c.filesystems.IDBFS,{},"/data"),c.syncfs(!0,t=>{t&&r(new Error(`Error syncing app data from IndexedDB: ${t}`));try{c.mkdir("/data/saves")}catch{}try{c.mkdir("/data/states")}catch{}try{c.mkdir("/data/games")}catch{}try{c.mkdir("/data/cheats")}catch{}try{c.mkdir("/data/screenshots")}catch{}e()})}),s.FSSync=()=>new Promise((e,r)=>{c.syncfs(t=>{t&&r(new Error(`Error syncing app data to IndexedDB: ${t}`)),e()})}),s.filePaths=()=>({root:"/data",cheatsPath:"/data/cheats",gamePath:"/data/games",savePath:"/data/saves",saveStatePath:"/data/states",screenshotsPath:"/data/screenshots"}),s.uploadSaveOrSaveState=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="sav")a="/data/saves/";else if(n.startsWith("ss"))a="/data/states/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadRom=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(["gba","gbc","gb","zip","7z"].includes(n))a="/data/games/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadCheats=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="cheats")a="/data/cheats/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)};const x=new Map([["a",0],["b",1],["select",2],["start",3],["right",4],["left",5],["up",6],["down",7],["r",8],["l",9]]);s.buttonPress=e=>{de("buttonPress",null,["number"])(x.get(e.toLowerCase()))},s.buttonUnpress=e=>{de("buttonUnpress",null,["number"])(x.get(e.toLowerCase()))},s.bindKey=(e,r)=>{de("bindKey",null,["string","number"])(e,x.get(r.toLowerCase()))},s.pauseGame=()=>{de("pauseGame",null,[])()},s.resumeGame=()=>{de("resumeGame",null,[])()},s.getVolume=()=>de("getVolume","number",[])(),s.setVolume=e=>{de("setVolume",null,["number"])(e)},s.getMainLoopTimingMode=()=>de("getMainLoopTimingMode","number",[])(),s.getMainLoopTimingValue=()=>de("getMainLoopTimingValue","number",[])(),s.setMainLoopTiming=(e,r)=>{de("setMainLoopTiming","number",["number","number"])(e,r)},s.quitGame=()=>{de("quitGame",null,[])()},s.quitMgba=()=>{de("quitMgba",null,[])()},s.quickReload=()=>{de("quickReload",null,[])()},s.toggleInput=e=>{de("setEventEnable",null,["boolean"])(e)},s.screenshot=e=>de("screenshot","boolean",["string"])(e),s.saveState=e=>de("saveState","boolean",["number"])(e),s.loadState=e=>de("loadState","boolean",["number"])(e),s.saveStateSlot=(e,r)=>{var t=de("saveStateSlot","number",["number","number"]);return s.saveStateSlot=(n,a)=>(a===void 0&&(a=63),t(n,a)),s.saveStateSlot(e,r)},s.loadStateSlot=(e,r)=>{var t=de("loadStateSlot","number",["number","number"]);return s.loadStateSlot=(n,a)=>(a===void 0&&(a=61),t(n,a)),s.loadStateSlot(e,r)},s.autoLoadCheats=()=>de("autoLoadCheats","bool",[])(),s.setFastForwardMultiplier=e=>{de("setFastForwardMultiplier",null,["number"])(e)},s.getFastForwardMultiplier=()=>de("getFastForwardMultiplier","number",[])();const g={alarmCallbackPtr:null,coreCrashedCallbackPtr:null,keysReadCallbackPtr:null,saveDataUpdatedCallbackPtr:null,videoFrameEndedCallbackPtr:null,videoFrameStartedCallbackPtr:null};s.addCoreCallbacks=e=>{const r=de("addCoreCallbacks",null,["number"]);Object.keys(g).forEach(t=>{const n=t.replace("CallbackPtr","Callback"),a=e[n];a!==void 0&&g[t]&&(Un(g[t]),g[t]=null),a&&(g[t]=Nn(a,"vi"))}),r(g.alarmCallbackPtr,g.coreCrashedCallbackPtr,g.keysReadCallbackPtr,g.saveDataUpdatedCallbackPtr,g.videoFrameEndedCallbackPtr,g.videoFrameStartedCallbackPtr)};var _=Object.assign({},s),j="./this.program",w=(e,r)=>{throw r},C=!0,F="";function T(e){return s.locateFile?s.locateFile(e,F):F+e}var W,G;typeof document<"u"&&document.currentScript&&(F=document.currentScript.src),l&&(F=l),F.startsWith("blob:")?F="":F=F.substr(0,F.replace(/[?#].*/,"").lastIndexOf("/")+1),W=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},G=(e,r,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){r(n.response);return}t()},n.onerror=t,n.send(null)};var A=s.print||console.log.bind(console),O=s.printErr||console.error.bind(console);Object.assign(s,_),_=null,s.arguments&&s.arguments,s.thisProgram&&(j=s.thisProgram),s.quit&&(w=s.quit);var V;s.wasmBinary&&(V=s.wasmBinary),typeof WebAssembly!="object"&&tr("no native wasm support detected");var K,X=!1,$;function q(e,r){e||tr(r)}var M,U,D,Q,f,ee,Y,le;function Fe(){var e=K.buffer;s.HEAP8=M=new Int8Array(e),s.HEAP16=D=new Int16Array(e),s.HEAPU8=U=new Uint8Array(e),s.HEAPU16=Q=new Uint16Array(e),s.HEAP32=f=new Int32Array(e),s.HEAPU32=ee=new Uint32Array(e),s.HEAPF32=Y=new Float32Array(e),s.HEAPF64=le=new Float64Array(e)}var qe=[],Ye=[],er=[],He=[];function Qe(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)ce(s.preRun.shift());Br(qe)}function oe(){!s.noFSInit&&!c.init.initialized&&c.init(),c.ignorePermissions=!1,Br(Ye)}function ge(){Br(er)}function Ee(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)De(s.postRun.shift());Br(He)}function ce(e){qe.unshift(e)}function Re(e){Ye.unshift(e)}function De(e){He.unshift(e)}var rr=0,sr=null;function Kg(e){return e}function at(e){var r;rr++,(r=s.monitorRunDependencies)==null||r.call(s,rr)}function Ir(e){var t;if(rr--,(t=s.monitorRunDependencies)==null||t.call(s,rr),rr==0&&sr){var r=sr;sr=null,r()}}function tr(e){var t;(t=s.onAbort)==null||t.call(s,e),e="Aborted("+e+")",O(e),X=!0,$=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw v(r),r}var Da="data:application/octet-stream;base64,",Zt=e=>e.startsWith(Da),ir;s.locateFile?(ir="mgba.wasm",Zt(ir)||(ir=T(ir))):ir=new URL(""+new URL("mgba-C3uUnxP8.wasm",import.meta.url).href,import.meta.url).href;function en(e){if(e==ir&&V)return new Uint8Array(V);throw"both async and sync fetching of the wasm failed"}function Ia(e){return!V&&C&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at '${e}'`;return r.arrayBuffer()}).catch(()=>en(e)):Promise.resolve().then(()=>en(e))}function rn(e,r,t){return Ia(e).then(n=>WebAssembly.instantiate(n,r)).then(n=>n).then(t,n=>{O(`failed to asynchronously prepare wasm: ${n}`),tr(n)})}function Ba(e,r,t,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!Zt(r)&&typeof fetch=="function"?fetch(r,{credentials:"same-origin"}).then(a=>{var i=WebAssembly.instantiateStreaming(a,t);return i.then(n,function(d){return O(`wasm streaming compile failed: ${d}`),O("falling back to ArrayBuffer instantiation"),rn(r,t,n)})}):rn(r,t,n)}function $a(){var e={a:Im};function r(n,a){return ae=n.exports,K=ae._d,Fe(),lr=ae.Ae,Re(ae.$d),Ir(),ae}at();function t(n){r(n.instance)}if(s.instantiateWasm)try{return s.instantiateWasm(e,r)}catch(n){O(`Module.instantiateWasm callback failed with error: ${n}`),v(n)}return Ba(V,ir,e,t).catch(v),{}}var Z,ue,tn={272368:(e,r)=>{s.canvas.width=e,s.canvas.height=r},272425:(e,r,t,n,a,i,d)=>{s.version={gitCommit:Le(e),gitShort:Le(r),gitBranch:Le(t),gitRevision:n,binaryName:Le(a),projectName:Le(i),projectVersion:Le(d)}},272657:()=>{c.syncfs(function(e){q(!e)})},272701:()=>typeof AudioContext<"u"?!0:typeof webkitAudioContext<"u",272848:()=>typeof navigator.mediaDevices<"u"&&typeof navigator.mediaDevices.getUserMedia<"u"?!0:typeof navigator.webkitGetUserMedia<"u",273082:e=>{typeof s.SDL2>"u"&&(s.SDL2={});var r=s.SDL2;return e?r.capture={}:r.audio={},r.audioContext||(typeof AudioContext<"u"?r.audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(r.audioContext=new webkitAudioContext),r.audioContext&&Ua(r.audioContext)),r.audioContext===void 0?-1:0},273575:()=>{var e=s.SDL2;return e.audioContext.sampleRate},273643:(e,r,t,n)=>{var a=s.SDL2,i=function(h){a.capture.silenceTimer!==void 0&&(clearTimeout(a.capture.silenceTimer),a.capture.silenceTimer=void 0),a.capture.mediaStreamNode=a.audioContext.createMediaStreamSource(h),a.capture.scriptProcessorNode=a.audioContext.createScriptProcessor(r,e,1),a.capture.scriptProcessorNode.onaudioprocess=function(b){a===void 0||a.capture===void 0||(b.outputBuffer.getChannelData(0).fill(0),a.capture.currentCaptureBuffer=b.inputBuffer,ot("vi",t,[n]))},a.capture.mediaStreamNode.connect(a.capture.scriptProcessorNode),a.capture.scriptProcessorNode.connect(a.audioContext.destination),a.capture.stream=h},d=function(h){};a.capture.silenceBuffer=a.audioContext.createBuffer(e,r,a.audioContext.sampleRate),a.capture.silenceBuffer.getChannelData(0).fill(0);var u=function(){a.capture.currentCaptureBuffer=a.capture.silenceBuffer,ot("vi",t,[n])};a.capture.silenceTimer=setTimeout(u,r/a.audioContext.sampleRate*1e3),navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(i).catch(d):navigator.webkitGetUserMedia!==void 0&&navigator.webkitGetUserMedia({audio:!0,video:!1},i,d)},275295:(e,r,t,n)=>{var a=s.SDL2;a.audio.scriptProcessorNode=a.audioContext.createScriptProcessor(r,0,e),a.audio.scriptProcessorNode.onaudioprocess=function(i){a===void 0||a.audio===void 0||(a.audio.currentOutputBuffer=i.outputBuffer,ot("vi",t,[n]))},a.audio.scriptProcessorNode.connect(a.audioContext.destination)},275705:(e,r)=>{for(var t=s.SDL2,n=t.capture.currentCaptureBuffer.numberOfChannels,a=0;a<n;++a){var i=t.capture.currentCaptureBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio capture buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";if(n==1)for(var d=0;d<r;++d)an(e+d*4,i[d],"float");else for(var d=0;d<r;++d)an(e+(d*n+a)*4,i[d],"float")}},276310:(e,r)=>{for(var t=s.SDL2,n=t.audio.currentOutputBuffer.numberOfChannels,a=0;a<n;++a){var i=t.audio.currentOutputBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio output buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";for(var d=0;d<r;++d)i[d]=Y[e+(d*n+a<<2)>>2]}},276790:e=>{var r=s.SDL2;if(e){if(r.capture.silenceTimer!==void 0&&clearTimeout(r.capture.silenceTimer),r.capture.stream!==void 0){for(var t=r.capture.stream.getAudioTracks(),n=0;n<t.length;n++)r.capture.stream.removeTrack(t[n]);r.capture.stream=void 0}r.capture.scriptProcessorNode!==void 0&&(r.capture.scriptProcessorNode.onaudioprocess=function(a){},r.capture.scriptProcessorNode.disconnect(),r.capture.scriptProcessorNode=void 0),r.capture.mediaStreamNode!==void 0&&(r.capture.mediaStreamNode.disconnect(),r.capture.mediaStreamNode=void 0),r.capture.silenceBuffer!==void 0&&(r.capture.silenceBuffer=void 0),r.capture=void 0}else r.audio.scriptProcessorNode!=null&&(r.audio.scriptProcessorNode.disconnect(),r.audio.scriptProcessorNode=void 0),r.audio=void 0;r.audioContext!==void 0&&r.audio===void 0&&r.capture===void 0&&(r.audioContext.close(),r.audioContext=void 0)},277962:(e,r,t)=>{var n=e,a=r,i=t;s.SDL2||(s.SDL2={});var d=s.SDL2;d.ctxCanvas!==s.canvas&&(d.ctx=s.createContext(s.canvas,!1,!0),d.ctxCanvas=s.canvas),(d.w!==n||d.h!==a||d.imageCtx!==d.ctx)&&(d.image=d.ctx.createImageData(n,a),d.w=n,d.h=a,d.imageCtx=d.ctx);var u=d.image.data,h=i>>2,b=0,S;if(typeof CanvasPixelArray<"u"&&u instanceof CanvasPixelArray)for(S=u.length;b<S;){var L=f[h];u[b]=L&255,u[b+1]=L>>8&255,u[b+2]=L>>16&255,u[b+3]=255,h++,b+=4}else{d.data32Data!==u&&(d.data32=new Int32Array(u.buffer),d.data8=new Uint8Array(u.buffer),d.data32Data=u);var z=d.data32;S=z.length,z.set(f.subarray(h,h+S));var P=d.data8,B=3,J=B+4*S;if(S%8==0)for(;B<J;)P[B]=255,B=B+4|0,P[B]=255,B=B+4|0,P[B]=255,B=B+4|0,P[B]=255,B=B+4|0,P[B]=255,B=B+4|0,P[B]=255,B=B+4|0,P[B]=255,B=B+4|0,P[B]=255,B=B+4|0;else for(;B<J;)P[B]=255,B=B+4|0}d.ctx.putImageData(d.image,0,0)},279431:(e,r,t,n,a)=>{var i=e,d=r,u=t,h=n,b=a,S=document.createElement("canvas");S.width=i,S.height=d;var L=S.getContext("2d"),z=L.createImageData(i,d),P=z.data,B=b>>2,J=0,xe;if(typeof CanvasPixelArray<"u"&&P instanceof CanvasPixelArray)for(xe=P.length;J<xe;){var me=f[B];P[J]=me&255,P[J+1]=me>>8&255,P[J+2]=me>>16&255,P[J+3]=me>>24&255,B++,J+=4}else{var Se=new Int32Array(P.buffer);xe=Se.length,Se.set(f.subarray(B,B+xe))}L.putImageData(z,0,0);var be=u===0&&h===0?"url("+S.toDataURL()+"), auto":"url("+S.toDataURL()+") "+u+" "+h+", auto",_e=Be(be.length+1);return he(be,_e,be.length+1),_e},280420:e=>{s.canvas&&(s.canvas.style.cursor=Le(e))},280503:()=>{s.canvas&&(s.canvas.style.cursor="none")},280572:()=>window.innerWidth,280602:()=>window.innerHeight};function nn(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Na=(e,r,t)=>{e.addEventListener(r,t,{once:!0})},Ua=(e,r)=>{r||(r=[document,document.getElementById("canvas")]),["keydown","mousedown","touchstart"].forEach(t=>{r.forEach(n=>{n&&Na(n,t,()=>{e.state==="suspended"&&e.resume()})})})},Br=e=>{for(;e.length>0;)e.shift()(s)},Oa=(e,r,t)=>{var n=s["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)},Fr=[],lr,ie=e=>{var r=Fr[e];return r||(e>=Fr.length&&(Fr.length=e+1),Fr[e]=r=lr.get(e)),r},ot=(e,r,t)=>{if(e.includes("j"))return Oa(e,r,t);var n=ie(r).apply(null,t);return n},za=s.noExitRuntime||!0;function an(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":M[e>>0]=r;break;case"i8":M[e>>0]=r;break;case"i16":D[e>>1]=r;break;case"i32":f[e>>2]=r;break;case"i64":tr("to do setValue(i64) use WASM_BIGINT");case"float":Y[e>>2]=r;break;case"double":le[e>>3]=r;break;case"*":ee[e>>2]=r;break;default:tr(`invalid type for setValue: ${t}`)}}var se={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var t=0,n=e.length-1;n>=0;n--){var a=e[n];a==="."?e.splice(n,1):a===".."?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t;t--)e.unshift("..");return e},normalize:e=>{var r=se.isAbs(e),t=e.substr(-1)==="/";return e=se.normalizeArray(e.split("/").filter(n=>!!n),!r).join("/"),!e&&!r&&(e="."),e&&t&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=se.splitPath(e),t=r[0],n=r[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)},basename:e=>{if(e==="/")return"/";e=se.normalize(e),e=e.replace(/\/$/,"");var r=e.lastIndexOf("/");return r===-1?e:e.substr(r+1)},join:function(){var e=Array.prototype.slice.call(arguments);return se.normalize(e.join("/"))},join2:(e,r)=>se.normalize(e+"/"+r)},Ga=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);tr("initRandomDevice")},on=e=>(on=Ga())(e),Je={resolve:function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var n=t>=0?arguments[t]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,r=se.isAbs(n)}return e=se.normalizeArray(e.split("/").filter(a=>!!a),!r).join("/"),(r?"/":"")+e||"."},relative:(e,r)=>{e=Je.resolve(e).substr(1),r=Je.resolve(r).substr(1);function t(b){for(var S=0;S<b.length&&b[S]==="";S++);for(var L=b.length-1;L>=0&&b[L]==="";L--);return S>L?[]:b.slice(S,L-S+1)}for(var n=t(e.split("/")),a=t(r.split("/")),i=Math.min(n.length,a.length),d=i,u=0;u<i;u++)if(n[u]!==a[u]){d=u;break}for(var h=[],u=d;u<n.length;u++)h.push("..");return h=h.concat(a.slice(d)),h.join("/")}},sn=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,gr=(e,r,t)=>{for(var n=r+t,a=r;e[a]&&!(a>=n);)++a;if(a-r>16&&e.buffer&&sn)return sn.decode(e.subarray(r,a));for(var i="";r<a;){var d=e[r++];if(!(d&128)){i+=String.fromCharCode(d);continue}var u=e[r++]&63;if((d&224)==192){i+=String.fromCharCode((d&31)<<6|u);continue}var h=e[r++]&63;if((d&240)==224?d=(d&15)<<12|u<<6|h:d=(d&7)<<18|u<<12|h<<6|e[r++]&63,d<65536)i+=String.fromCharCode(d);else{var b=d-65536;i+=String.fromCharCode(55296|b>>10,56320|b&1023)}}return i},st=[],xr=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},it=(e,r,t,n)=>{if(!(n>0))return 0;for(var a=t,i=t+n-1,d=0;d<e.length;++d){var u=e.charCodeAt(d);if(u>=55296&&u<=57343){var h=e.charCodeAt(++d);u=65536+((u&1023)<<10)|h&1023}if(u<=127){if(t>=i)break;r[t++]=u}else if(u<=2047){if(t+1>=i)break;r[t++]=192|u>>6,r[t++]=128|u&63}else if(u<=65535){if(t+2>=i)break;r[t++]=224|u>>12,r[t++]=128|u>>6&63,r[t++]=128|u&63}else{if(t+3>=i)break;r[t++]=240|u>>18,r[t++]=128|u>>12&63,r[t++]=128|u>>6&63,r[t++]=128|u&63}}return r[t]=0,t-a};function lt(e,r,t){var n=xr(e)+1,a=new Array(n),i=it(e,a,0,a.length);return a.length=i,a}var qa=()=>{if(!st.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"?(e=window.prompt("Input: "),e!==null&&(e+=`
`)):typeof readline=="function"&&(e=readline(),e!==null&&(e+=`
`)),!e)return null;st=lt(e)}return st.shift()},cr={ttys:[],init(){},shutdown(){},register(e,r){cr.ttys[e]={input:[],output:[],ops:r},c.registerDevice(e,cr.stream_ops)},stream_ops:{open(e){var r=cr.ttys[e.node.rdev];if(!r)throw new c.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,t,n,a){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var i=0,d=0;d<n;d++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&i===0)throw new c.ErrnoError(6);if(u==null)break;i++,r[t+d]=u}return i&&(e.node.timestamp=Date.now()),i},write(e,r,t,n,a){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,r[t+i])}catch{throw new c.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char(e){return qa()},put_char(e,r){r===null||r===10?(A(gr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(A(gr(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,t){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(O(gr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(O(gr(e.output,0)),e.output=[])}}},Ha=(e,r)=>(U.fill(0,e,e+r),e),Va=(e,r)=>Math.ceil(e/r)*r,ln=e=>{e=Va(e,65536);var r=qn(65536,e);return r?Ha(r,e):0},te={ops_table:null,mount(e){return te.createNode(null,"/",16895,0)},createNode(e,r,t,n){if(c.isBlkdev(t)||c.isFIFO(t))throw new c.ErrnoError(63);te.ops_table||(te.ops_table={dir:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,lookup:te.node_ops.lookup,mknod:te.node_ops.mknod,rename:te.node_ops.rename,unlink:te.node_ops.unlink,rmdir:te.node_ops.rmdir,readdir:te.node_ops.readdir,symlink:te.node_ops.symlink},stream:{llseek:te.stream_ops.llseek}},file:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:{llseek:te.stream_ops.llseek,read:te.stream_ops.read,write:te.stream_ops.write,allocate:te.stream_ops.allocate,mmap:te.stream_ops.mmap,msync:te.stream_ops.msync}},link:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,readlink:te.node_ops.readlink},stream:{}},chrdev:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:c.chrdev_stream_ops}});var a=c.createNode(e,r,t,n);return c.isDir(a.mode)?(a.node_ops=te.ops_table.dir.node,a.stream_ops=te.ops_table.dir.stream,a.contents={}):c.isFile(a.mode)?(a.node_ops=te.ops_table.file.node,a.stream_ops=te.ops_table.file.stream,a.usedBytes=0,a.contents=null):c.isLink(a.mode)?(a.node_ops=te.ops_table.link.node,a.stream_ops=te.ops_table.link.stream):c.isChrdev(a.mode)&&(a.node_ops=te.ops_table.chrdev.node,a.stream_ops=te.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[r]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var t=e.contents?e.contents.length:0;if(!(t>=r)){var n=1024*1024;r=Math.max(r,t*(t<n?2:1.125)>>>0),t!=0&&(r=Math.max(r,256));var a=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var t=e.contents;e.contents=new Uint8Array(r),t&&e.contents.set(t.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=c.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,c.isDir(e.mode)?r.size=4096:c.isFile(e.mode)?r.size=e.usedBytes:c.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.timestamp),r.mtime=new Date(e.timestamp),r.ctime=new Date(e.timestamp),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){r.mode!==void 0&&(e.mode=r.mode),r.timestamp!==void 0&&(e.timestamp=r.timestamp),r.size!==void 0&&te.resizeFileStorage(e,r.size)},lookup(e,r){throw c.genericErrors[44]},mknod(e,r,t,n){return te.createNode(e,r,t,n)},rename(e,r,t){if(c.isDir(e.mode)){var n;try{n=c.lookupNode(r,t)}catch{}if(n)for(var a in n.contents)throw new c.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=t,r.contents[t]=e,r.timestamp=e.parent.timestamp,e.parent=r},unlink(e,r){delete e.contents[r],e.timestamp=Date.now()},rmdir(e,r){var t=c.lookupNode(e,r);for(var n in t.contents)throw new c.ErrnoError(55);delete e.contents[r],e.timestamp=Date.now()},readdir(e){var r=[".",".."];for(var t of Object.keys(e.contents))r.push(t);return r},symlink(e,r,t){var n=te.createNode(e,r,41471,0);return n.link=t,n},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,r,t,n,a){var i=e.node.contents;if(a>=e.node.usedBytes)return 0;var d=Math.min(e.node.usedBytes-a,n);if(d>8&&i.subarray)r.set(i.subarray(a,a+d),t);else for(var u=0;u<d;u++)r[t+u]=i[a+u];return d},write(e,r,t,n,a,i){if(r.buffer===M.buffer&&(i=!1),!n)return 0;var d=e.node;if(d.timestamp=Date.now(),r.subarray&&(!d.contents||d.contents.subarray)){if(i)return d.contents=r.subarray(t,t+n),d.usedBytes=n,n;if(d.usedBytes===0&&a===0)return d.contents=r.slice(t,t+n),d.usedBytes=n,n;if(a+n<=d.usedBytes)return d.contents.set(r.subarray(t,t+n),a),n}if(te.expandFileStorage(d,a+n),d.contents.subarray&&r.subarray)d.contents.set(r.subarray(t,t+n),a);else for(var u=0;u<n;u++)d.contents[a+u]=r[t+u];return d.usedBytes=Math.max(d.usedBytes,a+n),n},llseek(e,r,t){var n=r;if(t===1?n+=e.position:t===2&&c.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new c.ErrnoError(28);return n},allocate(e,r,t){te.expandFileStorage(e.node,r+t),e.node.usedBytes=Math.max(e.node.usedBytes,r+t)},mmap(e,r,t,n,a){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var i,d,u=e.node.contents;if(!(a&2)&&u.buffer===M.buffer)d=!1,i=u.byteOffset;else{if((t>0||t+r<u.length)&&(u.subarray?u=u.subarray(t,t+r):u=Array.prototype.slice.call(u,t,t+r)),d=!0,i=ln(r),!i)throw new c.ErrnoError(48);M.set(u,i)}return{ptr:i,allocated:d}},msync(e,r,t,n,a){return te.stream_ops.write(e,r,0,n,t,!1),0}}},Wa=(e,r,t,n)=>{var a=`al ${e}`;G(e,i=>{r(new Uint8Array(i)),a&&Ir()},i=>{if(t)t();else throw`Loading data file "${e}" failed.`}),a&&at()},Xa=(e,r,t,n,a,i)=>{c.createDataFile(e,r,t,n,a,i)},ct=s.preloadPlugins||[],Ka=(e,r,t,n)=>{typeof E<"u"&&E.init();var a=!1;return ct.forEach(i=>{a||i.canHandle(r)&&(i.handle(e,r,t,n),a=!0)}),a},Ya=(e,r,t,n,a,i,d,u,h,b)=>{var S=r?Je.resolve(se.join2(e,r)):e;function L(z){function P(B){b==null||b(),u||Xa(e,r,B,n,a,h),i==null||i(),Ir()}Ka(z,S,P,()=>{d==null||d(),Ir()})||P(z)}at(),typeof t=="string"?Wa(t,L,d):L(t)},Qa=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},t=r[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},dt=(e,r)=>{var t=0;return e&&(t|=365),r&&(t|=146),t},fe={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var e=null;return typeof window=="object"&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),q(e,"IDBFS used, but indexedDB not supported"),e},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:function(e){return te.mount.apply(null,arguments)},syncfs:(e,r,t)=>{fe.getLocalSet(e,(n,a)=>{if(n)return t(n);fe.getRemoteSet(e,(i,d)=>{if(i)return t(i);var u=r?d:a,h=r?a:d;fe.reconcile(u,h,t)})})},quit:()=>{Object.values(fe.dbs).forEach(e=>e.close()),fe.dbs={}},getDB:(e,r)=>{var t=fe.dbs[e];if(t)return r(null,t);var n;try{n=fe.indexedDB().open(e,fe.DB_VERSION)}catch(a){return r(a)}if(!n)return r("Unable to connect to IndexedDB");n.onupgradeneeded=a=>{var i=a.target.result,d=a.target.transaction,u;i.objectStoreNames.contains(fe.DB_STORE_NAME)?u=d.objectStore(fe.DB_STORE_NAME):u=i.createObjectStore(fe.DB_STORE_NAME),u.indexNames.contains("timestamp")||u.createIndex("timestamp","timestamp",{unique:!1})},n.onsuccess=()=>{t=n.result,fe.dbs[e]=t,r(null,t)},n.onerror=a=>{r(a.target.error),a.preventDefault()}},getLocalSet:(e,r)=>{var t={};function n(h){return h!=="."&&h!==".."}function a(h){return b=>se.join2(h,b)}for(var i=c.readdir(e.mountpoint).filter(n).map(a(e.mountpoint));i.length;){var d=i.pop(),u;try{u=c.stat(d)}catch(h){return r(h)}c.isDir(u.mode)&&i.push.apply(i,c.readdir(d).filter(n).map(a(d))),t[d]={timestamp:u.mtime}}return r(null,{type:"local",entries:t})},getRemoteSet:(e,r)=>{var t={};fe.getDB(e.mountpoint,(n,a)=>{if(n)return r(n);try{var i=a.transaction([fe.DB_STORE_NAME],"readonly");i.onerror=h=>{r(h.target.error),h.preventDefault()};var d=i.objectStore(fe.DB_STORE_NAME),u=d.index("timestamp");u.openKeyCursor().onsuccess=h=>{var b=h.target.result;if(!b)return r(null,{type:"remote",db:a,entries:t});t[b.primaryKey]={timestamp:b.key},b.continue()}}catch(h){return r(h)}})},loadLocalEntry:(e,r)=>{var t,n;try{var a=c.lookupPath(e);n=a.node,t=c.stat(e)}catch(i){return r(i)}return c.isDir(t.mode)?r(null,{timestamp:t.mtime,mode:t.mode}):c.isFile(t.mode)?(n.contents=te.getFileDataAsTypedArray(n),r(null,{timestamp:t.mtime,mode:t.mode,contents:n.contents})):r(new Error("node type not supported"))},storeLocalEntry:(e,r,t)=>{try{if(c.isDir(r.mode))c.mkdirTree(e,r.mode);else if(c.isFile(r.mode))c.writeFile(e,r.contents,{canOwn:!0});else return t(new Error("node type not supported"));c.chmod(e,r.mode),c.utime(e,r.timestamp,r.timestamp)}catch(n){return t(n)}t(null)},removeLocalEntry:(e,r)=>{try{var t=c.stat(e);c.isDir(t.mode)?c.rmdir(e):c.isFile(t.mode)&&c.unlink(e)}catch(n){return r(n)}r(null)},loadRemoteEntry:(e,r,t)=>{var n=e.get(r);n.onsuccess=a=>t(null,a.target.result),n.onerror=a=>{t(a.target.error),a.preventDefault()}},storeRemoteEntry:(e,r,t,n)=>{try{var a=e.put(t,r)}catch(i){n(i);return}a.onsuccess=i=>n(),a.onerror=i=>{n(i.target.error),i.preventDefault()}},removeRemoteEntry:(e,r,t)=>{var n=e.delete(r);n.onsuccess=a=>t(),n.onerror=a=>{t(a.target.error),a.preventDefault()}},reconcile:(e,r,t)=>{var n=0,a=[];Object.keys(e.entries).forEach(function(L){var z=e.entries[L],P=r.entries[L];(!P||z.timestamp.getTime()!=P.timestamp.getTime())&&(a.push(L),n++)});var i=[];if(Object.keys(r.entries).forEach(function(L){e.entries[L]||(i.push(L),n++)}),!n)return t(null);var d=!1,u=e.type==="remote"?e.db:r.db,h=u.transaction([fe.DB_STORE_NAME],"readwrite"),b=h.objectStore(fe.DB_STORE_NAME);function S(L){if(L&&!d)return d=!0,t(L)}h.onerror=L=>{S(this.error),L.preventDefault()},h.oncomplete=L=>{d||t(null)},a.sort().forEach(L=>{r.type==="local"?fe.loadRemoteEntry(b,L,(z,P)=>{if(z)return S(z);fe.storeLocalEntry(L,P,S)}):fe.loadLocalEntry(L,(z,P)=>{if(z)return S(z);fe.storeRemoteEntry(b,L,P,S)})}),i.sort().reverse().forEach(L=>{r.type==="local"?fe.removeLocalEntry(L,S):fe.removeRemoteEntry(b,L,S)})}},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){this.name="ErrnoError",this.errno=e}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(e,r={}){if(e=Je.resolve(e),!e)return{path:"",node:null};var t={follow_mount:!0,recurse_count:0};if(r=Object.assign(t,r),r.recurse_count>8)throw new c.ErrnoError(32);for(var n=e.split("/").filter(L=>!!L),a=c.root,i="/",d=0;d<n.length;d++){var u=d===n.length-1;if(u&&r.parent)break;if(a=c.lookupNode(a,n[d]),i=se.join2(i,n[d]),c.isMountpoint(a)&&(!u||u&&r.follow_mount)&&(a=a.mounted.root),!u||r.follow)for(var h=0;c.isLink(a.mode);){var b=c.readlink(i);i=Je.resolve(se.dirname(i),b);var S=c.lookupPath(i,{recurse_count:r.recurse_count+1});if(a=S.node,h++>40)throw new c.ErrnoError(32)}}return{path:i,node:a}},getPath(e){for(var r;;){if(c.isRoot(e)){var t=e.mount.mountpoint;return r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var t=0,n=0;n<r.length;n++)t=(t<<5)-t+r.charCodeAt(n)|0;return(e+t>>>0)%c.nameTable.length},hashAddNode(e){var r=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[r],c.nameTable[r]=e},hashRemoveNode(e){var r=c.hashName(e.parent.id,e.name);if(c.nameTable[r]===e)c.nameTable[r]=e.name_next;else for(var t=c.nameTable[r];t;){if(t.name_next===e){t.name_next=e.name_next;break}t=t.name_next}},lookupNode(e,r){var t=c.mayLookup(e);if(t)throw new c.ErrnoError(t);for(var n=c.hashName(e.id,r),a=c.nameTable[n];a;a=a.name_next){var i=a.name;if(a.parent.id===e.id&&i===r)return a}return c.lookup(e,r)},createNode(e,r,t,n){var a=new c.FSNode(e,r,t,n);return c.hashAddNode(a),a},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return c.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var r=c.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){try{var t=c.lookupNode(e,r);return 20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,r,t){var n;try{n=c.lookupNode(e,r)}catch(i){return i.errno}var a=c.nodePermissions(e,"wx");if(a)return a;if(t){if(!c.isDir(n.mode))return 54;if(c.isRoot(n)||c.getPath(n)===c.cwd())return 10}else if(c.isDir(n.mode))return 31;return 0},mayOpen(e,r){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(r)!=="r"||r&512)?31:c.nodePermissions(e,c.flagsToPermissionString(r)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var r=c.getStream(e);if(!r)throw new c.ErrnoError(8);return r},getStream:e=>c.streams[e],createStream(e,r=-1){return c.FSStream||(c.FSStream=function(){this.shared={}},c.FSStream.prototype={},Object.defineProperties(c.FSStream.prototype,{object:{get(){return this.node},set(t){this.node=t}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(t){this.shared.flags=t}},position:{get(){return this.shared.position},set(t){this.shared.position=t}}})),e=Object.assign(new c.FSStream,e),r==-1&&(r=c.nextfd()),e.fd=r,c.streams[r]=e,e},closeStream(e){c.streams[e]=null},chrdev_stream_ops:{open(e){var t,n;var r=c.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,(n=(t=e.stream_ops).open)==null||n.call(t,e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){c.devices[e]={stream_ops:r}},getDevice:e=>c.devices[e],getMounts(e){for(var r=[],t=[e];t.length;){var n=t.pop();r.push(n),t.push.apply(t,n.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&O(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var t=c.getMounts(c.root.mount),n=0;function a(d){return c.syncFSRequests--,r(d)}function i(d){if(d)return i.errored?void 0:(i.errored=!0,a(d));++n>=t.length&&a(null)}t.forEach(d=>{if(!d.type.syncfs)return i(null);d.type.syncfs(d,e,i)})},mount(e,r,t){var n=t==="/",a=!t,i;if(n&&c.root)throw new c.ErrnoError(10);if(!n&&!a){var d=c.lookupPath(t,{follow_mount:!1});if(t=d.path,i=d.node,c.isMountpoint(i))throw new c.ErrnoError(10);if(!c.isDir(i.mode))throw new c.ErrnoError(54)}var u={type:e,opts:r,mountpoint:t,mounts:[]},h=e.mount(u);return h.mount=u,u.root=h,n?c.root=h:i&&(i.mounted=u,i.mount&&i.mount.mounts.push(u)),h},unmount(e){var r=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(r.node))throw new c.ErrnoError(28);var t=r.node,n=t.mounted,a=c.getMounts(n);Object.keys(c.nameTable).forEach(d=>{for(var u=c.nameTable[d];u;){var h=u.name_next;a.includes(u.mount)&&c.destroyNode(u),u=h}}),t.mounted=null;var i=t.mount.mounts.indexOf(n);t.mount.mounts.splice(i,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,t){var n=c.lookupPath(e,{parent:!0}),a=n.node,i=se.basename(e);if(!i||i==="."||i==="..")throw new c.ErrnoError(28);var d=c.mayCreate(a,i);if(d)throw new c.ErrnoError(d);if(!a.node_ops.mknod)throw new c.ErrnoError(63);return a.node_ops.mknod(a,i,r,t)},create(e,r){return r=r!==void 0?r:438,r&=4095,r|=32768,c.mknod(e,r,0)},mkdir(e,r){return r=r!==void 0?r:511,r&=1023,r|=16384,c.mknod(e,r,0)},mkdirTree(e,r){for(var t=e.split("/"),n="",a=0;a<t.length;++a)if(t[a]){n+="/"+t[a];try{c.mkdir(n,r)}catch(i){if(i.errno!=20)throw i}}},mkdev(e,r,t){return typeof t>"u"&&(t=r,r=438),r|=8192,c.mknod(e,r,t)},symlink(e,r){if(!Je.resolve(e))throw new c.ErrnoError(44);var t=c.lookupPath(r,{parent:!0}),n=t.node;if(!n)throw new c.ErrnoError(44);var a=se.basename(r),i=c.mayCreate(n,a);if(i)throw new c.ErrnoError(i);if(!n.node_ops.symlink)throw new c.ErrnoError(63);return n.node_ops.symlink(n,a,e)},rename(e,r){var t=se.dirname(e),n=se.dirname(r),a=se.basename(e),i=se.basename(r),d,u,h;if(d=c.lookupPath(e,{parent:!0}),u=d.node,d=c.lookupPath(r,{parent:!0}),h=d.node,!u||!h)throw new c.ErrnoError(44);if(u.mount!==h.mount)throw new c.ErrnoError(75);var b=c.lookupNode(u,a),S=Je.relative(e,n);if(S.charAt(0)!==".")throw new c.ErrnoError(28);if(S=Je.relative(r,t),S.charAt(0)!==".")throw new c.ErrnoError(55);var L;try{L=c.lookupNode(h,i)}catch{}if(b!==L){var z=c.isDir(b.mode),P=c.mayDelete(u,a,z);if(P)throw new c.ErrnoError(P);if(P=L?c.mayDelete(h,i,z):c.mayCreate(h,i),P)throw new c.ErrnoError(P);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(b)||L&&c.isMountpoint(L))throw new c.ErrnoError(10);if(h!==u&&(P=c.nodePermissions(u,"w"),P))throw new c.ErrnoError(P);c.hashRemoveNode(b);try{u.node_ops.rename(b,h,i)}catch(B){throw B}finally{c.hashAddNode(b)}}},rmdir(e){var r=c.lookupPath(e,{parent:!0}),t=r.node,n=se.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!0);if(i)throw new c.ErrnoError(i);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.rmdir(t,n),c.destroyNode(a)},readdir(e){var r=c.lookupPath(e,{follow:!0}),t=r.node;if(!t.node_ops.readdir)throw new c.ErrnoError(54);return t.node_ops.readdir(t)},unlink(e){var r=c.lookupPath(e,{parent:!0}),t=r.node;if(!t)throw new c.ErrnoError(44);var n=se.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!1);if(i)throw new c.ErrnoError(i);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.unlink(t,n),c.destroyNode(a)},readlink(e){var r=c.lookupPath(e),t=r.node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return Je.resolve(c.getPath(t.parent),t.node_ops.readlink(t))},stat(e,r){var t=c.lookupPath(e,{follow:!r}),n=t.node;if(!n)throw new c.ErrnoError(44);if(!n.node_ops.getattr)throw new c.ErrnoError(63);return n.node_ops.getattr(n)},lstat(e){return c.stat(e,!0)},chmod(e,r,t){var n;if(typeof e=="string"){var a=c.lookupPath(e,{follow:!t});n=a.node}else n=e;if(!n.node_ops.setattr)throw new c.ErrnoError(63);n.node_ops.setattr(n,{mode:r&4095|n.mode&-4096,timestamp:Date.now()})},lchmod(e,r){c.chmod(e,r,!0)},fchmod(e,r){var t=c.getStreamChecked(e);c.chmod(t.node,r)},chown(e,r,t,n){var a;if(typeof e=="string"){var i=c.lookupPath(e,{follow:!n});a=i.node}else a=e;if(!a.node_ops.setattr)throw new c.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown(e,r,t){c.chown(e,r,t,!0)},fchown(e,r,t){var n=c.getStreamChecked(e);c.chown(n.node,r,t)},truncate(e,r){if(r<0)throw new c.ErrnoError(28);var t;if(typeof e=="string"){var n=c.lookupPath(e,{follow:!0});t=n.node}else t=e;if(!t.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var a=c.nodePermissions(t,"w");if(a)throw new c.ErrnoError(a);t.node_ops.setattr(t,{size:r,timestamp:Date.now()})},ftruncate(e,r){var t=c.getStreamChecked(e);if(!(t.flags&2097155))throw new c.ErrnoError(28);c.truncate(t.node,r)},utime(e,r,t){var n=c.lookupPath(e,{follow:!0}),a=n.node;a.node_ops.setattr(a,{timestamp:Math.max(r,t)})},open(e,r,t){if(e==="")throw new c.ErrnoError(44);r=typeof r=="string"?Qa(r):r,t=typeof t>"u"?438:t,r&64?t=t&4095|32768:t=0;var n;if(typeof e=="object")n=e;else{e=se.normalize(e);try{var a=c.lookupPath(e,{follow:!(r&131072)});n=a.node}catch{}}var i=!1;if(r&64)if(n){if(r&128)throw new c.ErrnoError(20)}else n=c.mknod(e,t,0),i=!0;if(!n)throw new c.ErrnoError(44);if(c.isChrdev(n.mode)&&(r&=-513),r&65536&&!c.isDir(n.mode))throw new c.ErrnoError(54);if(!i){var d=c.mayOpen(n,r);if(d)throw new c.ErrnoError(d)}r&512&&!i&&c.truncate(n,0),r&=-131713;var u=c.createStream({node:n,path:c.getPath(n),flags:r,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),s.logReadFiles&&!(r&1)&&(c.readFiles||(c.readFiles={}),e in c.readFiles||(c.readFiles[e]=1)),u},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(t!=0&&t!=1&&t!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,t),e.ungotten=[],e.position},read(e,r,t,n,a){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var i=typeof a<"u";if(!i)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var d=e.stream_ops.read(e,r,t,n,a);return i||(e.position+=d),d},write(e,r,t,n,a,i){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,r,t,n,a,i);return d||(e.position+=u),u},allocate(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(r<0||t<=0)throw new c.ErrnoError(28);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(!c.isFile(e.node.mode)&&!c.isDir(e.node.mode))throw new c.ErrnoError(43);if(!e.stream_ops.allocate)throw new c.ErrnoError(138);e.stream_ops.allocate(e,r,t)},mmap(e,r,t,n,a){if(n&2&&!(a&2)&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);return e.stream_ops.mmap(e,r,t,n,a)},msync(e,r,t,n,a){return e.stream_ops.msync?e.stream_ops.msync(e,r,t,n,a):0},munmap:e=>0,ioctl(e,r,t){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,r,t)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var t,n=c.open(e,r.flags),a=c.stat(e),i=a.size,d=new Uint8Array(i);return c.read(n,d,0,i,0),r.encoding==="utf8"?t=gr(d,0):r.encoding==="binary"&&(t=d),c.close(n),t},writeFile(e,r,t={}){t.flags=t.flags||577;var n=c.open(e,t.flags,t.mode);if(typeof r=="string"){var a=new Uint8Array(xr(r)+1),i=it(r,a,0,a.length);c.write(n,a,0,i,void 0,t.canOwn)}else if(ArrayBuffer.isView(r))c.write(n,r,0,r.byteLength,void 0,t.canOwn);else throw new Error("Unsupported data type");c.close(n)},cwd:()=>c.currentPath,chdir(e){var r=c.lookupPath(e,{follow:!0});if(r.node===null)throw new c.ErrnoError(44);if(!c.isDir(r.node.mode))throw new c.ErrnoError(54);var t=c.nodePermissions(r.node,"x");if(t)throw new c.ErrnoError(t);c.currentPath=r.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(n,a,i,d,u)=>d}),c.mkdev("/dev/null",c.makedev(1,3)),cr.register(c.makedev(5,0),cr.default_tty_ops),cr.register(c.makedev(6,0),cr.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),r=0,t=()=>(r===0&&(r=on(e).byteLength),e[--r]);c.createDevice("/dev","random",t),c.createDevice("/dev","urandom",t),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var r=c.createNode(e,"fd",16895,73);return r.node_ops={lookup(t,n){var a=+n,i=c.getStreamChecked(a),d={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>i.path}};return d.parent=d,d}},r}},{},"/proc/self/fd")},createStandardStreams(){s.stdin?c.createDevice("/dev","stdin",s.stdin):c.symlink("/dev/tty","/dev/stdin"),s.stdout?c.createDevice("/dev","stdout",null,s.stdout):c.symlink("/dev/tty","/dev/stdout"),s.stderr?c.createDevice("/dev","stderr",null,s.stderr):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){[44].forEach(e=>{c.genericErrors[e]=new c.ErrnoError(e),c.genericErrors[e].stack="<generic error, no stack>"}),c.nameTable=new Array(4096),c.mount(te,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:te,IDBFS:fe}},init(e,r,t){c.init.initialized=!0,s.stdin=e||s.stdin,s.stdout=r||s.stdout,s.stderr=t||s.stderr,c.createStandardStreams()},quit(){c.init.initialized=!1;for(var e=0;e<c.streams.length;e++){var r=c.streams[e];r&&c.close(r)}},findObject(e,r){var t=c.analyzePath(e,r);return t.exists?t.object:null},analyzePath(e,r){try{var t=c.lookupPath(e,{follow:!r});e=t.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=c.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=se.basename(e),t=c.lookupPath(e,{follow:!r}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot=t.path==="/"}catch(a){n.error=a.errno}return n},createPath(e,r,t,n){e=typeof e=="string"?e:c.getPath(e);for(var a=r.split("/").reverse();a.length;){var i=a.pop();if(i){var d=se.join2(e,i);try{c.mkdir(d)}catch{}e=d}}return d},createFile(e,r,t,n,a){var i=se.join2(typeof e=="string"?e:c.getPath(e),r),d=dt(n,a);return c.create(i,d)},createDataFile(e,r,t,n,a,i){var d=r;e&&(e=typeof e=="string"?e:c.getPath(e),d=r?se.join2(e,r):e);var u=dt(n,a),h=c.create(d,u);if(t){if(typeof t=="string"){for(var b=new Array(t.length),S=0,L=t.length;S<L;++S)b[S]=t.charCodeAt(S);t=b}c.chmod(h,u|146);var z=c.open(h,577);c.write(z,t,0,t.length,0,i),c.close(z),c.chmod(h,u)}},createDevice(e,r,t,n){var a=se.join2(typeof e=="string"?e:c.getPath(e),r),i=dt(!!t,!!n);c.createDevice.major||(c.createDevice.major=64);var d=c.makedev(c.createDevice.major++,0);return c.registerDevice(d,{open(u){u.seekable=!1},close(u){var h;(h=n==null?void 0:n.buffer)!=null&&h.length&&n(10)},read(u,h,b,S,L){for(var z=0,P=0;P<S;P++){var B;try{B=t()}catch{throw new c.ErrnoError(29)}if(B===void 0&&z===0)throw new c.ErrnoError(6);if(B==null)break;z++,h[b+P]=B}return z&&(u.node.timestamp=Date.now()),z},write(u,h,b,S,L){for(var z=0;z<S;z++)try{n(h[b+z])}catch{throw new c.ErrnoError(29)}return S&&(u.node.timestamp=Date.now()),z}}),c.mkdev(a,i,d)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(W)try{e.contents=lt(W(e.url),!0),e.usedBytes=e.contents.length}catch{throw new c.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,r,t,n,a){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(P){if(!(P>this.length-1||P<0)){var B=P%this.chunkSize,J=P/this.chunkSize|0;return this.getter(J)[B]}},i.prototype.setDataGetter=function(P){this.getter=P},i.prototype.cacheLength=function(){var P=new XMLHttpRequest;if(P.open("HEAD",t,!1),P.send(null),!(P.status>=200&&P.status<300||P.status===304))throw new Error("Couldn't load "+t+". Status: "+P.status);var B=Number(P.getResponseHeader("Content-length")),J,xe=(J=P.getResponseHeader("Accept-Ranges"))&&J==="bytes",me=(J=P.getResponseHeader("Content-Encoding"))&&J==="gzip",Se=1024*1024;xe||(Se=B);var be=(je,Ue)=>{if(je>Ue)throw new Error("invalid range ("+je+", "+Ue+") or no bytes requested!");if(Ue>B-1)throw new Error("only "+B+" bytes available! programmer error!");var ye=new XMLHttpRequest;if(ye.open("GET",t,!1),B!==Se&&ye.setRequestHeader("Range","bytes="+je+"-"+Ue),ye.responseType="arraybuffer",ye.overrideMimeType&&ye.overrideMimeType("text/plain; charset=x-user-defined"),ye.send(null),!(ye.status>=200&&ye.status<300||ye.status===304))throw new Error("Couldn't load "+t+". Status: "+ye.status);return ye.response!==void 0?new Uint8Array(ye.response||[]):lt(ye.responseText||"")},_e=this;_e.setDataGetter(je=>{var Ue=je*Se,ye=(je+1)*Se-1;if(ye=Math.min(ye,B-1),typeof _e.chunks[je]>"u"&&(_e.chunks[je]=be(Ue,ye)),typeof _e.chunks[je]>"u")throw new Error("doXHR failed!");return _e.chunks[je]}),(me||!B)&&(Se=B=1,B=this.getter(0).length,Se=B,A("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=B,this._chunkSize=Se,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var d,u}else var u={isDevice:!1,url:t};var h=c.createFile(e,r,u,n,a);u.contents?h.contents=u.contents:u.url&&(h.contents=null,h.url=u.url),Object.defineProperties(h,{usedBytes:{get:function(){return this.contents.length}}});var b={},S=Object.keys(h.stream_ops);S.forEach(z=>{var P=h.stream_ops[z];b[z]=function(){return c.forceLoadFile(h),P.apply(null,arguments)}});function L(z,P,B,J,xe){var me=z.node.contents;if(xe>=me.length)return 0;var Se=Math.min(me.length-xe,J);if(me.slice)for(var be=0;be<Se;be++)P[B+be]=me[xe+be];else for(var be=0;be<Se;be++)P[B+be]=me.get(xe+be);return Se}return b.read=(z,P,B,J,xe)=>(c.forceLoadFile(h),L(z,P,B,J,xe)),b.mmap=(z,P,B,J,xe)=>{c.forceLoadFile(h);var me=ln(P);if(!me)throw new c.ErrnoError(48);return L(z,M,me,P,B),{ptr:me,allocated:!0}},h.stream_ops=b,h}},Le=(e,r)=>e?gr(U,e,r):"",re={DEFAULT_POLLMASK:5,calculateAt(e,r,t){if(se.isAbs(r))return r;var n;if(e===-100)n=c.cwd();else{var a=re.getStreamFromFD(e);n=a.path}if(r.length==0){if(!t)throw new c.ErrnoError(44);return n}return se.join2(n,r)},doStat(e,r,t){var n=e(r);f[t>>2]=n.dev,f[t+4>>2]=n.mode,ee[t+8>>2]=n.nlink,f[t+12>>2]=n.uid,f[t+16>>2]=n.gid,f[t+20>>2]=n.rdev,ue=[n.size>>>0,(Z=n.size,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[t+24>>2]=ue[0],f[t+28>>2]=ue[1],f[t+32>>2]=4096,f[t+36>>2]=n.blocks;var a=n.atime.getTime(),i=n.mtime.getTime(),d=n.ctime.getTime();return ue=[Math.floor(a/1e3)>>>0,(Z=Math.floor(a/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[t+40>>2]=ue[0],f[t+44>>2]=ue[1],ee[t+48>>2]=a%1e3*1e3,ue=[Math.floor(i/1e3)>>>0,(Z=Math.floor(i/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[t+56>>2]=ue[0],f[t+60>>2]=ue[1],ee[t+64>>2]=i%1e3*1e3,ue=[Math.floor(d/1e3)>>>0,(Z=Math.floor(d/1e3),+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[t+72>>2]=ue[0],f[t+76>>2]=ue[1],ee[t+80>>2]=d%1e3*1e3,ue=[n.ino>>>0,(Z=n.ino,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[t+88>>2]=ue[0],f[t+92>>2]=ue[1],0},doMsync(e,r,t,n,a){if(!c.isFile(r.node.mode))throw new c.ErrnoError(43);if(n&2)return 0;var i=U.slice(e,e+t);c.msync(r,i,a,t,n)},varargs:void 0,get(){var e=f[+re.varargs>>2];return re.varargs+=4,e},getp(){return re.get()},getStr(e){var r=Le(e);return r},getStreamFromFD(e){var r=c.getStreamChecked(e);return r}};function Ja(e,r,t){re.varargs=t;try{var n=re.getStreamFromFD(e);switch(r){case 0:{var a=re.get();if(a<0)return-28;for(;c.streams[a];)a++;var i;return i=c.createStream(n,a),i.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var a=re.get();return n.flags|=a,0}case 12:{var a=re.getp(),d=0;return D[a+d>>1]=2,0}case 13:case 14:return 0}return-28}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Za(e,r){try{var t=re.getStreamFromFD(e);return re.doStat(c.stat,t.path,r)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var br=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function eo(e,r,t){var n=br(r,t);try{return isNaN(n)?61:(c.ftruncate(e,n),0)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var he=(e,r,t)=>it(e,U,r,t);function ro(e,r){try{if(r===0)return-28;var t=c.cwd(),n=xr(t)+1;return r<n?-68:(he(t,e,r),n)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function to(e,r,t){try{var n=re.getStreamFromFD(e);n.getdents||(n.getdents=c.readdir(n.path));for(var a=280,i=0,d=c.llseek(n,0,1),u=Math.floor(d/a);u<n.getdents.length&&i+a<=t;){var h,b,S=n.getdents[u];if(S===".")h=n.node.id,b=4;else if(S===".."){var L=c.lookupPath(n.path,{parent:!0});h=L.node.id,b=4}else{var z=c.lookupNode(n.node,S);h=z.id,b=c.isChrdev(z.mode)?2:c.isDir(z.mode)?4:c.isLink(z.mode)?10:8}ue=[h>>>0,(Z=h,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[r+i>>2]=ue[0],f[r+i+4>>2]=ue[1],ue=[(u+1)*a>>>0,(Z=(u+1)*a,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[r+i+8>>2]=ue[0],f[r+i+12>>2]=ue[1],D[r+i+16>>1]=280,M[r+i+18>>0]=b,he(S,r+i+19,256),i+=a,u+=1}return c.llseek(n,u*a,0),i}catch(P){if(typeof c>"u"||P.name!=="ErrnoError")throw P;return-P.errno}}function no(e,r,t){re.varargs=t;try{var n=re.getStreamFromFD(e);switch(r){case 21509:return n.tty?0:-59;case 21505:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var a=n.tty.ops.ioctl_tcgets(n),i=re.getp();f[i>>2]=a.c_iflag||0,f[i+4>>2]=a.c_oflag||0,f[i+8>>2]=a.c_cflag||0,f[i+12>>2]=a.c_lflag||0;for(var d=0;d<32;d++)M[i+d+17>>0]=a.c_cc[d]||0;return 0}return 0}case 21510:case 21511:case 21512:return n.tty?0:-59;case 21506:case 21507:case 21508:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){for(var i=re.getp(),u=f[i>>2],h=f[i+4>>2],b=f[i+8>>2],S=f[i+12>>2],L=[],d=0;d<32;d++)L.push(M[i+d+17>>0]);return n.tty.ops.ioctl_tcsets(n.tty,r,{c_iflag:u,c_oflag:h,c_cflag:b,c_lflag:S,c_cc:L})}return 0}case 21519:{if(!n.tty)return-59;var i=re.getp();return f[i>>2]=0,0}case 21520:return n.tty?-28:-59;case 21531:{var i=re.getp();return c.ioctl(n,r,i)}case 21523:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var z=n.tty.ops.ioctl_tiocgwinsz(n.tty),i=re.getp();D[i>>1]=z[0],D[i+2>>1]=z[1]}return 0}case 21524:return n.tty?0:-59;case 21515:return n.tty?0:-59;default:return-28}}catch(P){if(typeof c>"u"||P.name!=="ErrnoError")throw P;return-P.errno}}function ao(e,r){try{return e=re.getStr(e),re.doStat(c.lstat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function oo(e,r,t){try{return r=re.getStr(r),r=re.calculateAt(e,r),r=se.normalize(r),r[r.length-1]==="/"&&(r=r.substr(0,r.length-1)),c.mkdir(r,t,0),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function so(e,r,t,n){try{r=re.getStr(r);var a=n&256,i=n&4096;return n=n&-6401,r=re.calculateAt(e,r,i),re.doStat(a?c.lstat:c.stat,r,t)}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function io(e,r,t,n){re.varargs=n;try{r=re.getStr(r),r=re.calculateAt(e,r);var a=n?re.get():0;return c.open(r,t,a).fd}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function lo(e,r,t,n){try{if(r=re.getStr(r),r=re.calculateAt(e,r),n<=0)return-28;var a=c.readlink(r),i=Math.min(n,xr(a)),d=M[t+i];return he(a,t,n+1),M[t+i]=d,i}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function co(e){try{return e=re.getStr(e),c.rmdir(e),0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function uo(e,r){try{return e=re.getStr(e),re.doStat(c.stat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function fo(e,r,t){try{return r=re.getStr(r),r=re.calculateAt(e,r),t===0?c.unlink(r):t===512?c.rmdir(r):tr("Invalid flags passed to unlinkat"),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var cn=e=>ee[e>>2]+f[e+4>>2]*4294967296;function mo(e,r,t,n){try{if(r=re.getStr(r),r=re.calculateAt(e,r,!0),t){var d=cn(t),u=f[t+8>>2];a=d*1e3+u/(1e3*1e3),t+=16,d=cn(t),u=f[t+8>>2],i=d*1e3+u/(1e3*1e3)}else var a=Date.now(),i=a;return c.utime(r,a,i),0}catch(h){if(typeof c>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}var po=1,ho=()=>po,vo=()=>{throw 1/0},go=e=>e%4===0&&(e%100!==0||e%400===0),xo=[0,31,60,91,121,152,182,213,244,274,305,335],bo=[0,31,59,90,120,151,181,212,243,273,304,334],dn=e=>{var r=go(e.getFullYear()),t=r?xo:bo,n=t[e.getMonth()]+e.getDate()-1;return n};function _o(e,r,t){var n=br(e,r),a=new Date(n*1e3);f[t>>2]=a.getSeconds(),f[t+4>>2]=a.getMinutes(),f[t+8>>2]=a.getHours(),f[t+12>>2]=a.getDate(),f[t+16>>2]=a.getMonth(),f[t+20>>2]=a.getFullYear()-1900,f[t+24>>2]=a.getDay();var i=dn(a)|0;f[t+28>>2]=i,f[t+36>>2]=-(a.getTimezoneOffset()*60);var d=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),h=d.getTimezoneOffset(),b=(u!=h&&a.getTimezoneOffset()==Math.min(h,u))|0;f[t+32>>2]=b}var yo=function(e){var r=(()=>{var t=new Date(f[e+20>>2]+1900,f[e+16>>2],f[e+12>>2],f[e+8>>2],f[e+4>>2],f[e>>2],0),n=f[e+32>>2],a=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),d=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),h=Math.min(u,d);if(n<0)f[e+32>>2]=+(d!=u&&h==a);else if(n>0!=(h==a)){var b=Math.max(u,d),S=n>0?h:b;t.setTime(t.getTime()+(S-a)*6e4)}f[e+24>>2]=t.getDay();var L=dn(t)|0;f[e+28>>2]=L,f[e>>2]=t.getSeconds(),f[e+4>>2]=t.getMinutes(),f[e+8>>2]=t.getHours(),f[e+12>>2]=t.getDate(),f[e+16>>2]=t.getMonth(),f[e+20>>2]=t.getYear();var z=t.getTime();return isNaN(z)?-1:z/1e3})();return Gn((Z=r,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)),r>>>0};function wo(e,r,t,n,a,i,d,u){var h=br(a,i);try{if(isNaN(h))return 61;var b=re.getStreamFromFD(n),S=c.mmap(b,e,h,r,t),L=S.ptr;return f[d>>2]=S.allocated,ee[u>>2]=L,0}catch(z){if(typeof c>"u"||z.name!=="ErrnoError")throw z;return-z.errno}}function So(e,r,t,n,a,i,d){var u=br(i,d);try{return isNaN(u)?61:(re.doMsync(e,re.getStreamFromFD(a),r,n,u),0)}catch(h){if(typeof c>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function Co(e,r,t,n,a,i,d){var u=br(i,d);try{if(isNaN(u))return 61;var h=re.getStreamFromFD(a);t&2&&re.doMsync(e,h,r,n,u),c.munmap(h)}catch(b){if(typeof c>"u"||b.name!=="ErrnoError")throw b;return-b.errno}}var Ve=e=>{var r=xr(e)+1,t=Be(r);return t&&he(e,t,r),t},Eo=(e,r,t)=>{var n=new Date().getFullYear(),a=new Date(n,0,1),i=new Date(n,6,1),d=a.getTimezoneOffset(),u=i.getTimezoneOffset(),h=Math.max(d,u);ee[e>>2]=h*60,f[r>>2]=+(d!=u);function b(B){var J=B.toTimeString().match(/\(([A-Za-z ]+)\)$/);return J?J[1]:"GMT"}var S=b(a),L=b(i),z=Ve(S),P=Ve(L);u<d?(ee[t>>2]=z,ee[t+4>>2]=P):(ee[t>>2]=P,ee[t+4>>2]=z)},ko=()=>{tr("")},_r=(e,r)=>{if(E.mainLoop.timingMode=e,E.mainLoop.timingValue=r,!E.mainLoop.func)return 1;if(E.mainLoop.running||(E.mainLoop.running=!0),e==0)E.mainLoop.scheduler=function(){var d=Math.max(0,E.mainLoop.tickStartTime+r-$r())|0;setTimeout(E.mainLoop.runner,d)},E.mainLoop.method="timeout";else if(e==1)E.mainLoop.scheduler=function(){E.requestAnimationFrame(E.mainLoop.runner)},E.mainLoop.method="rAF";else if(e==2){if(typeof E.setImmediate>"u")if(typeof setImmediate>"u"){var t=[],n="setimmediate",a=i=>{(i.data===n||i.data.target===n)&&(i.stopPropagation(),t.shift()())};addEventListener("message",a,!0),E.setImmediate=function(d){t.push(d),postMessage(n,"*")}}else E.setImmediate=setImmediate;E.mainLoop.scheduler=function(){E.setImmediate(E.mainLoop.runner)},E.mainLoop.method="immediate"}return 0},$r;$r=()=>performance.now();var un=(e,r,t,n,a)=>{q(!E.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),E.mainLoop.func=e,E.mainLoop.arg=n;var i=E.mainLoop.currentlyRunningMainloop;function d(){return!(i<E.mainLoop.currentlyRunningMainloop)}if(E.mainLoop.running=!1,E.mainLoop.runner=function(){var L,z;if(!X){if(E.mainLoop.queue.length>0){var h=E.mainLoop.queue.shift();if(h.func(h.arg),E.mainLoop.remainingBlockers){var b=E.mainLoop.remainingBlockers,S=b%1==0?b-1:Math.floor(b);h.counted?E.mainLoop.remainingBlockers=S:(S=S+.5,E.mainLoop.remainingBlockers=(8*b+S)/9)}if(E.mainLoop.updateStatus(),!d())return;setTimeout(E.mainLoop.runner,0);return}if(d()){if(E.mainLoop.currentFrameNumber=E.mainLoop.currentFrameNumber+1|0,E.mainLoop.timingMode==1&&E.mainLoop.timingValue>1&&E.mainLoop.currentFrameNumber%E.mainLoop.timingValue!=0){E.mainLoop.scheduler();return}else E.mainLoop.timingMode==0&&(E.mainLoop.tickStartTime=$r());E.mainLoop.runIter(e),d()&&(typeof SDL=="object"&&((z=(L=SDL.audio)==null?void 0:L.queueNewAudioData)==null||z.call(L)),E.mainLoop.scheduler())}}},a||(r&&r>0?_r(0,1e3/r):_r(1,1),E.mainLoop.scheduler()),t)throw"unwind"},ut=e=>{if(e instanceof nn||e=="unwind")return $;w(1,e)},jo=0,fn=()=>za||jo>0,Fo=e=>{var r;$=e,fn()||((r=s.onExit)==null||r.call(s,e),X=!0),w(e,new nn(e))},mn=(e,r)=>{$=e,Fo(e)},pn=mn,Lo=()=>{if(!fn())try{pn($)}catch(e){ut(e)}},ft=e=>{if(!X)try{e(),Lo()}catch(r){ut(r)}},hn=(e,r)=>setTimeout(()=>{ft(e)},r),E={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){E.mainLoop.scheduler=null,E.mainLoop.currentlyRunningMainloop++},resume(){E.mainLoop.currentlyRunningMainloop++;var e=E.mainLoop.timingMode,r=E.mainLoop.timingValue,t=E.mainLoop.func;E.mainLoop.func=null,un(t,0,!1,E.mainLoop.arg,!0),_r(e,r),E.mainLoop.scheduler()},updateStatus(){if(s.setStatus){var e=s.statusMessage||"Please wait...",r=E.mainLoop.remainingBlockers,t=E.mainLoop.expectedBlockers;r?r<t?s.setStatus(e+" ("+(t-r)+"/"+t+")"):s.setStatus(e):s.setStatus("")}},runIter(e){var t;if(!X){if(s.preMainLoop){var r=s.preMainLoop();if(r===!1)return}ft(e),(t=s.postMainLoop)==null||t.call(s)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(E.initted)return;E.initted=!0;var e={};e.canHandle=function(i){return!s.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(i)},e.handle=function(i,d,u,h){var b=new Blob([i],{type:E.getMimetype(d)});b.size!==i.length&&(b=new Blob([new Uint8Array(i).buffer],{type:E.getMimetype(d)}));var S=URL.createObjectURL(b),L=new Image;L.onload=()=>{q(L.complete,`Image ${d} could not be decoded`);var z=document.createElement("canvas");z.width=L.width,z.height=L.height;var P=z.getContext("2d");P.drawImage(L,0,0),URL.revokeObjectURL(S),u==null||u(i)},L.onerror=z=>{O(`Image ${S} could not be decoded`),h==null||h()},L.src=S},ct.push(e);var r={};r.canHandle=function(i){return!s.noAudioDecoding&&i.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(i,d,u,h){var b=!1;function S(B){b||(b=!0,u==null||u(i))}var L=new Blob([i],{type:E.getMimetype(d)}),z=URL.createObjectURL(L),P=new Audio;P.addEventListener("canplaythrough",()=>S(),!1),P.onerror=function(J){if(b)return;O(`warning: browser could not fully decode audio ${d}, trying slower base64 approach`);function xe(me){for(var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",be="=",_e="",je=0,Ue=0,ye=0;ye<me.length;ye++)for(je=je<<8|me[ye],Ue+=8;Ue>=6;){var Xm=je>>Ue-6&63;Ue-=6,_e+=Se[Xm]}return Ue==2?(_e+=Se[(je&3)<<4],_e+=be+be):Ue==4&&(_e+=Se[(je&15)<<2],_e+=be),_e}P.src="data:audio/x-"+d.substr(-3)+";base64,"+xe(i),S()},P.src=z,hn(()=>{S()},1e4)},ct.push(r);function t(){E.pointerLock=document.pointerLockElement===s.canvas||document.mozPointerLockElement===s.canvas||document.webkitPointerLockElement===s.canvas||document.msPointerLockElement===s.canvas}var n=s.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),s.elementPointerLock&&n.addEventListener("click",a=>{!E.pointerLock&&s.canvas.requestPointerLock&&(s.canvas.requestPointerLock(),a.preventDefault())},!1))},createContext(e,r,t,n){if(r&&s.ctx&&e==s.canvas)return s.ctx;var a,i;if(r){var d={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var u in n)d[u]=n[u];typeof k<"u"&&(i=k.createContext(e,d),i&&(a=k.getContext(i).GLctx))}else a=e.getContext("2d");return a?(t&&(r||q(typeof y>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),s.ctx=a,r&&k.makeContextCurrent(i),s.useWebGL=r,E.moduleContextCreatedCallbacks.forEach(h=>h()),E.init()),a):null},destroyContext(e,r,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(e,r){E.lockPointer=e,E.resizeCanvas=r,typeof E.lockPointer>"u"&&(E.lockPointer=!0),typeof E.resizeCanvas>"u"&&(E.resizeCanvas=!1);var t=s.canvas;function n(){var d,u;E.isFullscreen=!1;var i=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===i?(t.exitFullscreen=E.exitFullscreen,E.lockPointer&&t.requestPointerLock(),E.isFullscreen=!0,E.resizeCanvas?E.setFullscreenCanvasSize():E.updateCanvasDimensions(t)):(i.parentNode.insertBefore(t,i),i.parentNode.removeChild(i),E.resizeCanvas?E.setWindowedCanvasSize():E.updateCanvasDimensions(t)),(d=s.onFullScreen)==null||d.call(s,E.isFullscreen),(u=s.onFullscreen)==null||u.call(s,E.isFullscreen)}E.fullscreenHandlersInstalled||(E.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?()=>a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(a.webkitRequestFullScreen?()=>a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),a.requestFullscreen()},exitFullscreen(){if(!E.isFullscreen)return!1;var e=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return e.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(e){var r=Date.now();if(E.nextRAF===0)E.nextRAF=r+1e3/60;else for(;r+2>=E.nextRAF;)E.nextRAF+=1e3/60;var t=Math.max(E.nextRAF-r,0);setTimeout(e,t)},requestAnimationFrame(e){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(e);return}var r=E.fakeRequestAnimationFrame;r(e)},safeSetTimeout(e,r){return hn(e,r)},safeRequestAnimationFrame(e){return E.requestAnimationFrame(()=>{ft(e)})},getMimetype(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta(e){var r=0;switch(e.type){case"DOMMouseScroll":r=e.detail/3;break;case"mousewheel":r=e.wheelDelta/120;break;case"wheel":switch(r=e.deltaY,e.deltaMode){case 0:r/=100;break;case 1:r/=3;break;case 2:r*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return r},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(e,r){var t=s.canvas.getBoundingClientRect(),n=s.canvas.width,a=s.canvas.height,i=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,d=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset,u=e-(i+t.left),h=r-(d+t.top);return u=u*(n/t.width),h=h*(a/t.height),{x:u,y:h}},setMouseCoords(e,r){const{x:t,y:n}=E.calculateMouseCoords(e,r);E.mouseMovementX=t-E.mouseX,E.mouseMovementY=n-E.mouseY,E.mouseX=t,E.mouseY=n},calculateMouseEvent(e){if(E.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?E.mouseMovementX=E.mouseMovementY=0:(E.mouseMovementX=E.getMovementX(e),E.mouseMovementY=E.getMovementY(e)),typeof SDL<"u"?(E.mouseX=SDL.mouseX+E.mouseMovementX,E.mouseY=SDL.mouseY+E.mouseMovementY):(E.mouseX+=E.mouseMovementX,E.mouseY+=E.mouseMovementY);else{if(e.type==="touchstart"||e.type==="touchend"||e.type==="touchmove"){var r=e.touch;if(r===void 0)return;var t=E.calculateMouseCoords(r.pageX,r.pageY);if(e.type==="touchstart")E.lastTouches[r.identifier]=t,E.touches[r.identifier]=t;else if(e.type==="touchend"||e.type==="touchmove"){var n=E.touches[r.identifier];n||(n=t),E.lastTouches[r.identifier]=n,E.touches[r.identifier]=t}return}E.setMouseCoords(e.pageX,e.pageY)}},resizeListeners:[],updateResizeListeners(){var e=s.canvas;E.resizeListeners.forEach(r=>r(e.width,e.height))},setCanvasSize(e,r,t){var n=s.canvas;E.updateCanvasDimensions(n,e,r),t||E.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var e=ee[SDL.screen>>2];e=e|8388608,f[SDL.screen>>2]=e}E.updateCanvasDimensions(s.canvas),E.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var e=ee[SDL.screen>>2];e=e&-8388609,f[SDL.screen>>2]=e}E.updateCanvasDimensions(s.canvas),E.updateResizeListeners()},updateCanvasDimensions(e,r,t){r&&t?(e.widthNative=r,e.heightNative=t):(r=e.widthNative,t=e.heightNative);var n=r,a=t;if(s.forcedAspectRatio&&s.forcedAspectRatio>0&&(n/a<s.forcedAspectRatio?n=Math.round(a*s.forcedAspectRatio):a=Math.round(n/s.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&typeof screen<"u"){var i=Math.min(screen.width/n,screen.height/a);n=Math.round(n*i),a=Math.round(a*i)}E.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=a&&(e.height=a),typeof e.style<"u"&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=r&&(e.width=r),e.height!=t&&(e.height=t),typeof e.style<"u"&&(n!=r||a!=t?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}},H={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode(e){H.errorCode=e},chooseConfig(e,r,t,n,a){if(e!=62e3)return H.setErrorCode(12296),0;if(r)for(;;){var i=f[r>>2];if(i==12321){var d=f[r+4>>2];H.contextAttributes.alpha=d>0}else if(i==12325){var u=f[r+4>>2];H.contextAttributes.depth=u>0}else if(i==12326){var h=f[r+4>>2];H.contextAttributes.stencil=h>0}else if(i==12337){var b=f[r+4>>2];H.contextAttributes.antialias=b>0}else if(i==12338){var b=f[r+4>>2];H.contextAttributes.antialias=b==1}else if(i==12544){var S=f[r+4>>2];H.contextAttributes.lowLatency=S!=12547}else if(i==12344)break;r+=8}return(!t||!n)&&!a?(H.setErrorCode(12300),0):(a&&(f[a>>2]=1),t&&n>0&&(ee[t>>2]=62002),H.setErrorCode(12288),1)}},Ro=e=>e==12448?(H.setErrorCode(12288),1):(H.setErrorCode(12300),0),To=(e,r,t,n,a)=>H.chooseConfig(e,r,t,n,a),Po=e=>{var r=e.getExtension("ANGLE_instanced_arrays");if(r)return e.vertexAttribDivisor=(t,n)=>r.vertexAttribDivisorANGLE(t,n),e.drawArraysInstanced=(t,n,a,i)=>r.drawArraysInstancedANGLE(t,n,a,i),e.drawElementsInstanced=(t,n,a,i,d)=>r.drawElementsInstancedANGLE(t,n,a,i,d),1},Mo=e=>{var r=e.getExtension("OES_vertex_array_object");if(r)return e.createVertexArray=()=>r.createVertexArrayOES(),e.deleteVertexArray=t=>r.deleteVertexArrayOES(t),e.bindVertexArray=t=>r.bindVertexArrayOES(t),e.isVertexArray=t=>r.isVertexArrayOES(t),1},Ao=e=>{var r=e.getExtension("WEBGL_draw_buffers");if(r)return e.drawBuffers=(t,n)=>r.drawBuffersWEBGL(t,n),1},Do=e=>!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")),vn=function(e){var r=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_half_float","EXT_float_blend","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw"];return(e.getSupportedExtensions()||[]).filter(t=>r.includes(t))},k={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(r){k.lastError||(k.lastError=r)},getNewId:e=>{for(var r=k.counter++,t=e.length;t<r;t++)e[t]=null;return r},getSource:(e,r,t,n)=>{for(var a="",i=0;i<r;++i){var d=n?ee[n+i*4>>2]:void 0;a+=Le(ee[t+i*4>>2],d)}return a},createContext:(e,r)=>{if(!e.getContextSafariWebGL2Fixed){let a=function(i,d){var u=e.getContextSafariWebGL2Fixed(i,d);return i=="webgl"==u instanceof WebGLRenderingContext?u:null};e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=a}var t=e.getContext("webgl",r);if(!t)return 0;var n=k.registerContext(t,r);return n},registerContext:(e,r)=>{var t=k.getNewId(k.contexts),n={handle:t,attributes:r,version:r.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),k.contexts[t]=n,(typeof r.enableExtensionsByDefault>"u"||r.enableExtensionsByDefault)&&k.initExtensions(n),t},makeContextCurrent:e=>{var r;return k.currentContext=k.contexts[e],s.ctx=y=(r=k.currentContext)==null?void 0:r.GLctx,!(e&&!y)},getContext:e=>k.contexts[e],deleteContext:e=>{k.currentContext===k.contexts[e]&&(k.currentContext=null),typeof I=="object"&&I.removeAllHandlersOnTarget(k.contexts[e].GLctx.canvas),k.contexts[e]&&k.contexts[e].GLctx.canvas&&(k.contexts[e].GLctx.canvas.GLctxObject=void 0),k.contexts[e]=null},initExtensions:e=>{if(e||(e=k.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var r=e.GLctx;Po(r),Mo(r),Ao(r),r.disjointTimerQueryExt=r.getExtension("EXT_disjoint_timer_query"),Do(r),vn(r).forEach(t=>{!t.includes("lose_context")&&!t.includes("debug")&&r.getExtension(t)})}}},Io=(e,r,t,n)=>{if(e!=62e3)return H.setErrorCode(12296),0;for(var a=1;;){var i=f[n>>2];if(i==12440)a=f[n+4>>2];else{if(i==12344)break;return H.setErrorCode(12292),0}n+=8}return a!=2?(H.setErrorCode(12293),0):(H.contextAttributes.majorVersion=a-1,H.contextAttributes.minorVersion=0,H.context=k.createContext(s.canvas,H.contextAttributes),H.context!=0?(H.setErrorCode(12288),k.makeContextCurrent(H.context),s.useWebGL=!0,E.moduleContextCreatedCallbacks.forEach(function(d){d()}),k.makeContextCurrent(null),62004):(H.setErrorCode(12297),0))},Bo=(e,r,t,n)=>e!=62e3?(H.setErrorCode(12296),0):r!=62002?(H.setErrorCode(12293),0):(H.setErrorCode(12288),62006),$o=(e,r)=>e!=62e3?(H.setErrorCode(12296),0):r!=62004?(H.setErrorCode(12294),0):(k.deleteContext(H.context),H.setErrorCode(12288),H.currentContext==r&&(H.currentContext=0),1),No=(e,r)=>e!=62e3?(H.setErrorCode(12296),0):r!=62006?(H.setErrorCode(12301),1):(H.currentReadSurface==r&&(H.currentReadSurface=0),H.currentDrawSurface==r&&(H.currentDrawSurface=0),H.setErrorCode(12288),1),Uo=(e,r,t,n)=>{if(e!=62e3)return H.setErrorCode(12296),0;if(r!=62002)return H.setErrorCode(12293),0;if(!n)return H.setErrorCode(12300),0;switch(H.setErrorCode(12288),t){case 12320:return f[n>>2]=H.contextAttributes.alpha?32:24,1;case 12321:return f[n>>2]=H.contextAttributes.alpha?8:0,1;case 12322:return f[n>>2]=8,1;case 12323:return f[n>>2]=8,1;case 12324:return f[n>>2]=8,1;case 12325:return f[n>>2]=H.contextAttributes.depth?24:0,1;case 12326:return f[n>>2]=H.contextAttributes.stencil?8:0,1;case 12327:return f[n>>2]=12344,1;case 12328:return f[n>>2]=62002,1;case 12329:return f[n>>2]=0,1;case 12330:return f[n>>2]=4096,1;case 12331:return f[n>>2]=16777216,1;case 12332:return f[n>>2]=4096,1;case 12333:return f[n>>2]=0,1;case 12334:return f[n>>2]=0,1;case 12335:return f[n>>2]=12344,1;case 12337:return f[n>>2]=H.contextAttributes.antialias?4:0,1;case 12338:return f[n>>2]=H.contextAttributes.antialias?1:0,1;case 12339:return f[n>>2]=4,1;case 12340:return f[n>>2]=12344,1;case 12341:case 12342:case 12343:return f[n>>2]=-1,1;case 12345:case 12346:return f[n>>2]=0,1;case 12347:return f[n>>2]=0,1;case 12348:return f[n>>2]=1,1;case 12349:case 12350:return f[n>>2]=0,1;case 12351:return f[n>>2]=12430,1;case 12352:return f[n>>2]=4,1;case 12354:return f[n>>2]=0,1;default:return H.setErrorCode(12292),0}},Oo=e=>(H.setErrorCode(12288),e!=0&&e!=1?0:62e3),zo=()=>H.errorCode,Go=(e,r,t)=>e!=62e3?(H.setErrorCode(12296),0):(r&&(f[r>>2]=1),t&&(f[t>>2]=4),H.defaultDisplayInitialized=!0,H.setErrorCode(12288),1),qo=(e,r,t,n)=>e!=62e3?(H.setErrorCode(12296),0):n!=0&&n!=62004?(H.setErrorCode(12294),0):t!=0&&t!=62006||r!=0&&r!=62006?(H.setErrorCode(12301),0):(k.makeContextCurrent(n?H.context:null),H.currentContext=n,H.currentDrawSurface=r,H.currentReadSurface=t,H.setErrorCode(12288),1),Ho=(e,r)=>{if(e!=62e3)return H.setErrorCode(12296),0;if(H.setErrorCode(12288),H.stringCache[r])return H.stringCache[r];var t;switch(r){case 12371:t=Ve("Emscripten");break;case 12372:t=Ve("1.4 Emscripten EGL");break;case 12373:t=Ve("");break;case 12429:t=Ve("OpenGL_ES");break;default:return H.setErrorCode(12300),0}return H.stringCache[r]=t,t},Vo=(e,r)=>{if(!H.defaultDisplayInitialized)H.setErrorCode(12289);else if(!s.ctx)H.setErrorCode(12290);else if(s.ctx.isContextLost())H.setErrorCode(12302);else return H.setErrorCode(12288),1;return 0},Wo=(e,r)=>e!=62e3?(H.setErrorCode(12296),0):(r==0?_r(0,0):_r(1,r),H.setErrorCode(12288),1),Xo=e=>e!=62e3?(H.setErrorCode(12296),0):(H.currentContext=0,H.currentReadSurface=0,H.currentDrawSurface=0,H.defaultDisplayInitialized=!1,H.setErrorCode(12288),1),Ko=()=>(H.setErrorCode(12288),1),Yo=Ko,Qo=e=>(H.setErrorCode(12288),1),mt=[],gn=(e,r)=>{mt.length=0;for(var t;t=U[e++];){var n=t!=105;n&=t!=112,r+=n&&r%8?4:0,mt.push(t==112?ee[r>>2]:t==105?f[r>>2]:le[r>>3]),r+=n?8:4}return mt},Jo=(e,r,t)=>{var n=gn(r,t);return tn[e].apply(null,n)},Zo=(e,r,t)=>Jo(e,r,t),es=(e,r,t,n)=>{var a=gn(r,t);return tn[e].apply(null,a)},rs=(e,r,t)=>es(e,r,t),ts=()=>Date.now(),xn=e=>{var r=$e(),t=e();return Ne(r),t},I={removeAllEventListeners(){for(;I.eventHandlers.length;)I._removeHandler(I.eventHandlers.length-1);I.deferredCalls=[]},inEventHandler:0,deferredCalls:[],deferCall(e,r,t){function n(d,u){if(d.length!=u.length)return!1;for(var h in d)if(d[h]!=u[h])return!1;return!0}for(var a in I.deferredCalls){var i=I.deferredCalls[a];if(i.targetFunction==e&&n(i.argsList,t))return}I.deferredCalls.push({targetFunction:e,precedence:r,argsList:t}),I.deferredCalls.sort((d,u)=>d.precedence<u.precedence)},removeDeferredCalls(e){for(var r=0;r<I.deferredCalls.length;++r)I.deferredCalls[r].targetFunction==e&&(I.deferredCalls.splice(r,1),--r)},canPerformEventHandlerRequests(){return navigator.userActivation?navigator.userActivation.isActive:I.inEventHandler&&I.currentEventHandler.allowsDeferredCalls},runDeferredCalls(){if(I.canPerformEventHandlerRequests())for(var e=0;e<I.deferredCalls.length;++e){var r=I.deferredCalls[e];I.deferredCalls.splice(e,1),--e,r.targetFunction.apply(null,r.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(e,r)=>{for(var t=0;t<I.eventHandlers.length;++t)I.eventHandlers[t].target==e&&(!r||r==I.eventHandlers[t].eventTypeString)&&I._removeHandler(t--)},_removeHandler(e){var r=I.eventHandlers[e];r.target.removeEventListener(r.eventTypeString,r.eventListenerFunc,r.useCapture),I.eventHandlers.splice(e,1)},registerOrRemoveHandler(e){if(!e.target)return-4;if(e.callbackfunc)e.eventListenerFunc=function(t){++I.inEventHandler,I.currentEventHandler=e,I.runDeferredCalls(),e.handlerFunc(t),I.runDeferredCalls(),--I.inEventHandler},e.target.addEventListener(e.eventTypeString,e.eventListenerFunc,e.useCapture),I.eventHandlers.push(e);else for(var r=0;r<I.eventHandlers.length;++r)I.eventHandlers[r].target==e.target&&I.eventHandlers[r].eventTypeString==e.eventTypeString&&I._removeHandler(r--);return 0},getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":(e==null?void 0:e.nodeName)||"":""},fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},Nr={},ns=e=>e>2?Le(e):e,Ur=[0,document,window],Te=e=>{e=ns(e);var r=Ur[e]||document.querySelector(e);return r},bn=Te,as=(e,r,t)=>{var n=bn(e);if(!n)return-4;f[r>>2]=n.width,f[t>>2]=n.height},pt=e=>{var r=xr(e)+1,t=Vr(r);return he(e,t,r),t},_n=e=>xn(()=>{var r=Vr(8),t=r+4,n=pt(e.id);as(n,r,t);var a=[f[r>>2],f[t>>2]];return a}),yn=(e,r,t)=>{var n=bn(e);return n?(n.width=r,n.height=t,0):-4},wn=(e,r,t)=>{e.controlTransferredOffscreen?xn(()=>{var n=pt(e.id);yn(n,r,t)}):(e.width=r,e.height=t)},os=e=>{var r=_n(e),t=r[0],n=r[1],a=e.style.width,i=e.style.height,d=e.style.backgroundColor,u=document.body.style.backgroundColor,h=e.style.paddingLeft,b=e.style.paddingRight,S=e.style.paddingTop,L=e.style.paddingBottom,z=e.style.marginLeft,P=e.style.marginRight,B=e.style.marginTop,J=e.style.marginBottom,xe=document.body.style.margin,me=document.documentElement.style.overflow,Se=document.body.scroll,be=e.style.imageRendering;function _e(){var je=document.fullscreenElement||document.webkitFullscreenElement;je||(document.removeEventListener("fullscreenchange",_e),document.removeEventListener("webkitfullscreenchange",_e),wn(e,t,n),e.style.width=a,e.style.height=i,e.style.backgroundColor=d,u||(document.body.style.backgroundColor="white"),document.body.style.backgroundColor=u,e.style.paddingLeft=h,e.style.paddingRight=b,e.style.paddingTop=S,e.style.paddingBottom=L,e.style.marginLeft=z,e.style.marginRight=P,e.style.marginTop=B,e.style.marginBottom=J,document.body.style.margin=xe,document.documentElement.style.overflow=me,document.body.scroll=Se,e.style.imageRendering=be,e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,t,n),Nr.canvasResizedCallback&&ie(Nr.canvasResizedCallback)(37,0,Nr.canvasResizedCallbackUserData))}return document.addEventListener("fullscreenchange",_e),document.addEventListener("webkitfullscreenchange",_e),_e},ht=(e,r,t)=>{e.style.paddingLeft=e.style.paddingRight=t+"px",e.style.paddingTop=e.style.paddingBottom=r+"px"},Or=e=>Ur.indexOf(e)<0?e.getBoundingClientRect():{left:0,top:0},ss=(e,r)=>{var t=os(e),n=r.softFullscreen?innerWidth:screen.width,a=r.softFullscreen?innerHeight:screen.height,i=Or(e),d=i.width,u=i.height,h=_n(e),b=h[0],S=h[1];if(r.scaleMode==3)ht(e,(a-u)/2,(n-d)/2),n=d,a=u;else if(r.scaleMode==2)if(n*S<b*a){var L=S*n/b;ht(e,(a-L)/2,0),a=L}else{var z=b*a/S;ht(e,0,(n-z)/2),n=z}e.style.backgroundColor||(e.style.backgroundColor="black"),document.body.style.backgroundColor||(document.body.style.backgroundColor="black"),e.style.width=n+"px",e.style.height=a+"px",r.filteringMode==1&&(e.style.imageRendering="optimizeSpeed",e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated");var P=r.canvasResolutionScaleMode==2?devicePixelRatio:1;if(r.canvasResolutionScaleMode!=0){var B=n*P|0,J=a*P|0;wn(e,B,J),e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,B,J)}return t},vt=(e,r)=>{if((r.scaleMode!=0||r.canvasResolutionScaleMode!=0)&&ss(e,r),e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else return I.fullscreenEnabled()?-3:-1;return Nr=r,r.canvasResizedCallback&&ie(r.canvasResizedCallback)(37,0,r.canvasResizedCallbackUserData),0},is=()=>{if(!I.fullscreenEnabled())return-1;I.removeDeferredCalls(vt);var e=Ur[1];if(e.exitFullscreen)e.fullscreenElement&&e.exitFullscreen();else if(e.webkitExitFullscreen)e.webkitFullscreenElement&&e.webkitExitFullscreen();else return-1;return 0},gt=e=>{if(e.requestPointerLock)e.requestPointerLock();else return document.body.requestPointerLock?-3:-1;return 0},ls=()=>{if(I.removeDeferredCalls(gt),document.exitPointerLock)document.exitPointerLock();else return-1;return 0},cs=()=>devicePixelRatio,ds=(e,r,t)=>{if(e=Te(e),!e)return-4;var n=Or(e);return le[r>>3]=n.width,le[t>>3]=n.height,0},Sn=(e,r)=>{le[e>>3]=r.timestamp;for(var t=0;t<r.axes.length;++t)le[e+t*8+16>>3]=r.axes[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?le[e+t*8+528>>3]=r.buttons[t].value:le[e+t*8+528>>3]=r.buttons[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?f[e+t*4+1040>>2]=r.buttons[t].pressed:f[e+t*4+1040>>2]=r.buttons[t]==1;f[e+1296>>2]=r.connected,f[e+1300>>2]=r.index,f[e+8>>2]=r.axes.length,f[e+12>>2]=r.buttons.length,he(r.id,e+1304,64),he(r.mapping,e+1368,64)},us=(e,r)=>e<0||e>=I.lastGamepadState.length?-5:I.lastGamepadState[e]?(Sn(r,I.lastGamepadState[e]),0):-7,fs=(e,r)=>{e&&(f[e>>2]=E.mainLoop.timingMode),r&&(f[r>>2]=E.mainLoop.timingValue)},ms=()=>I.lastGamepadState.length,ps=(e,r)=>{f[e>>2]=screen.width,f[r>>2]=screen.height};function hs(e){y.activeTexture(e)}var vs=hs,gs=(e,r)=>{y.attachShader(k.programs[e],k.shaders[r])},xs=gs,bs=(e,r)=>{y.disjointTimerQueryExt.beginQueryEXT(e,k.queries[r])},_s=bs,ys=(e,r,t)=>{y.bindAttribLocation(k.programs[e],r,Le(t))},ws=ys,Ss=(e,r)=>{y.bindBuffer(e,k.buffers[r])},Cs=Ss,Es=(e,r)=>{y.bindFramebuffer(e,k.framebuffers[r])},ks=Es,js=(e,r)=>{y.bindRenderbuffer(e,k.renderbuffers[r])},Fs=js,Ls=(e,r)=>{y.bindTexture(e,k.textures[r])},Rs=Ls,Ts=e=>{y.bindVertexArray(k.vaos[e])},Ps=Ts,Ms=Ps;function As(e,r,t,n){y.blendColor(e,r,t,n)}var Ds=As;function Is(e){y.blendEquation(e)}var Bs=Is;function $s(e,r){y.blendEquationSeparate(e,r)}var Ns=$s;function Us(e,r){y.blendFunc(e,r)}var Os=Us;function zs(e,r,t,n){y.blendFuncSeparate(e,r,t,n)}var Gs=zs,qs=(e,r,t,n)=>{y.bufferData(e,t?U.subarray(t,t+r):r,n)},Hs=qs,Vs=(e,r,t,n)=>{y.bufferSubData(e,r,U.subarray(n,n+t))},Ws=Vs;function Xs(e){return y.checkFramebufferStatus(e)}var Ks=Xs;function Ys(e){y.clear(e)}var Qs=Ys;function Js(e,r,t,n){y.clearColor(e,r,t,n)}var Zs=Js;function ei(e){y.clearDepth(e)}var ri=ei;function ti(e){y.clearStencil(e)}var ni=ti,ai=(e,r,t,n)=>{y.colorMask(!!e,!!r,!!t,!!n)},oi=ai,si=e=>{y.compileShader(k.shaders[e])},ii=si,li=(e,r,t,n,a,i,d,u)=>{y.compressedTexImage2D(e,r,t,n,a,i,u?U.subarray(u,u+d):null)},ci=li,di=(e,r,t,n,a,i,d,u,h)=>{y.compressedTexSubImage2D(e,r,t,n,a,i,d,h?U.subarray(h,h+u):null)},ui=di;function fi(e,r,t,n,a,i,d,u){y.copyTexImage2D(e,r,t,n,a,i,d,u)}var mi=fi;function pi(e,r,t,n,a,i,d,u){y.copyTexSubImage2D(e,r,t,n,a,i,d,u)}var hi=pi,vi=()=>{var e=k.getNewId(k.programs),r=y.createProgram();return r.name=e,r.maxUniformLength=r.maxAttributeLength=r.maxUniformBlockNameLength=0,r.uniformIdCounter=1,k.programs[e]=r,e},gi=vi,xi=e=>{var r=k.getNewId(k.shaders);return k.shaders[r]=y.createShader(e),r},bi=xi;function _i(e){y.cullFace(e)}var yi=_i,wi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=k.buffers[n];a&&(y.deleteBuffer(a),a.name=0,k.buffers[n]=null)}},Si=wi,Ci=(e,r)=>{for(var t=0;t<e;++t){var n=f[r+t*4>>2],a=k.framebuffers[n];a&&(y.deleteFramebuffer(a),a.name=0,k.framebuffers[n]=null)}},Ei=Ci,ki=e=>{if(e){var r=k.programs[e];if(!r){k.recordError(1281);return}y.deleteProgram(r),r.name=0,k.programs[e]=null}},ji=ki,Fi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=k.queries[n];a&&(y.disjointTimerQueryExt.deleteQueryEXT(a),k.queries[n]=null)}},Li=Fi,Ri=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=k.renderbuffers[n];a&&(y.deleteRenderbuffer(a),a.name=0,k.renderbuffers[n]=null)}},Ti=Ri,Pi=e=>{if(e){var r=k.shaders[e];if(!r){k.recordError(1281);return}y.deleteShader(r),k.shaders[e]=null}},Mi=Pi,Ai=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=k.textures[n];a&&(y.deleteTexture(a),a.name=0,k.textures[n]=null)}},Di=Ai,Ii=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2];y.deleteVertexArray(k.vaos[n]),k.vaos[n]=null}},Bi=Ii,$i=Bi;function Ni(e){y.depthFunc(e)}var Ui=Ni,Oi=e=>{y.depthMask(!!e)},zi=Oi;function Gi(e,r){y.depthRange(e,r)}var qi=Gi,Hi=(e,r)=>{y.detachShader(k.programs[e],k.shaders[r])},Vi=Hi;function Wi(e){y.disable(e)}var Xi=Wi,Ki=e=>{y.disableVertexAttribArray(e)},Yi=Ki,Qi=(e,r,t)=>{y.drawArrays(e,r,t)},Ji=Qi,Zi=(e,r,t,n)=>{y.drawArraysInstanced(e,r,t,n)},el=Zi,rl=el,Cn=[],tl=(e,r)=>{for(var t=Cn[e],n=0;n<e;n++)t[n]=f[r+n*4>>2];y.drawBuffers(t)},nl=tl,al=nl,ol=(e,r,t,n)=>{y.drawElements(e,r,t,n)},sl=ol,il=(e,r,t,n,a)=>{y.drawElementsInstanced(e,r,t,n,a)},ll=il,cl=ll;function dl(e){y.enable(e)}var ul=dl,fl=e=>{y.enableVertexAttribArray(e)},ml=fl,pl=e=>{y.disjointTimerQueryExt.endQueryEXT(e)},hl=pl;function vl(){y.finish()}var gl=vl;function xl(){y.flush()}var bl=xl,_l=(e,r,t,n)=>{y.framebufferRenderbuffer(e,r,t,k.renderbuffers[n])},yl=_l,wl=(e,r,t,n,a)=>{y.framebufferTexture2D(e,r,t,k.textures[n],a)},Sl=wl;function Cl(e){y.frontFace(e)}var El=Cl,Lr=(e,r,t,n)=>{for(var a=0;a<e;a++){var i=y[t](),d=i&&k.getNewId(n);i?(i.name=d,n[d]=i):k.recordError(1282),f[r+a*4>>2]=d}},kl=(e,r)=>{Lr(e,r,"createBuffer",k.buffers)},jl=kl,Fl=(e,r)=>{Lr(e,r,"createFramebuffer",k.framebuffers)},Ll=Fl,Rl=(e,r)=>{for(var t=0;t<e;t++){var n=y.disjointTimerQueryExt.createQueryEXT();if(!n){for(k.recordError(1282);t<e;)f[r+t++*4>>2]=0;return}var a=k.getNewId(k.queries);n.name=a,k.queries[a]=n,f[r+t*4>>2]=a}},Tl=Rl,Pl=(e,r)=>{Lr(e,r,"createRenderbuffer",k.renderbuffers)},Ml=Pl,Al=(e,r)=>{Lr(e,r,"createTexture",k.textures)},Dl=Al;function Il(e,r){Lr(e,r,"createVertexArray",k.vaos)}var Bl=Il,$l=Bl;function Nl(e){y.generateMipmap(e)}var Ul=Nl,En=(e,r,t,n,a,i,d,u)=>{r=k.programs[r];var h=y[e](r,t);if(h){var b=u&&he(h.name,u,n);a&&(f[a>>2]=b),i&&(f[i>>2]=h.size),d&&(f[d>>2]=h.type)}},Ol=(e,r,t,n,a,i,d)=>{En("getActiveAttrib",e,r,t,n,a,i,d)},zl=Ol,Gl=(e,r,t,n,a,i,d)=>{En("getActiveUniform",e,r,t,n,a,i,d)},ql=Gl,Hl=(e,r,t,n)=>{var a=y.getAttachedShaders(k.programs[e]),i=a.length;i>r&&(i=r),f[t>>2]=i;for(var d=0;d<i;++d){var u=k.shaders.indexOf(a[d]);f[n+d*4>>2]=u}},Vl=Hl,Wl=(e,r)=>y.getAttribLocation(k.programs[e],Le(r)),Xl=Wl,kn=(e,r)=>{ee[e>>2]=r;var t=ee[e>>2];ee[e+4>>2]=(r-t)/4294967296},xt=(e,r,t)=>{if(!r){k.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:t!=0&&t!=1&&k.recordError(1280);return;case 36345:n=0;break;case 34466:var a=y.getParameter(34467);n=a?a.length:0;break}if(n===void 0){var i=y.getParameter(e);switch(typeof i){case"number":n=i;break;case"boolean":n=i?1:0;break;case"string":k.recordError(1280);return;case"object":if(i===null)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:{n=0;break}default:{k.recordError(1280);return}}else if(i instanceof Float32Array||i instanceof Uint32Array||i instanceof Int32Array||i instanceof Array){for(var d=0;d<i.length;++d)switch(t){case 0:f[r+d*4>>2]=i[d];break;case 2:Y[r+d*4>>2]=i[d];break;case 4:M[r+d>>0]=i[d]?1:0;break}return}else try{n=i.name|0}catch(u){k.recordError(1280),O(`GL_INVALID_ENUM in glGet${t}v: Unknown object returned from WebGL getParameter(${e})! (error: ${u})`);return}break;default:k.recordError(1280),O(`GL_INVALID_ENUM in glGet${t}v: Native code calling glGet${t}v(${e}) and it returns ${i} of type ${typeof i}!`);return}}switch(t){case 1:kn(r,n);break;case 0:f[r>>2]=n;break;case 2:Y[r>>2]=n;break;case 4:M[r>>0]=n?1:0;break}},Kl=(e,r)=>xt(e,r,4),Yl=Kl,Ql=(e,r,t)=>{if(!t){k.recordError(1281);return}f[t>>2]=y.getBufferParameter(e,r)},Jl=Ql,Zl=()=>{var e=y.getError()||k.lastError;return k.lastError=0,e},ec=Zl,rc=(e,r)=>xt(e,r,2),tc=rc,nc=(e,r,t,n)=>{var a=y.getFramebufferAttachmentParameter(e,r,t);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=a.name|0),f[n>>2]=a},ac=nc,oc=(e,r)=>xt(e,r,0),sc=oc,ic=(e,r,t,n)=>{var a=y.getProgramInfoLog(k.programs[e]);a===null&&(a="(unknown error)");var i=r>0&&n?he(a,n,r):0;t&&(f[t>>2]=i)},lc=ic,cc=(e,r,t)=>{if(!t){k.recordError(1281);return}if(e>=k.counter){k.recordError(1281);return}if(e=k.programs[e],r==35716){var n=y.getProgramInfoLog(e);n===null&&(n="(unknown error)"),f[t>>2]=n.length+1}else if(r==35719){if(!e.maxUniformLength)for(var a=0;a<y.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,y.getActiveUniform(e,a).name.length+1);f[t>>2]=e.maxUniformLength}else if(r==35722){if(!e.maxAttributeLength)for(var a=0;a<y.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,y.getActiveAttrib(e,a).name.length+1);f[t>>2]=e.maxAttributeLength}else if(r==35381){if(!e.maxUniformBlockNameLength)for(var a=0;a<y.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,y.getActiveUniformBlockName(e,a).length+1);f[t>>2]=e.maxUniformBlockNameLength}else f[t>>2]=y.getProgramParameter(e,r)},dc=cc,jn=(e,r,t)=>{if(!t){k.recordError(1281);return}var n=k.queries[e],a;a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r);var i;typeof a=="boolean"?i=a?1:0:i=a,kn(t,i)},uc=jn,Fn=(e,r,t)=>{if(!t){k.recordError(1281);return}var n=k.queries[e],a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r),i;typeof a=="boolean"?i=a?1:0:i=a,f[t>>2]=i},fc=Fn,mc=jn,pc=mc,hc=Fn,vc=hc,gc=(e,r,t)=>{if(!t){k.recordError(1281);return}f[t>>2]=y.disjointTimerQueryExt.getQueryEXT(e,r)},xc=gc,bc=(e,r,t)=>{if(!t){k.recordError(1281);return}f[t>>2]=y.getRenderbufferParameter(e,r)},_c=bc,yc=(e,r,t,n)=>{var a=y.getShaderInfoLog(k.shaders[e]);a===null&&(a="(unknown error)");var i=r>0&&n?he(a,n,r):0;t&&(f[t>>2]=i)},wc=yc,Sc=(e,r,t,n)=>{var a=y.getShaderPrecisionFormat(e,r);f[t>>2]=a.rangeMin,f[t+4>>2]=a.rangeMax,f[n>>2]=a.precision},Cc=Sc,Ec=(e,r,t,n)=>{var a=y.getShaderSource(k.shaders[e]);if(a){var i=r>0&&n?he(a,n,r):0;t&&(f[t>>2]=i)}},kc=Ec,jc=(e,r,t)=>{if(!t){k.recordError(1281);return}if(r==35716){var n=y.getShaderInfoLog(k.shaders[e]);n===null&&(n="(unknown error)");var a=n?n.length+1:0;f[t>>2]=a}else if(r==35720){var i=y.getShaderSource(k.shaders[e]),d=i?i.length+1:0;f[t>>2]=d}else f[t>>2]=y.getShaderParameter(k.shaders[e],r)},Fc=jc,Lc=function(){var r=vn(y);return r=r.concat(r.map(t=>"GL_"+t)),r},Rc=e=>{var r=k.stringCache[e];if(!r){switch(e){case 7939:r=Ve(Lc().join(" "));break;case 7936:case 7937:case 37445:case 37446:var t=y.getParameter(e);t||k.recordError(1280),r=t?Ve(t):0;break;case 7938:var n=y.getParameter(7938);n=`OpenGL ES 2.0 (${n})`,r=Ve(n);break;case 35724:var a=y.getParameter(35724),i=/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/,d=a.match(i);d!==null&&(d[1].length==3&&(d[1]=d[1]+"0"),a=`OpenGL ES GLSL ES ${d[1]} (${a})`),r=Ve(a);break;default:k.recordError(1280)}k.stringCache[e]=r}return r},Tc=Rc,Pc=(e,r,t)=>{if(!t){k.recordError(1281);return}Y[t>>2]=y.getTexParameter(e,r)},Mc=Pc,Ac=(e,r,t)=>{if(!t){k.recordError(1281);return}f[t>>2]=y.getTexParameter(e,r)},Dc=Ac,Ic=e=>parseInt(e),Ln=e=>e.slice(-1)=="]"&&e.lastIndexOf("["),Rn=e=>{var r=e.uniformLocsById,t=e.uniformSizeAndIdsByName,n,a;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},n=0;n<y.getProgramParameter(e,35718);++n){var i=y.getActiveUniform(e,n),d=i.name,u=i.size,h=Ln(d),b=h>0?d.slice(0,h):d,S=e.uniformIdCounter;for(e.uniformIdCounter+=u,t[b]=[u,S],a=0;a<u;++a)r[S]=a,e.uniformArrayNamesById[S++]=b}},Bc=(e,r)=>{if(r=Le(r),e=k.programs[e]){Rn(e);var t=e.uniformLocsById,n=0,a=r,i=Ln(r);i>0&&(n=Ic(r.slice(i+1))>>>0,a=r.slice(0,i));var d=e.uniformSizeAndIdsByName[a];if(d&&n<d[0]&&(n+=d[1],t[n]=t[n]||y.getUniformLocation(e,r)))return n}else k.recordError(1281);return-1},$c=Bc,we=e=>{var r=y.currentProgram;if(r){var t=r.uniformLocsById[e];return typeof t=="number"&&(r.uniformLocsById[e]=t=y.getUniformLocation(r,r.uniformArrayNamesById[e]+(t>0?`[${t}]`:""))),t}else k.recordError(1282)},Tn=(e,r,t,n)=>{if(!t){k.recordError(1281);return}e=k.programs[e],Rn(e);var a=y.getUniform(e,we(r));if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:Y[t>>2]=a;break}else for(var i=0;i<a.length;i++)switch(n){case 0:f[t+i*4>>2]=a[i];break;case 2:Y[t+i*4>>2]=a[i];break}},Nc=(e,r,t)=>{Tn(e,r,t,2)},Uc=Nc,Oc=(e,r,t)=>{Tn(e,r,t,0)},zc=Oc,Gc=(e,r,t)=>{if(!t){k.recordError(1281);return}f[t>>2]=y.getVertexAttribOffset(e,r)},qc=Gc,Pn=(e,r,t,n)=>{if(!t){k.recordError(1281);return}var a=y.getVertexAttrib(e,r);if(r==34975)f[t>>2]=a&&a.name;else if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:Y[t>>2]=a;break;case 5:f[t>>2]=Math.fround(a);break}else for(var i=0;i<a.length;i++)switch(n){case 0:f[t+i*4>>2]=a[i];break;case 2:Y[t+i*4>>2]=a[i];break;case 5:f[t+i*4>>2]=Math.fround(a[i]);break}},Hc=(e,r,t)=>{Pn(e,r,t,2)},Vc=Hc,Wc=(e,r,t)=>{Pn(e,r,t,5)},Xc=Wc;function Kc(e,r){y.hint(e,r)}var Yc=Kc,Qc=e=>{var r=k.buffers[e];return r?y.isBuffer(r):0},Jc=Qc;function Zc(e){return y.isEnabled(e)}var ed=Zc,rd=e=>{var r=k.framebuffers[e];return r?y.isFramebuffer(r):0},td=rd,nd=e=>(e=k.programs[e],e?y.isProgram(e):0),ad=nd,od=e=>{var r=k.queries[e];return r?y.disjointTimerQueryExt.isQueryEXT(r):0},sd=od,id=e=>{var r=k.renderbuffers[e];return r?y.isRenderbuffer(r):0},ld=id,cd=e=>{var r=k.shaders[e];return r?y.isShader(r):0},dd=cd,ud=e=>{var r=k.textures[e];return r?y.isTexture(r):0},fd=ud,md=e=>{var r=k.vaos[e];return r?y.isVertexArray(r):0},pd=md,hd=pd;function vd(e){y.lineWidth(e)}var gd=vd,xd=e=>{e=k.programs[e],y.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},bd=xd,_d=(e,r)=>{e==3317&&(k.unpackAlignment=r),y.pixelStorei(e,r)},yd=_d;function wd(e,r){y.polygonOffset(e,r)}var Sd=wd,Cd=(e,r)=>{y.disjointTimerQueryExt.queryCounterEXT(k.queries[e],r)},Ed=Cd,kd=(e,r,t,n)=>{function a(u,h){return u+h-1&-h}var i=e*t,d=a(i,n);return r*d},jd=e=>{var r={5:3,6:4,8:2,29502:3,29504:4};return r[e-6402]||1},Fd=e=>(e-=5120,e==1?U:e==4?f:e==6?Y:e==5||e==28922?ee:Q),Ld=e=>31-Math.clz32(e.BYTES_PER_ELEMENT),bt=(e,r,t,n,a,i)=>{var d=Fd(e),u=Ld(d),h=1<<u,b=jd(r)*h,S=kd(t,n,b,k.unpackAlignment);return d.subarray(a>>u,a+S>>u)},Rd=(e,r,t,n,a,i,d)=>{var u=bt(i,a,t,n,d);if(!u){k.recordError(1280);return}y.readPixels(e,r,t,n,a,i,u)},Td=Rd,Pd=()=>{},Md=Pd;function Ad(e,r,t,n){y.renderbufferStorage(e,r,t,n)}var Dd=Ad,Id=(e,r)=>{y.sampleCoverage(e,!!r)},Bd=Id;function $d(e,r,t,n){y.scissor(e,r,t,n)}var Nd=$d,Ud=(e,r,t,n,a)=>{k.recordError(1280)},Od=Ud,zd=(e,r,t,n)=>{var a=k.getSource(e,r,t,n);y.shaderSource(k.shaders[e],a)},Gd=zd;function qd(e,r,t){y.stencilFunc(e,r,t)}var Hd=qd;function Vd(e,r,t,n){y.stencilFuncSeparate(e,r,t,n)}var Wd=Vd;function Xd(e){y.stencilMask(e)}var Kd=Xd;function Yd(e,r){y.stencilMaskSeparate(e,r)}var Qd=Yd;function Jd(e,r,t){y.stencilOp(e,r,t)}var Zd=Jd;function eu(e,r,t,n){y.stencilOpSeparate(e,r,t,n)}var ru=eu,tu=(e,r,t,n,a,i,d,u,h)=>{y.texImage2D(e,r,t,n,a,i,d,u,h?bt(u,d,n,a,h):null)},nu=tu;function au(e,r,t){y.texParameterf(e,r,t)}var ou=au,su=(e,r,t)=>{var n=Y[t>>2];y.texParameterf(e,r,n)},iu=su;function lu(e,r,t){y.texParameteri(e,r,t)}var cu=lu,du=(e,r,t)=>{var n=f[t>>2];y.texParameteri(e,r,n)},uu=du,fu=(e,r,t,n,a,i,d,u,h)=>{var b=null;h&&(b=bt(u,d,a,i,h)),y.texSubImage2D(e,r,t,n,a,i,d,u,b)},mu=fu,pu=(e,r)=>{y.uniform1f(we(e),r)},hu=pu,nr=[],vu=(e,r,t)=>{if(r<=288)for(var n=nr[r-1],a=0;a<r;++a)n[a]=Y[t+4*a>>2];else var n=Y.subarray(t>>2,t+r*4>>2);y.uniform1fv(we(e),n)},gu=vu,xu=(e,r)=>{y.uniform1i(we(e),r)},bu=xu,Rr=[],_u=(e,r,t)=>{if(r<=288)for(var n=Rr[r-1],a=0;a<r;++a)n[a]=f[t+4*a>>2];else var n=f.subarray(t>>2,t+r*4>>2);y.uniform1iv(we(e),n)},yu=_u,wu=(e,r,t)=>{y.uniform2f(we(e),r,t)},Su=wu,Cu=(e,r,t)=>{if(r<=144)for(var n=nr[2*r-1],a=0;a<2*r;a+=2)n[a]=Y[t+4*a>>2],n[a+1]=Y[t+(4*a+4)>>2];else var n=Y.subarray(t>>2,t+r*8>>2);y.uniform2fv(we(e),n)},Eu=Cu,ku=(e,r,t)=>{y.uniform2i(we(e),r,t)},ju=ku,Fu=(e,r,t)=>{if(r<=144)for(var n=Rr[2*r-1],a=0;a<2*r;a+=2)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2];else var n=f.subarray(t>>2,t+r*8>>2);y.uniform2iv(we(e),n)},Lu=Fu,Ru=(e,r,t,n)=>{y.uniform3f(we(e),r,t,n)},Tu=Ru,Pu=(e,r,t)=>{if(r<=96)for(var n=nr[3*r-1],a=0;a<3*r;a+=3)n[a]=Y[t+4*a>>2],n[a+1]=Y[t+(4*a+4)>>2],n[a+2]=Y[t+(4*a+8)>>2];else var n=Y.subarray(t>>2,t+r*12>>2);y.uniform3fv(we(e),n)},Mu=Pu,Au=(e,r,t,n)=>{y.uniform3i(we(e),r,t,n)},Du=Au,Iu=(e,r,t)=>{if(r<=96)for(var n=Rr[3*r-1],a=0;a<3*r;a+=3)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2];else var n=f.subarray(t>>2,t+r*12>>2);y.uniform3iv(we(e),n)},Bu=Iu,$u=(e,r,t,n,a)=>{y.uniform4f(we(e),r,t,n,a)},Nu=$u,Uu=(e,r,t)=>{if(r<=72){var n=nr[4*r-1],a=Y;t>>=2;for(var i=0;i<4*r;i+=4){var d=t+i;n[i]=a[d],n[i+1]=a[d+1],n[i+2]=a[d+2],n[i+3]=a[d+3]}}else var n=Y.subarray(t>>2,t+r*16>>2);y.uniform4fv(we(e),n)},Ou=Uu,zu=(e,r,t,n,a)=>{y.uniform4i(we(e),r,t,n,a)},Gu=zu,qu=(e,r,t)=>{if(r<=72)for(var n=Rr[4*r-1],a=0;a<4*r;a+=4)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2],n[a+3]=f[t+(4*a+12)>>2];else var n=f.subarray(t>>2,t+r*16>>2);y.uniform4iv(we(e),n)},Hu=qu,Vu=(e,r,t,n)=>{if(r<=72)for(var a=nr[4*r-1],i=0;i<4*r;i+=4)a[i]=Y[n+4*i>>2],a[i+1]=Y[n+(4*i+4)>>2],a[i+2]=Y[n+(4*i+8)>>2],a[i+3]=Y[n+(4*i+12)>>2];else var a=Y.subarray(n>>2,n+r*16>>2);y.uniformMatrix2fv(we(e),!!t,a)},Wu=Vu,Xu=(e,r,t,n)=>{if(r<=32)for(var a=nr[9*r-1],i=0;i<9*r;i+=9)a[i]=Y[n+4*i>>2],a[i+1]=Y[n+(4*i+4)>>2],a[i+2]=Y[n+(4*i+8)>>2],a[i+3]=Y[n+(4*i+12)>>2],a[i+4]=Y[n+(4*i+16)>>2],a[i+5]=Y[n+(4*i+20)>>2],a[i+6]=Y[n+(4*i+24)>>2],a[i+7]=Y[n+(4*i+28)>>2],a[i+8]=Y[n+(4*i+32)>>2];else var a=Y.subarray(n>>2,n+r*36>>2);y.uniformMatrix3fv(we(e),!!t,a)},Ku=Xu,Yu=(e,r,t,n)=>{if(r<=18){var a=nr[16*r-1],i=Y;n>>=2;for(var d=0;d<16*r;d+=16){var u=n+d;a[d]=i[u],a[d+1]=i[u+1],a[d+2]=i[u+2],a[d+3]=i[u+3],a[d+4]=i[u+4],a[d+5]=i[u+5],a[d+6]=i[u+6],a[d+7]=i[u+7],a[d+8]=i[u+8],a[d+9]=i[u+9],a[d+10]=i[u+10],a[d+11]=i[u+11],a[d+12]=i[u+12],a[d+13]=i[u+13],a[d+14]=i[u+14],a[d+15]=i[u+15]}}else var a=Y.subarray(n>>2,n+r*64>>2);y.uniformMatrix4fv(we(e),!!t,a)},Qu=Yu,Ju=e=>{e=k.programs[e],y.useProgram(e),y.currentProgram=e},Zu=Ju,ef=e=>{y.validateProgram(k.programs[e])},rf=ef;function tf(e,r){y.vertexAttrib1f(e,r)}var nf=tf,af=(e,r)=>{y.vertexAttrib1f(e,Y[r>>2])},of=af;function sf(e,r,t){y.vertexAttrib2f(e,r,t)}var lf=sf,cf=(e,r)=>{y.vertexAttrib2f(e,Y[r>>2],Y[r+4>>2])},df=cf;function uf(e,r,t,n){y.vertexAttrib3f(e,r,t,n)}var ff=uf,mf=(e,r)=>{y.vertexAttrib3f(e,Y[r>>2],Y[r+4>>2],Y[r+8>>2])},pf=mf;function hf(e,r,t,n,a){y.vertexAttrib4f(e,r,t,n,a)}var vf=hf,gf=(e,r)=>{y.vertexAttrib4f(e,Y[r>>2],Y[r+4>>2],Y[r+8>>2],Y[r+12>>2])},xf=gf,bf=(e,r)=>{y.vertexAttribDivisor(e,r)},_f=bf,yf=_f,wf=(e,r,t,n,a,i)=>{y.vertexAttribPointer(e,r,t,!!n,a,i)},Sf=wf;function Cf(e,r,t,n){y.viewport(e,r,t,n)}var Ef=Cf,kf=()=>0,jf=(e,r,t)=>U.copyWithin(e,r,r+t),Ff=()=>{E.mainLoop.pause()},Lf=(e,r)=>{if(!I.fullscreenEnabled())return-1;if(e=Te(e),!e)return-4;if(!e.requestFullscreen&&!e.webkitRequestFullscreen)return-3;var t=I.canPerformEventHandlerRequests();return t?vt(e,r):r.deferUntilInEventHandler?(I.deferCall(vt,1,[e,r]),1):-2},Rf=(e,r,t)=>{var n={scaleMode:f[t>>2],canvasResolutionScaleMode:f[t+4>>2],filteringMode:f[t+8>>2],deferUntilInEventHandler:r,canvasResizedCallback:f[t+12>>2],canvasResizedCallbackUserData:f[t+16>>2]};return Lf(e,n)},Tf=(e,r)=>{if(e=Te(e),!e)return-4;if(!e.requestPointerLock)return-1;var t=I.canPerformEventHandlerRequests();return t?gt(e):r?(I.deferCall(gt,2,[e]),1):-2},Pf=()=>2147483648,Mf=e=>{var r=K.buffer,t=(e-r.byteLength+65535)/65536;try{return K.grow(t),Fe(),1}catch{}},Af=e=>{var r=U.length;e>>>=0;var t=Pf();if(e>t)return!1;for(var n=(h,b)=>h+(b-h%b)%b,a=1;a<=4;a*=2){var i=r*(1+.2/a);i=Math.min(i,e+100663296);var d=Math.min(t,n(Math.max(e,i),65536)),u=Mf(d);if(u)return!0}return!1},Df=()=>{E.mainLoop.resume()},_t=()=>{try{if(navigator.getGamepads)return(I.lastGamepadState=navigator.getGamepads())?0:-1}catch{navigator.getGamepads=null}return-1},If=(e,r,t,n,a,i)=>{var d=(h=event)=>{var b=ie(n)(a,0,r);if(b&&(b=Le(b)),b)return h.preventDefault(),h.returnValue=b,b},u={target:Te(e),eventTypeString:i,callbackfunc:n,handlerFunc:d,useCapture:t};return I.registerOrRemoveHandler(u)},Bf=(e,r,t)=>typeof onbeforeunload>"u"?-1:t!==1?-5:If(2,e,!0,r,28,"beforeunload"),Mn=(e,r,t,n,a,i,d)=>{I.focusEvent||(I.focusEvent=Be(256));var u=(b=event)=>{var S=I.getNodeNameForTarget(b.target),L=b.target.id?b.target.id:"",z=I.focusEvent;he(S,z+0,128),he(L,z+128,128),ie(n)(a,z,r)&&b.preventDefault()},h={target:Te(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},$f=(e,r,t,n,a)=>Mn(e,r,t,n,12,"blur"),Nf=(e,r,t)=>(e=Te(e),e?(e.style.width=r+"px",e.style.height=t+"px",0):-4),Uf=(e,r,t,n,a)=>Mn(e,r,t,n,13,"focus"),Of=e=>{var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=!!r;f[e>>2]=t,f[e+4>>2]=I.fullscreenEnabled();var n=t?r:I.previousFullscreenElement,a=I.getNodeNameForTarget(n),i=(n==null?void 0:n.id)||"";he(a,e+8,128),he(i,e+136,128),f[e+264>>2]=n?n.clientWidth:0,f[e+268>>2]=n?n.clientHeight:0,f[e+272>>2]=screen.width,f[e+276>>2]=screen.height,t&&(I.previousFullscreenElement=r)},An=(e,r,t,n,a,i,d)=>{I.fullscreenChangeEvent||(I.fullscreenChangeEvent=Be(280));var u=(b=event)=>{var S=I.fullscreenChangeEvent;Of(S),ie(n)(a,S,r)&&b.preventDefault()},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},zf=(e,r,t,n,a)=>I.fullscreenEnabled()?(e=Te(e),e?(An(e,r,t,n,19,"webkitfullscreenchange"),An(e,r,t,n,19,"fullscreenchange")):-4):-1,Dn=(e,r,t,n,a,i,d)=>{I.gamepadEvent||(I.gamepadEvent=Be(1432));var u=(b=event)=>{var S=I.gamepadEvent;Sn(S,b.gamepad),ie(n)(a,S,r)&&b.preventDefault()},h={target:Te(e),allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},Gf=(e,r,t,n)=>_t()?-1:Dn(2,e,r,t,26,"gamepadconnected"),qf=(e,r,t,n)=>_t()?-1:Dn(2,e,r,t,27,"gamepaddisconnected"),yt=(e,r,t,n,a,i,d)=>{I.keyEvent||(I.keyEvent=Be(176));var u=b=>{var S=I.keyEvent;le[S>>3]=b.timeStamp;var L=S>>2;f[L+2]=b.location,f[L+3]=b.ctrlKey,f[L+4]=b.shiftKey,f[L+5]=b.altKey,f[L+6]=b.metaKey,f[L+7]=b.repeat,f[L+8]=b.charCode,f[L+9]=b.keyCode,f[L+10]=b.which,he(b.key||"",S+44,32),he(b.code||"",S+76,32),he(b.char||"",S+108,32),he(b.locale||"",S+140,32),ie(n)(a,S,r)&&b.preventDefault()},h={target:Te(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},Hf=(e,r,t,n,a)=>yt(e,r,t,n,2,"keydown"),Vf=(e,r,t,n,a)=>yt(e,r,t,n,1,"keypress"),Wf=(e,r,t,n,a)=>yt(e,r,t,n,3,"keyup"),Xf=(e,r,t)=>{var n=ie(e);un(n,r,t)},In=(e,r,t)=>{le[e>>3]=r.timeStamp;var n=e>>2;f[n+2]=r.screenX,f[n+3]=r.screenY,f[n+4]=r.clientX,f[n+5]=r.clientY,f[n+6]=r.ctrlKey,f[n+7]=r.shiftKey,f[n+8]=r.altKey,f[n+9]=r.metaKey,D[n*2+20]=r.button,D[n*2+21]=r.buttons,f[n+11]=r.movementX,f[n+12]=r.movementY;var a=Or(t);f[n+13]=r.clientX-a.left,f[n+14]=r.clientY-a.top},Tr=(e,r,t,n,a,i,d)=>{I.mouseEvent||(I.mouseEvent=Be(72)),e=Te(e);var u=(b=event)=>{In(I.mouseEvent,b,e),ie(n)(a,I.mouseEvent,r)&&b.preventDefault()},h={target:e,allowsDeferredCalls:i!="mousemove"&&i!="mouseenter"&&i!="mouseleave",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},Kf=(e,r,t,n,a)=>Tr(e,r,t,n,5,"mousedown"),Yf=(e,r,t,n,a)=>Tr(e,r,t,n,33,"mouseenter"),Qf=(e,r,t,n,a)=>Tr(e,r,t,n,34,"mouseleave"),Jf=(e,r,t,n,a)=>Tr(e,r,t,n,8,"mousemove"),Zf=(e,r,t,n,a)=>Tr(e,r,t,n,6,"mouseup"),em=e=>{var r=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement,t=!!r;f[e>>2]=t;var n=I.getNodeNameForTarget(r),a=(r==null?void 0:r.id)||"";he(n,e+4,128),he(a,e+132,128)},zr=(e,r,t,n,a,i,d)=>{I.pointerlockChangeEvent||(I.pointerlockChangeEvent=Be(260));var u=(b=event)=>{var S=I.pointerlockChangeEvent;em(S),ie(n)(a,S,r)&&b.preventDefault()},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},rm=(e,r,t,n,a)=>!document||!document.body||!document.body.requestPointerLock&&!document.body.mozRequestPointerLock&&!document.body.webkitRequestPointerLock&&!document.body.msRequestPointerLock?-1:(e=Te(e),e?(zr(e,r,t,n,20,"mozpointerlockchange"),zr(e,r,t,n,20,"webkitpointerlockchange"),zr(e,r,t,n,20,"mspointerlockchange"),zr(e,r,t,n,20,"pointerlockchange")):-4),tm=(e,r,t,n,a,i,d)=>{I.uiEvent||(I.uiEvent=Be(36)),e=Te(e);var u=(b=event)=>{if(b.target==e){var S=document.body;if(S){var L=I.uiEvent;f[L>>2]=b.detail,f[L+4>>2]=S.clientWidth,f[L+8>>2]=S.clientHeight,f[L+12>>2]=innerWidth,f[L+16>>2]=innerHeight,f[L+20>>2]=outerWidth,f[L+24>>2]=outerHeight,f[L+28>>2]=pageXOffset,f[L+32>>2]=pageYOffset,ie(n)(a,L,r)&&b.preventDefault()}}},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},nm=(e,r,t,n,a)=>tm(e,r,t,n,10,"resize"),Gr=(e,r,t,n,a,i,d)=>{I.touchEvent||(I.touchEvent=Be(1696)),e=Te(e);var u=b=>{for(var S,L={},z=b.touches,P=0;P<z.length;++P)S=z[P],S.isChanged=S.onTarget=0,L[S.identifier]=S;for(var P=0;P<b.changedTouches.length;++P)S=b.changedTouches[P],S.isChanged=1,L[S.identifier]=S;for(var P=0;P<b.targetTouches.length;++P)L[b.targetTouches[P].identifier].onTarget=1;var B=I.touchEvent;le[B>>3]=b.timeStamp;var J=B>>2;f[J+3]=b.ctrlKey,f[J+4]=b.shiftKey,f[J+5]=b.altKey,f[J+6]=b.metaKey,J+=7;var xe=Or(e),me=0;for(var P in L)if(S=L[P],f[J+0]=S.identifier,f[J+1]=S.screenX,f[J+2]=S.screenY,f[J+3]=S.clientX,f[J+4]=S.clientY,f[J+5]=S.pageX,f[J+6]=S.pageY,f[J+7]=S.isChanged,f[J+8]=S.onTarget,f[J+9]=S.clientX-xe.left,f[J+10]=S.clientY-xe.top,J+=13,++me>31)break;f[B+8>>2]=me,ie(n)(a,B,r)&&b.preventDefault()},h={target:e,allowsDeferredCalls:i=="touchstart"||i=="touchend",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},am=(e,r,t,n,a)=>Gr(e,r,t,n,25,"touchcancel"),om=(e,r,t,n,a)=>Gr(e,r,t,n,23,"touchend"),sm=(e,r,t,n,a)=>Gr(e,r,t,n,24,"touchmove"),im=(e,r,t,n,a)=>Gr(e,r,t,n,22,"touchstart"),lm=e=>{var r=["hidden","visible","prerender","unloaded"],t=r.indexOf(document.visibilityState);f[e>>2]=document.hidden,f[e+4>>2]=t},cm=(e,r,t,n,a,i,d)=>{I.visibilityChangeEvent||(I.visibilityChangeEvent=Be(8));var u=(b=event)=>{var S=I.visibilityChangeEvent;lm(S),ie(n)(a,S,r)&&b.preventDefault()},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},dm=(e,r,t,n)=>cm(Ur[1],e,r,t,21,"visibilitychange"),um=(e,r,t,n,a,i,d)=>{I.wheelEvent||(I.wheelEvent=Be(104));var u=(b=event)=>{var S=I.wheelEvent;In(S,b,e),le[S+72>>3]=b.deltaX,le[S+80>>3]=b.deltaY,le[S+88>>3]=b.deltaZ,f[S+96>>2]=b.deltaMode,ie(n)(a,S,r)&&b.preventDefault()},h={target:e,allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return I.registerOrRemoveHandler(h)},fm=(e,r,t,n,a)=>(e=Te(e),e?typeof e.onwheel<"u"?um(e,r,t,n,9,"wheel"):-1:-4),mm=e=>document.title=Le(e),pm=()=>{throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},wt={},hm=()=>j||"./this.program",Pr=()=>{if(!Pr.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:hm()};for(var t in wt)wt[t]===void 0?delete r[t]:r[t]=wt[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);Pr.strings=n}return Pr.strings},vm=(e,r)=>{for(var t=0;t<e.length;++t)M[r++>>0]=e.charCodeAt(t);M[r>>0]=0},gm=(e,r)=>{var t=0;return Pr().forEach((n,a)=>{var i=r+t;ee[e+a*4>>2]=i,vm(n,i),t+=n.length+1}),0},xm=(e,r)=>{var t=Pr();ee[e>>2]=t.length;var n=0;return t.forEach(a=>n+=a.length+1),ee[r>>2]=n,0};function bm(e){try{var r=re.getStreamFromFD(e);return c.close(r),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return t.errno}}var _m=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=ee[r>>2],u=ee[r+4>>2];r+=8;var h=c.read(e,M,d,u,n);if(h<0)return-1;if(a+=h,h<u)break}return a};function ym(e,r,t,n){try{var a=re.getStreamFromFD(e),i=_m(a,r,t);return ee[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}function wm(e,r,t,n,a){var i=br(r,t);try{if(isNaN(i))return 61;var d=re.getStreamFromFD(e);return c.llseek(d,i,n),ue=[d.position>>>0,(Z=d.position,+Math.abs(Z)>=1?Z>0?+Math.floor(Z/4294967296)>>>0:~~+Math.ceil((Z-+(~~Z>>>0))/4294967296)>>>0:0)],f[a>>2]=ue[0],f[a+4>>2]=ue[1],d.getdents&&i===0&&n===0&&(d.getdents=null),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function Sm(e){var t;try{var r=re.getStreamFromFD(e);return(t=r.stream_ops)!=null&&t.fsync?r.stream_ops.fsync(r):0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return n.errno}}var Cm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=ee[r>>2],u=ee[r+4>>2];r+=8;var h=c.write(e,M,d,u,n);if(h<0)return-1;a+=h}return a};function Em(e,r,t,n){try{var a=re.getStreamFromFD(e),i=Cm(a,r,t);return ee[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var Bn=e=>{var r=s["_"+e];return r},km=(e,r)=>{M.set(e,r)},jm=(e,r,t,n,a)=>{var i={string:B=>{var J=0;return B!=null&&B!==0&&(J=pt(B)),J},array:B=>{var J=Vr(B.length);return km(B,J),J}};function d(B){return r==="string"?Le(B):r==="boolean"?!!B:B}var u=Bn(e),h=[],b=0;if(n)for(var S=0;S<n.length;S++){var L=i[t[S]];L?(b===0&&(b=$e()),h[S]=L(n[S])):h[S]=n[S]}var z=u.apply(null,h);function P(B){return b!==0&&Ne(b),d(B)}return z=P(z),z},de=(e,r,t,n)=>{var a=!t||t.every(d=>d==="number"||d==="boolean"),i=r!=="string";return i&&a&&!n?Bn(e):function(){return jm(e,r,t,arguments)}},$n=(e,r)=>{e<128?r.push(e):r.push(e%128|128,e>>7)},Fm=e=>{for(var r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},t={parameters:[],results:e[0]=="v"?[]:[r[e[0]]]},n=1;n<e.length;++n)t.parameters.push(r[e[n]]);return t},Lm=(e,r)=>{var t=e.slice(0,1),n=e.slice(1),a={i:127,p:127,j:126,f:125,d:124,e:111};r.push(96),$n(n.length,r);for(var i=0;i<n.length;++i)r.push(a[n[i]]);t=="v"?r.push(0):r.push(1,a[t])},Rm=(e,r)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Fm(r),e);var t=[1];Lm(r,t);var n=[0,97,115,109,1,0,0,0,1];$n(t.length,n),n.push.apply(n,t),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var a=new WebAssembly.Module(new Uint8Array(n)),i=new WebAssembly.Instance(a,{e:{f:e}}),d=i.exports.f;return d},Tm=(e,r)=>{if(dr)for(var t=e;t<e+r;t++){var n=ie(t);n&&dr.set(n,t)}},dr,Pm=e=>(dr||(dr=new WeakMap,Tm(0,lr.length)),dr.get(e)||0),St=[],Mm=()=>{if(St.length)return St.pop();try{lr.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return lr.length-1},Ct=(e,r)=>{lr.set(e,r),Fr[e]=lr.get(e)},Nn=(e,r)=>{var t=Pm(e);if(t)return t;var n=Mm();try{Ct(n,e)}catch(i){if(!(i instanceof TypeError))throw i;var a=Rm(e,r);Ct(n,a)}return dr.set(e,n),n},Un=e=>{dr.delete(ie(e)),Ct(e,null),St.push(e)},On=function(e,r,t,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=c.nextInode++,this.name=r,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},qr=365,Hr=146;Object.defineProperties(On.prototype,{read:{get:function(){return(this.mode&qr)===qr},set:function(e){e?this.mode|=qr:this.mode&=~qr}},write:{get:function(){return(this.mode&Hr)===Hr},set:function(e){e?this.mode|=Hr:this.mode&=~Hr}},isFolder:{get:function(){return c.isDir(this.mode)}},isDevice:{get:function(){return c.isChrdev(this.mode)}}}),c.FSNode=On,c.createPreloadedFile=Ya,c.staticInit(),s.requestFullscreen=E.requestFullscreen,s.requestAnimationFrame=E.requestAnimationFrame,s.setCanvasSize=E.setCanvasSize,s.pauseMainLoop=E.mainLoop.pause,s.resumeMainLoop=E.mainLoop.resume,s.getUserMedia=E.getUserMedia,s.createContext=E.createContext;for(var y,Ie=0;Ie<32;++Ie)Cn.push(new Array(Ie));for(var Am=new Float32Array(288),Ie=0;Ie<288;++Ie)nr[Ie]=Am.subarray(0,Ie+1);for(var Dm=new Int32Array(288),Ie=0;Ie<288;++Ie)Rr[Ie]=Dm.subarray(0,Ie+1);var Im={Q:Ja,rb:Za,ab:eo,mb:ro,ib:to,sb:no,ob:ao,jb:oo,pb:so,S:io,hb:lo,fb:co,qb:uo,gb:fo,db:mo,tb:ho,bb:vo,Za:_o,_a:yo,Wa:wo,Xa:So,Ya:Co,eb:Eo,a:ko,Qa:Ro,Ua:To,Ga:Io,Ja:Bo,Ha:$o,Ka:No,Va:Uo,O:Oo,Fa:zo,Ra:Go,La:qo,Ea:Ho,Ma:Vo,Na:Wo,Ta:Xo,Pa:Yo,Oa:Qo,i:Zo,b:rs,T:ts,ya:is,Ca:ls,h:cs,e:ds,V:us,X:fs,l:$r,Ub:ms,Da:ps,ea:vs,da:xs,ua:_s,ca:ws,ba:Cs,aa:ks,$:Fs,_:Rs,ma:Ms,Zd:Ds,Yd:Bs,Xd:Ns,Wd:Os,Vd:Gs,Ud:Hs,Td:Ws,Sd:Ks,Rd:Qs,Qd:Zs,Pd:ri,Od:ni,Nd:oi,Md:ii,Ld:ci,Kd:ui,Jd:mi,Id:hi,Hd:gi,Gd:bi,Fd:yi,Ed:Si,Dd:Ei,Cd:ji,wa:Li,Bd:Ti,Ad:Mi,zd:Di,la:$i,yd:Ui,xd:zi,wd:qi,vd:Vi,ud:Xi,td:Yi,sd:Ji,ha:rl,ia:al,rd:sl,ga:cl,qd:ul,pd:ml,ta:hl,od:gl,nd:bl,md:yl,kd:Sl,jd:El,id:jl,gd:Ll,xa:Tl,fd:Ml,ed:Dl,ka:$l,hd:Ul,dd:zl,cd:ql,bd:Vl,ad:Xl,$c:Yl,_c:Jl,Zc:ec,Yc:tc,Xc:ac,Wc:sc,Uc:lc,Vc:dc,oa:uc,qa:fc,na:pc,pa:vc,ra:xc,Tc:_c,Rc:wc,Qc:Cc,Pc:kc,Sc:Fc,Oc:Tc,Nc:Mc,Mc:Dc,Jc:$c,Lc:Uc,Kc:zc,Fc:qc,Hc:Vc,Gc:Xc,Ec:Yc,Dc:Jc,Cc:ed,Bc:td,Ac:ad,va:sd,zc:ld,yc:dd,wc:fd,ja:hd,vc:gd,uc:bd,tc:yd,sc:Sd,sa:Ed,rc:Td,qc:Md,pc:Dd,oc:Bd,nc:Nd,mc:Od,lc:Gd,kc:Hd,jc:Wd,ic:Kd,hc:Qd,gc:Zd,fc:ru,ec:nu,dc:ou,cc:iu,bc:cu,ac:uu,$b:mu,_b:hu,Zb:gu,Yb:bu,Xb:yu,Wb:Su,Vb:Eu,Tb:ju,Sb:Lu,Rb:Tu,Qb:Mu,Pb:Du,Ob:Bu,Nb:Nu,Mb:Ou,Lb:Gu,Kb:Hu,Jb:Wu,Ib:Ku,Hb:Qu,Gb:Zu,Fb:rf,Eb:nf,Db:of,Cb:lf,Bb:df,Ab:ff,zb:pf,yb:vf,xb:xf,fa:yf,wb:Sf,vb:Ef,o:kf,ub:jf,q:Ff,za:Rf,N:Tf,cb:Af,M:Df,W:_t,s:Bf,E:$f,g:yn,m:Nf,F:Uf,v:zf,U:Gf,R:qf,y:Hf,w:Vf,x:Wf,Ba:Xf,Sa:_r,K:Kf,I:Yf,H:Qf,L:Jf,J:Zf,z:rm,u:nm,A:am,C:om,B:sm,D:im,t:dm,G:fm,Aa:mm,n:pm,kb:gm,lb:xm,Ia:pn,j:bm,P:ym,$a:wm,nb:Sm,p:Em,Z:Om,Y:qm,c:$m,r:Bm,Ic:Hm,d:Nm,k:Gm,f:Um,xc:Vm,ld:zm},ae=$a();s._screenshot=e=>(s._screenshot=ae.ae)(e),s._buttonPress=e=>(s._buttonPress=ae.be)(e),s._buttonUnpress=e=>(s._buttonUnpress=ae.ce)(e),s._setVolume=e=>(s._setVolume=ae.de)(e),s._getVolume=()=>(s._getVolume=ae.ee)(),s._getMainLoopTimingMode=()=>(s._getMainLoopTimingMode=ae.fe)(),s._getMainLoopTimingValue=()=>(s._getMainLoopTimingValue=ae.ge)(),s._setMainLoopTiming=(e,r)=>(s._setMainLoopTiming=ae.he)(e,r),s._setFastForwardMultiplier=e=>(s._setFastForwardMultiplier=ae.ie)(e),s._getFastForwardMultiplier=()=>(s._getFastForwardMultiplier=ae.je)(),s._quitGame=()=>(s._quitGame=ae.ke)(),s._quitMgba=()=>(s._quitMgba=ae.le)(),s._quickReload=()=>(s._quickReload=ae.me)(),s._pauseGame=()=>(s._pauseGame=ae.ne)(),s._resumeGame=()=>(s._resumeGame=ae.oe)(),s._setEventEnable=e=>(s._setEventEnable=ae.pe)(e),s._bindKey=(e,r)=>(s._bindKey=ae.qe)(e,r),s._saveState=e=>(s._saveState=ae.re)(e),s._loadState=e=>(s._loadState=ae.se)(e),s._autoLoadCheats=()=>(s._autoLoadCheats=ae.te)(),s._loadGame=e=>(s._loadGame=ae.ue)(e),s._saveStateSlot=(e,r)=>(s._saveStateSlot=ae.ve)(e,r),s._loadStateSlot=(e,r)=>(s._loadStateSlot=ae.we)(e,r),s._addCoreCallbacks=(e,r,t,n,a,i)=>(s._addCoreCallbacks=ae.xe)(e,r,t,n,a,i),s._setupConstants=()=>(s._setupConstants=ae.ye)();var zn=s._main=(e,r)=>(zn=s._main=ae.ze)(e,r),Be=e=>(Be=ae.Be)(e),Gn=e=>(Gn=ae.Ce)(e),qn=(e,r)=>(qn=ae.De)(e,r),ze=(e,r)=>(ze=ae.Ee)(e,r),$e=()=>($e=ae.Fe)(),Ne=e=>(Ne=ae.Ge)(e),Vr=e=>(Vr=ae.He)(e);s.dynCall_ji=(e,r)=>(s.dynCall_ji=ae.Ie)(e,r),s.dynCall_jiji=(e,r,t,n,a)=>(s.dynCall_jiji=ae.Je)(e,r,t,n,a),s.dynCall_iiiji=(e,r,t,n,a,i)=>(s.dynCall_iiiji=ae.Ke)(e,r,t,n,a,i),s.dynCall_jii=(e,r,t)=>(s.dynCall_jii=ae.Le)(e,r,t),s._GBAInputInfo=109920,s._binaryName=186992,s._projectName=186996,s._projectVersion=187e3,s._gitCommit=186976,s._gitCommitShort=186980,s._gitBranch=186984,s._gitRevision=186988,s._GBIORegisterNames=49376,s._GBSavestateMagic=64640,s._GBSavestateVersion=64644,s._GBA_LUX_LEVELS=93136,s._GBAVideoObjSizes=138416,s._GBASavestateMagic=138208,s._GBASavestateVersion=138212;function Bm(e,r,t,n,a){var i=$e();try{return ie(e)(r,t,n,a)}catch(d){if(Ne(i),d!==d+0)throw d;ze(1,0)}}function $m(e,r,t,n){var a=$e();try{return ie(e)(r,t,n)}catch(i){if(Ne(a),i!==i+0)throw i;ze(1,0)}}function Nm(e,r,t){var n=$e();try{ie(e)(r,t)}catch(a){if(Ne(n),a!==a+0)throw a;ze(1,0)}}function Um(e,r,t,n,a){var i=$e();try{ie(e)(r,t,n,a)}catch(d){if(Ne(i),d!==d+0)throw d;ze(1,0)}}function Om(e,r){var t=$e();try{return ie(e)(r)}catch(n){if(Ne(t),n!==n+0)throw n;ze(1,0)}}function zm(e,r,t,n,a,i,d,u,h,b){var S=$e();try{ie(e)(r,t,n,a,i,d,u,h,b)}catch(L){if(Ne(S),L!==L+0)throw L;ze(1,0)}}function Gm(e,r,t,n){var a=$e();try{ie(e)(r,t,n)}catch(i){if(Ne(a),i!==i+0)throw i;ze(1,0)}}function qm(e,r,t){var n=$e();try{return ie(e)(r,t)}catch(a){if(Ne(n),a!==a+0)throw a;ze(1,0)}}function Hm(e,r){var t=$e();try{ie(e)(r)}catch(n){if(Ne(t),n!==n+0)throw n;ze(1,0)}}function Vm(e,r,t,n,a,i){var d=$e();try{ie(e)(r,t,n,a,i)}catch(u){if(Ne(d),u!==u+0)throw u;ze(1,0)}}s.cwrap=de,s.addFunction=Nn,s.removeFunction=Un,s.FS=c;var Wr;sr=function e(){Wr||Hn(),Wr||(sr=e)};function Wm(){var e=zn,r=0,t=0;try{var n=e(r,t);return mn(n,!0),n}catch(a){return ut(a)}}function Hn(){if(rr>0||(Qe(),rr>0))return;function e(){Wr||(Wr=!0,s.calledRun=!0,!X&&(oe(),ge(),p(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),Vn&&Wm(),Ee()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),e()},1)):e()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();var Vn=!0;return s.noInitialRun&&(Vn=!1),Hn(),m.ready}})();const dh=l=>{const[m,s]=R.useState(null);return R.useEffect(()=>{(async()=>{if(l){const v=await ch({canvas:l}),x=v.version.projectName+" "+v.version.projectVersion;console.log(x),await v.FSInit();const g=lh(v);s(g)}})()},[l]),m},Wt=R.createContext(null);Wt.displayName="EmulatorContext";const uh=({children:l})=>{const[m,s]=R.useState(null),p=dh(m);return o.jsx(Wt.Provider,{value:{emulator:p,canvas:m,setCanvas:s},children:l})},Xt=R.createContext(null);Xt.displayName="ResizeContext";const fh=({children:l})=>{const[m,s]=R.useState(!1);return o.jsx(Xt.Provider,{value:{areItemsResizable:m,setAreItemsResizable:s},children:l})},Kt=R.createContext(null);Kt.displayName="RunningContext";const mh=({children:l})=>{const[m,s]=R.useState(!1);return o.jsx(Kt.Provider,{value:{isRunning:m,setIsRunning:s},children:l})},ph="componentLayouts",hh=()=>{const[l,m]=ke(ph,{}),s=R.useCallback(()=>m({}),[m]),p=R.useMemo(()=>!!Object.values(l).some(v=>!!(v!=null&&v.position)||!!(v!=null&&v.size)),[l]);return{layouts:l,setLayouts:m,hasSetLayout:p,clearLayouts:s}},Yt=R.createContext(null);Yt.displayName="LayoutContext";const vh=({children:l})=>{const{layouts:m,setLayouts:s,hasSetLayout:p,clearLayouts:v}=hh(),x=R.useCallback((g,_)=>s(j=>({...j,[g]:{...j==null?void 0:j[g],..._}})),[s]);return R.useEffect(()=>{p||v()},[]),o.jsx(Yt.Provider,{value:{layouts:m,hasSetLayout:p,clearLayouts:v,setLayout:x},children:l})},Qt=R.createContext(null);Qt.displayName="ModalContext";const gh=({children:l})=>{const[m,s]=R.useState(null),[p,v]=R.useState(!1);return o.jsx(Qt.Provider,{value:{modalContent:m,setModalContent:s,isModalOpen:p,setIsModalOpen:v},children:l})},hr=l=>{const m=l.displayName,s=R.useContext(l);if(!s)throw new Error(`${m??"This context"} must be loaded under the matching ${m?`${m}.Provider`:"Provider"}`);return s},va=()=>hr(Ht),Er=()=>hr(Yt),Me=()=>hr(Qt),ve=()=>hr(Wt),tt=()=>hr(Vt),ga=()=>hr(Xt),Ze=()=>hr(Kt),xh=({isPaused:l})=>{const m=Ym(),{emulator:s}=ve(),{isRunning:p}=Ze(),[v,x]=R.useState(!1),g=p&&!l;R.useEffect(()=>{g&&(!m&&!v?(s==null||s.pause(),x(!0)):m&&v&&(s==null||s.resume(),x(!1)))},[s,m,g,v])},bh=l=>{const m=l.getContext("webgl");m==null||m.clearColor(0,0,0,1),m==null||m.clear(m==null?void 0:m.COLOR_BUFFER_BIT)},_h=l=>{const m=l.getContext("2d"),s=40,p=50;let v=0;if(!m)return;const x=l.width,g=l.height,_=x/2,j=g/2,w=m.getImageData(0,0,x,g),C=setInterval(()=>{v++;for(let F=0;F<g;++F)for(let T=0;T<x;++T){const W=Math.abs(T-_),G=Math.abs(F-j)*.8,A=(_-v-W)/_,O=(j-v-(F&1)*10-G+Math.pow(W,1/2))/j;w.data[(T+F*x)*4+3]*=Math.pow(A,1/3)*Math.pow(O,1/2)}m.putImageData(w,0,0),v>s&&(clearInterval(C),l.remove())},p)},yh=(l,m)=>{if(!l||!m)return;const s=document.createElement("canvas"),p=s.getContext("2d"),v=URL.createObjectURL(m);s.className=l.className,s.height=l.height,s.width=l.width,s.style.backgroundColor=l.style.backgroundColor,s.style.height=`${l.clientHeight}px`,s.style.imageRendering=l.style.imageRendering,s.style.margin=l.style.margin,s.style.objectFit=l.style.objectFit,s.style.width=`${l.clientWidth}px`,s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.right="0";const x=new Image;x.onload=()=>{var g;p==null||p.drawImage(x,0,0),(g=l.parentElement)==null||g.appendChild(s),bh(l),_h(s)},x.src=v},wh=l=>{if(!l)return null;const m="fade-copy.png",s=(l==null?void 0:l.filePaths().screenshotsPath)+"/"+m;if(!l.screenshot(m))return null;const v=l.getFile(s);return l==null||l.deleteFile(s),new Blob([v],{type:"image/png"})},Sh=()=>{const{canvas:l,emulator:m}=ve(),{isRunning:s,setIsRunning:p}=Ze();return R.useCallback(()=>{s&&(yh(l,wh(m)),m==null||m.quitGame()),p(!1)},[l,m,s,p])},Jt="completedProductTour",Ch={locale:{skip:o.jsx("strong",{"aria-label":"Skip",children:"Skip"})},placement:"auto",placementBeacon:"right-end",spotlightPadding:10},vr=({completedProductTourStepName:l,steps:m,allowScrolling:s=!0,isNotInModal:p=!1,millisecondDelay:v=500,renderWithoutDelay:x=!1,skipIfIntroSkipped:g=!0,skipRenderCondition:_=!1,zIndex:j=500})=>{const[w,C]=ke(Jt),{isModalOpen:F}=Me(),[T,W]=R.useState(x);if(It(()=>{W(!0)},x?null:v),!T||w!=null&&w[l]||g&&(w==null?void 0:w.hasCompletedProductTourIntro)===kt.SKIPPED||!(w!=null&&w.hasCompletedProductTourIntro)||!p&&!F||_)return null;const G=m.map(A=>({...Ch,...A}));return o.jsx(Vp,{continuous:!0,disableScrollParentFix:s,hideCloseButton:!0,showProgress:!0,showSkipButton:!0,steps:G,styles:{options:{zIndex:j}},callback:({status:A})=>{[kt.FINISHED,kt.SKIPPED].includes(A)&&C(O=>({...O,[l]:A}))}})},Eh=N.button`
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
  padding: inherit;
`,kr=rt.forwardRef(({children:l,...m},s)=>o.jsx(Eh,{ref:s,...m,children:l})),yr=({variation:l})=>{const m=Pe(),s=function(){switch(l){case"topLeft":return"-45deg";case"topRight":return"45deg";case"bottomLeft":return"45deg";case"bottomRight":return"-45deg";default:return"0deg"}}();return o.jsx(Qm,{"data-testid":"gripper-handle",color:m.gbaThemeBlue,style:{transform:`rotate(${s})`}})},kh=N.ul`
  background-color: ${({theme:l})=>l.panelBlueGray};
  list-style: none;
  padding: 10px;
  margin: 0;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-template-areas:
    '. . . .'
    'volume volume fastForward fastForward';

  ${({$controlled:l,$isLargerThanPhone:m})=>(l||m)&&`
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
  `}
`,jh=N.li`
  display: contents;
`,xa=aa`
  cursor: pointer;
  background-color: ${({theme:l})=>l.panelControlGray};
  border-radius: 0.25rem;
  min-width: 40px;
  min-height: 40px;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:l})=>l.pureBlack};
  width: ${({$controlled:l})=>l?"auto":"100%"};

  ${({$controlled:l,theme:m})=>!l&&`
    @media ${m.isLargerThanPhone} {
      width: auto;
    }
  `}
`,Fh=N(kr).attrs({className:"noDrag"})`
  ${xa}

  border: none;
  flex-grow: 1;
  margin: 0;
  padding: 0;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  &:active {
    color: ${({theme:l})=>l.gbaThemeBlue};
  }
`,Lh=N.li`
  ${xa}
  grid-area: ${({$gridArea:l})=>l};
  max-height: 40px;
`,Rh=N(Wp)`
  flex-grow: 1;

  > .MuiSlider-markActive {
    opacity: 1;
    background-color: currentColor;
  }
`,Xr=({ariaLabel:l,children:m,controlled:s,id:p,onClick:v})=>o.jsx(jh,{children:o.jsx(Fh,{"aria-label":l,id:p,onClick:v,$controlled:s,children:m})}),Kr=({icon:l,...m})=>{const s=Pe();return o.jsx(or,{size:"small",sx:{padding:0,color:s.pureBlack,"&:active":{color:s.gbaThemeBlue}},...m,children:l})},Yn=({controlled:l,gridArea:m,id:s,maxIcon:p,minIcon:v,...x})=>o.jsxs(Lh,{id:s,$gridArea:m,$controlled:l,children:[v,o.jsx(Rh,{marks:!0,sx:{width:"85px",margin:"0 10px",maxHeight:"40px"},valueLabelDisplay:"auto",...x}),p]}),Th=()=>{var Qe,oe,ge,Ee;const{emulator:l}=ve(),{isRunning:m}=Ze(),{areItemsDraggable:s,setAreItemsDraggable:p}=tt(),{areItemsResizable:v,setAreItemsResizable:x}=ga(),{layouts:g,setLayout:_}=Er(),j=Pe(),w=mr(j.isLargerThanPhone),[C,F]=R.useState(!1),[T,W]=R.useState(!1),G=R.useId(),A=Sh(),[O,V]=ke(fa,1),[K,X]=ke(ha,1);xh({isPaused:C});const $=R.useCallback(ce=>{var Re,De;!((Re=g==null?void 0:g.controlPanel)!=null&&Re.initialBounds)&&ce&&_("controlPanel",{initialBounds:(De=ce.resizableElement.current)==null?void 0:De.getBoundingClientRect()})},[_,g]),q=(Qe=g==null?void 0:g.screen)==null?void 0:Qe.initialBounds;if(!q)return null;const M=w?5:0,U=!!((oe=g==null?void 0:g.controlPanel)!=null&&oe.size)||T,D=()=>{m&&(C?l==null||l.resume():l==null||l.pause(),F(ce=>!ce))},Q=ce=>{l==null||l.setVolume(ce),V(ce)},f=ce=>{var De;const Re=Number((De=ce.target)==null?void 0:De.value);Q(Re)},ee=ce=>{l==null||l.setFastForwardMultiplier(ce),X(ce)},Y=ce=>{var De;const Re=Number((De=ce.target)==null?void 0:De.value);l==null||l.setFastForwardMultiplier(Re),X(Re)},le=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the control panel to quickly perform in game actions and reposition controls."}),o.jsx("p",{children:"Click next to take a tour of the controls!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(G)}`},{content:o.jsx("p",{children:"Use the this button to pause and resume your game if it is running."}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--play`)}`},{content:o.jsx("p",{children:"Use this button to quit your current game."}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--quit-game`)}`},{content:o.jsx("p",{children:"Use this button to enable dragging and repositioning of the screen, controls, and control panel."}),placement:w?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--drag`)}`},{content:o.jsx("p",{children:"Use this button to resize the screen and control panel."}),placement:w?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--resize`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the emulator volume."}),o.jsx("p",{children:"Your volume setting will be saved between refreshes!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(`${G}--volume-slider`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the fast forward speed."}),o.jsx("p",{children:"Your fast forward setting will be saved between refreshes!"})]}),placement:w?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${G}--fast-forward`)}`}],Fe={x:Math.floor(q.left),y:Math.floor(q.bottom+M)},qe={width:w?"auto":"100dvw",height:"auto"},Ye=((ge=g==null?void 0:g.controlPanel)==null?void 0:ge.position)??Fe,er=((Ee=g==null?void 0:g.controlPanel)==null?void 0:Ee.size)??qe,He={onFocus:l==null?void 0:l.disableKeyboardInput,onBlur:l==null?void 0:l.enableKeyboardInput,onClick:l==null?void 0:l.enableKeyboardInput};return o.jsxs(o.Fragment,{children:[o.jsx(oa,{"data-testid":"control-panel-wrapper",id:G,disableDragging:!s,enableResizing:v,resizeHandleComponent:{bottomRight:o.jsx(yr,{variation:"bottomRight"}),bottomLeft:o.jsx(yr,{variation:"bottomLeft"})},resizeHandleStyles:{bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"}},ref:$,cancel:".noDrag",position:Ye,size:er,onDragStop:(ce,Re)=>{_("controlPanel",{position:{x:Re.x,y:Re.y}})},onResizeStart:()=>W(!0),onResizeStop:(ce,Re,De,rr,sr)=>{_("controlPanel",{size:{width:De.clientWidth,height:De.clientHeight},position:{...sr}}),W(!1)},default:{...Fe,...qe},children:o.jsx(kh,{$controlled:U,$isLargerThanPhone:w,children:o.jsxs(sa.Provider,{value:{size:"2em"},children:[o.jsx(Xr,{id:`${G}--play`,ariaLabel:C||!m?"Play":"Pause",onClick:D,controlled:U,children:C||!m?o.jsx(Jm,{}):o.jsx(Zm,{})}),o.jsx(Xr,{id:`${G}--quit-game`,ariaLabel:"Quit Game",onClick:()=>{A(),F(!1)},controlled:U,children:o.jsx(ep,{})}),o.jsx(Xr,{id:`${G}--drag`,ariaLabel:s?"Anchor Items":"Drag Items",onClick:()=>{p(ce=>!ce)},controlled:U,children:s?o.jsx(Wn,{color:j.gbaThemeBlue}):o.jsx(Wn,{})}),o.jsx(Xr,{id:`${G}--resize`,ariaLabel:v?"Stop Resizing Items":"Resize Items",onClick:()=>{x(ce=>!ce)},controlled:U,children:v?o.jsx(Xn,{color:j.gbaThemeBlue}):o.jsx(Xn,{})}),o.jsx(Yn,{id:`${G}--volume-slider`,"aria-label":"Volume Slider",gridArea:"volume",controlled:U,value:O,step:.1,min:0,max:1,minIcon:o.jsx(Kr,{"aria-label":"Mute Volume",icon:o.jsx(rp,{style:{maxHeight:"100%"}}),onClick:()=>Q(0)}),maxIcon:o.jsx(Kr,{"aria-label":"Max Volume",icon:o.jsx(tp,{style:{maxHeight:"100%"}}),onClick:()=>Q(1)}),valueLabelFormat:`${O*100}`,onChange:f,...He}),o.jsx(Yn,{id:`${G}--fast-forward`,"aria-label":"Fast Forward Slider",gridArea:"fastForward",controlled:U,value:K,step:1,min:1,max:5,minIcon:o.jsx(Kr,{"aria-label":"Regular Speed",icon:o.jsx(np,{style:{maxHeight:"100%"}}),onClick:()=>ee(1)}),maxIcon:o.jsx(Kr,{"aria-label":"Max Fast Forward",icon:o.jsx(ap,{style:{maxHeight:"100%"}}),onClick:()=>ee(5)}),valueLabelFormat:`x${K}`,onChange:Y,...He})]})})}),o.jsx(vr,{steps:le,completedProductTourStepName:"hasCompletedControlPanelTour",zIndex:w?160:0,renderWithoutDelay:!0,isNotInModal:!0})]})},ba="currentSaveStateSlot",_a="areVirtualControlsEnabled",Ph=N.section`
  position: absolute;
  background-color: red;
  border-radius: 50%;
  width: 12rem;
  height: 12rem;
  background: ${({theme:l})=>l.pureBlack};
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};
  border-width: 2px;
  z-index: 12;

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `};
`,Mh=N.div`
  position: absolute;
  height: 4rem;
  width: 4rem;
  border: 2px solid ${({theme:l})=>l.gbaThemeBlue};
  border-radius: 50%;
  background-color: ${({theme:l})=>l.pureBlack};
  transition: ${({$isControlled:l=!1})=>l?"transform 0.3s ease-in-out":"none"};

  &:before {
    position: absolute;
    content: '';
    top: -0.8rem;
    left: -0.8rem;
    right: -0.8rem;
    bottom: -0.8rem;
    border: 0.8rem solid ${({theme:l})=>l.gbaThemeBlue}50;
    border-radius: 50%;
  }
`,nt=N.div`
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
`,Ah=N(nt)`
  border-width: 0 15px 25px 15px;
  border-color: transparent transparent ${({theme:l})=>l.pureWhite}
    transparent;
  top: 10px;
`,Dh=N(nt)`
  border-width: 25px 15px 0 15px;
  border-color: ${({theme:l})=>l.pureWhite} transparent transparent
    transparent;
  bottom: 10px;
`,Ih=N(nt)`
  border-width: 15px 25px 15px 0;
  border-color: transparent ${({theme:l})=>l.pureWhite} transparent
    transparent;
  left: 10px;
`,Bh=N(nt)`
  border-width: 15px 0 15px 25px;
  border-color: transparent transparent transparent
    ${({theme:l})=>l.pureWhite};
  right: 10px;
`,$h=({initialPosition:l})=>{var $;const{emulator:m}=ve(),{areItemsDraggable:s}=tt(),{layouts:p,setLayout:v}=Er(),[x,g]=R.useState({x:0,y:0}),[_,j]=R.useState(!0),w=R.useRef(null),C=R.useRef(null),[F,T]=R.useState({});R.useEffect(()=>{Object.keys(F).forEach(q=>{F[q]?m==null||m.simulateKeyDown(q):m==null||m.simulateKeyUp(q)})},[F,m]);const W=R.useCallback((q,M)=>T(U=>({...U,[q]:M})),[]),G=R.useCallback(q=>T(M=>Object.fromEntries(Object.entries(M).map(([U,D])=>[U,D===q?void 0:D]))),[]),A=({x:q,y:M})=>{const U=q*Math.cos(Math.PI/4)-M*Math.sin(Math.PI/4),D=q*Math.sin(Math.PI/4)+M*Math.cos(Math.PI/4);return U>=0&&D>=0?"RIGHT":U<0&&D>=0?"DOWN":U<0&&D<0?"LEFT":U>=0&&D<0?"UP":null},O=R.useCallback(q=>{if(!w.current||!C.current)return;const M=w.current.getBoundingClientRect(),U=C.current.getBoundingClientRect(),D=Math.max(-M.width/2+U.width/2,Math.min(q.clientX-M.left-M.width/2,M.width/2-U.width/2)),Q=Math.max(-M.height/2+U.height/2,Math.min(q.clientY-M.top-M.height/2,M.height/2-U.height/2));s||g({x:D,y:Q});const f=A({x:D,y:Q});f&&!F[f]&&(G(q.pointerId),W(f,q.pointerId))},[s,F,W,G]),V=R.useCallback(q=>{if(j(!1),!w.current)return;const M=w.current.getBoundingClientRect(),U=q.clientX-M.left-M.width/2,D=q.clientY-M.top-M.width/2;s||g({x:U,y:D});const Q=A({x:U,y:D});Q&&W(Q,q.pointerId)},[s,W]),K=q=>{j(!0),g({x:0,y:0}),G(q.pointerId)},X=(($=p==null?void 0:p.oPad)==null?void 0:$.position)??{x:0,y:0};return o.jsx(Tt,{nodeRef:w,disabled:!s,position:X,onStop:(q,M)=>v("oPad",{position:{x:M.x,y:M.y}}),children:o.jsxs(Ph,{"aria-label":"O-Pad",ref:w,$initialPosition:l,$areItemsDraggable:s,onPointerDown:V,onPointerMove:O,onPointerUp:K,onPointerCancel:K,onPointerOut:K,onPointerLeave:K,children:[o.jsx(Tt,{disabled:!0,nodeRef:C,position:x,children:o.jsx(Mh,{ref:C,$isControlled:_})}),o.jsx(Ih,{}),o.jsx(Bh,{}),o.jsx(Ah,{}),o.jsx(Dh,{})]})})},ya=N(kr)`
  background-color: ${({theme:l})=>l.darkGray};
  border-style: solid;
  border-color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  cursor: pointer;
  box-sizing: content-box;
  border-width: 2px;
`,Nh=N(ya)`
  width: ${({$diameter:l=60})=>l}px;
  height: ${({$diameter:l=60})=>l}px;
  border-radius: 100px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Uh=N(ya)`
  border-radius: 16px;
  width: fit-content;
  min-width: 85px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,Oh=({isRectangular:l=!1,width:m=60,children:s,keyId:p,inputName:v,onClick:x,initialPosition:g,initialOffset:_,enabled:j=!1,ariaLabel:w})=>{var X;const{emulator:C}=ve(),{areItemsDraggable:F}=tt(),{layouts:T,setLayout:W}=Er(),G=R.useRef(null);if(!j)return null;const A=x?{onClick:x}:{},O=p?{onPointerDown:()=>{C==null||C.simulateKeyDown(p)},onPointerUp:()=>{C==null||C.simulateKeyUp(p)},onPointerLeave:()=>{C==null||C.simulateKeyUp(p)},onPointerOut:()=>{C==null||C.simulateKeyUp(p)},onPointerCancel:()=>{C==null||C.simulateKeyUp(p)}}:{},V=p?{onKeyDown:$=>{($.code=="Space"||$.key==" ")&&(C==null||C.simulateKeyDown(p))},onKeyUp:$=>{($.code=="Space"||$.key==" ")&&(C==null||C.simulateKeyUp(p))}}:{},K=((X=T==null?void 0:T[v])==null?void 0:X.position)??{x:0,y:0};return o.jsx(Tt,{nodeRef:G,positionOffset:_,position:K,disabled:!F,onStop:($,q)=>W(v,{position:{x:q.x,y:q.y}}),children:l?o.jsx(Uh,{ref:G,$initialPosition:g,$areItemsDraggable:F,"aria-label":w,...O,...A,...V,children:s}):o.jsx(Nh,{ref:G,$initialPosition:g,$diameter:m,$areItemsDraggable:F,"aria-label":w,...O,...A,...V,children:s})})},zh=(l,m)=>l?m:null,wa=()=>{const{isRunning:l}=Ze(),{emulator:m}=ve(),[,s]=ke(qt),p=R.useCallback(x=>m==null?void 0:m.addCoreCallbacks({saveDataUpdatedCallback:zh(x.saveFileSystemOnInGameSave,()=>{m.fsSync(),x.notificationsEnabled&&Ge.success("Saved File System ")})}),[m]),v=R.useCallback(x=>{s(g=>({...g,...x})),l&&p(x)},[p,l,s]);return{addCallbacks:p,addCallbacksAndSaveSettings:v}},Sa=()=>{const{emulator:l}=ve(),{setIsRunning:m}=Ze(),[,s]=ke(pa),[p]=ke(ma),[v]=ke(fa,1),[x]=ke(ha,1),[g]=ke(qt,{saveFileSystemOnInGameSave:!1,notificationsEnabled:!0}),{addCallbacks:_}=wa();return R.useCallback(w=>{const C=l==null?void 0:l.run(w);return m(!!C),s(w),l==null||l.setVolume(v),C&&(p&&(l==null||l.remapKeyBindings(p)),x>1&&!(l!=null&&l.isFastForwardEnabled())&&(l==null||l.setFastForwardMultiplier(x)),_(g)),!!C},[_,g,v,p,l,x,m,s])},Ca=()=>{const l=Sa(),{isRunning:m,setIsRunning:s}=Ze(),{emulator:p}=ve(),[v]=ke(pa);return R.useCallback(()=>{if(m)p==null||p.quickReload();else if(p!=null&&p.getCurrentGameName()){const g=l(p.filePaths().gamePath+"/"+p.getCurrentGameName());s(!!g)}else if(v){const g=l(v);s(!!g)}},[p,m,s,l,v])};N.div`
  text-align: center;
`;const et=N.p`
  text-align: center;
  margin: 0;
`,Ea=N.h3`
  margin: 0;
`,ka=N.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,ja=N.div`
  padding: 1rem;
  overflow-y: auto;
`,Fa=N.div`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
  border-top: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,Xe=({children:l,className:m})=>o.jsx(ja,{className:m,children:l}),Ke=({children:l})=>o.jsx(Fa,{"data-testid":"modal-footer:wrapper",children:l}),Gh=N.button`
  width: 1em;
  height: 1em;
  padding: 1rem;
  margin: 0 0 0 auto;
  cursor: pointer;
  color: ${({theme:l})=>l.pureBlack};
  border: 0;
  border-radius: 0.25rem;
  opacity: 0.5;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    opacity: 1;
  }

  &:hover {
    opacity: 0.75;
  }

  background: transparent
    url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e")
    center/1em auto no-repeat;
`,Oe=({title:l,showExitIndicator:m=!0})=>{const{setIsModalOpen:s}=Me();return o.jsxs(ka,{children:[o.jsx(Ea,{id:"modalHeader",children:l}),m&&o.jsx(Gh,{"aria-label":"Close",onClick:()=>s(!1)})]})},qh=()=>{const{accessToken:m}=va(),s=R.useCallback(async _=>{const j="undefined/api/save/upload",w=new FormData;w.append("save",(_==null?void 0:_.saveFile)??"");const C={method:"POST",headers:{Authorization:`Bearer ${m}`},body:w},F=await fetch(j,C);if(!F.ok)throw new Error(`Received unexpected status code: ${F.status}`);return F},[void 0,m]),{data:p,isLoading:v,error:x,execute:g}=Ar({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:x,execute:g}},Hh=N.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,Vh=N.p`
  margin: 0;
  color: ${({theme:l})=>l.errorRed};
`,jr=({icon:l,text:m,className:s})=>o.jsxs(Hh,{"data-testid":"error-with-icon",className:s,children:[l,o.jsx(Vh,{children:m})]}),Wh=({errorColor:l,loadingColor:m,respStatus:s,isLoading:p,hasError:v})=>{const x=()=>o.jsx(Bt,{"data-testid":"upload-save-spinner",color:m,cssOverride:{margin:"0 auto"}});let g=null;return p?g=x:v?g=()=>o.jsx(jr,{icon:o.jsx(Sr,{style:{color:l}}),text:"Save file upload has failed"}):s===200?g=()=>o.jsx(et,{children:"Save file upload was successful!"}):g=()=>o.jsx(et,{children:"Are you sure you want to upload your current save file to the server?"}),o.jsx(Xe,{children:o.jsx(g,{})})},Xh=()=>{const l=Pe(),{setIsModalOpen:m}=Me(),{emulator:s}=ve(),p=R.useId(),{data:v,isLoading:x,error:g,execute:_}=qh(),j=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to upload your current save file to the server."}),o.jsx("p",{children:"Remember to save in game before uploading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"Send Save to Server"}),o.jsx(Wh,{errorColor:l.errorRed,loadingColor:l.gbaThemeBlue,isLoading:x,hasError:!!g,respStatus:v==null?void 0:v.status}),o.jsxs(Ke,{children:[o.jsx(pe,{id:p,variant:"contained",onClick:()=>{const w=s==null?void 0:s.getCurrentSave(),C=s==null?void 0:s.getCurrentSaveName();if(w&&C){const F=new Blob([w]),T=new File([F],C);_({saveFile:T})}},children:"Upload"}),o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(vr,{steps:j,completedProductTourStepName:"hasCompletedUploadSaveToServerTour"})]})},Qn=N.p`
  text-align: center;
  vertical-align: middle;
  line-height: 54px;
  color: ${({theme:l})=>l.pureWhite};
  margin: 0;
  font-size: 1.5em;
`,Yr=N.p`
  color: ${({theme:l})=>l.pureWhite};
  margin: 4px 5px;
`,Kh=l=>l.replace("-"," ").replace(/\w\S*/g,m=>m.charAt(0).toUpperCase()+m.substring(1).toLowerCase()),Yh=()=>{var U;const l=Pe(),m=mr(l.isLargerThanPhone),s=mr(l.isMobileWithUrlBar),{emulator:p}=ve(),{isRunning:v}=Ze(),{isAuthenticated:x}=va(),{setModalContent:g,setIsModalOpen:_}=Me(),{layouts:j}=Er(),w=R.useId(),C=Ca(),[F]=ke(ba,0),[T]=ke(_a),W=(U=j==null?void 0:j.controlPanel)==null?void 0:U.initialBounds;if(!W)return null;const G=D=>D===void 0&&!m||!!D,A=G(T==null?void 0:T.OpadAndButtons),O=(T==null?void 0:T.NotificationsEnabled)??!0,V=W.bottom,K=W.left,X={"a-button":{defaultMobile:{top:`calc(${V}px + 12%)`,left:"calc(100dvw - 25px)"},mobileWithUrlBar:{top:`calc(${V}px + 10%)`},largerThanPhone:{top:`calc(${V}px + 35px - 3%)`,left:`calc(${K}px + 450px)`}},"b-button":{defaultMobile:{top:`calc(${V}px + 15%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${V}px + 13%)`},largerThanPhone:{top:`calc(${V}px + 35px)`,left:`calc(${K}px + 375px)`}},"start-button":{defaultMobile:{top:"88dvh",left:"25dvw"},mobileWithUrlBar:{top:"92dvh",left:"50dvw"},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`${K}px`}},"select-button":{defaultMobile:{top:"88dvh",left:"55dvw"},mobileWithUrlBar:{top:"92dvh",left:"75dvw"},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${K}px + 103px)`}},"l-button":{defaultMobile:{top:`${V+15}px`,left:"15px"},largerThanPhone:{top:`calc(${V}px + 15px)`,left:`${K}px`}},"r-button":{defaultMobile:{top:`${V+15}px`,left:"calc(100dvw - 15px)"},largerThanPhone:{top:`calc(${V}px + 15px)`,left:`calc(${K}px + 190px)`}},"quickreload-button":{defaultMobile:{top:`${V+10}px`,left:"135px"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${K}px + 205px)`}},"uploadsave-button":{defaultMobile:{top:`${V+10}px`,left:"calc(100dvw - 135px)"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${K}px + 300px)`}},"loadstate-button":{defaultMobile:{top:`calc(${V}px + 25%)`,left:"calc(100dvw - 40px)"},mobileWithUrlBar:{top:`calc(${V}px + 23%)`},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${K}px + 248px)`}},"savestate-button":{defaultMobile:{top:`calc(${V}px + 27%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${V}px + 25%)`},largerThanPhone:{top:`calc(${V}px + 60px)`,left:`calc(${K}px + 300px)`}},"o-pad":{defaultMobile:{top:`calc(${V}px + 11%)`,left:"10px"},largerThanPhone:{top:`calc(${V}px + 10px)`,left:`calc(${K}px + 450px)`}}},$=D=>{var f,ee,Y,le;let Q;return s&&((f=X[D])!=null&&f.mobileWithUrlBar)?Q=(ee=X[D])==null?void 0:ee.mobileWithUrlBar:m&&((Y=X[D])!=null&&Y.largerThanPhone)&&(Q=(le=X[D])==null?void 0:le.largerThanPhone),{...X[D].defaultMobile,...Q}},q=(D,Q,f)=>{O&&Ge[D?"success":"error"](D?Q:f,{id:w})},M=[{keyId:"A",children:o.jsx(Qn,{children:"A"}),initialPosition:$("a-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"a-button",enabled:A},{keyId:"B",children:o.jsx(Qn,{children:"B"}),initialPosition:$("b-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"b-button",enabled:A},{keyId:"START",isRectangular:!0,children:o.jsx(Yr,{children:"Start"}),initialPosition:$("start-button"),keyName:"start-button",enabled:A},{keyId:"SELECT",isRectangular:!0,children:o.jsx(Yr,{children:"Select"}),initialPosition:$("select-button"),keyName:"select-button",enabled:A},{keyId:"L",isRectangular:!0,children:o.jsx(Yr,{children:"L"}),initialPosition:$("l-button"),keyName:"l-button",enabled:A},{keyId:"R",isRectangular:!0,children:o.jsx(Yr,{children:"R"}),initialPosition:$("r-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"r-button",enabled:A},{children:o.jsx(op,{}),onClick:()=>{C(),!(p!=null&&p.getCurrentGameName())&&O&&Ge.error("Load a game to quick reload",{id:w})},width:40,initialPosition:$("quickreload-button"),keyName:"quickreload-button",enabled:G(T==null?void 0:T.QuickReload)},{children:o.jsx(sp,{}),onClick:()=>{x()&&v?(g(o.jsx(Xh,{})),_(!0)):O&&Ge.error("Please log in and load a game",{id:w})},width:40,initialPosition:$("uploadsave-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"uploadsave-button",enabled:G(T==null?void 0:T.SendSaveToServer)},{children:o.jsx(ip,{}),onClick:()=>{const D=p==null?void 0:p.loadSaveState(F);q(!!D,`Loaded slot: ${F}`,`Failed to load slot: ${F}`)},width:40,initialPosition:$("loadstate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"loadstate-button",enabled:G(T==null?void 0:T.LoadState)},{children:o.jsx(lp,{}),onClick:()=>{const D=p==null?void 0:p.createSaveState(F);q(!!D,`Saved slot: ${F}`,`Failed to save slot: ${F}`)},width:40,initialPosition:$("savestate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"savestate-button",enabled:G(T==null?void 0:T.SaveState)}];return o.jsxs(sa.Provider,{value:{color:l.pureWhite,size:"2em"},children:[A&&o.jsx($h,{initialPosition:$("o-pad")}),M.map(D=>o.jsx(Oh,{ariaLabel:Kh(D.keyName),inputName:D.keyName,...D},D.keyName))]})},Qh={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:400},content:{width:"calc(100dvw - 20px)",height:"fit-content",margin:"25px auto auto auto",backgroundColor:"#fff",inset:"10px",maxWidth:"500px",padding:"0",maxHeight:"90dvh",display:"flex",touchAction:"none",flexDirection:"column",userSelect:"text"}},Jh=()=>{const{modalContent:l,isModalOpen:m,setIsModalOpen:s}=Me(),{emulator:p}=ve();return o.jsx(cp,{appElement:document.getElementById("root")||void 0,closeTimeoutMS:400,isOpen:m,style:Qh,onRequestClose:()=>s(!1),onAfterOpen:p==null?void 0:p.disableKeyboardInput,onAfterClose:p==null?void 0:p.enableKeyboardInput,aria:{labelledby:"modalHeader"},children:l})},pr=250,Zh=N.li`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}
`,ev=N(kr)`
  background-color: unset;
  border: none;
  color: inherit;
  cursor: pointer;
  height: 100%;
  padding: 0.5rem 1rem;
  text-align: inherit;
  width: 100%;

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,rv=N.span`
  margin-left: 0.5rem;
`,tv=N.ul`
  padding-left: 2rem;
`,Ft=({title:l,icon:m,children:s,$isExpanded:p=!1,$disabled:v=!1})=>{const[x,g]=R.useState(p?"auto":0);return R.useEffect(()=>{g(p?"auto":0)},[p]),o.jsxs(Zh,{$disabled:v,children:[o.jsxs(ev,{disabled:v,onClick:()=>{g(x===0?"auto":0)},children:[m,o.jsx(rv,{children:l})]}),o.jsx(dp,{duration:350,easing:"ease-in-out",height:x,children:o.jsx(tv,{children:s})})]})},nv=N.li`
  cursor: pointer;
  color: ${({theme:l})=>l.pureWhite};
  list-style-type: none;
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,av=N(kr)`
  background-color: unset;
  border: none;
  color: inherit;
  height: 100%;
  margin: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};

  text-align: inherit;
  width: 100%;
  cursor: pointer;
`,ov=N.span`
  margin-left: 0.5rem;
`,sv=N.a`
  display: block;
  text-decoration: none;
  color: unset;
  outline-offset: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};
`,Ae=({title:l,icon:m,onClick:s=void 0,$link:p=void 0,$disabled:v=!1,$withPadding:x=!1})=>{const g=o.jsxs(o.Fragment,{children:[m,o.jsx(ov,{children:l})]});return o.jsx(nv,{$disabled:v,children:p?o.jsx(sv,{href:p,$withPadding:x,target:"_blank",children:g}):o.jsx(av,{disabled:v,onClick:s,$withPadding:x,children:g})})},iv=()=>{const{setIsModalOpen:l}=Me(),[,m]=ke(Jt);return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"About"}),o.jsxs(Xe,{children:[o.jsx("p",{children:"Gbajs3 is a full featured Game Boy Advance emulator meant to operate online and offline in the browser."}),o.jsx("p",{children:"We currently support the mGBA core through the use of webassembly."}),o.jsx("p",{children:"Getting Started:"}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Using the ",o.jsx("i",{children:"Pre Game Actions"})," menu, upload a sav file if you have one available"]}),o.jsxs("li",{children:["Then, load a rom of your choice through the ",o.jsx("i",{children:"Upload Rom"})," or"," ",o.jsx("i",{children:"Load Local Rom"})," menu items"]}),o.jsx("li",{children:"Enjoy, your game will boot!"})]})]}),o.jsxs(Ke,{children:[o.jsx(pe,{variant:"contained",onClick:()=>{m({}),l(!1)},children:"Take a tour"}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},La=$t`
  100% {
    stroke-dashoffset: 0;
  }
`,lv=$t`
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
`,cv=$t`
  100% {
    box-shadow: inset 0 0 0 100vh var(--checkmark-fill-color);
  }
`,dv=N.svg`
  position: absolute;
  width: 24px;
  height: 24px;

  display: block;
  margin-left: auto;
  margin-right: auto;
  border-radius: 50%;
  stroke: ${({theme:l})=>l.pureWhite};
  stroke-width: 5;
  stroke-miterlimit: 10;
  animation: ${cv} 0.2s ease-in-out 0.2s forwards,
    ${lv} 0.12s ease-in-out 0.45s both;
`,uv=N.circle`
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 5;
  stroke-miterlimit: 10;
  stroke: ${({theme:l})=>l.checkMarkGreen};
  fill: none;
  animation: ${La} 0.3s cubic-bezier(0.65, 0, 0.45, 1) forwards;
`,fv=N.path`
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: ${La} 0.15s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
`,mv=N.span`
  ${({$isSuccessCheckVisible:l=!1})=>l&&"visibility: hidden;"}
`,Dr=({copy:l,msDuration:m=1100,onClick:s,showSuccess:p=!0,...v})=>{const x=R.useId(),[g,_]=R.useState(!1),j=!!p&&g;return It(()=>_(!1),j?m:null),o.jsxs(pe,{onClick:w=>{_(!0),s==null||s(w)},variant:"contained",...v,children:[j&&o.jsxs(dv,{role:"graphics-symbol","aria-labelledby":x,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52",children:[o.jsx("title",{id:x,children:"Circle Check"}),o.jsx(uv,{cx:"26",cy:"26",r:"25",fill:"none"}),o.jsx(fv,{fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),o.jsx(mv,{$isSuccessCheckVisible:j,children:l})]})},ur=rt.forwardRef(({id:l,label:m,watcher:s,...p},v)=>o.jsx(da,{"data-testid":"managed-checkbox:label",id:l,control:o.jsx(Mr,{ref:v,checked:!!s,...p}),label:m,style:{margin:0}})),pv=N.ul`
  list-style: none;
  display: ${({$shouldHide:l=!1})=>l?"none":"flex"};
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  margin: 0;
  max-width: 100%;
`,hv=N.li`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding-bottom: 10px;
  width: 100%;
`,vv=N(up)`
  min-height: 40px;
  min-width: 40px;
`,gv=N(ia)`
  width: 25px;
  height: 25px;
`,Jn=N.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: ${({$fullWidth:l=!1})=>l?"100%":"auto"};

  @media ${({theme:l})=>l.isLargerThanPhone} {
    flex-direction: row;
  }
`,xv=N.div`
  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: space-between;
`,bv=N.p`
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
  margin-top: ${({$withMargin:l=!1})=>l?"5px":"0"};
`,_v=()=>{var M;const l=Pe(),m=mr(l.isLargerThanPhone),{setIsModalOpen:s}=Me(),{emulator:p}=ve(),[v,x]=R.useState(!1),g=R.useId(),_={desc:"",code:"",enable:!1},[j,w]=R.useMemo(()=>{const U=p==null?void 0:p.getCurrentCheatsFile(),D=new TextDecoder().decode(U);return[D,p==null?void 0:p.parseCheatsString(D)]},[p]),{register:C,control:F,handleSubmit:T,watch:W,setValue:G,formState:{errors:A,isSubmitSuccessful:O}}=Cr({defaultValues:{rawCheats:j,cheats:w!=null&&w.length?w:[_]}}),{fields:V,append:K,remove:X}=fp({control:F,name:"cheats"}),$=R.useCallback(()=>{const U=p==null?void 0:p.getCurrentCheatsFile(),D=new TextDecoder().decode(U),Q=(p==null?void 0:p.parseCheatsString(D))??[];v?G("cheats",Q):G("rawCheats",D)},[p,G,v]),q=[{content:o.jsx("p",{children:"Use this form to enter, add, and delete cheats."}),target:`#${CSS.escape(`${g}--cheats-form`)}`},{content:o.jsx("p",{children:"This form field is for the name of the cheat."}),target:`#${CSS.escape(`${g}--name`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Put your cheat code into this field."}),o.jsx("p",{children:"Remember to separate multi-line cheats with the '+' character!"})]}),target:`#${CSS.escape(`${g}--cheat-code`)}`},{content:o.jsx("p",{children:"Use the checkbox to enable/disable a cheat."}),placement:"right",target:`#${CSS.escape(`${g}--enabled`)}`},{content:o.jsx("p",{children:"Use the trash button to remove a cheat entirely."}),placement:"right",target:`#${CSS.escape(`${g}--remove`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new cheat."]}),target:`#${CSS.escape(`${g}--add-cheat`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Submit"})," button to save your cheats, and convert them to libretro format."]}),target:`#${CSS.escape(`${g}--submit-button`)}`},{content:o.jsx("p",{children:"Use this button to toggle between viewing parsed cheats or raw cheats in libretro file format."}),placement:"right",target:`#${CSS.escape(`${g}--toggle-raw-cheats`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"Manage Cheats"}),o.jsx(Xe,{children:o.jsxs("form",{"aria-label":"Cheats Form",id:`${g}--cheats-form`,onSubmit:T(U=>{const D=v?new File([new Blob([U.rawCheats],{type:"text/plain"})],(p==null?void 0:p.getCurrentCheatsFileName())??"unknown.cheats"):p==null?void 0:p.parsedCheatsToFile(U.cheats);D&&(p==null||p.uploadCheats(D,()=>{p.autoLoadCheats(),$()}))}),children:[o.jsx(fr,{error:!!(A!=null&&A.rawCheats),label:"Raw Libretro Cheats",InputLabelProps:{shrink:!0},multiline:!0,fullWidth:!0,minRows:6,variant:"outlined",InputProps:{sx:{textarea:{whiteSpace:"pre",overflowX:"auto !important"}}},helperText:(M=A==null?void 0:A.rawCheats)==null?void 0:M.message,style:{display:v?"block":"none"},...C("rawCheats")}),o.jsx(pv,{$shouldHide:v,children:V.map((U,D)=>{var f,ee,Y,le,Fe,qe,Ye,er,He,Qe;const Q=oe=>D===0?oe:void 0;return o.jsxs(hv,{children:[o.jsxs(Jn,{$fullWidth:!0,children:[o.jsx(fr,{id:Q(`${g}--name`),label:"Name",error:!!((ee=(f=A==null?void 0:A.cheats)==null?void 0:f[D])!=null&&ee.desc),size:"small",autoComplete:"Name",style:m?{maxWidth:100}:void 0,helperText:(Fe=(le=(Y=A==null?void 0:A.cheats)==null?void 0:Y[D])==null?void 0:le.desc)==null?void 0:Fe.message,...C(`cheats.${D}.desc`,{required:{value:!0,message:"required"}})}),o.jsx(fr,{id:Q(`${g}--cheat-code`),label:"Cheat Code",error:!!((Ye=(qe=A==null?void 0:A.cheats)==null?void 0:qe[D])!=null&&Ye.code),size:"small",autoComplete:"Code",helperText:(Qe=(He=(er=A==null?void 0:A.cheats)==null?void 0:er[D])==null?void 0:He.code)==null?void 0:Qe.message,...C(`cheats.${D}.code`,{required:{value:!0,message:"required"}})})]}),o.jsxs(Jn,{children:[o.jsx(ur,{id:Q(`${g}--enabled`),label:"Enabled",watcher:W(`cheats.${D}.enable`),...C(`cheats.${D}.enable`)}),o.jsx(or,{"aria-label":"Delete",id:Q(`${g}--remove`),sx:{padding:0,marginRight:"auto","&:hover":{borderRadius:"10px"},"&:focus":{borderRadius:"10px"},"& .MuiTouchRipple-root .MuiTouchRipple-child":{borderRadius:"10px"}},onClick:()=>X(D),children:o.jsx(vv,{})})]})]},U.id)})}),o.jsxs(xv,{children:[o.jsx(or,{"aria-label":"Create new cheat",id:`${g}--add-cheat`,sx:{padding:0,display:v?"none":"flex"},onClick:()=>K(_),children:o.jsx(gv,{})}),o.jsx(bv,{$withMargin:v,children:"Join multi-line codes with '+'"})]})]})}),o.jsxs(Ke,{children:[o.jsx(Dr,{copy:"Submit",form:`${g}--cheats-form`,id:`${g}--submit-button`,showSuccess:O,type:"submit"}),o.jsx(pe,{id:`${g}--toggle-raw-cheats`,color:"info",variant:"contained",onClick:()=>x(U=>!U),children:v?"Parsed":"Raw"}),o.jsx(pe,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]}),o.jsx(vr,{steps:q,completedProductTourStepName:"hasCompletedCheatsTour"})]})},yv=N.form`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,wv=({id:l,onAfterSubmit:m})=>{const{emulator:s}=ve(),{isRunning:p}=Ze(),{handleSubmit:v,setValue:x,control:g,formState:{errors:_}}=Cr(),j=s==null?void 0:s.defaultKeyBindings(),[w,C]=ke(ma),F=W=>{const G=Object.entries(W).filter(([,A])=>!!A).map(([,A])=>A);p&&(s==null||s.remapKeyBindings(G)),C(G),m()},T=w??j;return o.jsx(yv,{"aria-label":"Key Bindings Form",id:l,onSubmit:v(F),children:T==null?void 0:T.map(W=>o.jsx(la,{control:g,name:W.gbaInput,defaultValue:W,rules:{validate:{noSpace:G=>G.key!==" "||"Space is reserved for accessibility requirements",noTab:G=>{var A;return((A=G.key)==null?void 0:A.toLowerCase())!=="tab"||"Tab is reserved for accessibility requirements"}}},render:({field:{value:G}})=>{var A;return o.jsx(fr,{variant:"outlined",label:G.gbaInput,value:G.key,onKeyDown:O=>{O.key.toLowerCase()!=="tab"&&(x(G.gbaInput,{gbaInput:G.gbaInput,key:O.key,location:O.location}),O.preventDefault())},error:!!_[W.gbaInput],helperText:(A=_==null?void 0:_[W.gbaInput])==null?void 0:A.message})}},`gba_input_${W.gbaInput.toLowerCase()}`))})},Ra=rt.forwardRef(({id:l,label:m,watcher:s,...p},v)=>o.jsx(da,{"data-testid":"managed-switch:label",id:l,control:o.jsx(Xp,{ref:v,checked:!!s,...p}),label:m,style:{margin:0}})),Sv=N.form`
  display: flex;
  flex-direction: column;
`,Cv=({id:l,onAfterSubmit:m})=>{const[s,p]=ke(_a),v=Pe(),x=mr(v.isLargerThanPhone),g=F=>F===void 0&&!x||!!F,{register:_,handleSubmit:j,watch:w}=Cr({values:s??{OpadAndButtons:g(void 0),SaveState:g(void 0),LoadState:g(void 0),QuickReload:g(void 0),SendSaveToServer:g(void 0),NotificationsEnabled:!0},resetOptions:{keepDirtyValues:!0}}),C=async F=>{p(T=>({...T,...F})),m()};return o.jsxs(Sv,{"aria-label":"Virtual Controls Form",id:l,onSubmit:j(C),children:[o.jsx(ur,{label:"Virtual D-pad/Buttons",watcher:w("OpadAndButtons"),..._("OpadAndButtons")}),o.jsx(ur,{label:"Save State",watcher:w("SaveState"),..._("SaveState")}),o.jsx(ur,{label:"Load State",watcher:w("LoadState"),..._("LoadState")}),o.jsx(ur,{label:"Quick Reload",watcher:w("QuickReload"),..._("QuickReload")}),o.jsx(ur,{label:"Send save to server",watcher:w("SendSaveToServer"),..._("SendSaveToServer")}),o.jsx(Ra,{label:"Enable Notifications",watcher:w("NotificationsEnabled"),..._("NotificationsEnabled")})]})},Ev=N(Kp)`
  border-bottom: 1px solid;
  border-color: rgba(0, 0, 0, 0.12);
`,kv=N.div`
  padding: 24px;
`,Mt=l=>({id:`control-tab-${l}`,"aria-controls":`tabpanel-${l}`}),Zn=({children:l,index:m,value:s})=>o.jsx("div",{role:"tabpanel",hidden:s!==m,id:`tabpanel-${m}`,"aria-labelledby":`tab-${m}`,children:s===m&&o.jsx(kv,{children:l})}),jv=({setFormId:l,virtualControlsFormId:m,keyBindingsFormId:s,resetPositionsButtonId:p,setIsSuccessfulSubmit:v})=>{const{clearLayouts:x}=Er(),[g,_]=R.useState(0),j=(C,F)=>{_(F),l(F===0?m:s),v(!1)},w=()=>v(!0);return o.jsxs(o.Fragment,{children:[o.jsxs(Ev,{value:g,onChange:j,"aria-label":"Control tabs",children:[o.jsx(Kn,{label:"Virtual Controls",...Mt(0)}),o.jsx(Kn,{label:"Key Bindings",...Mt(1)})]}),o.jsxs(Zn,{value:g,index:0,children:[o.jsx(Cv,{id:m,onAfterSubmit:w}),o.jsx(pe,{id:p,sx:{marginTop:"10px"},onClick:x,children:"Reset All Positions"})]}),o.jsx(Zn,{value:g,index:1,children:o.jsx(wv,{id:s,onAfterSubmit:w})})]})},Fv=()=>{const{setIsModalOpen:l}=Me(),m=R.useId(),[s,p]=R.useState(`${m}--virtual-controls-form`),[v,x]=R.useState(!1),g=[{content:o.jsx("p",{children:"Select which virtual controls you wish to enable in this form tab."}),target:`#${CSS.escape(`${m}--virtual-controls-form`)}`},{content:o.jsx("p",{children:"Use this button to reset the positions of the screen, control panel, and all virtual controls."}),target:`#${CSS.escape(`${m}--reset-positions-button`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the tab panel to change which form you are seeing."}),o.jsxs("p",{children:["Select the ",o.jsx("i",{children:"KEY BINDINGS"})," tab above, then click next!"]})]}),placement:"right",target:`#${CSS.escape(Mt(1).id)}`,disableBeacon:!0,disableOverlayClose:!0,hideCloseButton:!1,spotlightClicks:!0},{content:o.jsx("p",{children:"Remap keybindings by selecting a form field and typing your desired input."}),placement:"top-end",target:`#${CSS.escape(`${m}--key-bindings-form`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Save Changes"})," button to persist changes from the current form tab."]}),target:`#${CSS.escape(`${m}--save-changes-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"Controls"}),o.jsx(Xe,{children:o.jsx(jv,{setFormId:p,virtualControlsFormId:`${m}--virtual-controls-form`,keyBindingsFormId:`${m}--key-bindings-form`,resetPositionsButtonId:`${m}--reset-positions-button`,setIsSuccessfulSubmit:x})}),o.jsxs(Ke,{children:[o.jsx(Dr,{copy:"Save Changes",form:s,id:`${m}--save-changes-button`,type:"submit",showSuccess:v}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(vr,{steps:g,completedProductTourStepName:"hasCompletedControlsTour"})]})},Lv=()=>{const l=Pe(),{setIsModalOpen:m}=Me(),{emulator:s}=ve(),p=R.useId(),[v,x]=R.useState(!1),g=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to download your current save file."}),o.jsx("p",{children:"Remember to save in game before downloading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"Download Save"}),o.jsx(Xe,{children:v?o.jsx(jr,{icon:o.jsx(Sr,{style:{color:l.errorRed}}),text:"Load a rom to download its save file"}):o.jsx(et,{children:"Remember to save in game before downloading your save file!"})}),o.jsxs(Ke,{children:[o.jsx(pe,{id:p,variant:"contained",onClick:()=>{const _=s==null?void 0:s.getCurrentSave(),j=s==null?void 0:s.getCurrentSaveName();if(_&&j){const w=new Blob([_],{type:"data:application/octet-stream"}),C=document.createElement("a");C.download=j,C.href=URL.createObjectURL(w),C.click(),C.remove()}else x(!0)},children:"Download"}),o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(vr,{steps:g,completedProductTourStepName:"hasCompletedDownloadSaveTour"})]})},Ta=l=>o.jsx(Ut,{"data-testid":"action-box:minus",className:"minus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})}),Pa=l=>o.jsx(Ut,{"data-testid":"action-box:plus",className:"plus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})}),Rv=l=>o.jsx(Ut,{"data-testid":"action-box:close",className:"close",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})}),Tv=N.div`
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: space-between;

  > p {
    margin: 0;
    word-wrap: break-word;
    max-width: 100%;
  }
`,Pv=N.div`
  display: flex;
  gap: 15px;
`,Mv=Yp(l=>o.jsx(Qp,{...l}))(({theme:l})=>({marginTop:5,[`& .${jt.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${jt.groupTransition}`]:{marginLeft:15,paddingLeft:10,borderLeft:`1px dashed ${Jp(l.palette.text.primary,.4)}`},[`& .${jt.content}`]:{width:"auto",alignItems:"baseline"}})),Av=({id:l,allFiles:m,deleteFile:s,downloadFile:p})=>{if(!m)return null;const v=x=>{const g=x.path.split("/").pop(),_=o.jsxs(Tv,{children:[o.jsx("p",{children:g}),o.jsxs(Pv,{children:[o.jsx(or,{"aria-label":`Download ${g}`,sx:{padding:0,margin:0},onClick:()=>p(x.path),children:o.jsx(ca,{})}),o.jsx(or,{"aria-label":`Delete ${g}`,sx:{padding:0},onClick:()=>s(x.path),children:o.jsx(Nt,{})})]})]});return o.jsx(Mv,{itemId:x.path,label:x.isDir?g:_,children:x.isDir&&x.children?x.children.map(j=>v(j)):null},x.path)};return o.jsx(Zp,{id:l,"aria-label":"File System",defaultExpandedItems:[m.path],slots:{collapseIcon:Ta,endIcon:Rv,expandIcon:Pa},sx:{height:"fit-content"},children:v(m)})},Ma=aa`
  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
  font-weight: 400;
  font-size: 1rem;
  line-height: 1.5;
  letter-spacing: 0.00938em;
`,Dv=N.form`
  display: flex;
  flex-direction: column;

  /* copying styles from the treeitem to match file system display */
  & p {
    ${Ma}
  }
`,Iv=N.p`
  margin: 0;
  ${Ma}
`,Bv=N(kr)`
  display: flex;
  align-items: center;
  gap: 8px;
  background-color: unset;
  border: none;
  color: inherit;
  margin: 0;
`,$v=({id:l})=>{const[m]=ke(qt),{addCallbacksAndSaveSettings:s}=wa(),[p,v]=R.useState(!1),{register:x,handleSubmit:g,watch:_}=Cr({values:m,resetOptions:{keepDirtyValues:!0}});return o.jsxs("div",{id:l,children:[o.jsxs(Bv,{onClick:()=>v(j=>!j),children:[o.jsx(Iv,{children:"Options"}),p?o.jsx(Ta,{}):o.jsx(Pa,{})]}),o.jsx(eh,{in:p,children:o.jsxs(Dv,{"aria-label":"File System Options Form",onSubmit:g(s),children:[o.jsx(ur,{label:"Save file system on in-game save",watcher:_("saveFileSystemOnInGameSave"),...x("saveFileSystemOnInGameSave")}),o.jsx(Ra,{label:"Enable Notifications",watcher:_("notificationsEnabled"),...x("notificationsEnabled")}),o.jsx(pe,{sx:{width:"fit-content"},type:"submit",children:"Save Options"})]})})]})},Nv=N(Xe)`
  display: flex;
  flex-direction: column;
  gap: 1em;
`,Uv=()=>{const{setIsModalOpen:l}=Me(),{emulator:m}=ve(),[s,p]=R.useState(),v=R.useId(),x=R.useCallback(w=>{m==null||m.deleteFile(w),p(m==null?void 0:m.listAllFiles())},[m]),g=w=>{const C=w.split("/").pop(),F=m==null?void 0:m.getFile(w);if(F&&C){const T=new Blob([F],{type:"data:application/octet-stream"}),W=document.createElement("a");W.download=C,W.href=URL.createObjectURL(T),W.click(),W.remove()}},_=s??(m==null?void 0:m.listAllFiles()),j=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to view your current file tree, download files, and delete files from the tree."}),o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," and ",o.jsx("i",{children:"minus"})," icons to open and close file tree branches!"]})]}),target:`#${CSS.escape(`${v}--emulator-file-system`)}`},{content:o.jsxs("p",{children:["Click the ",o.jsx("i",{children:"Options"})," label to adjust and save settings related to the file system."]}),target:`#${CSS.escape(`${v}--file-system-options`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"SAVE FILE SYSTEM"})," button to persist all of your files to your device!"]}),target:`#${CSS.escape(`${v}--save-file-system-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"File System"}),o.jsxs(Nv,{children:[o.jsx(Av,{id:`${v}--emulator-file-system`,allFiles:_,deleteFile:x,downloadFile:g}),o.jsx($v,{id:`${v}--file-system-options`})]}),o.jsxs(Ke,{children:[o.jsx(Dr,{copy:"Save File System",id:`${v}--save-file-system-button`,onClick:m==null?void 0:m.fsSync}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(vr,{steps:j,completedProductTourStepName:"hasCompletedFileSystemTour"})]})},Ov=N.button`
  padding: 0.5rem 0.5rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: none;
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Jr=N.li`
  cursor: pointer;
  display: grid;
  grid-template-columns: auto 32px;
  gap: 10px;

  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
`,zv=N.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Jr}:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Jr}:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Jr}:not(:first-child) {
    border-top-width: 0;
  }
`,Gv=N(ia)`
  width: 25px;
  height: 25px;
`,qv=N(Nt)`
  height: 100%;
  width: 20px;
`,Hv=N.form`
  display: flex;
  justify-content: space-between;
  gap: 16px;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  margin-bottom: 16px;
  padding-bottom: 16px;
`,Vv=()=>{var X,$,q;const l=Pe(),{setIsModalOpen:m}=Me(),{emulator:s}=ve(),[p,v]=R.useState(),[x,g]=R.useState(null),[_,j]=ke(ba,0),w=R.useId(),{register:C,handleSubmit:F,setValue:T,formState:{errors:W,isSubmitSuccessful:G}}=Cr({defaultValues:{saveStateSlot:_}}),A=R.useCallback(()=>{var U;const M=(U=s==null?void 0:s.listSaveStates())==null?void 0:U.filter(D=>D!=="."&&D!=="..");v(M)},[s]);R.useEffect(()=>{T("saveStateSlot",_)},[_,T]);const O=async M=>{j(M.saveStateSlot)},V=p??((X=s==null?void 0:s.listSaveStates())==null?void 0:X.filter(M=>M!=="."&&M!=="..")),K=[{content:o.jsx("p",{children:"Use this input and button to manually update the current save state slot in use."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${w}--save-state-slot-form`)}`},{content:o.jsx("p",{children:"Tap a row to load a save state, or use the trash can icon to delete a save state."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${w}--save-state-list`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new save state. This will automatically increase the current save state number!"]}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${w}--add-state-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"Manage Save States"}),o.jsxs(Xe,{children:[o.jsxs(Hv,{id:`${w}--save-state-slot-form`,onSubmit:F(O),children:[o.jsx(fr,{label:"Current Save State Slot",type:"number",InputLabelProps:{shrink:!0},size:"small",error:!!(W!=null&&W.saveStateSlot),helperText:($=W==null?void 0:W.saveStateSlot)==null?void 0:$.message,...C("saveStateSlot",{required:{value:!0,message:"Slot is required"},min:{value:0,message:"Slot must be >= 0"},valueAsNumber:!0})}),o.jsx(Dr,{copy:"Update Slot",showSuccess:G,size:"small",type:"submit",sx:{maxHeight:"40px"}})]}),o.jsxs(zv,{id:`${w}--save-state-list`,children:[(q=V==null?void 0:V.map)==null?void 0:q.call(V,(M,U)=>o.jsxs(Jr,{children:[o.jsx(Ov,{onClick:()=>{const D=M.split(".").pop(),Q=D==null?void 0:D.replace("ss","");if(Q){const f=parseInt(Q);(s==null?void 0:s.loadSaveState(f))?(j(f),g(null)):g("Failed to load save state")}},children:M}),o.jsx(or,{"aria-label":`Delete ${M}`,sx:{padding:0},onClick:()=>{const D=M.split(".").pop(),Q=D==null?void 0:D.replace("ss","");if(Q){const f=parseInt(Q);s==null||s.deleteSaveState(f),A()}},children:o.jsx(qv,{})})]},`${M}_${U}`)),!(V!=null&&V.length)&&o.jsx("li",{children:o.jsx(et,{children:"No save states"})})]}),o.jsx(or,{id:`${w}--add-state-button`,"aria-label":"Create new save state",sx:{padding:0},onClick:()=>{(s==null?void 0:s.createSaveState(_+1))?(A(),j(U=>U+1),g(null)):g("Failed to create save state")},children:o.jsx(Gv,{})}),x&&o.jsx(jr,{icon:o.jsx(Sr,{style:{color:l.errorRed}}),text:x})]}),o.jsx(Ke,{children:o.jsx(pe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})}),o.jsx(vr,{steps:K,completedProductTourStepName:"hasCompletedSaveStatesTour"})]})},Wv=()=>{const[l,m]=R.useState(0),s=R.useCallback(_=>_?new Promise((j,w)=>{console.log("Reflashing Cartridge...");let C=_.romFile.size;const F=new FileReader;F.onload=T=>{if(T.target&&T.target.result){let W=T.target.result;typeof W=="string"&&(W=new TextEncoder().encode(W));let G=new Uint8Array(W);const A=new XMLHttpRequest;A.open("POST",`${_.esp32IP}/upload_rom_file?cartSize=${C}`,!0),A.upload.onprogress=function(O){if(O.lengthComputable){const V=O.loaded/O.total*67;m(V)}},A.onload=()=>{if(A.status>=200&&A.status<300){const O=new XMLHttpRequest;O.open("POST",`${_.esp32IP}/verify_rom_file?cartSize=${C}`,!0),O.upload.onprogress=function(V){if(V.lengthComputable){const K=67+V.loaded/V.total*33;m(K)}},O.onload=()=>{O.status>=200&&O.status<300?j(!0):w("Rom on cartridge has errors")},O.onerror=()=>w("Failed to upload rom for verification"),O.send(G)}else w("Failed to upload rom to cartridge")},A.onerror=()=>w("Failed to upload rom to cartridge"),A.send(G)}},F.readAsArrayBuffer(_.romFile)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:v,error:x,execute:g}=Ar({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:x,execute:g,progress:l}},Xv=N.div`
  cursor: pointer;
  border-color: ${({theme:l})=>l.blackRussian};
  background-color: ${({$isDragActive:l=!1,theme:m})=>l?m.arcticAirBlue:m.aliceBlue2};
  border-width: 1px;
  border-style: dashed;
  padding: 0.5rem;
  text-align: center;
`,Kv=N(mp)`
  height: 60px;
  width: auto;
`,Yv=N.div`
  padding-top: 3px;
`,Qv=N.ul`
  display: flex;
  flex-direction: column;
  gap: 10px;
  list-style: none;
  margin: 0;
  max-width: 100%;
  padding: 10px 5px 5px 5px;

  > p {
    margin: 0;
  }
`,Jv=N.li`
  align-items: center;
  display: flex;
  gap: 10px;
  justify-content: space-between;

  > p {
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
`,Zv=N.div`
  display: flex;
  gap: 15px;
`,eg=({fileNames:l,onDeleteFile:m})=>o.jsxs(Qv,{children:[o.jsxs("p",{children:["File",l.length>1&&"s"," to upload:"]}),l.map((s,p)=>o.jsxs(Jv,{children:[o.jsx("p",{children:s}),o.jsx(Zv,{children:o.jsx(or,{"aria-label":`Delete ${s}`,sx:{padding:0},onClick:()=>m(s),children:o.jsx(Nt,{})})})]},`${s}_${p}`))]}),rg=(l,m)=>{const s=`.${l.name.split(".").pop()}`;return m.some(p=>typeof p=="string"?p===s:!!p.regex.exec(s))},Lt=l=>typeof l=="string"?l:l.displayText,tg=(l,m)=>{if(!l.length)return;const s=m?"At least one":"One";let p=`${s} `+l.slice(0,-1).map(Lt).join(", ")+`, or ${Lt(l.slice(-1)[0])} file is required`;return l.length==1&&(p=`${s} ${Lt(l[0])} file is required`),v=>!(v instanceof File)||v&&rg(v,l)?null:{message:p,code:hp.FileInvalidType}},ng=({ariaLabel:l,children:m,error:s,hideAcceptedFiles:p,hideErrors:v,id:x,multiple:g=!1,name:_,onDrop:j,validFileExtensions:w})=>{const C=Pe(),[F,T]=R.useState([]),{getRootProps:W,getInputProps:G,isDragActive:A,fileRejections:O}=pp({multiple:g,onDrop:$=>{T($),j($)},validator:tg(w,g)}),V=s?[s]:O.length&&F.length?["Some files were rejected"]:[...new Set(O.flatMap($=>$.errors).map($=>$.message))],K=$=>{const q=F.filter(M=>M.name!==$);T(q),j(q)},X=F.map($=>$.name);return o.jsxs(o.Fragment,{children:[o.jsxs(Xv,{...W({id:x,$isDragActive:A,"aria-label":l}),children:[o.jsx("input",{"data-testid":"hidden-file-input",...G({name:_})}),o.jsx(Kv,{}),m]}),!!X.length&&!p&&o.jsx(eg,{fileNames:X,onDeleteFile:K}),!!V.length&&!v&&o.jsx(Yv,{children:V.map($=>o.jsx(jr,{icon:o.jsx(Sr,{style:{color:C.errorRed}}),text:$},$))})]})},ag=N.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,og=N.p`
  word-wrap: break-word;
  max-width: 100%;
`,sg=[".gba",".gbc",".gb",".zip",".7z"],ig=N.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,lg=({isLoading:l,children:m,indicator:s,progress:p})=>l?o.jsxs(ag,{children:[o.jsx(og,{children:p<4?"Erasing Sectors...":p>67?"Verifying ROM...":"Flashing new ROM to cartridge..."}),s,o.jsx(ig,{progress:p,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(p),"%"]})})]}):m,cg=({esp32IP:l})=>{const m=Pe(),{setIsModalOpen:s}=Me(),{handleSubmit:p,setValue:v,reset:x,control:g}=Cr(),{data:_,isLoading:j,error:w,execute:C,progress:F}=Wv(),T=R.useId(),W=R.useCallback(A=>{x(),v("romFile",A[0],{shouldValidate:!0})},[x,v]),G=async({romFile:A})=>{if(console.log(_),A){await C({romFile:A,esp32IP:l});return}};return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"Upload Rom"}),o.jsx(Xe,{children:o.jsxs(lg,{isLoading:j,indicator:o.jsx(Bt,{color:m.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:F,children:[!!w&&o.jsx(jr,{icon:o.jsx(Sr,{style:{color:m.errorRed}}),text:"Writing rom has failed"}),o.jsx("form",{id:T,"aria-label":"Upload Rom Form",onSubmit:p(G),children:o.jsx(la,{control:g,name:"romFile",rules:{validate:A=>!!A||"A rom file is required"},render:({field:{name:A},fieldState:{error:O}})=>o.jsx(ng,{ariaLabel:"Upload Rom",id:`${T}--drag-and-drop`,onDrop:W,name:A,validFileExtensions:sg,hideErrors:!!O,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})})})]})}),o.jsxs(Ke,{children:[o.jsx(pe,{form:T,type:"submit",variant:"contained",children:"Reflash Repro"}),o.jsx(pe,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]})]})},ar="https://raw.githubusercontent.com/webesp124/gb_data/refs/heads/main",Aa=["FLASH1M_V102","FLASH1M_V103","FLASH_V124","FLASH_V126","FLASH_ECLA","EEPROM_V122","EEPROM_V124","SRAM_V112","SRAM_V113","REPRO_FLASH1M","NONE"],At=l=>(console.log("Save Type: "+l),l[0]=="N"?0:l[0]=="E"?1:l[0]=="S"?3:l[0]=="F"&&l[5]=="1"?5:l[0]=="F"?4:l[0]=="R"&&l[11]=="1"?55:(console.log("Invalid Save Type"),-1)),dg=(l,m)=>{let s=Number(m.cartSize/1024/1024),p="";return s==1?p=l.checksum_1MB:s==2?p=l.checksum_2MB:s==4?p=l.checksum_4MB:s==8?p=l.checksum_8MB:s==16&&(p=l.checksum_16MB),p.toUpperCase()},ug=l=>new Promise(m=>setTimeout(m,l)),fg=async l=>{let m,s;s=null;let p="";try{if(m=await(await fetch(`${l}/get_game_info`,{method:"GET",headers:{"Access-Control-Request-Private-Network":"true"}})).json(),m.romName=="")throw new Error("Error Reading Cartridge, ROM name empty");if(m.is_gba){if(s=await(await fetch(ar+`/information_rom_gba/${m.cartID}.json`)).json(),console.log(s),p=dg(m,s),p!=s.checksum1000){console.log("Checksums do not match. Trying to get a different one...");try{const g=await fetch(ar+`/information_rom_gba/${p}-${m.cartID}.json`);if(!g.ok||g.status!=200)throw new Error(`HTTP error! Status: ${g.status}`);let _=await g.json();_&&Object.keys(_).length>0?(console.log("Additional Data exists"),s=_):console.log("Additional Data does not exist or is empty")}catch(g){console.error("An error occurred while fetching additional data: ",g)}}}else s=await(await fetch(ar+`/information_rom_gb/${m.romName}.json`)).json(),console.log(s),m.checksumStr!=s.global_checksum&&console.log("Checksums do not match. Trying to get a different one...");return[m,s,p]}catch(v){console.error("Error fetching game information:",v)}finally{return[m,s,p]}},mg=(l,m)=>{let s=m.coverImage;return s?s.startsWith("/")?l.is_gba?ar+s.replace("/covers/","/covers_gba/"):ar+s.replace("/covers/","/covers_gb/"):s.startsWith(".")?l.is_gba?ar+s.substring(1).replace("/covers/","/covers_gba/"):ar+s.substring(1).replace("/covers/","/covers_gb/"):s:""},pg=()=>{const[l,m]=R.useState(0),s=R.useCallback(_=>_?new Promise((j,w)=>{const C=new XMLHttpRequest;C.open("GET",_.url,!0),C.responseType="arraybuffer",C.overrideMimeType("text/plain; charset=x-user-defined"),C.onprogress=function(F){if(F.lengthComputable){const T=F.loaded/F.total*100;m(T)}},C.onload=()=>{var F,T;if(C.status>=200&&C.status<300){const W=C.getResponseHeader("Content-Disposition"),G=(T=(F=W==null?void 0:W.split(";").pop())==null?void 0:F.split("=").pop())==null?void 0:T.replace(/"/g,""),A=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.gba"),O=new File([C.response],_.fullName??G??A);if(_.patchFile!=null&&_.patchFile!=""){console.log("applying bps patch to file: "+_.patchFile),_.patchFile.startsWith(".")&&(_.patchFile=ar+_.patchFile.substring(1));const V=new XMLHttpRequest;V.open("GET",_.patchFile,!0),V.responseType="arraybuffer",V.overrideMimeType("text/plain; charset=x-user-defined"),V.onload=()=>{const K=new Uint8Array(V.response),{instructions:X,checksum:$}=vp(K);console.log($);const q=new Uint8Array(C.response),M=gp(X,q),U=new File([M],_.fullName??G??A);j(U)},V.onerror=()=>{console.error("Request for patch file failed"),w(new Error("Network error occurred: Patch File"))},V.send(null)}else console.log("resolved file"),j(O)}else console.error("Request failed2"),w(new Error(`Received unexpected status code: ${C.status}`))},C.onerror=()=>{console.error("Request failed"),w(new Error("Network error occurred"))},C.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:v,error:x,execute:g}=Ar({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:x,execute:g,progress:l}},hg=()=>{const[l,m]=R.useState(0),s=R.useCallback(_=>_?new Promise((j,w)=>{console.log(_.fullName);const C=new XMLHttpRequest;C.open("GET",_.url,!0),C.responseType="arraybuffer",C.overrideMimeType("text/plain; charset=x-user-defined"),C.onprogress=function(F){if(F.lengthComputable){const T=F.loaded/F.total*100;m(T)}},C.onload=()=>{var F,T;if(C.status>=200&&C.status<300){const W=C.getResponseHeader("Content-Disposition"),G=(T=(F=W==null?void 0:W.split(";").pop())==null?void 0:F.split("=").pop())==null?void 0:T.replace(/"/g,""),A=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.sav"),O=new File([C.response],_.fullName??G??A);j(O)}else w(new Error(`Received unexpected status code: ${C.status}`))},C.onerror=()=>{console.error("Request failed"),w(new Error("Network error occurred"))},C.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:v,error:x,execute:g}=Ar({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:v,error:x,execute:g,progress:l}},ea=({gameData:l,checksum1000String:m,selectedSave:s,setSelectedSave:p,saveName:v})=>{var j;const{emulator:x}=ve(),g=w=>{p(w)},_=((j=x==null?void 0:x.listSaves)==null?void 0:j.call(x).filter(w=>w.includes(l.cartID+"_"+m)))||[];return R.useEffect(()=>{for(const w of _)v===w&&p(w)},[]),o.jsx(o.Fragment,{children:o.jsx(Ot,{children:o.jsxs(zt,{children:[o.jsx(ua,{children:o.jsxs(Ce,{children:[o.jsx(ne,{children:"Select"}),o.jsx(ne,{children:"Save"}),o.jsx(ne,{children:"Last Saved"})]})}),o.jsxs(Gt,{children:[o.jsxs(Ce,{children:[o.jsx(ne,{children:o.jsx(Mr,{checked:s==="Cartridge Save",onChange:()=>g("Cartridge Save")})}),o.jsx(ne,{children:"Cartridge Save"}),o.jsx(ne,{children:"-"})]},"cartridge-save"),_.length>0?_.map((w,C)=>{var F;return o.jsxs(Ce,{sx:{borderBottom:C===_.length-1?"none":void 0},children:[o.jsx(ne,{sx:{borderBottom:C===_.length-1?"none":void 0},children:o.jsx(Mr,{checked:s===w,onChange:()=>g(w)})}),o.jsx(ne,{sx:{borderBottom:C===_.length-1?"none":void 0},children:w}),o.jsx(ne,{sx:{borderBottom:C===_.length-1?"none":void 0},children:(F=x==null?void 0:x.getStatSaves)==null?void 0:F.call(x,w).mtime.toLocaleString()})]},C)}):o.jsx(Ce,{children:o.jsx(ne,{colSpan:3,children:"None"})})]})]})})})},Dt=({gameData:l,checksum1000String:m,selectedGame:s,setSelectedGame:p,romName:v})=>{var j,w;const{emulator:x}=ve(),g=C=>{p(C)};let _;return l==null?_=((j=x==null?void 0:x.listRoms)==null?void 0:j.call(x).filter(C=>C!=="."&&C!==".."))||[]:_=((w=x==null?void 0:x.listRoms)==null?void 0:w.call(x).filter(C=>C.includes(l.cartID+"_"+m)))||[],R.useEffect(()=>{for(const C of _)v===C&&p(C)},[]),o.jsx(o.Fragment,{children:o.jsx(Ot,{children:o.jsxs(zt,{children:[o.jsx(ua,{children:o.jsxs(Ce,{children:[o.jsx(ne,{children:"Select"}),o.jsx(ne,{children:"Rom File"}),o.jsx(ne,{children:"Created"})]})}),o.jsxs(Gt,{children:[o.jsxs(Ce,{children:[o.jsx(ne,{children:o.jsx(Mr,{checked:s==="Cartridge Rom",onChange:()=>g("Cartridge Rom")})}),o.jsx(ne,{children:"Cartridge Rom"}),o.jsx(ne,{children:"-"})]},"cartridge-game"),_.length>0?_.map((C,F)=>{var T;return o.jsxs(Ce,{sx:{borderBottom:F===_.length-1?"none":void 0},children:[o.jsx(ne,{sx:{borderBottom:F===_.length-1?"none":void 0},children:o.jsx(Mr,{checked:s===C,onChange:()=>g(C)})}),o.jsx(ne,{sx:{borderBottom:F===_.length-1?"none":void 0},children:C}),o.jsx(ne,{sx:{borderBottom:F===_.length-1?"none":void 0},children:(T=x==null?void 0:x.getStatRoms)==null?void 0:T.call(x,C).mtime.toLocaleString()})]},F)}):o.jsx(Ce,{children:o.jsx(ne,{colSpan:3,children:"None"})})]})]})})})},vg=N.form`
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100dvw;
  max-width: fill-available;
  max-width: stretch;
  max-width: -webkit-fill-available;
  max-width: -moz-available;
`,Zr=N.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,Rt=N.img`
  max-width: 75%;
  height: auto;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid black;
`,gg=N.div`
display: flex;
gap: 10px;
width: 100%;
flex-direction: column;
`,ra=N.p`
  word-wrap: break-word;
  max-width: 100%;
`,xg=N.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,bg=({isLoading:l,isExternalRomLoading:m,children:s,indicator:p,progress:v})=>l?o.jsxs(Zr,{children:[m&&o.jsx(ra,{children:"Dumping Rom from cartridge..."}),!m&&o.jsx(ra,{children:"Dumping Save from cartridge..."}),p,o.jsx(xg,{progress:v,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(v),"%"]})})]}):s,ta=({additionalData:l,setAdditionalData:m,gameData:s,setGameData:p,esp32IP:v,setEsp32IP:x})=>{const g=Pe(),{setIsModalOpen:_}=Me(),{emulator:j}=ve(),{data:w,isLoading:C,error:F,execute:T,progress:W}=pg(),{data:G,execute:A}=hg(),O=Sa(),[V,K]=R.useState(!1),[X,$]=R.useState(!1),q=!C&&!!w,[M,U]=R.useState(null),[D,Q]=R.useState("Cartridge Save"),[f,ee]=R.useState("Cartridge Rom"),Y=oe=>{const{name:ge,value:Ee}=oe.target;m(ce=>({...ce,[ge]:Ee}))};R.useEffect(()=>{if(q){const oe=()=>{O((j==null?void 0:j.filePaths().gamePath)+"/"+w.name)&&_(!1)};j==null||j.uploadRom(w,oe)}},[q,w,j,_,O]);const le=async()=>{try{K(!0);const[oe,ge,Ee]=await fg([v]);p(oe),m(ge),U(Ee),K(!1)}catch(oe){console.error("Error fetching game info:",oe)}};R.useEffect(()=>{G!=null&&(j==null||j.uploadSaveOrSaveState(G))},[G,j]),R.useEffect(()=>{V||le()},[]);const Fe=()=>s.is_gba?l?l.fullName+"_"+s.cartID+"_"+M:s.romName+"_"+s.cartID+"_"+M:l?l.fullName+"_"+s.romName+"_"+s.checksumStr:s.romName+"_"+s.checksumStr,qe=async()=>{$(!0),console.log("Using save: "+D),console.log("Using save: "+D);let oe=Fe()+".sav";D=="Cartridge Save"&&(s.is_gba?await He(l.saveType,oe):s.sramSize&&await Qe(oe)),await ug(300),console.log("save loaded"),await er(),$(!1)},Ye=async oe=>{var Ee;let ge=(Ee=j==null?void 0:j.listRoms)==null?void 0:Ee.call(j);return console.log(ge),ge&&ge.includes(oe)?(console.log("rom exists locally"),O((j==null?void 0:j.filePaths().gamePath)+"/"+oe),_(!1),$(!1),!0):!1},er=async()=>{if($(!0),f!="Cartridge Rom")await Ye(f)||console.log("Unable to load local rom");else if(s.is_gba){let oe=Fe()+".gba",ge=l.cartSize,Ee=`${v}/get_current_game.gba?cartSize=${ge}&saveType=4`;await T({url:new URL(Ee),fullName:oe,patchFile:l.patchFile})}else{let oe=Fe()+".gb",ge=`${v}/get_current_game.gb`;await T({url:new URL(ge),fullName:oe,patchFile:null})}$(!1)},He=async(oe,ge)=>{try{console.log(oe);var Ee=At(oe);if(Ee==-1){console.log("Invalid Save Type");return}console.log(Ee);var ce=`${v}/get_current_save?saveType=${Ee}`;await A({url:new URL(ce),fullName:ge})}catch(Re){console.error("Error fetching save:",Re)}finally{}},Qe=async oe=>{try{var ge=`${v}/get_current_save`;await A({url:new URL(ge),fullName:oe})}catch(Ee){console.error("Error fetching save:",Ee)}finally{}};return o.jsxs(o.Fragment,{children:[s&&l?o.jsx(Oe,{title:l.fullName}):s&&!l?o.jsx(Oe,{title:s.romName==""||s.romName=="Error"?"Error Reading Cartridge":s.romName}):!s&&l?o.jsx(Oe,{title:l.fullName}):o.jsx(Oe,{title:"Connecting to cartridge reader..."}),o.jsx(Xe,{children:o.jsxs(bg,{isLoading:X,isExternalRomLoading:C,indicator:o.jsx(Bt,{color:g.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:W,children:[!!F&&o.jsx(jr,{icon:o.jsx(Sr,{style:{color:g.errorRed}}),text:"Loading rom from URL has failed"}),o.jsxs(o.Fragment,{children:[s&&l&&o.jsxs(o.Fragment,{children:[o.jsx(Zr,{children:o.jsx(Rt,{id:"cover-image",src:mg(s,l),alt:`${l.fullName} Cover`})}),o.jsx(Ot,{id:"game-info",children:o.jsx(zt,{children:o.jsxs(Gt,{children:[o.jsxs(Ce,{children:[o.jsx(ne,{children:"Full Name:"}),o.jsx(ne,{children:l.fullName})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"ROM Name:"}),o.jsx(ne,{children:s.romName})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"Cart Size:"}),o.jsx(ne,{children:o.jsxs(Pt,{name:"cartSize",value:l.cartSize,onChange:Y,children:[o.jsxs(Qr,{value:l.cartSize,children:[(l.cartSize/1024/1024).toFixed(2),"MB"]},(l.cartSize/1024/1024).toFixed(2)),[1,2,4,8,16,32,64].map(oe=>o.jsxs(Qr,{value:oe*1024*1024,children:[oe,"MB"]},oe))]})})]}),s&&s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Save Type:"}),o.jsx(ne,{children:o.jsx(Pt,{name:"saveType",value:l.saveType,onChange:Y,children:Aa.map(oe=>o.jsx(Qr,{value:oe,children:oe},oe))})})]}),l.patchFile!=null&&l.patchFile.length>0&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"BPS Patch File:"})," ",o.jsx(ne,{children:l.patchFile})]}),s&&s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Cart ID:"})," ",o.jsx(ne,{children:s.cartID})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"ROM Version:"})," ",o.jsx(ne,{children:s.romVersion})]}),s&&s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Checksum:"})," ",o.jsxs(ne,{children:["0x",M]})]}),s&&!s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Checksum:"})," ",o.jsxs(ne,{children:["0x",s.checksum_gb]})]}),s&&!s.is_gba&&o.jsxs(Ce,{children:[o.jsx(ne,{children:"Global Checksum:"})," ",o.jsxs(ne,{children:["0x",s.checksumStr]})]}),o.jsxs(Ce,{children:[o.jsx(ne,{children:"Publisher:"})," ",o.jsx(ne,{children:l.publisher})]}),o.jsxs(Ce,{children:[o.jsx(ne,{style:{border:"none"},children:"Release Date:"})," ",o.jsx(ne,{style:{border:"none"},children:l.releaseDate})]})]})})}),j&&o.jsxs(o.Fragment,{children:[o.jsx(wr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Saves"}),s&&s.is_gba&&o.jsx(ea,{gameData:s,checksum1000String:M,selectedSave:D,setSelectedSave:Q,saveName:Fe()+".sav"}),s&&!s.is_gba&&o.jsx(ea,{gameData:s,checksum1000String:s.checksum_gb,selectedSave:D,setSelectedSave:Q,saveName:Fe()+".sav"}),o.jsx(wr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Roms"}),s&&s.is_gba&&o.jsx(Dt,{gameData:s,checksum1000String:M,selectedGame:f,setSelectedGame:ee,romName:Fe()+".gba"}),s&&!s.is_gba&&o.jsx(Dt,{gameData:s,checksum1000String:s.checksum_gb,selectedGame:f,setSelectedGame:ee,romName:Fe()+".gb"})]}),o.jsx(wr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"})]}),!s&&!l&&o.jsx(Zr,{children:o.jsx(Rt,{src:"./img/connect.jpeg",alt:"waiting for cartridge reader response illustration"})}),s&&!l&&(s.romName==""||s.romName=="Error")&&o.jsx(Zr,{children:o.jsx(Rt,{src:"./img/error_cart.jpeg",alt:"can not correctly read cartridge illustration"})})]}),o.jsxs(vg,{"aria-label":"Login Form",children:[o.jsx(fr,{label:"ESP32 IP Address",autoComplete:"esp32IPInputField",variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px"},defaultValue:v,onChange:oe=>{x(oe.target.value)}}),o.jsxs(pe,{variant:"outlined",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"8px"},onClick:()=>{le()},children:[o.jsx(xp,{style:{fontSize:"18px"}})," ","Refresh"]})]})]})}),o.jsx(Ke,{children:!X&&o.jsxs(gg,{children:[s&&l&&o.jsxs(pe,{variant:"contained",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>qe(),children:[o.jsx(bp,{style:{fontSize:"30px",marginRight:"10px"}})," ","Start Game"]}),o.jsx(pe,{variant:"outlined",style:{padding:"10px 20px 10px 20px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>_(!1),children:"Close"})]})})]})},_g=()=>{const{setIsModalOpen:l}=Me(),{emulator:m}=ve(),s=[{label:"Full Name",value:"fullName",setter:"setFullName"},{label:"Cover Image",value:"coverImage",setter:"setCoverImage"},{label:"Publisher",value:"publisher",setter:"setPublisher"},{label:"Release Date",value:"releaseDate",setter:"setReleaseDate"},{label:"CRC",value:"crc",setter:"setCrc"},{label:"Cart Size (Bytes)",value:"cartSize",setter:"setCartSize"},{label:"Save Type",value:"saveType",setter:"setSaveType"},{label:"Checksum 1000",value:"checksum1000",setter:"setChecksum1000"},{label:"Cart ID",value:"cartId",setter:"setCartId"},{label:"Patch File",value:"patchFile",setter:"setPatchFile"},{label:"Console",value:"console",setter:"setConsole"}],[p,v]=R.useState({fullName:"",coverImage:"",publisher:"",releaseDate:"",crc:"",cartSize:"",saveType:"",checksum1000:"",cartId:"",patchFile:"",console:".gba"}),[x,g]=R.useState(""),[_,j]=R.useState(""),[w,C]=R.useState(new Uint8Array);R.useEffect(()=>{x&&V(x)},[x]);const F=X=>{const $=X.target.files[0];if($){j($.name);let q=G($.name).fileName;v(U=>({...U,fullName:q})),v(U=>({...U,patchFile:q+".bps"}));const M=new FileReader;M.onload=U=>{if(U.target&&U.target.result){let D=U.target.result;typeof D=="string"&&(D=new TextEncoder().encode(D)),C(new Uint8Array(D))}},M.readAsArrayBuffer($)}},T=(X,$)=>{v(q=>({...q,[$]:X.target.value}))},W=R.useId();function G(X){const $=X.match(/\.(gb|gbc|gba)$/i);return $?{fileName:X.replace(/\.(gb|gbc|gba)$/i,""),removedExtension:$[0]}:{fileName:X,removedExtension:"gba"}}const A=async X=>{let q=await(await fetch(`./information_rom/${X}.json`)).json();v(M=>({...M,coverImage:q.coverImage})),v(M=>({...M,publisher:q.publisher})),v(M=>({...M,releaseDate:q.releaseDate})),v(M=>({...M,saveType:q.saveType}))},O=()=>{const X={fullName:p.fullName,coverImage:p.coverImage,publisher:p.publisher,releaseDate:p.releaseDate,crc:p.crc,cartSize:p.cartSize,saveType:p.saveType,checksum1000:p.checksum1000,patchFile:"./patches/"+p.patchFile,console:p.console},$=JSON.stringify(X,null,2),q=new Blob([$],{type:"application/json"}),M=document.createElement("a");M.href=URL.createObjectURL(q),M.download=p.checksum1000+"-"+p.cartId+".json",document.body.appendChild(M),M.click(),URL.revokeObjectURL(M.href),document.body.removeChild(M)},V=X=>{const $=X.split("/").pop();if($){v(f=>({...f,console:G($).removedExtension})),v(f=>{var ee;return{...f,cartSize:(ee=m==null?void 0:m.getStatRoms)==null?void 0:ee.call(m,X).size}});const q=/_([A-Z0-9]{1,4})_([A-Z0-9]{1,8})\./,M=$.match(q);if(!M){console.log("No match found");return}const U=M[1],D=M[2];console.log("CartID:",U),console.log("Checksum1000:",D),v(f=>({...f,checksum1000:D})),v(f=>({...f,cartId:U}));const Q=m==null?void 0:m.getFile("/data/games/"+X);if(Q){let f=(_p.buf(Q)>>>0).toString(16).toUpperCase();v(ee=>({...ee,crc:f}))}A(U)}},K=()=>{const X=m==null?void 0:m.getFile("/data/games/"+x),$=w;if(X&&$){const q=yp(X,$),{buffer:M,checksum:U}=wp(q);console.log("Patch Checksum: "+U);const D=new Blob([M],{type:"application/octet-stream"}),Q=document.createElement("a");Q.href=URL.createObjectURL(D),Q.download=p.patchFile,document.body.appendChild(Q),Q.click(),URL.revokeObjectURL(Q.href),document.body.removeChild(Q),O()}};return o.jsxs(o.Fragment,{children:[o.jsx(Oe,{title:"File System"}),o.jsxs(Xe,{children:[o.jsx(wr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Base Rom"}),o.jsx(Dt,{gameData:null,checksum1000String:null,selectedGame:x,setSelectedGame:g,romName:".gba"}),o.jsx(wr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Patched Rom"}),o.jsx("input",{type:"file",onChange:F,accept:".gba"}),_&&o.jsxs("p",{children:["Selected File: ",_]}),o.jsx(wr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Information"}),s.map(X=>X.value!="saveType"?o.jsx(fr,{label:X.label,variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px",width:"98%"},value:p[X.value],onChange:$=>T($,X.value)},X.value):null),o.jsx(rh,{sx:{minWidth:120},children:o.jsxs(th,{fullWidth:!0,style:{padding:"3px 8px 3px 8px",marginLeft:"5px",width:"98%",marginTop:"5px"},children:[o.jsx(nh,{id:"demo-simple-select-label",children:"Save Type"}),o.jsx(Pt,{name:"saveType",value:p.saveType,onChange:X=>T(X,"saveType"),label:"Save Type",style:{fontSize:"14px"},children:Aa.map(X=>o.jsx(Qr,{value:X,children:X},X))})]})})]}),o.jsxs(Ke,{children:[o.jsx(Dr,{copy:"Create Patch File",id:`${W}--create-patch-button-button`,onClick:()=>K()}),o.jsx(pe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},yg=N.div`
  width: ${pr}px;
  height: 100dvh;
  position: fixed;
  background-color: ${({theme:l})=>l.mediumBlack};
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  z-index: 150;
  overflow-y: auto;
  text-align: left;
  left: 0;
  top: 0;
  touch-action: none;
  border-right: 1px solid ${({theme:l})=>l.borderBlue};

  ${({$isExpanded:l=!1})=>!l&&`left: -${pr+5}px;
    `}

  &::-webkit-scrollbar {
    display: none;
  }
`,wg=N.h2`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0.5rem 1rem;
  font-size: calc(1.3rem + 0.6vw);
  font-weight: 500;
  line-height: 1.2;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  border-bottom: 1px solid ${({theme:l})=>l.borderBlue};

  &:hover {
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Sg=N.ul`
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
  margin-top: 0;
  list-style: none;
  padding: 0;
`,Cg=N(kr)`
  background-color: ${({theme:l})=>l.mediumBlack};
  color: ${({theme:l})=>l.pureWhite};
  z-index: 200;
  position: fixed;
  left: ${pr-50}px;
  top: 12px;
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  cursor: pointer;
  padding: 0.05rem 0.3rem;
  border-radius: 0.35rem;
  border: none;
  min-height: 36px;
  min-width: 36px;

  ${({$isExpanded:l=!1})=>!l&&`left: 5px;
    `}

  &:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
`,Eg=N.button`
  position: absolute;
  width: calc(100dvw - ${pr}px);
  left: ${pr}px;
  height: 99%;
  background: 0 0;
  z-index: 140;
  border: none;
`,kg=()=>{const[l,m]=R.useState(!0),{setModalContent:s,setIsModalOpen:p}=Me(),{canvas:v,emulator:x}=ve(),{isRunning:g}=Ze(),_=Pe(),j=mr(_.isLargerThanPhone),w=R.useId(),C=Ca(),[F,T]=R.useState(null),[W,G]=R.useState(null),A="https://192.168.1.3",[O,V]=R.useState(A);return R.useEffect(()=>{const X=new URLSearchParams(window.location.search).get("esp32_ip");X&&V("https://"+X);const $=setTimeout(()=>{console.log("run12"),s(o.jsx(ta,{additionalData:F,setAdditionalData:T,gameData:W,setGameData:G,esp32IP:O,setEsp32IP:V})),p(!0)},500);return()=>clearTimeout($)},[F,W,O]),o.jsxs(o.Fragment,{children:[o.jsx(Cg,{id:"menu-btn",$isExpanded:l,onClick:()=>m(K=>!K),"aria-label":"Menu Toggle",children:o.jsx(Sp,{style:{height:"1.8em",width:"1.8em",verticalAlign:"middle"}})}),o.jsxs(yg,{"data-testid":"menu-wrapper",id:"menu-wrapper",$isExpanded:l,children:[o.jsx(wg,{id:w,children:"WifiBOY"}),o.jsxs(Sg,{"aria-labelledby":w,children:[o.jsx(Ae,{title:"My Cartridge",icon:o.jsx(Et,{}),$withPadding:!0,onClick:()=>{s(o.jsx(ta,{additionalData:F,setAdditionalData:T,gameData:W,setGameData:G,esp32IP:O,setEsp32IP:V})),p(!0)}}),o.jsxs(Ft,{title:"Cartridge Actions",$isExpanded:!0,icon:o.jsx(Cp,{}),children:[o.jsx(Ae,{title:"Save to Cartridge",$disabled:!g,icon:o.jsx(Ep,{}),onClick:()=>{const K=x==null?void 0:x.getCurrentSave(),X=x==null?void 0:x.getCurrentSaveName();if(K&&X){const q=new XMLHttpRequest;if(!F){console.log("No save type information.");return}var $=At(F.saveType);if($==-1){console.log("Invalid Save Type");return}console.log($);const M=new Promise((U,D)=>{q.open("POST",`${O}/upload_save_file?saveType=${$}`,!0),q.onload=()=>{if(q.status>=200&&q.status<300){const Q=new XMLHttpRequest;Q.open("POST",`${O}/verify_save_file?saveType=${$}`,!0),Q.onload=()=>{Q.status>=200&&Q.status<300?U("Uploaded  and verified save on cartridge"):D("Save on cartridge has errors")},Q.onerror=()=>D("Failed to upload save for verification"),Q.send(K)}else D("Failed to upload save to cartridge")},q.onerror=()=>D("Failed to upload save to cartridge"),q.send(K)});Ge.promise(M,{loading:"Uploading save to cartridge...",success:U=>`${U}`,error:U=>`${U}`})}else Ge.error("Current save not available")}}),o.jsx(Ae,{title:"Verify Cartridge Save",$disabled:!g,icon:o.jsx(kp,{}),onClick:()=>{let K=x==null?void 0:x.getCurrentSave();const X=x==null?void 0:x.getCurrentSaveName();if(K&&X){K.length>131072&&(K=K.slice(0,131072));const q=new XMLHttpRequest;if(!F){console.log("No save type information.");return}var $=At(F.saveType);if($==-1){console.log("Invalid Save Type");return}const M=new Promise((U,D)=>{q.open("POST",`${O}/verify_save_file?saveType=${$}`,!0),q.upload.onprogress=function(Q){if(Q.lengthComputable){const f=67+Q.loaded/Q.total*33;console.log(f+"( "+Q.loaded+" )")}else console.log("event.lengthComputable is false")},q.onload=()=>{q.status>=200&&q.status<300?U("Verified save on cartridge"):D("Save on cartridge is not the same.")},q.onerror=()=>D("Failed to upload save"),q.send(K)});Ge.promise(M,{loading:"Verifying save on cartridge...",success:U=>`${U}`,error:U=>`${U}`})}else Ge.error("Current save not available")}}),o.jsx(Ae,{title:"Reflash Cartridge Rom",icon:o.jsx(jp,{}),onClick:()=>{s(o.jsx(cg,{esp32IP:O})),p(!0)}})]}),o.jsxs(Ft,{title:"In Game Actions",$disabled:!g,$isExpanded:g,icon:o.jsx(Fp,{}),children:[o.jsx(Ae,{title:"Screenshot",$disabled:!g,icon:o.jsx(Lp,{}),onClick:()=>{x!=null&&x.screenshot()?Ge.success("Screenshot saved successfully"):Ge.error("Screenshot has failed")}}),o.jsx(Ae,{title:"Full Screen",$disabled:!g,icon:o.jsx(Rp,{}),onClick:()=>{v==null||v.requestFullscreen().catch(()=>{Ge.error("Full screen request has failed")})}}),o.jsx(Ae,{title:"Download Save",$disabled:!g,icon:o.jsx(ca,{}),onClick:()=>{s(o.jsx(Lv,{})),p(!0)}}),o.jsx(Ae,{title:"Quick Reload",$disabled:!g,icon:o.jsx(Tp,{}),onClick:C}),o.jsx(Ae,{title:"Manage Save States",$disabled:!g,icon:o.jsx(Pp,{}),onClick:()=>{s(o.jsx(Vv,{})),p(!0)}}),o.jsx(Ae,{title:"Manage Cheats",$disabled:!g,icon:o.jsx(Mp,{}),onClick:()=>{s(o.jsx(_v,{})),p(!0)}})]}),o.jsx(Ae,{title:"Controls",icon:o.jsx(Et,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Fv,{})),p(!0)}}),o.jsx(Ae,{title:"File System",icon:o.jsx(Ap,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Uv,{})),p(!0)}}),o.jsxs(Ft,{title:"Other",icon:o.jsx(Dp,{}),children:[o.jsx(Ae,{title:"Create Patch File",icon:o.jsx(Et,{}),$withPadding:!0,onClick:()=>{s(o.jsx(_g,{})),p(!0)}}),o.jsx(Ae,{title:"About",icon:o.jsx(Ip,{}),$withPadding:!0,onClick:()=>{s(o.jsx(iv,{})),p(!0)}})]})]}),o.jsx(Bp,{style:{color:"white",bottom:"15px",position:"absolute",fontSize:"24px",right:"15px"}}),o.jsx($p,{style:{color:"white",bottom:"15px",position:"absolute",fontSize:"24px",right:"45px"}}),o.jsx(Np,{style:{color:"white",bottom:"15px",position:"absolute",fontSize:"24px",right:"75px"}}),o.jsx(Up,{style:{color:"white",bottom:"15px",position:"absolute",fontSize:"24px",right:"105px"}})]}),l&&!j&&o.jsx(Eg,{"aria-label":"Menu Dismiss",onClick:()=>{m(!1)}})]})};N.ul`
  text-align: left;
`;const jg=()=>!0,Fg=()=>{const[l]=ke(Jt);return l!=null&&l.hasCompletedProductTourIntro,o.jsx(Op,{})},Lg=240,Rg=160,Tg=N.canvas`
  background-color: ${({theme:l})=>l.pureBlack};
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -moz-crisp-edges;
  image-rendering: -o-crisp-edges;
  width: 100%;
  height: 100%;
  display: block;
  margin: 0 auto;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`,Pg=N(oa)`
  background-color: ${({theme:l})=>l.pureBlack};
  border: solid 1px ${({theme:l})=>l.pureBlack};
  overflow: visible;
  width: 100dvw;
  height: calc(100dvw * 2 / 3);

  @media ${({theme:l})=>l.isLargerThanPhone} {
    width: min(
      calc(100dvw - ${pr+35}px),
      calc(85dvh * 3 / 2)
    );
    height: 85dvh;
  }
`,Mg={width:"",height:""},Ag=()=>{var G,A;const l=Pe(),m=mr(l.isLargerThanPhone),{setCanvas:s}=ve(),{areItemsDraggable:p}=tt(),{areItemsResizable:v}=ga(),{layouts:x,setLayout:g,hasSetLayout:_}=Er(),j=m?pr+10:0,w=m?15:0,C=R.useCallback(O=>{var V,K,X,$,q,M,U,D;_||((X=(K=(V=O==null?void 0:O.resizableElement)==null?void 0:V.current)==null?void 0:K.style)==null||X.removeProperty("width"),(M=(q=($=O==null?void 0:O.resizableElement)==null?void 0:$.current)==null?void 0:q.style)==null||M.removeProperty("height")),!((U=x==null?void 0:x.screen)!=null&&U.initialBounds)&&O&&g("screen",{initialBounds:(D=O.resizableElement.current)==null?void 0:D.getBoundingClientRect()})},[_,x,g]),F=R.useCallback(O=>s(O),[s]),T=((G=x==null?void 0:x.screen)==null?void 0:G.position)??{x:j,y:w},W=((A=x==null?void 0:x.screen)==null?void 0:A.size)??Mg;return o.jsx(Pg,{"data-testid":"screen-wrapper",disableDragging:!p,ref:C,enableResizing:v,resizeHandleComponent:{topRight:o.jsx(yr,{variation:"topRight"}),bottomRight:o.jsx(yr,{variation:"bottomRight"}),bottomLeft:o.jsx(yr,{variation:"bottomLeft"}),topLeft:o.jsx(yr,{variation:"topLeft"})},resizeHandleStyles:{topRight:{marginTop:"15px",marginRight:"15px"},bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"},topLeft:{marginTop:"15px",marginLeft:"15px"}},position:T,size:W,onDragStop:(O,V)=>{g("screen",{position:{x:V.x,y:V.y}})},onResizeStop:(O,V,K,X,$)=>{g("screen",{size:{width:K.clientWidth,height:K.clientHeight},position:{...$}})},children:o.jsx(Tg,{"data-testid":"screen-wrapper:render-canvas",ref:F,width:Lg,height:Rg})})},Dg=N.div`
  background-color: #fff;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  height: fit-content;
  inset: 10px;
  margin: 25px auto auto;
  padding-top: 25px;
  max-height: 80%;
  max-width: calc(100dvw - 20px);
  padding: 0;
  touch-action: none;
  user-select: text;
  width: fit-content;

  @media ${({theme:l})=>l.isLargerThanPhone} {
    max-width: 600px;
  }
`,Ig=N.div`
  background-color: rgba(0, 0, 0, 0.5);
  width: 100dvw;
  height: 100dvh;
  position: absolute;
`,Bg=N(ka)`
  justify-content: center;
`,$g=N(ja)`
  padding: 1em 1em 0 1em;
`,Ng=N.img`
  object-fit: contain;
  max-width: 100%;
`,Ug=N(Fa)`
  justify-content: center;
  flex-wrap: wrap;
`,Og=N.div`
  position: relative;
`,zg=N.a`
  font-size: 5px;
  position: absolute;
  right: 15%;
  bottom: 6%;
`,na=()=>o.jsx("span",{children:""}),Gg=({error:l,resetErrorBoundary:m})=>o.jsx(Ig,{children:o.jsxs(Dg,{role:"alert",children:[o.jsx(Bg,{children:o.jsx(Ea,{children:"An irrecoverable error occurred"})}),o.jsxs($g,{children:[o.jsxs(Og,{children:[o.jsx(Ng,{src:"/img/error-512x512.png",alt:"GameBoy Advance with error icon"}),o.jsx(zg,{target:"_blank",href:"https://www.freepik.com/free-vector/editable-text-effect-error-3d-hack-virus-font-style_21408324.htm",children:"Font by NACreative"})]}),o.jsx("p",{style:{color:"red"},children:l.message}),o.jsx("p",{children:"Please use the buttons below to copy the stack trace and create an issue, this helps a lot with error reporting!"})]}),o.jsxs(Ug,{children:[o.jsx(pe,{color:"info",variant:"contained",onClick:()=>{navigator.clipboard.writeText(l.stack??"No stack available")},children:"Copy trace"}),o.jsx(na,{}),o.jsx(pe,{color:"success",variant:"contained",href:"https://github.com/thenick775/gbajs3/issues",target:"_blank",children:"Create issue"}),o.jsx(na,{}),o.jsx(pe,{color:"secondary",variant:"contained",onClick:m,children:"Dismiss and reset"})]})]})}),qg=({children:l})=>o.jsx(zp,{fallbackRender:Gg,children:l}),Hg=()=>{const l=Pe();return o.jsx(Gp,{toastOptions:{success:{duration:1e3},error:{duration:1500},style:{background:l.darkCharcoal,color:l.pureWhite}}})},Vg=({children:l})=>o.jsx(uh,{children:o.jsx(mh,{children:o.jsx(sh,{children:o.jsx(fh,{children:l})})})}),Wg={isLargerThanPhone:"only screen and (min-width: 600px)",isMobileLandscape:"only screen and (max-height: 1000px) and (max-width: 1000px) and (orientation: landscape)",isMobilePortrait:"only screen and (max-width: 1000px) and (orientation: portrait)",isMobileWithUrlBar:"only screen and (max-height: 700px) and (orientation: portrait)",aliceBlue1:"#f8f9fa",aliceBlue2:"#edf2f7",arcticAirBlue:"#cad8e5",blackRussian:"#1a202c",blueCharcoal:"rgb(15 23 42)",checkMarkGreen:"#7ac142",darkCharcoal:"#333",darkGrayBlue:"#495057",disabledGray:"#6c757d",errorRed:"#d32f2f",gbaThemeBlue:"#0d6efd",mediumBlack:"rgb(2 6 23)",menuHighlight:"#ffffff26",menuHover:"#0a58ca",pattensBlue:"#dee2e6",pureBlack:"#000",pureWhite:"#fff",darkGray:"#111",panelControlGray:"#a9a9a9",panelBlueGray:"rgb(30 41 59)",borderBlue:"rgb(15 23 42)"},Xg=()=>o.jsx(qp,{theme:Wg,children:o.jsxs(qg,{children:[o.jsx(jg,{}),o.jsx(Hg,{}),o.jsx(Fg,{}),o.jsx(oh,{children:o.jsx(Vg,{children:o.jsx(vh,{children:o.jsxs(gh,{children:[o.jsx(kg,{}),o.jsx(Ag,{}),o.jsx(Th,{}),o.jsx(Yh,{}),o.jsx(Jh,{})]})})})})]})});Hp.createRoot(document.getElementById("root")).render(o.jsx(rt.StrictMode,{children:o.jsx(Xg,{})}));
