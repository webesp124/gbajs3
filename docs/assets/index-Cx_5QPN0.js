import{r as T,z as Mm,A as Pt,j as o,B as Fe,D as Dm,E as D,q as et,F as Pe,H as Am,I as Bm,J as Zn,K as ea,L as Im,M as $m,N as Nm,O as Nn,Q as Un,S as Um,U as Om,V as Gm,W as zm,X as Lt,Y as ur,Z as Mt,$ as qm,a0 as Qe,a1 as Vm,a2 as Hm,a3 as Wm,a4 as Xm,a5 as Km,a6 as Dt,a7 as Ym,a8 as ra,a9 as hr,aa as Qm,ab as rt,ac as ta,ad as At,ae as Ft,af as Jm,ag as Zm,ah as ep,ai as rp,aj as tp,ak as np,al as ap,am as On,an as op,ao as Gn,ap as sp,aq as ip,ar as lp,as as cp,at as dp,au as up,av as fp,aw as mp,ax as pp,ay as hp,az as vp,aA as gp,aB as xp,aC as bp,aD as _p,aE as yp}from"./vendor-B7BwmGTK.js";import{S as Et,c as wp}from"./vendor_react-joyride-CppJfDYL.js";import{u as fr,S as Sp,I as sr,B as fe,F as na,C as Rr,T as dr,a as Ep,b as Cp,c as zn,d as Bt,s as kp,e as jp,t as Ct,f as Lp,g as Fp,D as Yr,h as aa,i as oa,j as sa,k as or,l as ye,m as ia}from"./vendor_@mui-D829ocsU.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))p(b);new MutationObserver(b=>{for(const x of b)if(x.type==="childList")for(const v of x.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&p(v)}).observe(document,{childList:!0,subtree:!0});function s(b){const x={};return b.integrity&&(x.integrity=b.integrity),b.referrerPolicy&&(x.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?x.credentials="include":b.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function p(b){if(b.ep)return;b.ep=!0;const x=s(b);fetch(b.href,x)}})();const la="currentEmulatorVolume",ca="currentEmulatorKeyBindings",da="currentGameName",ua="currentFastForward",Pr=({fetchFn:l,loadOnMount:m=!1,clearDataOnLoad:s=!1})=>{const[p,b]=T.useState(null),[x,v]=T.useState(null),[_,k]=T.useState(!1),w=()=>v(null),S=T.useCallback(async L=>{k(!0),v(null),s&&b(null);try{const R=await l(L);b(R),k(!1)}catch(R){v(R),k(!1)}},[s,l]);return T.useEffect(()=>{m&&l&&S()},[]),{data:p,isLoading:_,error:x,clearError:w,execute:S}},Rp=({loadOnMount:l=!1}={})=>{const s=T.useCallback(async()=>(await fetch("undefined/api/tokens/refresh",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).json(),[void 0]),{data:p,isLoading:b,error:x,clearError:v,execute:_}=Pr({fetchFn:s,clearDataOnLoad:!0,loadOnMount:l});return{data:p,isLoading:b,error:x,clearError:v,execute:_}},It=T.createContext(null);It.displayName="AuthContext";const Tp=({children:l})=>{const[p,b]=T.useState(null),[x,v]=T.useState(null),{data:_,isLoading:k,execute:w,error:S,clearError:L}=Rp({loadOnMount:!1}),R=!k&&!!_;T.useEffect(()=>{R&&(b(_),v("refresh"))},[R,_]);const N=T.useCallback(()=>{if(p){const{exp:B}=Mm(p);if(B&&Date.now()<=B*1e3)return!0}return!1},[p]),O=N()&&!_&&x!=="refresh";return T.useEffect(()=>{O&&L()},[O,L]),Pt(async()=>{await w()},N()&&!S?24e4:null),o.jsx(It.Provider,{value:{accessToken:p,setAccessToken:b,setAccessTokenSource:v,isAuthenticated:N},children:l})},$t=T.createContext(null);$t.displayName="DragContext";const Pp=({children:l})=>{const[m,s]=T.useState(!1);return o.jsx($t.Provider,{value:{areItemsDraggable:m,setAreItemsDraggable:s},children:l})},Xe=0,Mp=3,Dp=l=>{const m=l.filePaths(),s=(_,k)=>{var S,L;let w=(S=_==null?void 0:_.split("/"))==null?void 0:S.pop();if(k){const R="."+((L=w==null?void 0:w.split("."))==null?void 0:L.pop());w=w==null?void 0:w.replace(R,k)}return w},p=()=>{const _={path:m.root,isDir:!0,children:[]},k=[".",".."],w=({path:S,children:L})=>{for(const R of l.FS.readdir(S)){if(k.includes(R))continue;const N=`${S}/${R}`,{mode:O}=l.FS.lookupPath(N,{}).node,B={path:N,isDir:l.FS.isDir(O),children:[]};L==null||L.push(B),B.isDir&&w(B)}};return w(_),_},b=_=>{var R;const k=_.split(`
`),w=["cheats = ",""];if(!((R=k==null?void 0:k[0])!=null&&R.match("^cheats = [0-9]+$")))return[];const S={},L={desc:"desc",code:"code",enable:"enable"};for(const N of k){if(w.includes(N))continue;const O=N.match(/^cheat([0-9]+)_([a-zA-Z]+)\s*=\s*"?([a-zA-Z0-9\s+:_]+)"?$/);if(O){const[,B,W,z]=O,Y=L[W];S[B]=S[B]||{desc:"",code:"",enable:!1},Y&&(S[B][Y]=Y===L.enable?z.toLowerCase()==="true":z)}}return Object.values(S)},x=_=>{const k=_.map((L,R)=>`cheat${R}_desc = "${L.desc}"
cheat${R}_enable = ${L.enable}
cheat${R}_code = "${L.code}"
`),w=`cheats = ${k==null?void 0:k.length}

`,S=s(l.gameName,".cheats");if(k!=null&&k.length&&S){const L=w+k.join(`
`),R=new Blob([L],{type:"text/plain"});return new File([R],S)}return null},v=({key:_,location:k})=>{let w=k===Mp?`Keypad ${_}`:_;return w.toLowerCase().includes("enter")&&(w=w.replace(/enter/gi,"Return")),w.toLowerCase().includes("arrow")&&(w=w.replace(/arrow/gi,"")),w};return{autoLoadCheats:l.autoLoadCheats,createSaveState:l.saveState,defaultKeyBindings:()=>[{gbaInput:"A",key:"X",location:Xe},{gbaInput:"B",key:"Z",location:Xe},{gbaInput:"L",key:"A",location:Xe},{gbaInput:"R",key:"S",location:Xe},{gbaInput:"Start",key:"Enter",location:Xe},{gbaInput:"Select",key:"Backspace",location:Xe},{gbaInput:"Up",key:"ArrowUp",location:Xe},{gbaInput:"Down",key:"ArrowDown",location:Xe},{gbaInput:"Left",key:"ArrowLeft",location:Xe},{gbaInput:"Right",key:"ArrowRight",location:Xe}],loadSaveState:l.loadState,listSaveStates:()=>l.FS.readdir(m.saveStatePath),listRoms:()=>l.FS.readdir(m.gamePath),listSaves:()=>l.FS.readdir(m.savePath),getStatSaves:_=>l.FS.stat("/data/saves/"+_),getStatRoms:_=>l.FS.stat("/data/games/"+_),setVolume:async _=>{(l.SDL2.audioContext.state==="suspended"||l.SDL2.audioContext.state==="interrupted")&&await l.SDL2.audioContext.resume(),l.setVolume(_)},getVolume:l.getVolume,enableKeyboardInput:()=>l.toggleInput(!0),disableKeyboardInput:()=>l.toggleInput(!1),simulateKeyDown:l.buttonPress,simulateKeyUp:l.buttonUnpress,setFastForwardMultiplier:l.setFastForwardMultiplier,isFastForwardEnabled:()=>l.getFastForwardMultiplier()>1,run:l.loadGame,getCurrentRom:()=>l.gameName?l.FS.readFile(l.gameName):null,getCurrentGameName:()=>s(l.gameName),setCurrentGameName:_=>{_&&!l.gameName&&(l.gameName=_)},getCurrentSave:()=>l.saveName?l.getSave():null,getCurrentSaveName:()=>s(l.saveName),getFile:_=>l.FS.readFile(_),uploadCheats:l.uploadCheats,uploadRom:l.uploadRom,uploadSaveOrSaveState:l.uploadSaveOrSaveState,deleteSaveState:_=>{const k=s(l.saveName,".ss"+_),w=`${m.saveStatePath}/${k}`;l.FS.unlink(w)},deleteFile:l.FS.unlink,pause:l.pauseGame,resume:l.resumeGame,quitGame:l.quitGame,quitEmulator:l.quitMgba,quickReload:l.quickReload,getCurrentCheatsFile:()=>{const _=s(l.gameName,".cheats"),k=`${m.cheatsPath}/${_}`;return l.FS.analyzePath(k).exists?l.FS.readFile(k):new Uint8Array},getCurrentCheatsFileName:()=>s(l.gameName,".cheats"),screenshot:l.screenshot,remapKeyBindings:_=>_.forEach(k=>l.bindKey(v(k),k.gbaInput)),filePaths:l.filePaths,fsSync:l.FSSync,listAllFiles:p,parseCheatsString:b,parsedCheatsToFile:x}};var Ap=(()=>{var l=import.meta.url;return function(m={}){var s=m,p,b;s.ready=new Promise((e,r)=>{p=e,b=r}),s.loadGame=e=>{if(de("loadGame","number",["string"])(e)){const t=e.split(".");t.pop();const n=t.join(".")+".sav";return s.gameName=e,s.saveName=n.replace("/data/games/","/data/saves/"),!0}return!1},s.getSave=()=>c.readFile(s.saveName),s.listRoms=()=>c.readdir("/data/games/"),s.listSaves=()=>c.readdir("/data/saves/"),s.FSInit=()=>new Promise((e,r)=>{c.mkdir("/data"),c.mount(c.filesystems.IDBFS,{},"/data"),c.syncfs(!0,t=>{t&&r(new Error(`Error syncing app data from IndexedDB: ${t}`));try{c.mkdir("/data/saves")}catch{}try{c.mkdir("/data/states")}catch{}try{c.mkdir("/data/games")}catch{}try{c.mkdir("/data/cheats")}catch{}try{c.mkdir("/data/screenshots")}catch{}e()})}),s.FSSync=()=>new Promise((e,r)=>{c.syncfs(t=>{t&&r(new Error(`Error syncing app data to IndexedDB: ${t}`)),e()})}),s.filePaths=()=>({root:"/data",cheatsPath:"/data/cheats",gamePath:"/data/games",savePath:"/data/saves",saveStatePath:"/data/states",screenshotsPath:"/data/screenshots"}),s.uploadSaveOrSaveState=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="sav")a="/data/saves/";else if(n.startsWith("ss"))a="/data/states/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadRom=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(["gba","gbc","gb","zip","7z"].includes(n))a="/data/games/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)},s.uploadCheats=(e,r)=>{const t=e.name.split(".");if(t.length<2){console.warn("unrecognized file extension: "+e.name);return}const n=t[t.length-1].toLowerCase();let a=null;if(n=="cheats")a="/data/cheats/";else{console.warn("unrecognized file extension: "+n);return}const i=new FileReader;i.onload=d=>{c.writeFile(a+e.name,new Uint8Array(d.target.result)),r&&r()},i.readAsArrayBuffer(e)};const x=new Map([["a",0],["b",1],["select",2],["start",3],["right",4],["left",5],["up",6],["down",7],["r",8],["l",9]]);s.buttonPress=e=>{de("buttonPress",null,["number"])(x.get(e.toLowerCase()))},s.buttonUnpress=e=>{de("buttonUnpress",null,["number"])(x.get(e.toLowerCase()))},s.bindKey=(e,r)=>{de("bindKey",null,["string","number"])(e,x.get(r.toLowerCase()))},s.pauseGame=()=>{de("pauseGame",null,[])()},s.resumeGame=()=>{de("resumeGame",null,[])()},s.getVolume=()=>de("getVolume","number",[])(),s.setVolume=e=>{de("setVolume",null,["number"])(e)},s.getMainLoopTimingMode=()=>de("getMainLoopTimingMode","number",[])(),s.getMainLoopTimingValue=()=>de("getMainLoopTimingValue","number",[])(),s.setMainLoopTiming=(e,r)=>{de("setMainLoopTiming","number",["number","number"])(e,r)},s.quitGame=()=>{de("quitGame",null,[])()},s.quitMgba=()=>{de("quitMgba",null,[])()},s.quickReload=()=>{de("quickReload",null,[])()},s.toggleInput=e=>{de("setEventEnable",null,["boolean"])(e)},s.screenshot=e=>de("screenshot","boolean",["string"])(e),s.saveState=e=>de("saveState","boolean",["number"])(e),s.loadState=e=>de("loadState","boolean",["number"])(e),s.saveStateSlot=(e,r)=>{var t=de("saveStateSlot","number",["number","number"]);return s.saveStateSlot=(n,a)=>(a===void 0&&(a=63),t(n,a)),s.saveStateSlot(e,r)},s.loadStateSlot=(e,r)=>{var t=de("loadStateSlot","number",["number","number"]);return s.loadStateSlot=(n,a)=>(a===void 0&&(a=61),t(n,a)),s.loadStateSlot(e,r)},s.autoLoadCheats=()=>de("autoLoadCheats","bool",[])(),s.setFastForwardMultiplier=e=>{de("setFastForwardMultiplier",null,["number"])(e)},s.getFastForwardMultiplier=()=>de("getFastForwardMultiplier","number",[])();var v=Object.assign({},s),_="./this.program",k=(e,r)=>{throw r},w=!0,S="";function L(e){return s.locateFile?s.locateFile(e,S):S+e}var R,N;typeof document<"u"&&document.currentScript&&(S=document.currentScript.src),l&&(S=l),S.startsWith("blob:")?S="":S=S.substr(0,S.replace(/[?#].*/,"").lastIndexOf("/")+1),R=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(null),r.responseText},N=(e,r,t)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){r(n.response);return}t()},n.onerror=t,n.send(null)};var O=s.print||console.log.bind(console),B=s.printErr||console.error.bind(console);Object.assign(s,v),v=null,s.arguments&&s.arguments,s.thisProgram&&(_=s.thisProgram),s.quit&&(k=s.quit);var W;s.wasmBinary&&(W=s.wasmBinary),typeof WebAssembly!="object"&&nr("no native wasm support detected");var z,Y=!1,ee;function H(e,r){e||nr(r)}var G,q,V,I,f,X,K,oe;function Me(){var e=z.buffer;s.HEAP8=G=new Int8Array(e),s.HEAP16=V=new Int16Array(e),s.HEAPU8=q=new Uint8Array(e),s.HEAPU16=I=new Uint16Array(e),s.HEAP32=f=new Int32Array(e),s.HEAPU32=X=new Uint32Array(e),s.HEAPF32=K=new Float32Array(e),s.HEAPF64=oe=new Float64Array(e)}var De=[],He=[],rr=[],Je=[];function Ze(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)tr(s.preRun.shift());Ar(De)}function ne(){!s.noFSInit&&!c.init.initialized&&c.init(),c.ignorePermissions=!1,Ar(He)}function we(){Ar(rr)}function Ce(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)Ae(s.postRun.shift());Ar(Je)}function tr(e){De.unshift(e)}function ie(e){He.unshift(e)}function Ae(e){Je.unshift(e)}var Se=0,gr=null;function Ht(e){return e}function ot(e){var r;Se++,(r=s.monitorRunDependencies)==null||r.call(s,Se)}function Dr(e){var t;if(Se--,(t=s.monitorRunDependencies)==null||t.call(s,Se),Se==0&&gr){var r=gr;gr=null,r()}}function nr(e){var t;(t=s.onAbort)==null||t.call(s,e),e="Aborted("+e+")",B(e),Y=!0,ee=1,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw b(r),r}var Ca="data:application/octet-stream;base64,",Wt=e=>e.startsWith(Ca),lr;s.locateFile?(lr="mgba.wasm",Wt(lr)||(lr=L(lr))):lr=new URL(""+new URL("mgba-xM1paPxV.wasm",import.meta.url).href,import.meta.url).href;function Xt(e){if(e==lr&&W)return new Uint8Array(W);throw"both async and sync fetching of the wasm failed"}function ka(e){return!W&&w&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(r=>{if(!r.ok)throw`failed to load wasm binary file at '${e}'`;return r.arrayBuffer()}).catch(()=>Xt(e)):Promise.resolve().then(()=>Xt(e))}function Kt(e,r,t){return ka(e).then(n=>WebAssembly.instantiate(n,r)).then(n=>n).then(t,n=>{B(`failed to asynchronously prepare wasm: ${n}`),nr(n)})}function ja(e,r,t,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!Wt(r)&&typeof fetch=="function"?fetch(r,{credentials:"same-origin"}).then(a=>{var i=WebAssembly.instantiateStreaming(a,t);return i.then(n,function(d){return B(`wasm streaming compile failed: ${d}`),B("falling back to ArrayBuffer instantiation"),Kt(r,t,n)})}):Kt(r,t,n)}function La(){var e={a:_m};function r(n,a){return te=n.exports,z=te._d,Me(),Jt=te.ze,ie(te.$d),Dr(),te}ot();function t(n){r(n.instance)}if(s.instantiateWasm)try{return s.instantiateWasm(e,r)}catch(n){B(`Module.instantiateWasm callback failed with error: ${n}`),b(n)}return ja(W,lr,e,t).catch(b),{}}var J,le,Yt={272368:(e,r)=>{s.canvas.width=e,s.canvas.height=r},272425:(e,r,t,n,a,i,d)=>{s.version={gitCommit:je(e),gitShort:je(r),gitBranch:je(t),gitRevision:n,binaryName:je(a),projectName:je(i),projectVersion:je(d)}},272657:()=>{c.syncfs(function(e){H(!e)})},272701:()=>typeof AudioContext<"u"?!0:typeof webkitAudioContext<"u",272848:()=>typeof navigator.mediaDevices<"u"&&typeof navigator.mediaDevices.getUserMedia<"u"?!0:typeof navigator.webkitGetUserMedia<"u",273082:e=>{typeof s.SDL2>"u"&&(s.SDL2={});var r=s.SDL2;return e?r.capture={}:r.audio={},r.audioContext||(typeof AudioContext<"u"?r.audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(r.audioContext=new webkitAudioContext),r.audioContext&&Ra(r.audioContext)),r.audioContext===void 0?-1:0},273575:()=>{var e=s.SDL2;return e.audioContext.sampleRate},273643:(e,r,t,n)=>{var a=s.SDL2,i=function(h){a.capture.silenceTimer!==void 0&&(clearTimeout(a.capture.silenceTimer),a.capture.silenceTimer=void 0),a.capture.mediaStreamNode=a.audioContext.createMediaStreamSource(h),a.capture.scriptProcessorNode=a.audioContext.createScriptProcessor(r,e,1),a.capture.scriptProcessorNode.onaudioprocess=function(g){a===void 0||a.capture===void 0||(g.outputBuffer.getChannelData(0).fill(0),a.capture.currentCaptureBuffer=g.inputBuffer,st("vi",t,[n]))},a.capture.mediaStreamNode.connect(a.capture.scriptProcessorNode),a.capture.scriptProcessorNode.connect(a.audioContext.destination),a.capture.stream=h},d=function(h){};a.capture.silenceBuffer=a.audioContext.createBuffer(e,r,a.audioContext.sampleRate),a.capture.silenceBuffer.getChannelData(0).fill(0);var u=function(){a.capture.currentCaptureBuffer=a.capture.silenceBuffer,st("vi",t,[n])};a.capture.silenceTimer=setTimeout(u,r/a.audioContext.sampleRate*1e3),navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(i).catch(d):navigator.webkitGetUserMedia!==void 0&&navigator.webkitGetUserMedia({audio:!0,video:!1},i,d)},275295:(e,r,t,n)=>{var a=s.SDL2;a.audio.scriptProcessorNode=a.audioContext.createScriptProcessor(r,0,e),a.audio.scriptProcessorNode.onaudioprocess=function(i){a===void 0||a.audio===void 0||(a.audio.currentOutputBuffer=i.outputBuffer,st("vi",t,[n]))},a.audio.scriptProcessorNode.connect(a.audioContext.destination)},275705:(e,r)=>{for(var t=s.SDL2,n=t.capture.currentCaptureBuffer.numberOfChannels,a=0;a<n;++a){var i=t.capture.currentCaptureBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio capture buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";if(n==1)for(var d=0;d<r;++d)Zt(e+d*4,i[d],"float");else for(var d=0;d<r;++d)Zt(e+(d*n+a)*4,i[d],"float")}},276310:(e,r)=>{for(var t=s.SDL2,n=t.audio.currentOutputBuffer.numberOfChannels,a=0;a<n;++a){var i=t.audio.currentOutputBuffer.getChannelData(a);if(i.length!=r)throw"Web Audio output buffer length mismatch! Destination size: "+i.length+" samples vs expected "+r+" samples!";for(var d=0;d<r;++d)i[d]=K[e+(d*n+a<<2)>>2]}},276790:e=>{var r=s.SDL2;if(e){if(r.capture.silenceTimer!==void 0&&clearTimeout(r.capture.silenceTimer),r.capture.stream!==void 0){for(var t=r.capture.stream.getAudioTracks(),n=0;n<t.length;n++)r.capture.stream.removeTrack(t[n]);r.capture.stream=void 0}r.capture.scriptProcessorNode!==void 0&&(r.capture.scriptProcessorNode.onaudioprocess=function(a){},r.capture.scriptProcessorNode.disconnect(),r.capture.scriptProcessorNode=void 0),r.capture.mediaStreamNode!==void 0&&(r.capture.mediaStreamNode.disconnect(),r.capture.mediaStreamNode=void 0),r.capture.silenceBuffer!==void 0&&(r.capture.silenceBuffer=void 0),r.capture=void 0}else r.audio.scriptProcessorNode!=null&&(r.audio.scriptProcessorNode.disconnect(),r.audio.scriptProcessorNode=void 0),r.audio=void 0;r.audioContext!==void 0&&r.audio===void 0&&r.capture===void 0&&(r.audioContext.close(),r.audioContext=void 0)},277962:(e,r,t)=>{var n=e,a=r,i=t;s.SDL2||(s.SDL2={});var d=s.SDL2;d.ctxCanvas!==s.canvas&&(d.ctx=s.createContext(s.canvas,!1,!0),d.ctxCanvas=s.canvas),(d.w!==n||d.h!==a||d.imageCtx!==d.ctx)&&(d.image=d.ctx.createImageData(n,a),d.w=n,d.h=a,d.imageCtx=d.ctx);var u=d.image.data,h=i>>2,g=0,E;if(typeof CanvasPixelArray<"u"&&u instanceof CanvasPixelArray)for(E=u.length;g<E;){var F=f[h];u[g]=F&255,u[g+1]=F>>8&255,u[g+2]=F>>16&255,u[g+3]=255,h++,g+=4}else{d.data32Data!==u&&(d.data32=new Int32Array(u.buffer),d.data8=new Uint8Array(u.buffer),d.data32Data=u);var $=d.data32;E=$.length,$.set(f.subarray(h,h+E));var P=d.data8,A=3,Q=A+4*E;if(E%8==0)for(;A<Q;)P[A]=255,A=A+4|0,P[A]=255,A=A+4|0,P[A]=255,A=A+4|0,P[A]=255,A=A+4|0,P[A]=255,A=A+4|0,P[A]=255,A=A+4|0,P[A]=255,A=A+4|0,P[A]=255,A=A+4|0;else for(;A<Q;)P[A]=255,A=A+4|0}d.ctx.putImageData(d.image,0,0)},279431:(e,r,t,n,a)=>{var i=e,d=r,u=t,h=n,g=a,E=document.createElement("canvas");E.width=i,E.height=d;var F=E.getContext("2d"),$=F.createImageData(i,d),P=$.data,A=g>>2,Q=0,he;if(typeof CanvasPixelArray<"u"&&P instanceof CanvasPixelArray)for(he=P.length;Q<he;){var ue=f[A];P[Q]=ue&255,P[Q+1]=ue>>8&255,P[Q+2]=ue>>16&255,P[Q+3]=ue>>24&255,A++,Q+=4}else{var _e=new Int32Array(P.buffer);he=_e.length,_e.set(f.subarray(A,A+he))}F.putImageData($,0,0);var ve=u===0&&h===0?"url("+E.toDataURL()+"), auto":"url("+E.toDataURL()+") "+u+" "+h+", auto",ge=Ie(ve.length+1);return pe(ve,ge,ve.length+1),ge},280420:e=>{s.canvas&&(s.canvas.style.cursor=je(e))},280503:()=>{s.canvas&&(s.canvas.style.cursor="none")},280572:()=>window.innerWidth,280602:()=>window.innerHeight};function Qt(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var Fa=(e,r,t)=>{e.addEventListener(r,t,{once:!0})},Ra=(e,r)=>{r||(r=[document,document.getElementById("canvas")]),["keydown","mousedown","touchstart"].forEach(t=>{r.forEach(n=>{n&&Fa(n,t,()=>{e.state==="suspended"&&e.resume()})})})},Ar=e=>{for(;e.length>0;)e.shift()(s)},Ta=(e,r,t)=>{var n=s["dynCall_"+e];return t&&t.length?n.apply(null,[r].concat(t)):n.call(null,r)},Br=[],Jt,se=e=>{var r=Br[e];return r||(e>=Br.length&&(Br.length=e+1),Br[e]=r=Jt.get(e)),r},st=(e,r,t)=>{if(e.includes("j"))return Ta(e,r,t);var n=se(r).apply(null,t);return n},Pa=s.noExitRuntime||!0;function Zt(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":G[e>>0]=r;break;case"i8":G[e>>0]=r;break;case"i16":V[e>>1]=r;break;case"i32":f[e>>2]=r;break;case"i64":nr("to do setValue(i64) use WASM_BIGINT");case"float":K[e>>2]=r;break;case"double":oe[e>>3]=r;break;case"*":X[e>>2]=r;break;default:nr(`invalid type for setValue: ${t}`)}}var ae={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var t=0,n=e.length-1;n>=0;n--){var a=e[n];a==="."?e.splice(n,1):a===".."?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t;t--)e.unshift("..");return e},normalize:e=>{var r=ae.isAbs(e),t=e.substr(-1)==="/";return e=ae.normalizeArray(e.split("/").filter(n=>!!n),!r).join("/"),!e&&!r&&(e="."),e&&t&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=ae.splitPath(e),t=r[0],n=r[1];return!t&&!n?".":(n&&(n=n.substr(0,n.length-1)),t+n)},basename:e=>{if(e==="/")return"/";e=ae.normalize(e),e=e.replace(/\/$/,"");var r=e.lastIndexOf("/");return r===-1?e:e.substr(r+1)},join:function(){var e=Array.prototype.slice.call(arguments);return ae.normalize(e.join("/"))},join2:(e,r)=>ae.normalize(e+"/"+r)},Ma=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return e=>crypto.getRandomValues(e);nr("initRandomDevice")},en=e=>(en=Ma())(e),er={resolve:function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var n=t>=0?arguments[t]:c.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,r=ae.isAbs(n)}return e=ae.normalizeArray(e.split("/").filter(a=>!!a),!r).join("/"),(r?"/":"")+e||"."},relative:(e,r)=>{e=er.resolve(e).substr(1),r=er.resolve(r).substr(1);function t(g){for(var E=0;E<g.length&&g[E]==="";E++);for(var F=g.length-1;F>=0&&g[F]==="";F--);return E>F?[]:g.slice(E,F-E+1)}for(var n=t(e.split("/")),a=t(r.split("/")),i=Math.min(n.length,a.length),d=i,u=0;u<i;u++)if(n[u]!==a[u]){d=u;break}for(var h=[],u=d;u<n.length;u++)h.push("..");return h=h.concat(a.slice(d)),h.join("/")}},rn=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,xr=(e,r,t)=>{for(var n=r+t,a=r;e[a]&&!(a>=n);)++a;if(a-r>16&&e.buffer&&rn)return rn.decode(e.subarray(r,a));for(var i="";r<a;){var d=e[r++];if(!(d&128)){i+=String.fromCharCode(d);continue}var u=e[r++]&63;if((d&224)==192){i+=String.fromCharCode((d&31)<<6|u);continue}var h=e[r++]&63;if((d&240)==224?d=(d&15)<<12|u<<6|h:d=(d&7)<<18|u<<12|h<<6|e[r++]&63,d<65536)i+=String.fromCharCode(d);else{var g=d-65536;i+=String.fromCharCode(55296|g>>10,56320|g&1023)}}return i},it=[],br=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},lt=(e,r,t,n)=>{if(!(n>0))return 0;for(var a=t,i=t+n-1,d=0;d<e.length;++d){var u=e.charCodeAt(d);if(u>=55296&&u<=57343){var h=e.charCodeAt(++d);u=65536+((u&1023)<<10)|h&1023}if(u<=127){if(t>=i)break;r[t++]=u}else if(u<=2047){if(t+1>=i)break;r[t++]=192|u>>6,r[t++]=128|u&63}else if(u<=65535){if(t+2>=i)break;r[t++]=224|u>>12,r[t++]=128|u>>6&63,r[t++]=128|u&63}else{if(t+3>=i)break;r[t++]=240|u>>18,r[t++]=128|u>>12&63,r[t++]=128|u>>6&63,r[t++]=128|u&63}}return r[t]=0,t-a};function ct(e,r,t){var n=br(e)+1,a=new Array(n),i=lt(e,a,0,a.length);return a.length=i,a}var Da=()=>{if(!it.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"?(e=window.prompt("Input: "),e!==null&&(e+=`
`)):typeof readline=="function"&&(e=readline(),e!==null&&(e+=`
`)),!e)return null;it=ct(e)}return it.shift()},cr={ttys:[],init(){},shutdown(){},register(e,r){cr.ttys[e]={input:[],output:[],ops:r},c.registerDevice(e,cr.stream_ops)},stream_ops:{open(e){var r=cr.ttys[e.node.rdev];if(!r)throw new c.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,t,n,a){if(!e.tty||!e.tty.ops.get_char)throw new c.ErrnoError(60);for(var i=0,d=0;d<n;d++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new c.ErrnoError(29)}if(u===void 0&&i===0)throw new c.ErrnoError(6);if(u==null)break;i++,r[t+d]=u}return i&&(e.node.timestamp=Date.now()),i},write(e,r,t,n,a){if(!e.tty||!e.tty.ops.put_char)throw new c.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,r[t+i])}catch{throw new c.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char(e){return Da()},put_char(e,r){r===null||r===10?(O(xr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(O(xr(e.output,0)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,t){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(B(xr(e.output,0)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output&&e.output.length>0&&(B(xr(e.output,0)),e.output=[])}}},Aa=(e,r)=>(q.fill(0,e,e+r),e),Ba=(e,r)=>Math.ceil(e/r)*r,tn=e=>{e=Ba(e,65536);var r=Bn(65536,e);return r?Aa(r,e):0},re={ops_table:null,mount(e){return re.createNode(null,"/",16895,0)},createNode(e,r,t,n){if(c.isBlkdev(t)||c.isFIFO(t))throw new c.ErrnoError(63);re.ops_table||(re.ops_table={dir:{node:{getattr:re.node_ops.getattr,setattr:re.node_ops.setattr,lookup:re.node_ops.lookup,mknod:re.node_ops.mknod,rename:re.node_ops.rename,unlink:re.node_ops.unlink,rmdir:re.node_ops.rmdir,readdir:re.node_ops.readdir,symlink:re.node_ops.symlink},stream:{llseek:re.stream_ops.llseek}},file:{node:{getattr:re.node_ops.getattr,setattr:re.node_ops.setattr},stream:{llseek:re.stream_ops.llseek,read:re.stream_ops.read,write:re.stream_ops.write,allocate:re.stream_ops.allocate,mmap:re.stream_ops.mmap,msync:re.stream_ops.msync}},link:{node:{getattr:re.node_ops.getattr,setattr:re.node_ops.setattr,readlink:re.node_ops.readlink},stream:{}},chrdev:{node:{getattr:re.node_ops.getattr,setattr:re.node_ops.setattr},stream:c.chrdev_stream_ops}});var a=c.createNode(e,r,t,n);return c.isDir(a.mode)?(a.node_ops=re.ops_table.dir.node,a.stream_ops=re.ops_table.dir.stream,a.contents={}):c.isFile(a.mode)?(a.node_ops=re.ops_table.file.node,a.stream_ops=re.ops_table.file.stream,a.usedBytes=0,a.contents=null):c.isLink(a.mode)?(a.node_ops=re.ops_table.link.node,a.stream_ops=re.ops_table.link.stream):c.isChrdev(a.mode)&&(a.node_ops=re.ops_table.chrdev.node,a.stream_ops=re.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[r]=a,e.timestamp=a.timestamp),a},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var t=e.contents?e.contents.length:0;if(!(t>=r)){var n=1024*1024;r=Math.max(r,t*(t<n?2:1.125)>>>0),t!=0&&(r=Math.max(r,256));var a=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(a.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var t=e.contents;e.contents=new Uint8Array(r),t&&e.contents.set(t.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=c.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,c.isDir(e.mode)?r.size=4096:c.isFile(e.mode)?r.size=e.usedBytes:c.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.timestamp),r.mtime=new Date(e.timestamp),r.ctime=new Date(e.timestamp),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){r.mode!==void 0&&(e.mode=r.mode),r.timestamp!==void 0&&(e.timestamp=r.timestamp),r.size!==void 0&&re.resizeFileStorage(e,r.size)},lookup(e,r){throw c.genericErrors[44]},mknod(e,r,t,n){return re.createNode(e,r,t,n)},rename(e,r,t){if(c.isDir(e.mode)){var n;try{n=c.lookupNode(r,t)}catch{}if(n)for(var a in n.contents)throw new c.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=t,r.contents[t]=e,r.timestamp=e.parent.timestamp,e.parent=r},unlink(e,r){delete e.contents[r],e.timestamp=Date.now()},rmdir(e,r){var t=c.lookupNode(e,r);for(var n in t.contents)throw new c.ErrnoError(55);delete e.contents[r],e.timestamp=Date.now()},readdir(e){var r=[".",".."];for(var t of Object.keys(e.contents))r.push(t);return r},symlink(e,r,t){var n=re.createNode(e,r,41471,0);return n.link=t,n},readlink(e){if(!c.isLink(e.mode))throw new c.ErrnoError(28);return e.link}},stream_ops:{read(e,r,t,n,a){var i=e.node.contents;if(a>=e.node.usedBytes)return 0;var d=Math.min(e.node.usedBytes-a,n);if(d>8&&i.subarray)r.set(i.subarray(a,a+d),t);else for(var u=0;u<d;u++)r[t+u]=i[a+u];return d},write(e,r,t,n,a,i){if(r.buffer===G.buffer&&(i=!1),!n)return 0;var d=e.node;if(d.timestamp=Date.now(),r.subarray&&(!d.contents||d.contents.subarray)){if(i)return d.contents=r.subarray(t,t+n),d.usedBytes=n,n;if(d.usedBytes===0&&a===0)return d.contents=r.slice(t,t+n),d.usedBytes=n,n;if(a+n<=d.usedBytes)return d.contents.set(r.subarray(t,t+n),a),n}if(re.expandFileStorage(d,a+n),d.contents.subarray&&r.subarray)d.contents.set(r.subarray(t,t+n),a);else for(var u=0;u<n;u++)d.contents[a+u]=r[t+u];return d.usedBytes=Math.max(d.usedBytes,a+n),n},llseek(e,r,t){var n=r;if(t===1?n+=e.position:t===2&&c.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new c.ErrnoError(28);return n},allocate(e,r,t){re.expandFileStorage(e.node,r+t),e.node.usedBytes=Math.max(e.node.usedBytes,r+t)},mmap(e,r,t,n,a){if(!c.isFile(e.node.mode))throw new c.ErrnoError(43);var i,d,u=e.node.contents;if(!(a&2)&&u.buffer===G.buffer)d=!1,i=u.byteOffset;else{if((t>0||t+r<u.length)&&(u.subarray?u=u.subarray(t,t+r):u=Array.prototype.slice.call(u,t,t+r)),d=!0,i=tn(r),!i)throw new c.ErrnoError(48);G.set(u,i)}return{ptr:i,allocated:d}},msync(e,r,t,n,a){return re.stream_ops.write(e,r,0,n,t,!1),0}}},Ia=(e,r,t,n)=>{var a=`al ${e}`;N(e,i=>{r(new Uint8Array(i)),a&&Dr()},i=>{if(t)t();else throw`Loading data file "${e}" failed.`}),a&&ot()},$a=(e,r,t,n,a,i)=>{c.createDataFile(e,r,t,n,a,i)},dt=s.preloadPlugins||[],Na=(e,r,t,n)=>{typeof C<"u"&&C.init();var a=!1;return dt.forEach(i=>{a||i.canHandle(r)&&(i.handle(e,r,t,n),a=!0)}),a},Ua=(e,r,t,n,a,i,d,u,h,g)=>{var E=r?er.resolve(ae.join2(e,r)):e;function F($){function P(A){g==null||g(),u||$a(e,r,A,n,a,h),i==null||i(),Dr()}Na($,E,P,()=>{d==null||d(),Dr()})||P($)}ot(),typeof t=="string"?Ia(t,F,d):F(t)},Oa=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},t=r[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},ut=(e,r)=>{var t=0;return e&&(t|=365),r&&(t|=146),t},ce={dbs:{},indexedDB:()=>{if(typeof indexedDB<"u")return indexedDB;var e=null;return typeof window=="object"&&(e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),H(e,"IDBFS used, but indexedDB not supported"),e},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",mount:function(e){return re.mount.apply(null,arguments)},syncfs:(e,r,t)=>{ce.getLocalSet(e,(n,a)=>{if(n)return t(n);ce.getRemoteSet(e,(i,d)=>{if(i)return t(i);var u=r?d:a,h=r?a:d;ce.reconcile(u,h,t)})})},quit:()=>{Object.values(ce.dbs).forEach(e=>e.close()),ce.dbs={}},getDB:(e,r)=>{var t=ce.dbs[e];if(t)return r(null,t);var n;try{n=ce.indexedDB().open(e,ce.DB_VERSION)}catch(a){return r(a)}if(!n)return r("Unable to connect to IndexedDB");n.onupgradeneeded=a=>{var i=a.target.result,d=a.target.transaction,u;i.objectStoreNames.contains(ce.DB_STORE_NAME)?u=d.objectStore(ce.DB_STORE_NAME):u=i.createObjectStore(ce.DB_STORE_NAME),u.indexNames.contains("timestamp")||u.createIndex("timestamp","timestamp",{unique:!1})},n.onsuccess=()=>{t=n.result,ce.dbs[e]=t,r(null,t)},n.onerror=a=>{r(a.target.error),a.preventDefault()}},getLocalSet:(e,r)=>{var t={};function n(h){return h!=="."&&h!==".."}function a(h){return g=>ae.join2(h,g)}for(var i=c.readdir(e.mountpoint).filter(n).map(a(e.mountpoint));i.length;){var d=i.pop(),u;try{u=c.stat(d)}catch(h){return r(h)}c.isDir(u.mode)&&i.push.apply(i,c.readdir(d).filter(n).map(a(d))),t[d]={timestamp:u.mtime}}return r(null,{type:"local",entries:t})},getRemoteSet:(e,r)=>{var t={};ce.getDB(e.mountpoint,(n,a)=>{if(n)return r(n);try{var i=a.transaction([ce.DB_STORE_NAME],"readonly");i.onerror=h=>{r(h.target.error),h.preventDefault()};var d=i.objectStore(ce.DB_STORE_NAME),u=d.index("timestamp");u.openKeyCursor().onsuccess=h=>{var g=h.target.result;if(!g)return r(null,{type:"remote",db:a,entries:t});t[g.primaryKey]={timestamp:g.key},g.continue()}}catch(h){return r(h)}})},loadLocalEntry:(e,r)=>{var t,n;try{var a=c.lookupPath(e);n=a.node,t=c.stat(e)}catch(i){return r(i)}return c.isDir(t.mode)?r(null,{timestamp:t.mtime,mode:t.mode}):c.isFile(t.mode)?(n.contents=re.getFileDataAsTypedArray(n),r(null,{timestamp:t.mtime,mode:t.mode,contents:n.contents})):r(new Error("node type not supported"))},storeLocalEntry:(e,r,t)=>{try{if(c.isDir(r.mode))c.mkdirTree(e,r.mode);else if(c.isFile(r.mode))c.writeFile(e,r.contents,{canOwn:!0});else return t(new Error("node type not supported"));c.chmod(e,r.mode),c.utime(e,r.timestamp,r.timestamp)}catch(n){return t(n)}t(null)},removeLocalEntry:(e,r)=>{try{var t=c.stat(e);c.isDir(t.mode)?c.rmdir(e):c.isFile(t.mode)&&c.unlink(e)}catch(n){return r(n)}r(null)},loadRemoteEntry:(e,r,t)=>{var n=e.get(r);n.onsuccess=a=>t(null,a.target.result),n.onerror=a=>{t(a.target.error),a.preventDefault()}},storeRemoteEntry:(e,r,t,n)=>{try{var a=e.put(t,r)}catch(i){n(i);return}a.onsuccess=i=>n(),a.onerror=i=>{n(i.target.error),i.preventDefault()}},removeRemoteEntry:(e,r,t)=>{var n=e.delete(r);n.onsuccess=a=>t(),n.onerror=a=>{t(a.target.error),a.preventDefault()}},reconcile:(e,r,t)=>{var n=0,a=[];Object.keys(e.entries).forEach(function(F){var $=e.entries[F],P=r.entries[F];(!P||$.timestamp.getTime()!=P.timestamp.getTime())&&(a.push(F),n++)});var i=[];if(Object.keys(r.entries).forEach(function(F){e.entries[F]||(i.push(F),n++)}),!n)return t(null);var d=!1,u=e.type==="remote"?e.db:r.db,h=u.transaction([ce.DB_STORE_NAME],"readwrite"),g=h.objectStore(ce.DB_STORE_NAME);function E(F){if(F&&!d)return d=!0,t(F)}h.onerror=F=>{E(this.error),F.preventDefault()},h.oncomplete=F=>{d||t(null)},a.sort().forEach(F=>{r.type==="local"?ce.loadRemoteEntry(g,F,($,P)=>{if($)return E($);ce.storeLocalEntry(F,P,E)}):ce.loadLocalEntry(F,($,P)=>{if($)return E($);ce.storeRemoteEntry(g,F,P,E)})}),i.sort().reverse().forEach(F=>{r.type==="local"?ce.removeLocalEntry(F,E):ce.removeRemoteEntry(g,F,E)})}},c={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(e){this.name="ErrnoError",this.errno=e}},genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(e,r={}){if(e=er.resolve(e),!e)return{path:"",node:null};var t={follow_mount:!0,recurse_count:0};if(r=Object.assign(t,r),r.recurse_count>8)throw new c.ErrnoError(32);for(var n=e.split("/").filter(F=>!!F),a=c.root,i="/",d=0;d<n.length;d++){var u=d===n.length-1;if(u&&r.parent)break;if(a=c.lookupNode(a,n[d]),i=ae.join2(i,n[d]),c.isMountpoint(a)&&(!u||u&&r.follow_mount)&&(a=a.mounted.root),!u||r.follow)for(var h=0;c.isLink(a.mode);){var g=c.readlink(i);i=er.resolve(ae.dirname(i),g);var E=c.lookupPath(i,{recurse_count:r.recurse_count+1});if(a=E.node,h++>40)throw new c.ErrnoError(32)}}return{path:i,node:a}},getPath(e){for(var r;;){if(c.isRoot(e)){var t=e.mount.mountpoint;return r?t[t.length-1]!=="/"?`${t}/${r}`:t+r:t}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var t=0,n=0;n<r.length;n++)t=(t<<5)-t+r.charCodeAt(n)|0;return(e+t>>>0)%c.nameTable.length},hashAddNode(e){var r=c.hashName(e.parent.id,e.name);e.name_next=c.nameTable[r],c.nameTable[r]=e},hashRemoveNode(e){var r=c.hashName(e.parent.id,e.name);if(c.nameTable[r]===e)c.nameTable[r]=e.name_next;else for(var t=c.nameTable[r];t;){if(t.name_next===e){t.name_next=e.name_next;break}t=t.name_next}},lookupNode(e,r){var t=c.mayLookup(e);if(t)throw new c.ErrnoError(t);for(var n=c.hashName(e.id,r),a=c.nameTable[n];a;a=a.name_next){var i=a.name;if(a.parent.id===e.id&&i===r)return a}return c.lookup(e,r)},createNode(e,r,t,n){var a=new c.FSNode(e,r,t,n);return c.hashAddNode(a),a},destroyNode(e){c.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return c.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!c.isDir(e.mode))return 54;var r=c.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){try{var t=c.lookupNode(e,r);return 20}catch{}return c.nodePermissions(e,"wx")},mayDelete(e,r,t){var n;try{n=c.lookupNode(e,r)}catch(i){return i.errno}var a=c.nodePermissions(e,"wx");if(a)return a;if(t){if(!c.isDir(n.mode))return 54;if(c.isRoot(n)||c.getPath(n)===c.cwd())return 10}else if(c.isDir(n.mode))return 31;return 0},mayOpen(e,r){return e?c.isLink(e.mode)?32:c.isDir(e.mode)&&(c.flagsToPermissionString(r)!=="r"||r&512)?31:c.nodePermissions(e,c.flagsToPermissionString(r)):44},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=c.MAX_OPEN_FDS;e++)if(!c.streams[e])return e;throw new c.ErrnoError(33)},getStreamChecked(e){var r=c.getStream(e);if(!r)throw new c.ErrnoError(8);return r},getStream:e=>c.streams[e],createStream(e,r=-1){return c.FSStream||(c.FSStream=function(){this.shared={}},c.FSStream.prototype={},Object.defineProperties(c.FSStream.prototype,{object:{get(){return this.node},set(t){this.node=t}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(t){this.shared.flags=t}},position:{get(){return this.shared.position},set(t){this.shared.position=t}}})),e=Object.assign(new c.FSStream,e),r==-1&&(r=c.nextfd()),e.fd=r,c.streams[r]=e,e},closeStream(e){c.streams[e]=null},chrdev_stream_ops:{open(e){var t,n;var r=c.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,(n=(t=e.stream_ops).open)==null||n.call(t,e)},llseek(){throw new c.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){c.devices[e]={stream_ops:r}},getDevice:e=>c.devices[e],getMounts(e){for(var r=[],t=[e];t.length;){var n=t.pop();r.push(n),t.push.apply(t,n.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),c.syncFSRequests++,c.syncFSRequests>1&&B(`warning: ${c.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var t=c.getMounts(c.root.mount),n=0;function a(d){return c.syncFSRequests--,r(d)}function i(d){if(d)return i.errored?void 0:(i.errored=!0,a(d));++n>=t.length&&a(null)}t.forEach(d=>{if(!d.type.syncfs)return i(null);d.type.syncfs(d,e,i)})},mount(e,r,t){var n=t==="/",a=!t,i;if(n&&c.root)throw new c.ErrnoError(10);if(!n&&!a){var d=c.lookupPath(t,{follow_mount:!1});if(t=d.path,i=d.node,c.isMountpoint(i))throw new c.ErrnoError(10);if(!c.isDir(i.mode))throw new c.ErrnoError(54)}var u={type:e,opts:r,mountpoint:t,mounts:[]},h=e.mount(u);return h.mount=u,u.root=h,n?c.root=h:i&&(i.mounted=u,i.mount&&i.mount.mounts.push(u)),h},unmount(e){var r=c.lookupPath(e,{follow_mount:!1});if(!c.isMountpoint(r.node))throw new c.ErrnoError(28);var t=r.node,n=t.mounted,a=c.getMounts(n);Object.keys(c.nameTable).forEach(d=>{for(var u=c.nameTable[d];u;){var h=u.name_next;a.includes(u.mount)&&c.destroyNode(u),u=h}}),t.mounted=null;var i=t.mount.mounts.indexOf(n);t.mount.mounts.splice(i,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,t){var n=c.lookupPath(e,{parent:!0}),a=n.node,i=ae.basename(e);if(!i||i==="."||i==="..")throw new c.ErrnoError(28);var d=c.mayCreate(a,i);if(d)throw new c.ErrnoError(d);if(!a.node_ops.mknod)throw new c.ErrnoError(63);return a.node_ops.mknod(a,i,r,t)},create(e,r){return r=r!==void 0?r:438,r&=4095,r|=32768,c.mknod(e,r,0)},mkdir(e,r){return r=r!==void 0?r:511,r&=1023,r|=16384,c.mknod(e,r,0)},mkdirTree(e,r){for(var t=e.split("/"),n="",a=0;a<t.length;++a)if(t[a]){n+="/"+t[a];try{c.mkdir(n,r)}catch(i){if(i.errno!=20)throw i}}},mkdev(e,r,t){return typeof t>"u"&&(t=r,r=438),r|=8192,c.mknod(e,r,t)},symlink(e,r){if(!er.resolve(e))throw new c.ErrnoError(44);var t=c.lookupPath(r,{parent:!0}),n=t.node;if(!n)throw new c.ErrnoError(44);var a=ae.basename(r),i=c.mayCreate(n,a);if(i)throw new c.ErrnoError(i);if(!n.node_ops.symlink)throw new c.ErrnoError(63);return n.node_ops.symlink(n,a,e)},rename(e,r){var t=ae.dirname(e),n=ae.dirname(r),a=ae.basename(e),i=ae.basename(r),d,u,h;if(d=c.lookupPath(e,{parent:!0}),u=d.node,d=c.lookupPath(r,{parent:!0}),h=d.node,!u||!h)throw new c.ErrnoError(44);if(u.mount!==h.mount)throw new c.ErrnoError(75);var g=c.lookupNode(u,a),E=er.relative(e,n);if(E.charAt(0)!==".")throw new c.ErrnoError(28);if(E=er.relative(r,t),E.charAt(0)!==".")throw new c.ErrnoError(55);var F;try{F=c.lookupNode(h,i)}catch{}if(g!==F){var $=c.isDir(g.mode),P=c.mayDelete(u,a,$);if(P)throw new c.ErrnoError(P);if(P=F?c.mayDelete(h,i,$):c.mayCreate(h,i),P)throw new c.ErrnoError(P);if(!u.node_ops.rename)throw new c.ErrnoError(63);if(c.isMountpoint(g)||F&&c.isMountpoint(F))throw new c.ErrnoError(10);if(h!==u&&(P=c.nodePermissions(u,"w"),P))throw new c.ErrnoError(P);c.hashRemoveNode(g);try{u.node_ops.rename(g,h,i)}catch(A){throw A}finally{c.hashAddNode(g)}}},rmdir(e){var r=c.lookupPath(e,{parent:!0}),t=r.node,n=ae.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!0);if(i)throw new c.ErrnoError(i);if(!t.node_ops.rmdir)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.rmdir(t,n),c.destroyNode(a)},readdir(e){var r=c.lookupPath(e,{follow:!0}),t=r.node;if(!t.node_ops.readdir)throw new c.ErrnoError(54);return t.node_ops.readdir(t)},unlink(e){var r=c.lookupPath(e,{parent:!0}),t=r.node;if(!t)throw new c.ErrnoError(44);var n=ae.basename(e),a=c.lookupNode(t,n),i=c.mayDelete(t,n,!1);if(i)throw new c.ErrnoError(i);if(!t.node_ops.unlink)throw new c.ErrnoError(63);if(c.isMountpoint(a))throw new c.ErrnoError(10);t.node_ops.unlink(t,n),c.destroyNode(a)},readlink(e){var r=c.lookupPath(e),t=r.node;if(!t)throw new c.ErrnoError(44);if(!t.node_ops.readlink)throw new c.ErrnoError(28);return er.resolve(c.getPath(t.parent),t.node_ops.readlink(t))},stat(e,r){var t=c.lookupPath(e,{follow:!r}),n=t.node;if(!n)throw new c.ErrnoError(44);if(!n.node_ops.getattr)throw new c.ErrnoError(63);return n.node_ops.getattr(n)},lstat(e){return c.stat(e,!0)},chmod(e,r,t){var n;if(typeof e=="string"){var a=c.lookupPath(e,{follow:!t});n=a.node}else n=e;if(!n.node_ops.setattr)throw new c.ErrnoError(63);n.node_ops.setattr(n,{mode:r&4095|n.mode&-4096,timestamp:Date.now()})},lchmod(e,r){c.chmod(e,r,!0)},fchmod(e,r){var t=c.getStreamChecked(e);c.chmod(t.node,r)},chown(e,r,t,n){var a;if(typeof e=="string"){var i=c.lookupPath(e,{follow:!n});a=i.node}else a=e;if(!a.node_ops.setattr)throw new c.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown(e,r,t){c.chown(e,r,t,!0)},fchown(e,r,t){var n=c.getStreamChecked(e);c.chown(n.node,r,t)},truncate(e,r){if(r<0)throw new c.ErrnoError(28);var t;if(typeof e=="string"){var n=c.lookupPath(e,{follow:!0});t=n.node}else t=e;if(!t.node_ops.setattr)throw new c.ErrnoError(63);if(c.isDir(t.mode))throw new c.ErrnoError(31);if(!c.isFile(t.mode))throw new c.ErrnoError(28);var a=c.nodePermissions(t,"w");if(a)throw new c.ErrnoError(a);t.node_ops.setattr(t,{size:r,timestamp:Date.now()})},ftruncate(e,r){var t=c.getStreamChecked(e);if(!(t.flags&2097155))throw new c.ErrnoError(28);c.truncate(t.node,r)},utime(e,r,t){var n=c.lookupPath(e,{follow:!0}),a=n.node;a.node_ops.setattr(a,{timestamp:Math.max(r,t)})},open(e,r,t){if(e==="")throw new c.ErrnoError(44);r=typeof r=="string"?Oa(r):r,t=typeof t>"u"?438:t,r&64?t=t&4095|32768:t=0;var n;if(typeof e=="object")n=e;else{e=ae.normalize(e);try{var a=c.lookupPath(e,{follow:!(r&131072)});n=a.node}catch{}}var i=!1;if(r&64)if(n){if(r&128)throw new c.ErrnoError(20)}else n=c.mknod(e,t,0),i=!0;if(!n)throw new c.ErrnoError(44);if(c.isChrdev(n.mode)&&(r&=-513),r&65536&&!c.isDir(n.mode))throw new c.ErrnoError(54);if(!i){var d=c.mayOpen(n,r);if(d)throw new c.ErrnoError(d)}r&512&&!i&&c.truncate(n,0),r&=-131713;var u=c.createStream({node:n,path:c.getPath(n),flags:r,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return u.stream_ops.open&&u.stream_ops.open(u),s.logReadFiles&&!(r&1)&&(c.readFiles||(c.readFiles={}),e in c.readFiles||(c.readFiles[e]=1)),u},close(e){if(c.isClosed(e))throw new c.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{c.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new c.ErrnoError(70);if(t!=0&&t!=1&&t!=2)throw new c.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,t),e.ungotten=[],e.position},read(e,r,t,n,a){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if((e.flags&2097155)===1)throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.read)throw new c.ErrnoError(28);var i=typeof a<"u";if(!i)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var d=e.stream_ops.read(e,r,t,n,a);return i||(e.position+=d),d},write(e,r,t,n,a,i){if(n<0||a<0)throw new c.ErrnoError(28);if(c.isClosed(e))throw new c.ErrnoError(8);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(c.isDir(e.node.mode))throw new c.ErrnoError(31);if(!e.stream_ops.write)throw new c.ErrnoError(28);e.seekable&&e.flags&1024&&c.llseek(e,0,2);var d=typeof a<"u";if(!d)a=e.position;else if(!e.seekable)throw new c.ErrnoError(70);var u=e.stream_ops.write(e,r,t,n,a,i);return d||(e.position+=u),u},allocate(e,r,t){if(c.isClosed(e))throw new c.ErrnoError(8);if(r<0||t<=0)throw new c.ErrnoError(28);if(!(e.flags&2097155))throw new c.ErrnoError(8);if(!c.isFile(e.node.mode)&&!c.isDir(e.node.mode))throw new c.ErrnoError(43);if(!e.stream_ops.allocate)throw new c.ErrnoError(138);e.stream_ops.allocate(e,r,t)},mmap(e,r,t,n,a){if(n&2&&!(a&2)&&(e.flags&2097155)!==2)throw new c.ErrnoError(2);if((e.flags&2097155)===1)throw new c.ErrnoError(2);if(!e.stream_ops.mmap)throw new c.ErrnoError(43);return e.stream_ops.mmap(e,r,t,n,a)},msync(e,r,t,n,a){return e.stream_ops.msync?e.stream_ops.msync(e,r,t,n,a):0},munmap:e=>0,ioctl(e,r,t){if(!e.stream_ops.ioctl)throw new c.ErrnoError(59);return e.stream_ops.ioctl(e,r,t)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var t,n=c.open(e,r.flags),a=c.stat(e),i=a.size,d=new Uint8Array(i);return c.read(n,d,0,i,0),r.encoding==="utf8"?t=xr(d,0):r.encoding==="binary"&&(t=d),c.close(n),t},writeFile(e,r,t={}){t.flags=t.flags||577;var n=c.open(e,t.flags,t.mode);if(typeof r=="string"){var a=new Uint8Array(br(r)+1),i=lt(r,a,0,a.length);c.write(n,a,0,i,void 0,t.canOwn)}else if(ArrayBuffer.isView(r))c.write(n,r,0,r.byteLength,void 0,t.canOwn);else throw new Error("Unsupported data type");c.close(n)},cwd:()=>c.currentPath,chdir(e){var r=c.lookupPath(e,{follow:!0});if(r.node===null)throw new c.ErrnoError(44);if(!c.isDir(r.node.mode))throw new c.ErrnoError(54);var t=c.nodePermissions(r.node,"x");if(t)throw new c.ErrnoError(t);c.currentPath=r.path},createDefaultDirectories(){c.mkdir("/tmp"),c.mkdir("/home"),c.mkdir("/home/web_user")},createDefaultDevices(){c.mkdir("/dev"),c.registerDevice(c.makedev(1,3),{read:()=>0,write:(n,a,i,d,u)=>d}),c.mkdev("/dev/null",c.makedev(1,3)),cr.register(c.makedev(5,0),cr.default_tty_ops),cr.register(c.makedev(6,0),cr.default_tty1_ops),c.mkdev("/dev/tty",c.makedev(5,0)),c.mkdev("/dev/tty1",c.makedev(6,0));var e=new Uint8Array(1024),r=0,t=()=>(r===0&&(r=en(e).byteLength),e[--r]);c.createDevice("/dev","random",t),c.createDevice("/dev","urandom",t),c.mkdir("/dev/shm"),c.mkdir("/dev/shm/tmp")},createSpecialDirectories(){c.mkdir("/proc");var e=c.mkdir("/proc/self");c.mkdir("/proc/self/fd"),c.mount({mount(){var r=c.createNode(e,"fd",16895,73);return r.node_ops={lookup(t,n){var a=+n,i=c.getStreamChecked(a),d={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>i.path}};return d.parent=d,d}},r}},{},"/proc/self/fd")},createStandardStreams(){s.stdin?c.createDevice("/dev","stdin",s.stdin):c.symlink("/dev/tty","/dev/stdin"),s.stdout?c.createDevice("/dev","stdout",null,s.stdout):c.symlink("/dev/tty","/dev/stdout"),s.stderr?c.createDevice("/dev","stderr",null,s.stderr):c.symlink("/dev/tty1","/dev/stderr"),c.open("/dev/stdin",0),c.open("/dev/stdout",1),c.open("/dev/stderr",1)},staticInit(){[44].forEach(e=>{c.genericErrors[e]=new c.ErrnoError(e),c.genericErrors[e].stack="<generic error, no stack>"}),c.nameTable=new Array(4096),c.mount(re,{},"/"),c.createDefaultDirectories(),c.createDefaultDevices(),c.createSpecialDirectories(),c.filesystems={MEMFS:re,IDBFS:ce}},init(e,r,t){c.init.initialized=!0,s.stdin=e||s.stdin,s.stdout=r||s.stdout,s.stderr=t||s.stderr,c.createStandardStreams()},quit(){c.init.initialized=!1;for(var e=0;e<c.streams.length;e++){var r=c.streams[e];r&&c.close(r)}},findObject(e,r){var t=c.analyzePath(e,r);return t.exists?t.object:null},analyzePath(e,r){try{var t=c.lookupPath(e,{follow:!r});e=t.path}catch{}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=c.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=ae.basename(e),t=c.lookupPath(e,{follow:!r}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot=t.path==="/"}catch(a){n.error=a.errno}return n},createPath(e,r,t,n){e=typeof e=="string"?e:c.getPath(e);for(var a=r.split("/").reverse();a.length;){var i=a.pop();if(i){var d=ae.join2(e,i);try{c.mkdir(d)}catch{}e=d}}return d},createFile(e,r,t,n,a){var i=ae.join2(typeof e=="string"?e:c.getPath(e),r),d=ut(n,a);return c.create(i,d)},createDataFile(e,r,t,n,a,i){var d=r;e&&(e=typeof e=="string"?e:c.getPath(e),d=r?ae.join2(e,r):e);var u=ut(n,a),h=c.create(d,u);if(t){if(typeof t=="string"){for(var g=new Array(t.length),E=0,F=t.length;E<F;++E)g[E]=t.charCodeAt(E);t=g}c.chmod(h,u|146);var $=c.open(h,577);c.write($,t,0,t.length,0,i),c.close($),c.chmod(h,u)}},createDevice(e,r,t,n){var a=ae.join2(typeof e=="string"?e:c.getPath(e),r),i=ut(!!t,!!n);c.createDevice.major||(c.createDevice.major=64);var d=c.makedev(c.createDevice.major++,0);return c.registerDevice(d,{open(u){u.seekable=!1},close(u){var h;(h=n==null?void 0:n.buffer)!=null&&h.length&&n(10)},read(u,h,g,E,F){for(var $=0,P=0;P<E;P++){var A;try{A=t()}catch{throw new c.ErrnoError(29)}if(A===void 0&&$===0)throw new c.ErrnoError(6);if(A==null)break;$++,h[g+P]=A}return $&&(u.node.timestamp=Date.now()),$},write(u,h,g,E,F){for(var $=0;$<E;$++)try{n(h[g+$])}catch{throw new c.ErrnoError(29)}return E&&(u.node.timestamp=Date.now()),$}}),c.mkdev(a,i,d)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(R)try{e.contents=ct(R(e.url),!0),e.usedBytes=e.contents.length}catch{throw new c.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(e,r,t,n,a){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(P){if(!(P>this.length-1||P<0)){var A=P%this.chunkSize,Q=P/this.chunkSize|0;return this.getter(Q)[A]}},i.prototype.setDataGetter=function(P){this.getter=P},i.prototype.cacheLength=function(){var P=new XMLHttpRequest;if(P.open("HEAD",t,!1),P.send(null),!(P.status>=200&&P.status<300||P.status===304))throw new Error("Couldn't load "+t+". Status: "+P.status);var A=Number(P.getResponseHeader("Content-length")),Q,he=(Q=P.getResponseHeader("Accept-Ranges"))&&Q==="bytes",ue=(Q=P.getResponseHeader("Content-Encoding"))&&Q==="gzip",_e=1024*1024;he||(_e=A);var ve=(Ee,Ue)=>{if(Ee>Ue)throw new Error("invalid range ("+Ee+", "+Ue+") or no bytes requested!");if(Ue>A-1)throw new Error("only "+A+" bytes available! programmer error!");var xe=new XMLHttpRequest;if(xe.open("GET",t,!1),A!==_e&&xe.setRequestHeader("Range","bytes="+Ee+"-"+Ue),xe.responseType="arraybuffer",xe.overrideMimeType&&xe.overrideMimeType("text/plain; charset=x-user-defined"),xe.send(null),!(xe.status>=200&&xe.status<300||xe.status===304))throw new Error("Couldn't load "+t+". Status: "+xe.status);return xe.response!==void 0?new Uint8Array(xe.response||[]):ct(xe.responseText||"")},ge=this;ge.setDataGetter(Ee=>{var Ue=Ee*_e,xe=(Ee+1)*_e-1;if(xe=Math.min(xe,A-1),typeof ge.chunks[Ee]>"u"&&(ge.chunks[Ee]=ve(Ue,xe)),typeof ge.chunks[Ee]>"u")throw new Error("doXHR failed!");return ge.chunks[Ee]}),(ue||!A)&&(_e=A=1,A=this.getter(0).length,_e=A,O("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=A,this._chunkSize=_e,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var d,u}else var u={isDevice:!1,url:t};var h=c.createFile(e,r,u,n,a);u.contents?h.contents=u.contents:u.url&&(h.contents=null,h.url=u.url),Object.defineProperties(h,{usedBytes:{get:function(){return this.contents.length}}});var g={},E=Object.keys(h.stream_ops);E.forEach($=>{var P=h.stream_ops[$];g[$]=function(){return c.forceLoadFile(h),P.apply(null,arguments)}});function F($,P,A,Q,he){var ue=$.node.contents;if(he>=ue.length)return 0;var _e=Math.min(ue.length-he,Q);if(ue.slice)for(var ve=0;ve<_e;ve++)P[A+ve]=ue[he+ve];else for(var ve=0;ve<_e;ve++)P[A+ve]=ue.get(he+ve);return _e}return g.read=($,P,A,Q,he)=>(c.forceLoadFile(h),F($,P,A,Q,he)),g.mmap=($,P,A,Q,he)=>{c.forceLoadFile(h);var ue=tn(P);if(!ue)throw new c.ErrnoError(48);return F($,G,ue,P,A),{ptr:ue,allocated:!0}},h.stream_ops=g,h}},je=(e,r)=>e?xr(q,e,r):"",Z={DEFAULT_POLLMASK:5,calculateAt(e,r,t){if(ae.isAbs(r))return r;var n;if(e===-100)n=c.cwd();else{var a=Z.getStreamFromFD(e);n=a.path}if(r.length==0){if(!t)throw new c.ErrnoError(44);return n}return ae.join2(n,r)},doStat(e,r,t){var n=e(r);f[t>>2]=n.dev,f[t+4>>2]=n.mode,X[t+8>>2]=n.nlink,f[t+12>>2]=n.uid,f[t+16>>2]=n.gid,f[t+20>>2]=n.rdev,le=[n.size>>>0,(J=n.size,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+24>>2]=le[0],f[t+28>>2]=le[1],f[t+32>>2]=4096,f[t+36>>2]=n.blocks;var a=n.atime.getTime(),i=n.mtime.getTime(),d=n.ctime.getTime();return le=[Math.floor(a/1e3)>>>0,(J=Math.floor(a/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+40>>2]=le[0],f[t+44>>2]=le[1],X[t+48>>2]=a%1e3*1e3,le=[Math.floor(i/1e3)>>>0,(J=Math.floor(i/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+56>>2]=le[0],f[t+60>>2]=le[1],X[t+64>>2]=i%1e3*1e3,le=[Math.floor(d/1e3)>>>0,(J=Math.floor(d/1e3),+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+72>>2]=le[0],f[t+76>>2]=le[1],X[t+80>>2]=d%1e3*1e3,le=[n.ino>>>0,(J=n.ino,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[t+88>>2]=le[0],f[t+92>>2]=le[1],0},doMsync(e,r,t,n,a){if(!c.isFile(r.node.mode))throw new c.ErrnoError(43);if(n&2)return 0;var i=q.slice(e,e+t);c.msync(r,i,a,t,n)},varargs:void 0,get(){var e=f[+Z.varargs>>2];return Z.varargs+=4,e},getp(){return Z.get()},getStr(e){var r=je(e);return r},getStreamFromFD(e){var r=c.getStreamChecked(e);return r}};function Ga(e,r,t){Z.varargs=t;try{var n=Z.getStreamFromFD(e);switch(r){case 0:{var a=Z.get();if(a<0)return-28;for(;c.streams[a];)a++;var i;return i=c.createStream(n,a),i.fd}case 1:case 2:return 0;case 3:return n.flags;case 4:{var a=Z.get();return n.flags|=a,0}case 12:{var a=Z.getp(),d=0;return V[a+d>>1]=2,0}case 13:case 14:return 0}return-28}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function za(e,r){try{var t=Z.getStreamFromFD(e);return Z.doStat(c.stat,t.path,r)}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var _r=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function qa(e,r,t){var n=_r(r,t);try{return isNaN(n)?61:(c.ftruncate(e,n),0)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}var pe=(e,r,t)=>lt(e,q,r,t);function Va(e,r){try{if(r===0)return-28;var t=c.cwd(),n=br(t)+1;return r<n?-68:(pe(t,e,r),n)}catch(a){if(typeof c>"u"||a.name!=="ErrnoError")throw a;return-a.errno}}function Ha(e,r,t){try{var n=Z.getStreamFromFD(e);n.getdents||(n.getdents=c.readdir(n.path));for(var a=280,i=0,d=c.llseek(n,0,1),u=Math.floor(d/a);u<n.getdents.length&&i+a<=t;){var h,g,E=n.getdents[u];if(E===".")h=n.node.id,g=4;else if(E===".."){var F=c.lookupPath(n.path,{parent:!0});h=F.node.id,g=4}else{var $=c.lookupNode(n.node,E);h=$.id,g=c.isChrdev($.mode)?2:c.isDir($.mode)?4:c.isLink($.mode)?10:8}le=[h>>>0,(J=h,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[r+i>>2]=le[0],f[r+i+4>>2]=le[1],le=[(u+1)*a>>>0,(J=(u+1)*a,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[r+i+8>>2]=le[0],f[r+i+12>>2]=le[1],V[r+i+16>>1]=280,G[r+i+18>>0]=g,pe(E,r+i+19,256),i+=a,u+=1}return c.llseek(n,u*a,0),i}catch(P){if(typeof c>"u"||P.name!=="ErrnoError")throw P;return-P.errno}}function Wa(e,r,t){Z.varargs=t;try{var n=Z.getStreamFromFD(e);switch(r){case 21509:return n.tty?0:-59;case 21505:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcgets){var a=n.tty.ops.ioctl_tcgets(n),i=Z.getp();f[i>>2]=a.c_iflag||0,f[i+4>>2]=a.c_oflag||0,f[i+8>>2]=a.c_cflag||0,f[i+12>>2]=a.c_lflag||0;for(var d=0;d<32;d++)G[i+d+17>>0]=a.c_cc[d]||0;return 0}return 0}case 21510:case 21511:case 21512:return n.tty?0:-59;case 21506:case 21507:case 21508:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tcsets){for(var i=Z.getp(),u=f[i>>2],h=f[i+4>>2],g=f[i+8>>2],E=f[i+12>>2],F=[],d=0;d<32;d++)F.push(G[i+d+17>>0]);return n.tty.ops.ioctl_tcsets(n.tty,r,{c_iflag:u,c_oflag:h,c_cflag:g,c_lflag:E,c_cc:F})}return 0}case 21519:{if(!n.tty)return-59;var i=Z.getp();return f[i>>2]=0,0}case 21520:return n.tty?-28:-59;case 21531:{var i=Z.getp();return c.ioctl(n,r,i)}case 21523:{if(!n.tty)return-59;if(n.tty.ops.ioctl_tiocgwinsz){var $=n.tty.ops.ioctl_tiocgwinsz(n.tty),i=Z.getp();V[i>>1]=$[0],V[i+2>>1]=$[1]}return 0}case 21524:return n.tty?0:-59;case 21515:return n.tty?0:-59;default:return-28}}catch(P){if(typeof c>"u"||P.name!=="ErrnoError")throw P;return-P.errno}}function Xa(e,r){try{return e=Z.getStr(e),Z.doStat(c.lstat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function Ka(e,r,t){try{return r=Z.getStr(r),r=Z.calculateAt(e,r),r=ae.normalize(r),r[r.length-1]==="/"&&(r=r.substr(0,r.length-1)),c.mkdir(r,t,0),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function Ya(e,r,t,n){try{r=Z.getStr(r);var a=n&256,i=n&4096;return n=n&-6401,r=Z.calculateAt(e,r,i),Z.doStat(a?c.lstat:c.stat,r,t)}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return-d.errno}}function Qa(e,r,t,n){Z.varargs=n;try{r=Z.getStr(r),r=Z.calculateAt(e,r);var a=n?Z.get():0;return c.open(r,t,a).fd}catch(i){if(typeof c>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function Ja(e,r,t,n){try{if(r=Z.getStr(r),r=Z.calculateAt(e,r),n<=0)return-28;var a=c.readlink(r),i=Math.min(n,br(a)),d=G[t+i];return pe(a,t,n+1),G[t+i]=d,i}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Za(e){try{return e=Z.getStr(e),c.rmdir(e),0}catch(r){if(typeof c>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function eo(e,r){try{return e=Z.getStr(e),Z.doStat(c.stat,e,r)}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function ro(e,r,t){try{return r=Z.getStr(r),r=Z.calculateAt(e,r),t===0?c.unlink(r):t===512?c.rmdir(r):nr("Invalid flags passed to unlinkat"),0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}var nn=e=>X[e>>2]+f[e+4>>2]*4294967296;function to(e,r,t,n){try{if(r=Z.getStr(r),r=Z.calculateAt(e,r,!0),t){var d=nn(t),u=f[t+8>>2];a=d*1e3+u/(1e3*1e3),t+=16,d=nn(t),u=f[t+8>>2],i=d*1e3+u/(1e3*1e3)}else var a=Date.now(),i=a;return c.utime(r,a,i),0}catch(h){if(typeof c>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}var no=1,ao=()=>no,oo=()=>{throw 1/0},so=e=>e%4===0&&(e%100!==0||e%400===0),io=[0,31,60,91,121,152,182,213,244,274,305,335],lo=[0,31,59,90,120,151,181,212,243,273,304,334],an=e=>{var r=so(e.getFullYear()),t=r?io:lo,n=t[e.getMonth()]+e.getDate()-1;return n};function co(e,r,t){var n=_r(e,r),a=new Date(n*1e3);f[t>>2]=a.getSeconds(),f[t+4>>2]=a.getMinutes(),f[t+8>>2]=a.getHours(),f[t+12>>2]=a.getDate(),f[t+16>>2]=a.getMonth(),f[t+20>>2]=a.getFullYear()-1900,f[t+24>>2]=a.getDay();var i=an(a)|0;f[t+28>>2]=i,f[t+36>>2]=-(a.getTimezoneOffset()*60);var d=new Date(a.getFullYear(),0,1),u=new Date(a.getFullYear(),6,1).getTimezoneOffset(),h=d.getTimezoneOffset(),g=(u!=h&&a.getTimezoneOffset()==Math.min(h,u))|0;f[t+32>>2]=g}var uo=function(e){var r=(()=>{var t=new Date(f[e+20>>2]+1900,f[e+16>>2],f[e+12>>2],f[e+8>>2],f[e+4>>2],f[e>>2],0),n=f[e+32>>2],a=t.getTimezoneOffset(),i=new Date(t.getFullYear(),0,1),d=new Date(t.getFullYear(),6,1).getTimezoneOffset(),u=i.getTimezoneOffset(),h=Math.min(u,d);if(n<0)f[e+32>>2]=+(d!=u&&h==a);else if(n>0!=(h==a)){var g=Math.max(u,d),E=n>0?h:g;t.setTime(t.getTime()+(E-a)*6e4)}f[e+24>>2]=t.getDay();var F=an(t)|0;f[e+28>>2]=F,f[e>>2]=t.getSeconds(),f[e+4>>2]=t.getMinutes(),f[e+8>>2]=t.getHours(),f[e+12>>2]=t.getDate(),f[e+16>>2]=t.getMonth(),f[e+20>>2]=t.getYear();var $=t.getTime();return isNaN($)?-1:$/1e3})();return An((J=r,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)),r>>>0};function fo(e,r,t,n,a,i,d,u){var h=_r(a,i);try{if(isNaN(h))return 61;var g=Z.getStreamFromFD(n),E=c.mmap(g,e,h,r,t),F=E.ptr;return f[d>>2]=E.allocated,X[u>>2]=F,0}catch($){if(typeof c>"u"||$.name!=="ErrnoError")throw $;return-$.errno}}function mo(e,r,t,n,a,i,d){var u=_r(i,d);try{return isNaN(u)?61:(Z.doMsync(e,Z.getStreamFromFD(a),r,n,u),0)}catch(h){if(typeof c>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function po(e,r,t,n,a,i,d){var u=_r(i,d);try{if(isNaN(u))return 61;var h=Z.getStreamFromFD(a);t&2&&Z.doMsync(e,h,r,n,u),c.munmap(h)}catch(g){if(typeof c>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}var We=e=>{var r=br(e)+1,t=Ie(r);return t&&pe(e,t,r),t},ho=(e,r,t)=>{var n=new Date().getFullYear(),a=new Date(n,0,1),i=new Date(n,6,1),d=a.getTimezoneOffset(),u=i.getTimezoneOffset(),h=Math.max(d,u);X[e>>2]=h*60,f[r>>2]=+(d!=u);function g(A){var Q=A.toTimeString().match(/\(([A-Za-z ]+)\)$/);return Q?Q[1]:"GMT"}var E=g(a),F=g(i),$=We(E),P=We(F);u<d?(X[t>>2]=$,X[t+4>>2]=P):(X[t>>2]=P,X[t+4>>2]=$)},vo=()=>{nr("")},yr=(e,r)=>{if(C.mainLoop.timingMode=e,C.mainLoop.timingValue=r,!C.mainLoop.func)return 1;if(C.mainLoop.running||(C.mainLoop.running=!0),e==0)C.mainLoop.scheduler=function(){var d=Math.max(0,C.mainLoop.tickStartTime+r-Ir())|0;setTimeout(C.mainLoop.runner,d)},C.mainLoop.method="timeout";else if(e==1)C.mainLoop.scheduler=function(){C.requestAnimationFrame(C.mainLoop.runner)},C.mainLoop.method="rAF";else if(e==2){if(typeof C.setImmediate>"u")if(typeof setImmediate>"u"){var t=[],n="setimmediate",a=i=>{(i.data===n||i.data.target===n)&&(i.stopPropagation(),t.shift()())};addEventListener("message",a,!0),C.setImmediate=function(d){t.push(d),postMessage(n,"*")}}else C.setImmediate=setImmediate;C.mainLoop.scheduler=function(){C.setImmediate(C.mainLoop.runner)},C.mainLoop.method="immediate"}return 0},Ir;Ir=()=>performance.now();var on=(e,r,t,n,a)=>{H(!C.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),C.mainLoop.func=e,C.mainLoop.arg=n;var i=C.mainLoop.currentlyRunningMainloop;function d(){return!(i<C.mainLoop.currentlyRunningMainloop)}if(C.mainLoop.running=!1,C.mainLoop.runner=function(){var F,$;if(!Y){if(C.mainLoop.queue.length>0){var h=C.mainLoop.queue.shift();if(h.func(h.arg),C.mainLoop.remainingBlockers){var g=C.mainLoop.remainingBlockers,E=g%1==0?g-1:Math.floor(g);h.counted?C.mainLoop.remainingBlockers=E:(E=E+.5,C.mainLoop.remainingBlockers=(8*g+E)/9)}if(C.mainLoop.updateStatus(),!d())return;setTimeout(C.mainLoop.runner,0);return}if(d()){if(C.mainLoop.currentFrameNumber=C.mainLoop.currentFrameNumber+1|0,C.mainLoop.timingMode==1&&C.mainLoop.timingValue>1&&C.mainLoop.currentFrameNumber%C.mainLoop.timingValue!=0){C.mainLoop.scheduler();return}else C.mainLoop.timingMode==0&&(C.mainLoop.tickStartTime=Ir());C.mainLoop.runIter(e),d()&&(typeof SDL=="object"&&(($=(F=SDL.audio)==null?void 0:F.queueNewAudioData)==null||$.call(F)),C.mainLoop.scheduler())}}},a||(r&&r>0?yr(0,1e3/r):yr(1,1),C.mainLoop.scheduler()),t)throw"unwind"},ft=e=>{if(e instanceof Qt||e=="unwind")return ee;k(1,e)},go=0,sn=()=>Pa||go>0,xo=e=>{var r;ee=e,sn()||((r=s.onExit)==null||r.call(s,e),Y=!0),k(e,new Qt(e))},ln=(e,r)=>{ee=e,xo(e)},cn=ln,bo=()=>{if(!sn())try{cn(ee)}catch(e){ft(e)}},mt=e=>{if(!Y)try{e(),bo()}catch(r){ft(r)}},dn=(e,r)=>setTimeout(()=>{mt(e)},r),C={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause(){C.mainLoop.scheduler=null,C.mainLoop.currentlyRunningMainloop++},resume(){C.mainLoop.currentlyRunningMainloop++;var e=C.mainLoop.timingMode,r=C.mainLoop.timingValue,t=C.mainLoop.func;C.mainLoop.func=null,on(t,0,!1,C.mainLoop.arg,!0),yr(e,r),C.mainLoop.scheduler()},updateStatus(){if(s.setStatus){var e=s.statusMessage||"Please wait...",r=C.mainLoop.remainingBlockers,t=C.mainLoop.expectedBlockers;r?r<t?s.setStatus(e+" ("+(t-r)+"/"+t+")"):s.setStatus(e):s.setStatus("")}},runIter(e){var t;if(!Y){if(s.preMainLoop){var r=s.preMainLoop();if(r===!1)return}mt(e),(t=s.postMainLoop)==null||t.call(s)}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init(){if(C.initted)return;C.initted=!0;var e={};e.canHandle=function(i){return!s.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(i)},e.handle=function(i,d,u,h){var g=new Blob([i],{type:C.getMimetype(d)});g.size!==i.length&&(g=new Blob([new Uint8Array(i).buffer],{type:C.getMimetype(d)}));var E=URL.createObjectURL(g),F=new Image;F.onload=()=>{H(F.complete,`Image ${d} could not be decoded`);var $=document.createElement("canvas");$.width=F.width,$.height=F.height;var P=$.getContext("2d");P.drawImage(F,0,0),URL.revokeObjectURL(E),u==null||u(i)},F.onerror=$=>{B(`Image ${E} could not be decoded`),h==null||h()},F.src=E},dt.push(e);var r={};r.canHandle=function(i){return!s.noAudioDecoding&&i.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(i,d,u,h){var g=!1;function E(A){g||(g=!0,u==null||u(i))}var F=new Blob([i],{type:C.getMimetype(d)}),$=URL.createObjectURL(F),P=new Audio;P.addEventListener("canplaythrough",()=>E(),!1),P.onerror=function(Q){if(g)return;B(`warning: browser could not fully decode audio ${d}, trying slower base64 approach`);function he(ue){for(var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ve="=",ge="",Ee=0,Ue=0,xe=0;xe<ue.length;xe++)for(Ee=Ee<<8|ue[xe],Ue+=8;Ue>=6;){var Pm=Ee>>Ue-6&63;Ue-=6,ge+=_e[Pm]}return Ue==2?(ge+=_e[(Ee&3)<<4],ge+=ve+ve):Ue==4&&(ge+=_e[(Ee&15)<<2],ge+=ve),ge}P.src="data:audio/x-"+d.substr(-3)+";base64,"+he(i),E()},P.src=$,dn(()=>{E()},1e4)},dt.push(r);function t(){C.pointerLock=document.pointerLockElement===s.canvas||document.mozPointerLockElement===s.canvas||document.webkitPointerLockElement===s.canvas||document.msPointerLockElement===s.canvas}var n=s.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||(()=>{}),n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||(()=>{}),n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),s.elementPointerLock&&n.addEventListener("click",a=>{!C.pointerLock&&s.canvas.requestPointerLock&&(s.canvas.requestPointerLock(),a.preventDefault())},!1))},createContext(e,r,t,n){if(r&&s.ctx&&e==s.canvas)return s.ctx;var a,i;if(r){var d={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var u in n)d[u]=n[u];typeof j<"u"&&(i=j.createContext(e,d),i&&(a=j.getContext(i).GLctx))}else a=e.getContext("2d");return a?(t&&(r||H(typeof y>"u","cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),s.ctx=a,r&&j.makeContextCurrent(i),s.useWebGL=r,C.moduleContextCreatedCallbacks.forEach(h=>h()),C.init()),a):null},destroyContext(e,r,t){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen(e,r){C.lockPointer=e,C.resizeCanvas=r,typeof C.lockPointer>"u"&&(C.lockPointer=!0),typeof C.resizeCanvas>"u"&&(C.resizeCanvas=!1);var t=s.canvas;function n(){var d,u;C.isFullscreen=!1;var i=t.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===i?(t.exitFullscreen=C.exitFullscreen,C.lockPointer&&t.requestPointerLock(),C.isFullscreen=!0,C.resizeCanvas?C.setFullscreenCanvasSize():C.updateCanvasDimensions(t)):(i.parentNode.insertBefore(t,i),i.parentNode.removeChild(i),C.resizeCanvas?C.setWindowedCanvasSize():C.updateCanvasDimensions(t)),(d=s.onFullScreen)==null||d.call(s,C.isFullscreen),(u=s.onFullscreen)==null||u.call(s,C.isFullscreen)}C.fullscreenHandlersInstalled||(C.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var a=document.createElement("div");t.parentNode.insertBefore(a,t),a.appendChild(t),a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||(a.webkitRequestFullscreen?()=>a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):null)||(a.webkitRequestFullScreen?()=>a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):null),a.requestFullscreen()},exitFullscreen(){if(!C.isFullscreen)return!1;var e=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||(()=>{});return e.apply(document,[]),!0},nextRAF:0,fakeRequestAnimationFrame(e){var r=Date.now();if(C.nextRAF===0)C.nextRAF=r+1e3/60;else for(;r+2>=C.nextRAF;)C.nextRAF+=1e3/60;var t=Math.max(C.nextRAF-r,0);setTimeout(e,t)},requestAnimationFrame(e){if(typeof requestAnimationFrame=="function"){requestAnimationFrame(e);return}var r=C.fakeRequestAnimationFrame;r(e)},safeSetTimeout(e,r){return dn(e,r)},safeRequestAnimationFrame(e){return C.requestAnimationFrame(()=>{mt(e)})},getMimetype(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]},getUserMedia(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta(e){var r=0;switch(e.type){case"DOMMouseScroll":r=e.detail/3;break;case"mousewheel":r=e.wheelDelta/120;break;case"wheel":switch(r=e.deltaY,e.deltaMode){case 0:r/=100;break;case 1:r/=3;break;case 2:r*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return r},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseCoords(e,r){var t=s.canvas.getBoundingClientRect(),n=s.canvas.width,a=s.canvas.height,i=typeof window.scrollX<"u"?window.scrollX:window.pageXOffset,d=typeof window.scrollY<"u"?window.scrollY:window.pageYOffset,u=e-(i+t.left),h=r-(d+t.top);return u=u*(n/t.width),h=h*(a/t.height),{x:u,y:h}},setMouseCoords(e,r){const{x:t,y:n}=C.calculateMouseCoords(e,r);C.mouseMovementX=t-C.mouseX,C.mouseMovementY=n-C.mouseY,C.mouseX=t,C.mouseY=n},calculateMouseEvent(e){if(C.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?C.mouseMovementX=C.mouseMovementY=0:(C.mouseMovementX=C.getMovementX(e),C.mouseMovementY=C.getMovementY(e)),typeof SDL<"u"?(C.mouseX=SDL.mouseX+C.mouseMovementX,C.mouseY=SDL.mouseY+C.mouseMovementY):(C.mouseX+=C.mouseMovementX,C.mouseY+=C.mouseMovementY);else{if(e.type==="touchstart"||e.type==="touchend"||e.type==="touchmove"){var r=e.touch;if(r===void 0)return;var t=C.calculateMouseCoords(r.pageX,r.pageY);if(e.type==="touchstart")C.lastTouches[r.identifier]=t,C.touches[r.identifier]=t;else if(e.type==="touchend"||e.type==="touchmove"){var n=C.touches[r.identifier];n||(n=t),C.lastTouches[r.identifier]=n,C.touches[r.identifier]=t}return}C.setMouseCoords(e.pageX,e.pageY)}},resizeListeners:[],updateResizeListeners(){var e=s.canvas;C.resizeListeners.forEach(r=>r(e.width,e.height))},setCanvasSize(e,r,t){var n=s.canvas;C.updateCanvasDimensions(n,e,r),t||C.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize(){if(typeof SDL<"u"){var e=X[SDL.screen>>2];e=e|8388608,f[SDL.screen>>2]=e}C.updateCanvasDimensions(s.canvas),C.updateResizeListeners()},setWindowedCanvasSize(){if(typeof SDL<"u"){var e=X[SDL.screen>>2];e=e&-8388609,f[SDL.screen>>2]=e}C.updateCanvasDimensions(s.canvas),C.updateResizeListeners()},updateCanvasDimensions(e,r,t){r&&t?(e.widthNative=r,e.heightNative=t):(r=e.widthNative,t=e.heightNative);var n=r,a=t;if(s.forcedAspectRatio&&s.forcedAspectRatio>0&&(n/a<s.forcedAspectRatio?n=Math.round(a*s.forcedAspectRatio):a=Math.round(n/s.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&typeof screen<"u"){var i=Math.min(screen.width/n,screen.height/a);n=Math.round(n*i),a=Math.round(a*i)}C.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=a&&(e.height=a),typeof e.style<"u"&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=r&&(e.width=r),e.height!=t&&(e.height=t),typeof e.style<"u"&&(n!=r||a!=t?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",a+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}},U={errorCode:12288,defaultDisplayInitialized:!1,currentContext:0,currentReadSurface:0,currentDrawSurface:0,contextAttributes:{alpha:!1,depth:!1,stencil:!1,antialias:!1},stringCache:{},setErrorCode(e){U.errorCode=e},chooseConfig(e,r,t,n,a){if(e!=62e3)return U.setErrorCode(12296),0;if(r)for(;;){var i=f[r>>2];if(i==12321){var d=f[r+4>>2];U.contextAttributes.alpha=d>0}else if(i==12325){var u=f[r+4>>2];U.contextAttributes.depth=u>0}else if(i==12326){var h=f[r+4>>2];U.contextAttributes.stencil=h>0}else if(i==12337){var g=f[r+4>>2];U.contextAttributes.antialias=g>0}else if(i==12338){var g=f[r+4>>2];U.contextAttributes.antialias=g==1}else if(i==12544){var E=f[r+4>>2];U.contextAttributes.lowLatency=E!=12547}else if(i==12344)break;r+=8}return(!t||!n)&&!a?(U.setErrorCode(12300),0):(a&&(f[a>>2]=1),t&&n>0&&(X[t>>2]=62002),U.setErrorCode(12288),1)}},_o=e=>e==12448?(U.setErrorCode(12288),1):(U.setErrorCode(12300),0),yo=(e,r,t,n,a)=>U.chooseConfig(e,r,t,n,a),wo=e=>{var r=e.getExtension("ANGLE_instanced_arrays");if(r)return e.vertexAttribDivisor=(t,n)=>r.vertexAttribDivisorANGLE(t,n),e.drawArraysInstanced=(t,n,a,i)=>r.drawArraysInstancedANGLE(t,n,a,i),e.drawElementsInstanced=(t,n,a,i,d)=>r.drawElementsInstancedANGLE(t,n,a,i,d),1},So=e=>{var r=e.getExtension("OES_vertex_array_object");if(r)return e.createVertexArray=()=>r.createVertexArrayOES(),e.deleteVertexArray=t=>r.deleteVertexArrayOES(t),e.bindVertexArray=t=>r.bindVertexArrayOES(t),e.isVertexArray=t=>r.isVertexArrayOES(t),1},Eo=e=>{var r=e.getExtension("WEBGL_draw_buffers");if(r)return e.drawBuffers=(t,n)=>r.drawBuffersWEBGL(t,n),1},Co=e=>!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")),un=function(e){var r=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_half_float","EXT_float_blend","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw"];return(e.getSupportedExtensions()||[]).filter(t=>r.includes(t))},j={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(r){j.lastError||(j.lastError=r)},getNewId:e=>{for(var r=j.counter++,t=e.length;t<r;t++)e[t]=null;return r},getSource:(e,r,t,n)=>{for(var a="",i=0;i<r;++i){var d=n?X[n+i*4>>2]:void 0;a+=je(X[t+i*4>>2],d)}return a},createContext:(e,r)=>{if(!e.getContextSafariWebGL2Fixed){let a=function(i,d){var u=e.getContextSafariWebGL2Fixed(i,d);return i=="webgl"==u instanceof WebGLRenderingContext?u:null};e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=a}var t=e.getContext("webgl",r);if(!t)return 0;var n=j.registerContext(t,r);return n},registerContext:(e,r)=>{var t=j.getNewId(j.contexts),n={handle:t,attributes:r,version:r.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),j.contexts[t]=n,(typeof r.enableExtensionsByDefault>"u"||r.enableExtensionsByDefault)&&j.initExtensions(n),t},makeContextCurrent:e=>{var r;return j.currentContext=j.contexts[e],s.ctx=y=(r=j.currentContext)==null?void 0:r.GLctx,!(e&&!y)},getContext:e=>j.contexts[e],deleteContext:e=>{j.currentContext===j.contexts[e]&&(j.currentContext=null),typeof M=="object"&&M.removeAllHandlersOnTarget(j.contexts[e].GLctx.canvas),j.contexts[e]&&j.contexts[e].GLctx.canvas&&(j.contexts[e].GLctx.canvas.GLctxObject=void 0),j.contexts[e]=null},initExtensions:e=>{if(e||(e=j.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var r=e.GLctx;wo(r),So(r),Eo(r),r.disjointTimerQueryExt=r.getExtension("EXT_disjoint_timer_query"),Co(r),un(r).forEach(t=>{!t.includes("lose_context")&&!t.includes("debug")&&r.getExtension(t)})}}},ko=(e,r,t,n)=>{if(e!=62e3)return U.setErrorCode(12296),0;for(var a=1;;){var i=f[n>>2];if(i==12440)a=f[n+4>>2];else{if(i==12344)break;return U.setErrorCode(12292),0}n+=8}return a!=2?(U.setErrorCode(12293),0):(U.contextAttributes.majorVersion=a-1,U.contextAttributes.minorVersion=0,U.context=j.createContext(s.canvas,U.contextAttributes),U.context!=0?(U.setErrorCode(12288),j.makeContextCurrent(U.context),s.useWebGL=!0,C.moduleContextCreatedCallbacks.forEach(function(d){d()}),j.makeContextCurrent(null),62004):(U.setErrorCode(12297),0))},jo=(e,r,t,n)=>e!=62e3?(U.setErrorCode(12296),0):r!=62002?(U.setErrorCode(12293),0):(U.setErrorCode(12288),62006),Lo=(e,r)=>e!=62e3?(U.setErrorCode(12296),0):r!=62004?(U.setErrorCode(12294),0):(j.deleteContext(U.context),U.setErrorCode(12288),U.currentContext==r&&(U.currentContext=0),1),Fo=(e,r)=>e!=62e3?(U.setErrorCode(12296),0):r!=62006?(U.setErrorCode(12301),1):(U.currentReadSurface==r&&(U.currentReadSurface=0),U.currentDrawSurface==r&&(U.currentDrawSurface=0),U.setErrorCode(12288),1),Ro=(e,r,t,n)=>{if(e!=62e3)return U.setErrorCode(12296),0;if(r!=62002)return U.setErrorCode(12293),0;if(!n)return U.setErrorCode(12300),0;switch(U.setErrorCode(12288),t){case 12320:return f[n>>2]=U.contextAttributes.alpha?32:24,1;case 12321:return f[n>>2]=U.contextAttributes.alpha?8:0,1;case 12322:return f[n>>2]=8,1;case 12323:return f[n>>2]=8,1;case 12324:return f[n>>2]=8,1;case 12325:return f[n>>2]=U.contextAttributes.depth?24:0,1;case 12326:return f[n>>2]=U.contextAttributes.stencil?8:0,1;case 12327:return f[n>>2]=12344,1;case 12328:return f[n>>2]=62002,1;case 12329:return f[n>>2]=0,1;case 12330:return f[n>>2]=4096,1;case 12331:return f[n>>2]=16777216,1;case 12332:return f[n>>2]=4096,1;case 12333:return f[n>>2]=0,1;case 12334:return f[n>>2]=0,1;case 12335:return f[n>>2]=12344,1;case 12337:return f[n>>2]=U.contextAttributes.antialias?4:0,1;case 12338:return f[n>>2]=U.contextAttributes.antialias?1:0,1;case 12339:return f[n>>2]=4,1;case 12340:return f[n>>2]=12344,1;case 12341:case 12342:case 12343:return f[n>>2]=-1,1;case 12345:case 12346:return f[n>>2]=0,1;case 12347:return f[n>>2]=0,1;case 12348:return f[n>>2]=1,1;case 12349:case 12350:return f[n>>2]=0,1;case 12351:return f[n>>2]=12430,1;case 12352:return f[n>>2]=4,1;case 12354:return f[n>>2]=0,1;default:return U.setErrorCode(12292),0}},To=e=>(U.setErrorCode(12288),e!=0&&e!=1?0:62e3),Po=()=>U.errorCode,Mo=(e,r,t)=>e!=62e3?(U.setErrorCode(12296),0):(r&&(f[r>>2]=1),t&&(f[t>>2]=4),U.defaultDisplayInitialized=!0,U.setErrorCode(12288),1),Do=(e,r,t,n)=>e!=62e3?(U.setErrorCode(12296),0):n!=0&&n!=62004?(U.setErrorCode(12294),0):t!=0&&t!=62006||r!=0&&r!=62006?(U.setErrorCode(12301),0):(j.makeContextCurrent(n?U.context:null),U.currentContext=n,U.currentDrawSurface=r,U.currentReadSurface=t,U.setErrorCode(12288),1),Ao=(e,r)=>{if(e!=62e3)return U.setErrorCode(12296),0;if(U.setErrorCode(12288),U.stringCache[r])return U.stringCache[r];var t;switch(r){case 12371:t=We("Emscripten");break;case 12372:t=We("1.4 Emscripten EGL");break;case 12373:t=We("");break;case 12429:t=We("OpenGL_ES");break;default:return U.setErrorCode(12300),0}return U.stringCache[r]=t,t},Bo=(e,r)=>{if(!U.defaultDisplayInitialized)U.setErrorCode(12289);else if(!s.ctx)U.setErrorCode(12290);else if(s.ctx.isContextLost())U.setErrorCode(12302);else return U.setErrorCode(12288),1;return 0},Io=(e,r)=>e!=62e3?(U.setErrorCode(12296),0):(r==0?yr(0,0):yr(1,r),U.setErrorCode(12288),1),$o=e=>e!=62e3?(U.setErrorCode(12296),0):(U.currentContext=0,U.currentReadSurface=0,U.currentDrawSurface=0,U.defaultDisplayInitialized=!1,U.setErrorCode(12288),1),No=()=>(U.setErrorCode(12288),1),Uo=No,Oo=e=>(U.setErrorCode(12288),1),pt=[],fn=(e,r)=>{pt.length=0;for(var t;t=q[e++];){var n=t!=105;n&=t!=112,r+=n&&r%8?4:0,pt.push(t==112?X[r>>2]:t==105?f[r>>2]:oe[r>>3]),r+=n?8:4}return pt},Go=(e,r,t)=>{var n=fn(r,t);return Yt[e].apply(null,n)},zo=(e,r,t)=>Go(e,r,t),qo=(e,r,t,n)=>{var a=fn(r,t);return Yt[e].apply(null,a)},Vo=(e,r,t)=>qo(e,r,t),Ho=()=>Date.now(),mn=e=>{var r=$e(),t=e();return Ne(r),t},M={removeAllEventListeners(){for(;M.eventHandlers.length;)M._removeHandler(M.eventHandlers.length-1);M.deferredCalls=[]},inEventHandler:0,deferredCalls:[],deferCall(e,r,t){function n(d,u){if(d.length!=u.length)return!1;for(var h in d)if(d[h]!=u[h])return!1;return!0}for(var a in M.deferredCalls){var i=M.deferredCalls[a];if(i.targetFunction==e&&n(i.argsList,t))return}M.deferredCalls.push({targetFunction:e,precedence:r,argsList:t}),M.deferredCalls.sort((d,u)=>d.precedence<u.precedence)},removeDeferredCalls(e){for(var r=0;r<M.deferredCalls.length;++r)M.deferredCalls[r].targetFunction==e&&(M.deferredCalls.splice(r,1),--r)},canPerformEventHandlerRequests(){return navigator.userActivation?navigator.userActivation.isActive:M.inEventHandler&&M.currentEventHandler.allowsDeferredCalls},runDeferredCalls(){if(M.canPerformEventHandlerRequests())for(var e=0;e<M.deferredCalls.length;++e){var r=M.deferredCalls[e];M.deferredCalls.splice(e,1),--e,r.targetFunction.apply(null,r.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(e,r)=>{for(var t=0;t<M.eventHandlers.length;++t)M.eventHandlers[t].target==e&&(!r||r==M.eventHandlers[t].eventTypeString)&&M._removeHandler(t--)},_removeHandler(e){var r=M.eventHandlers[e];r.target.removeEventListener(r.eventTypeString,r.eventListenerFunc,r.useCapture),M.eventHandlers.splice(e,1)},registerOrRemoveHandler(e){if(!e.target)return-4;if(e.callbackfunc)e.eventListenerFunc=function(t){++M.inEventHandler,M.currentEventHandler=e,M.runDeferredCalls(),e.handlerFunc(t),M.runDeferredCalls(),--M.inEventHandler},e.target.addEventListener(e.eventTypeString,e.eventListenerFunc,e.useCapture),M.eventHandlers.push(e);else for(var r=0;r<M.eventHandlers.length;++r)M.eventHandlers[r].target==e.target&&M.eventHandlers[r].eventTypeString==e.eventTypeString&&M._removeHandler(r--);return 0},getNodeNameForTarget(e){return e?e==window?"#window":e==screen?"#screen":(e==null?void 0:e.nodeName)||"":""},fullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}},$r={},Wo=e=>e>2?je(e):e,Nr=[0,document,window],Re=e=>{e=Wo(e);var r=Nr[e]||document.querySelector(e);return r},pn=Re,Xo=(e,r,t)=>{var n=pn(e);if(!n)return-4;f[r>>2]=n.width,f[t>>2]=n.height},ht=e=>{var r=br(e)+1,t=Vr(r);return pe(e,t,r),t},hn=e=>mn(()=>{var r=Vr(8),t=r+4,n=ht(e.id);Xo(n,r,t);var a=[f[r>>2],f[t>>2]];return a}),vn=(e,r,t)=>{var n=pn(e);return n?(n.width=r,n.height=t,0):-4},gn=(e,r,t)=>{e.controlTransferredOffscreen?mn(()=>{var n=ht(e.id);vn(n,r,t)}):(e.width=r,e.height=t)},Ko=e=>{var r=hn(e),t=r[0],n=r[1],a=e.style.width,i=e.style.height,d=e.style.backgroundColor,u=document.body.style.backgroundColor,h=e.style.paddingLeft,g=e.style.paddingRight,E=e.style.paddingTop,F=e.style.paddingBottom,$=e.style.marginLeft,P=e.style.marginRight,A=e.style.marginTop,Q=e.style.marginBottom,he=document.body.style.margin,ue=document.documentElement.style.overflow,_e=document.body.scroll,ve=e.style.imageRendering;function ge(){var Ee=document.fullscreenElement||document.webkitFullscreenElement;Ee||(document.removeEventListener("fullscreenchange",ge),document.removeEventListener("webkitfullscreenchange",ge),gn(e,t,n),e.style.width=a,e.style.height=i,e.style.backgroundColor=d,u||(document.body.style.backgroundColor="white"),document.body.style.backgroundColor=u,e.style.paddingLeft=h,e.style.paddingRight=g,e.style.paddingTop=E,e.style.paddingBottom=F,e.style.marginLeft=$,e.style.marginRight=P,e.style.marginTop=A,e.style.marginBottom=Q,document.body.style.margin=he,document.documentElement.style.overflow=ue,document.body.scroll=_e,e.style.imageRendering=ve,e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,t,n),$r.canvasResizedCallback&&se($r.canvasResizedCallback)(37,0,$r.canvasResizedCallbackUserData))}return document.addEventListener("fullscreenchange",ge),document.addEventListener("webkitfullscreenchange",ge),ge},vt=(e,r,t)=>{e.style.paddingLeft=e.style.paddingRight=t+"px",e.style.paddingTop=e.style.paddingBottom=r+"px"},Ur=e=>Nr.indexOf(e)<0?e.getBoundingClientRect():{left:0,top:0},Yo=(e,r)=>{var t=Ko(e),n=r.softFullscreen?innerWidth:screen.width,a=r.softFullscreen?innerHeight:screen.height,i=Ur(e),d=i.width,u=i.height,h=hn(e),g=h[0],E=h[1];if(r.scaleMode==3)vt(e,(a-u)/2,(n-d)/2),n=d,a=u;else if(r.scaleMode==2)if(n*E<g*a){var F=E*n/g;vt(e,(a-F)/2,0),a=F}else{var $=g*a/E;vt(e,0,(n-$)/2),n=$}e.style.backgroundColor||(e.style.backgroundColor="black"),document.body.style.backgroundColor||(document.body.style.backgroundColor="black"),e.style.width=n+"px",e.style.height=a+"px",r.filteringMode==1&&(e.style.imageRendering="optimizeSpeed",e.style.imageRendering="-moz-crisp-edges",e.style.imageRendering="-o-crisp-edges",e.style.imageRendering="-webkit-optimize-contrast",e.style.imageRendering="optimize-contrast",e.style.imageRendering="crisp-edges",e.style.imageRendering="pixelated");var P=r.canvasResolutionScaleMode==2?devicePixelRatio:1;if(r.canvasResolutionScaleMode!=0){var A=n*P|0,Q=a*P|0;gn(e,A,Q),e.GLctxObject&&e.GLctxObject.GLctx.viewport(0,0,A,Q)}return t},gt=(e,r)=>{if((r.scaleMode!=0||r.canvasResolutionScaleMode!=0)&&Yo(e,r),e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else return M.fullscreenEnabled()?-3:-1;return $r=r,r.canvasResizedCallback&&se(r.canvasResizedCallback)(37,0,r.canvasResizedCallbackUserData),0},Qo=()=>{if(!M.fullscreenEnabled())return-1;M.removeDeferredCalls(gt);var e=Nr[1];if(e.exitFullscreen)e.fullscreenElement&&e.exitFullscreen();else if(e.webkitExitFullscreen)e.webkitFullscreenElement&&e.webkitExitFullscreen();else return-1;return 0},xt=e=>{if(e.requestPointerLock)e.requestPointerLock();else return document.body.requestPointerLock?-3:-1;return 0},Jo=()=>{if(M.removeDeferredCalls(xt),document.exitPointerLock)document.exitPointerLock();else return-1;return 0},Zo=()=>devicePixelRatio,es=(e,r,t)=>{if(e=Re(e),!e)return-4;var n=Ur(e);return oe[r>>3]=n.width,oe[t>>3]=n.height,0},xn=(e,r)=>{oe[e>>3]=r.timestamp;for(var t=0;t<r.axes.length;++t)oe[e+t*8+16>>3]=r.axes[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?oe[e+t*8+528>>3]=r.buttons[t].value:oe[e+t*8+528>>3]=r.buttons[t];for(var t=0;t<r.buttons.length;++t)typeof r.buttons[t]=="object"?f[e+t*4+1040>>2]=r.buttons[t].pressed:f[e+t*4+1040>>2]=r.buttons[t]==1;f[e+1296>>2]=r.connected,f[e+1300>>2]=r.index,f[e+8>>2]=r.axes.length,f[e+12>>2]=r.buttons.length,pe(r.id,e+1304,64),pe(r.mapping,e+1368,64)},rs=(e,r)=>e<0||e>=M.lastGamepadState.length?-5:M.lastGamepadState[e]?(xn(r,M.lastGamepadState[e]),0):-7,ts=(e,r)=>{e&&(f[e>>2]=C.mainLoop.timingMode),r&&(f[r>>2]=C.mainLoop.timingValue)},ns=()=>M.lastGamepadState.length,as=(e,r)=>{f[e>>2]=screen.width,f[r>>2]=screen.height};function os(e){y.activeTexture(e)}var ss=os,is=(e,r)=>{y.attachShader(j.programs[e],j.shaders[r])},ls=is,cs=(e,r)=>{y.disjointTimerQueryExt.beginQueryEXT(e,j.queries[r])},ds=cs,us=(e,r,t)=>{y.bindAttribLocation(j.programs[e],r,je(t))},fs=us,ms=(e,r)=>{y.bindBuffer(e,j.buffers[r])},ps=ms,hs=(e,r)=>{y.bindFramebuffer(e,j.framebuffers[r])},vs=hs,gs=(e,r)=>{y.bindRenderbuffer(e,j.renderbuffers[r])},xs=gs,bs=(e,r)=>{y.bindTexture(e,j.textures[r])},_s=bs,ys=e=>{y.bindVertexArray(j.vaos[e])},ws=ys,Ss=ws;function Es(e,r,t,n){y.blendColor(e,r,t,n)}var Cs=Es;function ks(e){y.blendEquation(e)}var js=ks;function Ls(e,r){y.blendEquationSeparate(e,r)}var Fs=Ls;function Rs(e,r){y.blendFunc(e,r)}var Ts=Rs;function Ps(e,r,t,n){y.blendFuncSeparate(e,r,t,n)}var Ms=Ps,Ds=(e,r,t,n)=>{y.bufferData(e,t?q.subarray(t,t+r):r,n)},As=Ds,Bs=(e,r,t,n)=>{y.bufferSubData(e,r,q.subarray(n,n+t))},Is=Bs;function $s(e){return y.checkFramebufferStatus(e)}var Ns=$s;function Us(e){y.clear(e)}var Os=Us;function Gs(e,r,t,n){y.clearColor(e,r,t,n)}var zs=Gs;function qs(e){y.clearDepth(e)}var Vs=qs;function Hs(e){y.clearStencil(e)}var Ws=Hs,Xs=(e,r,t,n)=>{y.colorMask(!!e,!!r,!!t,!!n)},Ks=Xs,Ys=e=>{y.compileShader(j.shaders[e])},Qs=Ys,Js=(e,r,t,n,a,i,d,u)=>{y.compressedTexImage2D(e,r,t,n,a,i,u?q.subarray(u,u+d):null)},Zs=Js,ei=(e,r,t,n,a,i,d,u,h)=>{y.compressedTexSubImage2D(e,r,t,n,a,i,d,h?q.subarray(h,h+u):null)},ri=ei;function ti(e,r,t,n,a,i,d,u){y.copyTexImage2D(e,r,t,n,a,i,d,u)}var ni=ti;function ai(e,r,t,n,a,i,d,u){y.copyTexSubImage2D(e,r,t,n,a,i,d,u)}var oi=ai,si=()=>{var e=j.getNewId(j.programs),r=y.createProgram();return r.name=e,r.maxUniformLength=r.maxAttributeLength=r.maxUniformBlockNameLength=0,r.uniformIdCounter=1,j.programs[e]=r,e},ii=si,li=e=>{var r=j.getNewId(j.shaders);return j.shaders[r]=y.createShader(e),r},ci=li;function di(e){y.cullFace(e)}var ui=di,fi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=j.buffers[n];a&&(y.deleteBuffer(a),a.name=0,j.buffers[n]=null)}},mi=fi,pi=(e,r)=>{for(var t=0;t<e;++t){var n=f[r+t*4>>2],a=j.framebuffers[n];a&&(y.deleteFramebuffer(a),a.name=0,j.framebuffers[n]=null)}},hi=pi,vi=e=>{if(e){var r=j.programs[e];if(!r){j.recordError(1281);return}y.deleteProgram(r),r.name=0,j.programs[e]=null}},gi=vi,xi=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=j.queries[n];a&&(y.disjointTimerQueryExt.deleteQueryEXT(a),j.queries[n]=null)}},bi=xi,_i=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=j.renderbuffers[n];a&&(y.deleteRenderbuffer(a),a.name=0,j.renderbuffers[n]=null)}},yi=_i,wi=e=>{if(e){var r=j.shaders[e];if(!r){j.recordError(1281);return}y.deleteShader(r),j.shaders[e]=null}},Si=wi,Ei=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2],a=j.textures[n];a&&(y.deleteTexture(a),a.name=0,j.textures[n]=null)}},Ci=Ei,ki=(e,r)=>{for(var t=0;t<e;t++){var n=f[r+t*4>>2];y.deleteVertexArray(j.vaos[n]),j.vaos[n]=null}},ji=ki,Li=ji;function Fi(e){y.depthFunc(e)}var Ri=Fi,Ti=e=>{y.depthMask(!!e)},Pi=Ti;function Mi(e,r){y.depthRange(e,r)}var Di=Mi,Ai=(e,r)=>{y.detachShader(j.programs[e],j.shaders[r])},Bi=Ai;function Ii(e){y.disable(e)}var $i=Ii,Ni=e=>{y.disableVertexAttribArray(e)},Ui=Ni,Oi=(e,r,t)=>{y.drawArrays(e,r,t)},Gi=Oi,zi=(e,r,t,n)=>{y.drawArraysInstanced(e,r,t,n)},qi=zi,Vi=qi,bn=[],Hi=(e,r)=>{for(var t=bn[e],n=0;n<e;n++)t[n]=f[r+n*4>>2];y.drawBuffers(t)},Wi=Hi,Xi=Wi,Ki=(e,r,t,n)=>{y.drawElements(e,r,t,n)},Yi=Ki,Qi=(e,r,t,n,a)=>{y.drawElementsInstanced(e,r,t,n,a)},Ji=Qi,Zi=Ji;function el(e){y.enable(e)}var rl=el,tl=e=>{y.enableVertexAttribArray(e)},nl=tl,al=e=>{y.disjointTimerQueryExt.endQueryEXT(e)},ol=al;function sl(){y.finish()}var il=sl;function ll(){y.flush()}var cl=ll,dl=(e,r,t,n)=>{y.framebufferRenderbuffer(e,r,t,j.renderbuffers[n])},ul=dl,fl=(e,r,t,n,a)=>{y.framebufferTexture2D(e,r,t,j.textures[n],a)},ml=fl;function pl(e){y.frontFace(e)}var hl=pl,kr=(e,r,t,n)=>{for(var a=0;a<e;a++){var i=y[t](),d=i&&j.getNewId(n);i?(i.name=d,n[d]=i):j.recordError(1282),f[r+a*4>>2]=d}},vl=(e,r)=>{kr(e,r,"createBuffer",j.buffers)},gl=vl,xl=(e,r)=>{kr(e,r,"createFramebuffer",j.framebuffers)},bl=xl,_l=(e,r)=>{for(var t=0;t<e;t++){var n=y.disjointTimerQueryExt.createQueryEXT();if(!n){for(j.recordError(1282);t<e;)f[r+t++*4>>2]=0;return}var a=j.getNewId(j.queries);n.name=a,j.queries[a]=n,f[r+t*4>>2]=a}},yl=_l,wl=(e,r)=>{kr(e,r,"createRenderbuffer",j.renderbuffers)},Sl=wl,El=(e,r)=>{kr(e,r,"createTexture",j.textures)},Cl=El;function kl(e,r){kr(e,r,"createVertexArray",j.vaos)}var jl=kl,Ll=jl;function Fl(e){y.generateMipmap(e)}var Rl=Fl,_n=(e,r,t,n,a,i,d,u)=>{r=j.programs[r];var h=y[e](r,t);if(h){var g=u&&pe(h.name,u,n);a&&(f[a>>2]=g),i&&(f[i>>2]=h.size),d&&(f[d>>2]=h.type)}},Tl=(e,r,t,n,a,i,d)=>{_n("getActiveAttrib",e,r,t,n,a,i,d)},Pl=Tl,Ml=(e,r,t,n,a,i,d)=>{_n("getActiveUniform",e,r,t,n,a,i,d)},Dl=Ml,Al=(e,r,t,n)=>{var a=y.getAttachedShaders(j.programs[e]),i=a.length;i>r&&(i=r),f[t>>2]=i;for(var d=0;d<i;++d){var u=j.shaders.indexOf(a[d]);f[n+d*4>>2]=u}},Bl=Al,Il=(e,r)=>y.getAttribLocation(j.programs[e],je(r)),$l=Il,yn=(e,r)=>{X[e>>2]=r;var t=X[e>>2];X[e+4>>2]=(r-t)/4294967296},bt=(e,r,t)=>{if(!r){j.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:t!=0&&t!=1&&j.recordError(1280);return;case 36345:n=0;break;case 34466:var a=y.getParameter(34467);n=a?a.length:0;break}if(n===void 0){var i=y.getParameter(e);switch(typeof i){case"number":n=i;break;case"boolean":n=i?1:0;break;case"string":j.recordError(1280);return;case"object":if(i===null)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:{n=0;break}default:{j.recordError(1280);return}}else if(i instanceof Float32Array||i instanceof Uint32Array||i instanceof Int32Array||i instanceof Array){for(var d=0;d<i.length;++d)switch(t){case 0:f[r+d*4>>2]=i[d];break;case 2:K[r+d*4>>2]=i[d];break;case 4:G[r+d>>0]=i[d]?1:0;break}return}else try{n=i.name|0}catch(u){j.recordError(1280),B(`GL_INVALID_ENUM in glGet${t}v: Unknown object returned from WebGL getParameter(${e})! (error: ${u})`);return}break;default:j.recordError(1280),B(`GL_INVALID_ENUM in glGet${t}v: Native code calling glGet${t}v(${e}) and it returns ${i} of type ${typeof i}!`);return}}switch(t){case 1:yn(r,n);break;case 0:f[r>>2]=n;break;case 2:K[r>>2]=n;break;case 4:G[r>>0]=n?1:0;break}},Nl=(e,r)=>bt(e,r,4),Ul=Nl,Ol=(e,r,t)=>{if(!t){j.recordError(1281);return}f[t>>2]=y.getBufferParameter(e,r)},Gl=Ol,zl=()=>{var e=y.getError()||j.lastError;return j.lastError=0,e},ql=zl,Vl=(e,r)=>bt(e,r,2),Hl=Vl,Wl=(e,r,t,n)=>{var a=y.getFramebufferAttachmentParameter(e,r,t);(a instanceof WebGLRenderbuffer||a instanceof WebGLTexture)&&(a=a.name|0),f[n>>2]=a},Xl=Wl,Kl=(e,r)=>bt(e,r,0),Yl=Kl,Ql=(e,r,t,n)=>{var a=y.getProgramInfoLog(j.programs[e]);a===null&&(a="(unknown error)");var i=r>0&&n?pe(a,n,r):0;t&&(f[t>>2]=i)},Jl=Ql,Zl=(e,r,t)=>{if(!t){j.recordError(1281);return}if(e>=j.counter){j.recordError(1281);return}if(e=j.programs[e],r==35716){var n=y.getProgramInfoLog(e);n===null&&(n="(unknown error)"),f[t>>2]=n.length+1}else if(r==35719){if(!e.maxUniformLength)for(var a=0;a<y.getProgramParameter(e,35718);++a)e.maxUniformLength=Math.max(e.maxUniformLength,y.getActiveUniform(e,a).name.length+1);f[t>>2]=e.maxUniformLength}else if(r==35722){if(!e.maxAttributeLength)for(var a=0;a<y.getProgramParameter(e,35721);++a)e.maxAttributeLength=Math.max(e.maxAttributeLength,y.getActiveAttrib(e,a).name.length+1);f[t>>2]=e.maxAttributeLength}else if(r==35381){if(!e.maxUniformBlockNameLength)for(var a=0;a<y.getProgramParameter(e,35382);++a)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,y.getActiveUniformBlockName(e,a).length+1);f[t>>2]=e.maxUniformBlockNameLength}else f[t>>2]=y.getProgramParameter(e,r)},ec=Zl,wn=(e,r,t)=>{if(!t){j.recordError(1281);return}var n=j.queries[e],a;a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r);var i;typeof a=="boolean"?i=a?1:0:i=a,yn(t,i)},rc=wn,Sn=(e,r,t)=>{if(!t){j.recordError(1281);return}var n=j.queries[e],a=y.disjointTimerQueryExt.getQueryObjectEXT(n,r),i;typeof a=="boolean"?i=a?1:0:i=a,f[t>>2]=i},tc=Sn,nc=wn,ac=nc,oc=Sn,sc=oc,ic=(e,r,t)=>{if(!t){j.recordError(1281);return}f[t>>2]=y.disjointTimerQueryExt.getQueryEXT(e,r)},lc=ic,cc=(e,r,t)=>{if(!t){j.recordError(1281);return}f[t>>2]=y.getRenderbufferParameter(e,r)},dc=cc,uc=(e,r,t,n)=>{var a=y.getShaderInfoLog(j.shaders[e]);a===null&&(a="(unknown error)");var i=r>0&&n?pe(a,n,r):0;t&&(f[t>>2]=i)},fc=uc,mc=(e,r,t,n)=>{var a=y.getShaderPrecisionFormat(e,r);f[t>>2]=a.rangeMin,f[t+4>>2]=a.rangeMax,f[n>>2]=a.precision},pc=mc,hc=(e,r,t,n)=>{var a=y.getShaderSource(j.shaders[e]);if(a){var i=r>0&&n?pe(a,n,r):0;t&&(f[t>>2]=i)}},vc=hc,gc=(e,r,t)=>{if(!t){j.recordError(1281);return}if(r==35716){var n=y.getShaderInfoLog(j.shaders[e]);n===null&&(n="(unknown error)");var a=n?n.length+1:0;f[t>>2]=a}else if(r==35720){var i=y.getShaderSource(j.shaders[e]),d=i?i.length+1:0;f[t>>2]=d}else f[t>>2]=y.getShaderParameter(j.shaders[e],r)},xc=gc,bc=function(){var r=un(y);return r=r.concat(r.map(t=>"GL_"+t)),r},_c=e=>{var r=j.stringCache[e];if(!r){switch(e){case 7939:r=We(bc().join(" "));break;case 7936:case 7937:case 37445:case 37446:var t=y.getParameter(e);t||j.recordError(1280),r=t?We(t):0;break;case 7938:var n=y.getParameter(7938);n=`OpenGL ES 2.0 (${n})`,r=We(n);break;case 35724:var a=y.getParameter(35724),i=/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/,d=a.match(i);d!==null&&(d[1].length==3&&(d[1]=d[1]+"0"),a=`OpenGL ES GLSL ES ${d[1]} (${a})`),r=We(a);break;default:j.recordError(1280)}j.stringCache[e]=r}return r},yc=_c,wc=(e,r,t)=>{if(!t){j.recordError(1281);return}K[t>>2]=y.getTexParameter(e,r)},Sc=wc,Ec=(e,r,t)=>{if(!t){j.recordError(1281);return}f[t>>2]=y.getTexParameter(e,r)},Cc=Ec,kc=e=>parseInt(e),En=e=>e.slice(-1)=="]"&&e.lastIndexOf("["),Cn=e=>{var r=e.uniformLocsById,t=e.uniformSizeAndIdsByName,n,a;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},n=0;n<y.getProgramParameter(e,35718);++n){var i=y.getActiveUniform(e,n),d=i.name,u=i.size,h=En(d),g=h>0?d.slice(0,h):d,E=e.uniformIdCounter;for(e.uniformIdCounter+=u,t[g]=[u,E],a=0;a<u;++a)r[E]=a,e.uniformArrayNamesById[E++]=g}},jc=(e,r)=>{if(r=je(r),e=j.programs[e]){Cn(e);var t=e.uniformLocsById,n=0,a=r,i=En(r);i>0&&(n=kc(r.slice(i+1))>>>0,a=r.slice(0,i));var d=e.uniformSizeAndIdsByName[a];if(d&&n<d[0]&&(n+=d[1],t[n]=t[n]||y.getUniformLocation(e,r)))return n}else j.recordError(1281);return-1},Lc=jc,be=e=>{var r=y.currentProgram;if(r){var t=r.uniformLocsById[e];return typeof t=="number"&&(r.uniformLocsById[e]=t=y.getUniformLocation(r,r.uniformArrayNamesById[e]+(t>0?`[${t}]`:""))),t}else j.recordError(1282)},kn=(e,r,t,n)=>{if(!t){j.recordError(1281);return}e=j.programs[e],Cn(e);var a=y.getUniform(e,be(r));if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:K[t>>2]=a;break}else for(var i=0;i<a.length;i++)switch(n){case 0:f[t+i*4>>2]=a[i];break;case 2:K[t+i*4>>2]=a[i];break}},Fc=(e,r,t)=>{kn(e,r,t,2)},Rc=Fc,Tc=(e,r,t)=>{kn(e,r,t,0)},Pc=Tc,Mc=(e,r,t)=>{if(!t){j.recordError(1281);return}f[t>>2]=y.getVertexAttribOffset(e,r)},Dc=Mc,jn=(e,r,t,n)=>{if(!t){j.recordError(1281);return}var a=y.getVertexAttrib(e,r);if(r==34975)f[t>>2]=a&&a.name;else if(typeof a=="number"||typeof a=="boolean")switch(n){case 0:f[t>>2]=a;break;case 2:K[t>>2]=a;break;case 5:f[t>>2]=Math.fround(a);break}else for(var i=0;i<a.length;i++)switch(n){case 0:f[t+i*4>>2]=a[i];break;case 2:K[t+i*4>>2]=a[i];break;case 5:f[t+i*4>>2]=Math.fround(a[i]);break}},Ac=(e,r,t)=>{jn(e,r,t,2)},Bc=Ac,Ic=(e,r,t)=>{jn(e,r,t,5)},$c=Ic;function Nc(e,r){y.hint(e,r)}var Uc=Nc,Oc=e=>{var r=j.buffers[e];return r?y.isBuffer(r):0},Gc=Oc;function zc(e){return y.isEnabled(e)}var qc=zc,Vc=e=>{var r=j.framebuffers[e];return r?y.isFramebuffer(r):0},Hc=Vc,Wc=e=>(e=j.programs[e],e?y.isProgram(e):0),Xc=Wc,Kc=e=>{var r=j.queries[e];return r?y.disjointTimerQueryExt.isQueryEXT(r):0},Yc=Kc,Qc=e=>{var r=j.renderbuffers[e];return r?y.isRenderbuffer(r):0},Jc=Qc,Zc=e=>{var r=j.shaders[e];return r?y.isShader(r):0},ed=Zc,rd=e=>{var r=j.textures[e];return r?y.isTexture(r):0},td=rd,nd=e=>{var r=j.vaos[e];return r?y.isVertexArray(r):0},ad=nd,od=ad;function sd(e){y.lineWidth(e)}var id=sd,ld=e=>{e=j.programs[e],y.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}},cd=ld,dd=(e,r)=>{e==3317&&(j.unpackAlignment=r),y.pixelStorei(e,r)},ud=dd;function fd(e,r){y.polygonOffset(e,r)}var md=fd,pd=(e,r)=>{y.disjointTimerQueryExt.queryCounterEXT(j.queries[e],r)},hd=pd,vd=(e,r,t,n)=>{function a(u,h){return u+h-1&-h}var i=e*t,d=a(i,n);return r*d},gd=e=>{var r={5:3,6:4,8:2,29502:3,29504:4};return r[e-6402]||1},xd=e=>(e-=5120,e==1?q:e==4?f:e==6?K:e==5||e==28922?X:I),bd=e=>31-Math.clz32(e.BYTES_PER_ELEMENT),_t=(e,r,t,n,a,i)=>{var d=xd(e),u=bd(d),h=1<<u,g=gd(r)*h,E=vd(t,n,g,j.unpackAlignment);return d.subarray(a>>u,a+E>>u)},_d=(e,r,t,n,a,i,d)=>{var u=_t(i,a,t,n,d);if(!u){j.recordError(1280);return}y.readPixels(e,r,t,n,a,i,u)},yd=_d,wd=()=>{},Sd=wd;function Ed(e,r,t,n){y.renderbufferStorage(e,r,t,n)}var Cd=Ed,kd=(e,r)=>{y.sampleCoverage(e,!!r)},jd=kd;function Ld(e,r,t,n){y.scissor(e,r,t,n)}var Fd=Ld,Rd=(e,r,t,n,a)=>{j.recordError(1280)},Td=Rd,Pd=(e,r,t,n)=>{var a=j.getSource(e,r,t,n);y.shaderSource(j.shaders[e],a)},Md=Pd;function Dd(e,r,t){y.stencilFunc(e,r,t)}var Ad=Dd;function Bd(e,r,t,n){y.stencilFuncSeparate(e,r,t,n)}var Id=Bd;function $d(e){y.stencilMask(e)}var Nd=$d;function Ud(e,r){y.stencilMaskSeparate(e,r)}var Od=Ud;function Gd(e,r,t){y.stencilOp(e,r,t)}var zd=Gd;function qd(e,r,t,n){y.stencilOpSeparate(e,r,t,n)}var Vd=qd,Hd=(e,r,t,n,a,i,d,u,h)=>{y.texImage2D(e,r,t,n,a,i,d,u,h?_t(u,d,n,a,h):null)},Wd=Hd;function Xd(e,r,t){y.texParameterf(e,r,t)}var Kd=Xd,Yd=(e,r,t)=>{var n=K[t>>2];y.texParameterf(e,r,n)},Qd=Yd;function Jd(e,r,t){y.texParameteri(e,r,t)}var Zd=Jd,eu=(e,r,t)=>{var n=f[t>>2];y.texParameteri(e,r,n)},ru=eu,tu=(e,r,t,n,a,i,d,u,h)=>{var g=null;h&&(g=_t(u,d,a,i,h)),y.texSubImage2D(e,r,t,n,a,i,d,u,g)},nu=tu,au=(e,r)=>{y.uniform1f(be(e),r)},ou=au,ar=[],su=(e,r,t)=>{if(r<=288)for(var n=ar[r-1],a=0;a<r;++a)n[a]=K[t+4*a>>2];else var n=K.subarray(t>>2,t+r*4>>2);y.uniform1fv(be(e),n)},iu=su,lu=(e,r)=>{y.uniform1i(be(e),r)},cu=lu,jr=[],du=(e,r,t)=>{if(r<=288)for(var n=jr[r-1],a=0;a<r;++a)n[a]=f[t+4*a>>2];else var n=f.subarray(t>>2,t+r*4>>2);y.uniform1iv(be(e),n)},uu=du,fu=(e,r,t)=>{y.uniform2f(be(e),r,t)},mu=fu,pu=(e,r,t)=>{if(r<=144)for(var n=ar[2*r-1],a=0;a<2*r;a+=2)n[a]=K[t+4*a>>2],n[a+1]=K[t+(4*a+4)>>2];else var n=K.subarray(t>>2,t+r*8>>2);y.uniform2fv(be(e),n)},hu=pu,vu=(e,r,t)=>{y.uniform2i(be(e),r,t)},gu=vu,xu=(e,r,t)=>{if(r<=144)for(var n=jr[2*r-1],a=0;a<2*r;a+=2)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2];else var n=f.subarray(t>>2,t+r*8>>2);y.uniform2iv(be(e),n)},bu=xu,_u=(e,r,t,n)=>{y.uniform3f(be(e),r,t,n)},yu=_u,wu=(e,r,t)=>{if(r<=96)for(var n=ar[3*r-1],a=0;a<3*r;a+=3)n[a]=K[t+4*a>>2],n[a+1]=K[t+(4*a+4)>>2],n[a+2]=K[t+(4*a+8)>>2];else var n=K.subarray(t>>2,t+r*12>>2);y.uniform3fv(be(e),n)},Su=wu,Eu=(e,r,t,n)=>{y.uniform3i(be(e),r,t,n)},Cu=Eu,ku=(e,r,t)=>{if(r<=96)for(var n=jr[3*r-1],a=0;a<3*r;a+=3)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2];else var n=f.subarray(t>>2,t+r*12>>2);y.uniform3iv(be(e),n)},ju=ku,Lu=(e,r,t,n,a)=>{y.uniform4f(be(e),r,t,n,a)},Fu=Lu,Ru=(e,r,t)=>{if(r<=72){var n=ar[4*r-1],a=K;t>>=2;for(var i=0;i<4*r;i+=4){var d=t+i;n[i]=a[d],n[i+1]=a[d+1],n[i+2]=a[d+2],n[i+3]=a[d+3]}}else var n=K.subarray(t>>2,t+r*16>>2);y.uniform4fv(be(e),n)},Tu=Ru,Pu=(e,r,t,n,a)=>{y.uniform4i(be(e),r,t,n,a)},Mu=Pu,Du=(e,r,t)=>{if(r<=72)for(var n=jr[4*r-1],a=0;a<4*r;a+=4)n[a]=f[t+4*a>>2],n[a+1]=f[t+(4*a+4)>>2],n[a+2]=f[t+(4*a+8)>>2],n[a+3]=f[t+(4*a+12)>>2];else var n=f.subarray(t>>2,t+r*16>>2);y.uniform4iv(be(e),n)},Au=Du,Bu=(e,r,t,n)=>{if(r<=72)for(var a=ar[4*r-1],i=0;i<4*r;i+=4)a[i]=K[n+4*i>>2],a[i+1]=K[n+(4*i+4)>>2],a[i+2]=K[n+(4*i+8)>>2],a[i+3]=K[n+(4*i+12)>>2];else var a=K.subarray(n>>2,n+r*16>>2);y.uniformMatrix2fv(be(e),!!t,a)},Iu=Bu,$u=(e,r,t,n)=>{if(r<=32)for(var a=ar[9*r-1],i=0;i<9*r;i+=9)a[i]=K[n+4*i>>2],a[i+1]=K[n+(4*i+4)>>2],a[i+2]=K[n+(4*i+8)>>2],a[i+3]=K[n+(4*i+12)>>2],a[i+4]=K[n+(4*i+16)>>2],a[i+5]=K[n+(4*i+20)>>2],a[i+6]=K[n+(4*i+24)>>2],a[i+7]=K[n+(4*i+28)>>2],a[i+8]=K[n+(4*i+32)>>2];else var a=K.subarray(n>>2,n+r*36>>2);y.uniformMatrix3fv(be(e),!!t,a)},Nu=$u,Uu=(e,r,t,n)=>{if(r<=18){var a=ar[16*r-1],i=K;n>>=2;for(var d=0;d<16*r;d+=16){var u=n+d;a[d]=i[u],a[d+1]=i[u+1],a[d+2]=i[u+2],a[d+3]=i[u+3],a[d+4]=i[u+4],a[d+5]=i[u+5],a[d+6]=i[u+6],a[d+7]=i[u+7],a[d+8]=i[u+8],a[d+9]=i[u+9],a[d+10]=i[u+10],a[d+11]=i[u+11],a[d+12]=i[u+12],a[d+13]=i[u+13],a[d+14]=i[u+14],a[d+15]=i[u+15]}}else var a=K.subarray(n>>2,n+r*64>>2);y.uniformMatrix4fv(be(e),!!t,a)},Ou=Uu,Gu=e=>{e=j.programs[e],y.useProgram(e),y.currentProgram=e},zu=Gu,qu=e=>{y.validateProgram(j.programs[e])},Vu=qu;function Hu(e,r){y.vertexAttrib1f(e,r)}var Wu=Hu,Xu=(e,r)=>{y.vertexAttrib1f(e,K[r>>2])},Ku=Xu;function Yu(e,r,t){y.vertexAttrib2f(e,r,t)}var Qu=Yu,Ju=(e,r)=>{y.vertexAttrib2f(e,K[r>>2],K[r+4>>2])},Zu=Ju;function ef(e,r,t,n){y.vertexAttrib3f(e,r,t,n)}var rf=ef,tf=(e,r)=>{y.vertexAttrib3f(e,K[r>>2],K[r+4>>2],K[r+8>>2])},nf=tf;function af(e,r,t,n,a){y.vertexAttrib4f(e,r,t,n,a)}var of=af,sf=(e,r)=>{y.vertexAttrib4f(e,K[r>>2],K[r+4>>2],K[r+8>>2],K[r+12>>2])},lf=sf,cf=(e,r)=>{y.vertexAttribDivisor(e,r)},df=cf,uf=df,ff=(e,r,t,n,a,i)=>{y.vertexAttribPointer(e,r,t,!!n,a,i)},mf=ff;function pf(e,r,t,n){y.viewport(e,r,t,n)}var hf=pf,vf=()=>0,gf=(e,r,t)=>q.copyWithin(e,r,r+t),xf=()=>{C.mainLoop.pause()},bf=(e,r)=>{if(!M.fullscreenEnabled())return-1;if(e=Re(e),!e)return-4;if(!e.requestFullscreen&&!e.webkitRequestFullscreen)return-3;var t=M.canPerformEventHandlerRequests();return t?gt(e,r):r.deferUntilInEventHandler?(M.deferCall(gt,1,[e,r]),1):-2},_f=(e,r,t)=>{var n={scaleMode:f[t>>2],canvasResolutionScaleMode:f[t+4>>2],filteringMode:f[t+8>>2],deferUntilInEventHandler:r,canvasResizedCallback:f[t+12>>2],canvasResizedCallbackUserData:f[t+16>>2]};return bf(e,n)},yf=(e,r)=>{if(e=Re(e),!e)return-4;if(!e.requestPointerLock)return-1;var t=M.canPerformEventHandlerRequests();return t?xt(e):r?(M.deferCall(xt,2,[e]),1):-2},wf=()=>2147483648,Sf=e=>{var r=z.buffer,t=(e-r.byteLength+65535)/65536;try{return z.grow(t),Me(),1}catch{}},Ef=e=>{var r=q.length;e>>>=0;var t=wf();if(e>t)return!1;for(var n=(h,g)=>h+(g-h%g)%g,a=1;a<=4;a*=2){var i=r*(1+.2/a);i=Math.min(i,e+100663296);var d=Math.min(t,n(Math.max(e,i),65536)),u=Sf(d);if(u)return!0}return!1},Cf=()=>{C.mainLoop.resume()},yt=()=>{try{if(navigator.getGamepads)return(M.lastGamepadState=navigator.getGamepads())?0:-1}catch{navigator.getGamepads=null}return-1},kf=(e,r,t,n,a,i)=>{var d=(h=event)=>{var g=se(n)(a,0,r);if(g&&(g=je(g)),g)return h.preventDefault(),h.returnValue=g,g},u={target:Re(e),eventTypeString:i,callbackfunc:n,handlerFunc:d,useCapture:t};return M.registerOrRemoveHandler(u)},jf=(e,r,t)=>typeof onbeforeunload>"u"?-1:t!==1?-5:kf(2,e,!0,r,28,"beforeunload"),Ln=(e,r,t,n,a,i,d)=>{M.focusEvent||(M.focusEvent=Ie(256));var u=(g=event)=>{var E=M.getNodeNameForTarget(g.target),F=g.target.id?g.target.id:"",$=M.focusEvent;pe(E,$+0,128),pe(F,$+128,128),se(n)(a,$,r)&&g.preventDefault()},h={target:Re(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Lf=(e,r,t,n,a)=>Ln(e,r,t,n,12,"blur"),Ff=(e,r,t)=>(e=Re(e),e?(e.style.width=r+"px",e.style.height=t+"px",0):-4),Rf=(e,r,t,n,a)=>Ln(e,r,t,n,13,"focus"),Tf=e=>{var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,t=!!r;f[e>>2]=t,f[e+4>>2]=M.fullscreenEnabled();var n=t?r:M.previousFullscreenElement,a=M.getNodeNameForTarget(n),i=(n==null?void 0:n.id)||"";pe(a,e+8,128),pe(i,e+136,128),f[e+264>>2]=n?n.clientWidth:0,f[e+268>>2]=n?n.clientHeight:0,f[e+272>>2]=screen.width,f[e+276>>2]=screen.height,t&&(M.previousFullscreenElement=r)},Fn=(e,r,t,n,a,i,d)=>{M.fullscreenChangeEvent||(M.fullscreenChangeEvent=Ie(280));var u=(g=event)=>{var E=M.fullscreenChangeEvent;Tf(E),se(n)(a,E,r)&&g.preventDefault()},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Pf=(e,r,t,n,a)=>M.fullscreenEnabled()?(e=Re(e),e?(Fn(e,r,t,n,19,"webkitfullscreenchange"),Fn(e,r,t,n,19,"fullscreenchange")):-4):-1,Rn=(e,r,t,n,a,i,d)=>{M.gamepadEvent||(M.gamepadEvent=Ie(1432));var u=(g=event)=>{var E=M.gamepadEvent;xn(E,g.gamepad),se(n)(a,E,r)&&g.preventDefault()},h={target:Re(e),allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Mf=(e,r,t,n)=>yt()?-1:Rn(2,e,r,t,26,"gamepadconnected"),Df=(e,r,t,n)=>yt()?-1:Rn(2,e,r,t,27,"gamepaddisconnected"),wt=(e,r,t,n,a,i,d)=>{M.keyEvent||(M.keyEvent=Ie(176));var u=g=>{var E=M.keyEvent;oe[E>>3]=g.timeStamp;var F=E>>2;f[F+2]=g.location,f[F+3]=g.ctrlKey,f[F+4]=g.shiftKey,f[F+5]=g.altKey,f[F+6]=g.metaKey,f[F+7]=g.repeat,f[F+8]=g.charCode,f[F+9]=g.keyCode,f[F+10]=g.which,pe(g.key||"",E+44,32),pe(g.code||"",E+76,32),pe(g.char||"",E+108,32),pe(g.locale||"",E+140,32),se(n)(a,E,r)&&g.preventDefault()},h={target:Re(e),eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Af=(e,r,t,n,a)=>wt(e,r,t,n,2,"keydown"),Bf=(e,r,t,n,a)=>wt(e,r,t,n,1,"keypress"),If=(e,r,t,n,a)=>wt(e,r,t,n,3,"keyup"),$f=(e,r,t)=>{var n=se(e);on(n,r,t)},Tn=(e,r,t)=>{oe[e>>3]=r.timeStamp;var n=e>>2;f[n+2]=r.screenX,f[n+3]=r.screenY,f[n+4]=r.clientX,f[n+5]=r.clientY,f[n+6]=r.ctrlKey,f[n+7]=r.shiftKey,f[n+8]=r.altKey,f[n+9]=r.metaKey,V[n*2+20]=r.button,V[n*2+21]=r.buttons,f[n+11]=r.movementX,f[n+12]=r.movementY;var a=Ur(t);f[n+13]=r.clientX-a.left,f[n+14]=r.clientY-a.top},Lr=(e,r,t,n,a,i,d)=>{M.mouseEvent||(M.mouseEvent=Ie(72)),e=Re(e);var u=(g=event)=>{Tn(M.mouseEvent,g,e),se(n)(a,M.mouseEvent,r)&&g.preventDefault()},h={target:e,allowsDeferredCalls:i!="mousemove"&&i!="mouseenter"&&i!="mouseleave",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Nf=(e,r,t,n,a)=>Lr(e,r,t,n,5,"mousedown"),Uf=(e,r,t,n,a)=>Lr(e,r,t,n,33,"mouseenter"),Of=(e,r,t,n,a)=>Lr(e,r,t,n,34,"mouseleave"),Gf=(e,r,t,n,a)=>Lr(e,r,t,n,8,"mousemove"),zf=(e,r,t,n,a)=>Lr(e,r,t,n,6,"mouseup"),qf=e=>{var r=document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement||document.msPointerLockElement,t=!!r;f[e>>2]=t;var n=M.getNodeNameForTarget(r),a=(r==null?void 0:r.id)||"";pe(n,e+4,128),pe(a,e+132,128)},Or=(e,r,t,n,a,i,d)=>{M.pointerlockChangeEvent||(M.pointerlockChangeEvent=Ie(260));var u=(g=event)=>{var E=M.pointerlockChangeEvent;qf(E),se(n)(a,E,r)&&g.preventDefault()},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Vf=(e,r,t,n,a)=>!document||!document.body||!document.body.requestPointerLock&&!document.body.mozRequestPointerLock&&!document.body.webkitRequestPointerLock&&!document.body.msRequestPointerLock?-1:(e=Re(e),e?(Or(e,r,t,n,20,"mozpointerlockchange"),Or(e,r,t,n,20,"webkitpointerlockchange"),Or(e,r,t,n,20,"mspointerlockchange"),Or(e,r,t,n,20,"pointerlockchange")):-4),Hf=(e,r,t,n,a,i,d)=>{M.uiEvent||(M.uiEvent=Ie(36)),e=Re(e);var u=(g=event)=>{if(g.target==e){var E=document.body;if(E){var F=M.uiEvent;f[F>>2]=g.detail,f[F+4>>2]=E.clientWidth,f[F+8>>2]=E.clientHeight,f[F+12>>2]=innerWidth,f[F+16>>2]=innerHeight,f[F+20>>2]=outerWidth,f[F+24>>2]=outerHeight,f[F+28>>2]=pageXOffset,f[F+32>>2]=pageYOffset,se(n)(a,F,r)&&g.preventDefault()}}},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Wf=(e,r,t,n,a)=>Hf(e,r,t,n,10,"resize"),Gr=(e,r,t,n,a,i,d)=>{M.touchEvent||(M.touchEvent=Ie(1696)),e=Re(e);var u=g=>{for(var E,F={},$=g.touches,P=0;P<$.length;++P)E=$[P],E.isChanged=E.onTarget=0,F[E.identifier]=E;for(var P=0;P<g.changedTouches.length;++P)E=g.changedTouches[P],E.isChanged=1,F[E.identifier]=E;for(var P=0;P<g.targetTouches.length;++P)F[g.targetTouches[P].identifier].onTarget=1;var A=M.touchEvent;oe[A>>3]=g.timeStamp;var Q=A>>2;f[Q+3]=g.ctrlKey,f[Q+4]=g.shiftKey,f[Q+5]=g.altKey,f[Q+6]=g.metaKey,Q+=7;var he=Ur(e),ue=0;for(var P in F)if(E=F[P],f[Q+0]=E.identifier,f[Q+1]=E.screenX,f[Q+2]=E.screenY,f[Q+3]=E.clientX,f[Q+4]=E.clientY,f[Q+5]=E.pageX,f[Q+6]=E.pageY,f[Q+7]=E.isChanged,f[Q+8]=E.onTarget,f[Q+9]=E.clientX-he.left,f[Q+10]=E.clientY-he.top,Q+=13,++ue>31)break;f[A+8>>2]=ue,se(n)(a,A,r)&&g.preventDefault()},h={target:e,allowsDeferredCalls:i=="touchstart"||i=="touchend",eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},Xf=(e,r,t,n,a)=>Gr(e,r,t,n,25,"touchcancel"),Kf=(e,r,t,n,a)=>Gr(e,r,t,n,23,"touchend"),Yf=(e,r,t,n,a)=>Gr(e,r,t,n,24,"touchmove"),Qf=(e,r,t,n,a)=>Gr(e,r,t,n,22,"touchstart"),Jf=e=>{var r=["hidden","visible","prerender","unloaded"],t=r.indexOf(document.visibilityState);f[e>>2]=document.hidden,f[e+4>>2]=t},Zf=(e,r,t,n,a,i,d)=>{M.visibilityChangeEvent||(M.visibilityChangeEvent=Ie(8));var u=(g=event)=>{var E=M.visibilityChangeEvent;Jf(E),se(n)(a,E,r)&&g.preventDefault()},h={target:e,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},em=(e,r,t,n)=>Zf(Nr[1],e,r,t,21,"visibilitychange"),rm=(e,r,t,n,a,i,d)=>{M.wheelEvent||(M.wheelEvent=Ie(104));var u=(g=event)=>{var E=M.wheelEvent;Tn(E,g,e),oe[E+72>>3]=g.deltaX,oe[E+80>>3]=g.deltaY,oe[E+88>>3]=g.deltaZ,f[E+96>>2]=g.deltaMode,se(n)(a,E,r)&&g.preventDefault()},h={target:e,allowsDeferredCalls:!0,eventTypeString:i,callbackfunc:n,handlerFunc:u,useCapture:t};return M.registerOrRemoveHandler(h)},tm=(e,r,t,n,a)=>(e=Re(e),e?typeof e.onwheel<"u"?rm(e,r,t,n,9,"wheel"):-1:-4),nm=e=>document.title=je(e),am=()=>{throw"Please compile your program with async support in order to use asynchronous operations like emscripten_sleep"},St={},om=()=>_||"./this.program",Fr=()=>{if(!Fr.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:om()};for(var t in St)St[t]===void 0?delete r[t]:r[t]=St[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);Fr.strings=n}return Fr.strings},sm=(e,r)=>{for(var t=0;t<e.length;++t)G[r++>>0]=e.charCodeAt(t);G[r>>0]=0},im=(e,r)=>{var t=0;return Fr().forEach((n,a)=>{var i=r+t;X[e+a*4>>2]=i,sm(n,i),t+=n.length+1}),0},lm=(e,r)=>{var t=Fr();X[e>>2]=t.length;var n=0;return t.forEach(a=>n+=a.length+1),X[r>>2]=n,0};function cm(e){try{var r=Z.getStreamFromFD(e);return c.close(r),0}catch(t){if(typeof c>"u"||t.name!=="ErrnoError")throw t;return t.errno}}var dm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=X[r>>2],u=X[r+4>>2];r+=8;var h=c.read(e,G,d,u,n);if(h<0)return-1;if(a+=h,h<u)break}return a};function um(e,r,t,n){try{var a=Z.getStreamFromFD(e),i=dm(a,r,t);return X[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}function fm(e,r,t,n,a){var i=_r(r,t);try{if(isNaN(i))return 61;var d=Z.getStreamFromFD(e);return c.llseek(d,i,n),le=[d.position>>>0,(J=d.position,+Math.abs(J)>=1?J>0?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],f[a>>2]=le[0],f[a+4>>2]=le[1],d.getdents&&i===0&&n===0&&(d.getdents=null),0}catch(u){if(typeof c>"u"||u.name!=="ErrnoError")throw u;return u.errno}}function mm(e){var t;try{var r=Z.getStreamFromFD(e);return(t=r.stream_ops)!=null&&t.fsync?r.stream_ops.fsync(r):0}catch(n){if(typeof c>"u"||n.name!=="ErrnoError")throw n;return n.errno}}var pm=(e,r,t,n)=>{for(var a=0,i=0;i<t;i++){var d=X[r>>2],u=X[r+4>>2];r+=8;var h=c.write(e,G,d,u,n);if(h<0)return-1;a+=h}return a};function hm(e,r,t,n){try{var a=Z.getStreamFromFD(e),i=pm(a,r,t);return X[n>>2]=i,0}catch(d){if(typeof c>"u"||d.name!=="ErrnoError")throw d;return d.errno}}var Pn=e=>{var r=s["_"+e];return r},vm=(e,r)=>{G.set(e,r)},gm=(e,r,t,n,a)=>{var i={string:A=>{var Q=0;return A!=null&&A!==0&&(Q=ht(A)),Q},array:A=>{var Q=Vr(A.length);return vm(A,Q),Q}};function d(A){return r==="string"?je(A):r==="boolean"?!!A:A}var u=Pn(e),h=[],g=0;if(n)for(var E=0;E<n.length;E++){var F=i[t[E]];F?(g===0&&(g=$e()),h[E]=F(n[E])):h[E]=n[E]}var $=u.apply(null,h);function P(A){return g!==0&&Ne(g),d(A)}return $=P($),$},de=(e,r,t,n)=>{var a=!t||t.every(d=>d==="number"||d==="boolean"),i=r!=="string";return i&&a&&!n?Pn(e):function(){return gm(e,r,t,arguments)}},Mn=function(e,r,t,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=c.nextInode++,this.name=r,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},zr=365,qr=146;Object.defineProperties(Mn.prototype,{read:{get:function(){return(this.mode&zr)===zr},set:function(e){e?this.mode|=zr:this.mode&=~zr}},write:{get:function(){return(this.mode&qr)===qr},set:function(e){e?this.mode|=qr:this.mode&=~qr}},isFolder:{get:function(){return c.isDir(this.mode)}},isDevice:{get:function(){return c.isChrdev(this.mode)}}}),c.FSNode=Mn,c.createPreloadedFile=Ua,c.staticInit(),s.requestFullscreen=C.requestFullscreen,s.requestAnimationFrame=C.requestAnimationFrame,s.setCanvasSize=C.setCanvasSize,s.pauseMainLoop=C.mainLoop.pause,s.resumeMainLoop=C.mainLoop.resume,s.getUserMedia=C.getUserMedia,s.createContext=C.createContext;for(var y,Be=0;Be<32;++Be)bn.push(new Array(Be));for(var xm=new Float32Array(288),Be=0;Be<288;++Be)ar[Be]=xm.subarray(0,Be+1);for(var bm=new Int32Array(288),Be=0;Be<288;++Be)jr[Be]=bm.subarray(0,Be+1);var _m={Q:Ga,rb:za,ab:qa,mb:Va,ib:Ha,sb:Wa,ob:Xa,jb:Ka,pb:Ya,S:Qa,hb:Ja,fb:Za,qb:eo,gb:ro,db:to,tb:ao,bb:oo,Za:co,_a:uo,Wa:fo,Xa:mo,Ya:po,eb:ho,a:vo,Qa:_o,Ua:yo,Ga:ko,Ja:jo,Ha:Lo,Ka:Fo,Va:Ro,O:To,Fa:Po,Ra:Mo,La:Do,Ea:Ao,Ma:Bo,Na:Io,Ta:$o,Pa:Uo,Oa:Oo,i:zo,b:Vo,T:Ho,ya:Qo,Ca:Jo,h:Zo,e:es,V:rs,X:ts,l:Ir,Ub:ns,Da:as,ea:ss,da:ls,ua:ds,ca:fs,ba:ps,aa:vs,$:xs,_:_s,ma:Ss,Zd:Cs,Yd:js,Xd:Fs,Wd:Ts,Vd:Ms,Ud:As,Td:Is,Sd:Ns,Rd:Os,Qd:zs,Pd:Vs,Od:Ws,Nd:Ks,Md:Qs,Ld:Zs,Kd:ri,Jd:ni,Id:oi,Hd:ii,Gd:ci,Fd:ui,Ed:mi,Dd:hi,Cd:gi,wa:bi,Bd:yi,Ad:Si,zd:Ci,la:Li,yd:Ri,xd:Pi,wd:Di,vd:Bi,ud:$i,td:Ui,sd:Gi,ha:Vi,ia:Xi,rd:Yi,ga:Zi,qd:rl,pd:nl,ta:ol,od:il,nd:cl,md:ul,kd:ml,jd:hl,id:gl,gd:bl,xa:yl,fd:Sl,ed:Cl,ka:Ll,hd:Rl,dd:Pl,cd:Dl,bd:Bl,ad:$l,$c:Ul,_c:Gl,Zc:ql,Yc:Hl,Xc:Xl,Wc:Yl,Uc:Jl,Vc:ec,oa:rc,qa:tc,na:ac,pa:sc,ra:lc,Tc:dc,Rc:fc,Qc:pc,Pc:vc,Sc:xc,Oc:yc,Nc:Sc,Mc:Cc,Jc:Lc,Lc:Rc,Kc:Pc,Fc:Dc,Hc:Bc,Gc:$c,Ec:Uc,Dc:Gc,Cc:qc,Bc:Hc,Ac:Xc,va:Yc,zc:Jc,yc:ed,wc:td,ja:od,vc:id,uc:cd,tc:ud,sc:md,sa:hd,rc:yd,qc:Sd,pc:Cd,oc:jd,nc:Fd,mc:Td,lc:Md,kc:Ad,jc:Id,ic:Nd,hc:Od,gc:zd,fc:Vd,ec:Wd,dc:Kd,cc:Qd,bc:Zd,ac:ru,$b:nu,_b:ou,Zb:iu,Yb:cu,Xb:uu,Wb:mu,Vb:hu,Tb:gu,Sb:bu,Rb:yu,Qb:Su,Pb:Cu,Ob:ju,Nb:Fu,Mb:Tu,Lb:Mu,Kb:Au,Jb:Iu,Ib:Nu,Hb:Ou,Gb:zu,Fb:Vu,Eb:Wu,Db:Ku,Cb:Qu,Bb:Zu,Ab:rf,zb:nf,yb:of,xb:lf,fa:uf,wb:mf,vb:hf,o:vf,ub:gf,q:xf,za:_f,N:yf,cb:Ef,M:Cf,W:yt,s:jf,E:Lf,g:vn,m:Ff,F:Rf,v:Pf,U:Mf,R:Df,y:Af,w:Bf,x:If,Ba:$f,Sa:yr,K:Nf,I:Uf,H:Of,L:Gf,J:zf,z:Vf,u:Wf,A:Xf,C:Kf,B:Yf,D:Qf,t:em,G:tm,Aa:nm,n:am,kb:im,lb:lm,Ia:cn,j:cm,P:um,$a:fm,nb:mm,p:hm,Z:Cm,Y:Lm,c:wm,r:ym,Ic:Fm,d:Sm,k:jm,f:Em,xc:Rm,ld:km},te=La();s._screenshot=e=>(s._screenshot=te.ae)(e),s._buttonPress=e=>(s._buttonPress=te.be)(e),s._buttonUnpress=e=>(s._buttonUnpress=te.ce)(e),s._setVolume=e=>(s._setVolume=te.de)(e),s._getVolume=()=>(s._getVolume=te.ee)(),s._getMainLoopTimingMode=()=>(s._getMainLoopTimingMode=te.fe)(),s._getMainLoopTimingValue=()=>(s._getMainLoopTimingValue=te.ge)(),s._setMainLoopTiming=(e,r)=>(s._setMainLoopTiming=te.he)(e,r),s._setFastForwardMultiplier=e=>(s._setFastForwardMultiplier=te.ie)(e),s._getFastForwardMultiplier=()=>(s._getFastForwardMultiplier=te.je)(),s._quitGame=()=>(s._quitGame=te.ke)(),s._quitMgba=()=>(s._quitMgba=te.le)(),s._quickReload=()=>(s._quickReload=te.me)(),s._pauseGame=()=>(s._pauseGame=te.ne)(),s._resumeGame=()=>(s._resumeGame=te.oe)(),s._setEventEnable=e=>(s._setEventEnable=te.pe)(e),s._bindKey=(e,r)=>(s._bindKey=te.qe)(e,r),s._saveState=e=>(s._saveState=te.re)(e),s._loadState=e=>(s._loadState=te.se)(e),s._autoLoadCheats=()=>(s._autoLoadCheats=te.te)(),s._loadGame=e=>(s._loadGame=te.ue)(e),s._saveStateSlot=(e,r)=>(s._saveStateSlot=te.ve)(e,r),s._loadStateSlot=(e,r)=>(s._loadStateSlot=te.we)(e,r),s._setupConstants=()=>(s._setupConstants=te.xe)();var Dn=s._main=(e,r)=>(Dn=s._main=te.ye)(e,r),Ie=e=>(Ie=te.Ae)(e),An=e=>(An=te.Be)(e),Bn=(e,r)=>(Bn=te.Ce)(e,r),qe=(e,r)=>(qe=te.De)(e,r),$e=()=>($e=te.Ee)(),Ne=e=>(Ne=te.Fe)(e),Vr=e=>(Vr=te.Ge)(e);s.dynCall_ji=(e,r)=>(s.dynCall_ji=te.He)(e,r),s.dynCall_jiji=(e,r,t,n,a)=>(s.dynCall_jiji=te.Ie)(e,r,t,n,a),s.dynCall_iiiji=(e,r,t,n,a,i)=>(s.dynCall_iiiji=te.Je)(e,r,t,n,a,i),s.dynCall_jii=(e,r,t)=>(s.dynCall_jii=te.Ke)(e,r,t),s._GBAInputInfo=109920,s._binaryName=186992,s._projectName=186996,s._projectVersion=187e3,s._gitCommit=186976,s._gitCommitShort=186980,s._gitBranch=186984,s._gitRevision=186988,s._GBIORegisterNames=49376,s._GBSavestateMagic=64640,s._GBSavestateVersion=64644,s._GBA_LUX_LEVELS=93136,s._GBAVideoObjSizes=138416,s._GBASavestateMagic=138208,s._GBASavestateVersion=138212;function ym(e,r,t,n,a){var i=$e();try{return se(e)(r,t,n,a)}catch(d){if(Ne(i),d!==d+0)throw d;qe(1,0)}}function wm(e,r,t,n){var a=$e();try{return se(e)(r,t,n)}catch(i){if(Ne(a),i!==i+0)throw i;qe(1,0)}}function Sm(e,r,t){var n=$e();try{se(e)(r,t)}catch(a){if(Ne(n),a!==a+0)throw a;qe(1,0)}}function Em(e,r,t,n,a){var i=$e();try{se(e)(r,t,n,a)}catch(d){if(Ne(i),d!==d+0)throw d;qe(1,0)}}function Cm(e,r){var t=$e();try{return se(e)(r)}catch(n){if(Ne(t),n!==n+0)throw n;qe(1,0)}}function km(e,r,t,n,a,i,d,u,h,g){var E=$e();try{se(e)(r,t,n,a,i,d,u,h,g)}catch(F){if(Ne(E),F!==F+0)throw F;qe(1,0)}}function jm(e,r,t,n){var a=$e();try{se(e)(r,t,n)}catch(i){if(Ne(a),i!==i+0)throw i;qe(1,0)}}function Lm(e,r,t){var n=$e();try{return se(e)(r,t)}catch(a){if(Ne(n),a!==a+0)throw a;qe(1,0)}}function Fm(e,r){var t=$e();try{se(e)(r)}catch(n){if(Ne(t),n!==n+0)throw n;qe(1,0)}}function Rm(e,r,t,n,a,i){var d=$e();try{se(e)(r,t,n,a,i)}catch(u){if(Ne(d),u!==u+0)throw u;qe(1,0)}}s.cwrap=de,s.FS=c;var Hr;gr=function e(){Hr||In(),Hr||(gr=e)};function Tm(){var e=Dn,r=0,t=0;try{var n=e(r,t);return ln(n,!0),n}catch(a){return ft(a)}}function In(){if(Se>0||(Ze(),Se>0))return;function e(){Hr||(Hr=!0,s.calledRun=!0,!Y&&(ne(),we(),p(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),$n&&Tm(),Ce()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),e()},1)):e()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();var $n=!0;return s.noInitialRun&&($n=!1),In(),m.ready}})();const Bp=l=>{const[m,s]=T.useState(null);return T.useEffect(()=>{(async()=>{if(l){const b=await Ap({canvas:l}),x=b.version.projectName+" "+b.version.projectVersion;console.log(x),await b.FSInit();const v=Dp(b);s(v)}})()},[l]),m},Nt=T.createContext(null);Nt.displayName="EmulatorContext";const Ip=({children:l})=>{const[m,s]=T.useState(null),p=Bp(m);return o.jsx(Nt.Provider,{value:{emulator:p,canvas:m,setCanvas:s},children:l})},Ut=T.createContext(null);Ut.displayName="ResizeContext";const $p=({children:l})=>{const[m,s]=T.useState(!1);return o.jsx(Ut.Provider,{value:{areItemsResizable:m,setAreItemsResizable:s},children:l})},Ot=T.createContext(null);Ot.displayName="RunningContext";const Np=({children:l})=>{const[m,s]=T.useState(!1);return o.jsx(Ot.Provider,{value:{isRunning:m,setIsRunning:s},children:l})},Up="componentLayouts",Op=()=>{const[l,m]=Fe(Up,{}),s=T.useCallback(()=>m({}),[m]),p=T.useMemo(()=>!!Object.values(l).some(b=>!!(b!=null&&b.position)||!!(b!=null&&b.size)),[l]);return{layouts:l,setLayouts:m,hasSetLayout:p,clearLayouts:s}},Gt=T.createContext(null);Gt.displayName="LayoutContext";const Gp=({children:l})=>{const{layouts:m,setLayouts:s,hasSetLayout:p,clearLayouts:b}=Op(),x=T.useCallback((v,_)=>s(k=>({...k,[v]:{...k==null?void 0:k[v],..._}})),[s]);return T.useEffect(()=>{p||b()},[]),o.jsx(Gt.Provider,{value:{layouts:m,hasSetLayout:p,clearLayouts:b,setLayout:x},children:l})},zt=T.createContext(null);zt.displayName="ModalContext";const zp=({children:l})=>{const[m,s]=T.useState(null),[p,b]=T.useState(!1);return o.jsx(zt.Provider,{value:{modalContent:m,setModalContent:s,isModalOpen:p,setIsModalOpen:b},children:l})},vr=l=>{const m=l.displayName,s=T.useContext(l);if(!s)throw new Error(`${m??"This context"} must be loaded under the matching ${m?`${m}.Provider`:"Provider"}`);return s},fa=()=>vr(It),Er=()=>vr(Gt),ke=()=>vr(zt),me=()=>vr(Nt),tt=()=>vr($t),ma=()=>vr(Ut),ir=()=>vr(Ot),qp=({isPaused:l})=>{const m=Dm(),{emulator:s}=me(),{isRunning:p}=ir(),[b,x]=T.useState(!1),v=p&&!l;T.useEffect(()=>{v&&(!m&&!b?(s==null||s.pause(),x(!0)):m&&b&&(s==null||s.resume(),x(!1)))},[s,m,v,b])},Vp=l=>{const m=l.getContext("webgl");m==null||m.clearColor(0,0,0,1),m==null||m.clear(m==null?void 0:m.COLOR_BUFFER_BIT)},Hp=l=>{const m=l.getContext("2d"),s=40,p=50;let b=0;if(!m)return;const x=l.width,v=l.height,_=x/2,k=v/2,w=m.getImageData(0,0,x,v),S=setInterval(()=>{b++;for(let L=0;L<v;++L)for(let R=0;R<x;++R){const N=Math.abs(R-_),O=Math.abs(L-k)*.8,B=(_-b-N)/_,W=(k-b-(L&1)*10-O+Math.pow(N,1/2))/k;w.data[(R+L*x)*4+3]*=Math.pow(B,1/3)*Math.pow(W,1/2)}m.putImageData(w,0,0),b>s&&(clearInterval(S),l.remove())},p)},Wp=(l,m)=>{if(!l||!m)return;const s=document.createElement("canvas"),p=s.getContext("2d"),b=URL.createObjectURL(m);s.className=l.className,s.height=l.height,s.width=l.width,s.style.backgroundColor=l.style.backgroundColor,s.style.height=`${l.clientHeight}px`,s.style.imageRendering=l.style.imageRendering,s.style.margin=l.style.margin,s.style.objectFit=l.style.objectFit,s.style.width=`${l.clientWidth}px`,s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.right="0";const x=new Image;x.onload=()=>{var v;p==null||p.drawImage(x,0,0),(v=l.parentElement)==null||v.appendChild(s),Vp(l),Hp(s)},x.src=b},Xp=l=>{if(!l)return null;const m="fade-copy.png",s=(l==null?void 0:l.filePaths().screenshotsPath)+"/"+m;if(!l.screenshot(m))return null;const b=l.getFile(s);return l==null||l.deleteFile(s),new Blob([b],{type:"image/png"})},Kp=()=>{const{canvas:l,emulator:m}=me(),{isRunning:s,setIsRunning:p}=ir();return T.useCallback(()=>{s&&(Wp(l,Xp(m)),m==null||m.quitGame()),p(!1)},[l,m,s,p])},qt="completedProductTour",Yp={locale:{skip:o.jsx("strong",{"aria-label":"Skip",children:"Skip"})},placement:"auto",placementBeacon:"right-end",spotlightPadding:10},Ve=({completedProductTourStepName:l,steps:m,allowScrolling:s=!0,isNotInModal:p=!1,millisecondDelay:b=500,renderWithoutDelay:x=!1,skipIfIntroSkipped:v=!0,skipRenderCondition:_=!1,zIndex:k=500})=>{const[w,S]=Fe(qt),{isModalOpen:L}=ke(),[R,N]=T.useState(x);if(Pt(()=>{N(!0)},x?null:b),!R||w!=null&&w[l]||v&&(w==null?void 0:w.hasCompletedProductTourIntro)===Et.SKIPPED||!(w!=null&&w.hasCompletedProductTourIntro)||!p&&!L||_)return null;const O=m.map(B=>({...Yp,...B}));return o.jsx(wp,{continuous:!0,disableScrollParentFix:s,hideCloseButton:!0,showProgress:!0,showSkipButton:!0,steps:O,styles:{options:{zIndex:k}},callback:({status:B})=>{[Et.FINISHED,Et.SKIPPED].includes(B)&&S(W=>({...W,[l]:B}))}})},Qp=D.button`
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
  padding: inherit;
`,Mr=et.forwardRef(({children:l,...m},s)=>o.jsx(Qp,{ref:s,...m,children:l})),Sr=({variation:l})=>{const m=Pe(),s=function(){switch(l){case"topLeft":return"-45deg";case"topRight":return"45deg";case"bottomLeft":return"45deg";case"bottomRight":return"-45deg";default:return"0deg"}}();return o.jsx(Am,{"data-testid":"gripper-handle",color:m.gbaThemeBlue,style:{transform:`rotate(${s})`}})},Jp=D.ul`
  background-color: ${({theme:l})=>l.panelBlueGray};
  list-style: none;
  padding: 10px;
  margin: 0;
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 10px 10px;
  grid-template-areas:
    '. . . .'
    'volume volume fastForward fastForward';

  ${({$controlled:l,$isLargerThanPhone:m})=>(l||m)&&`
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-evenly;
    gap: 10px;
  `}
`,Zp=D.li`
  display: contents;
`,pa=Bm`
  cursor: pointer;
  background-color: ${({theme:l})=>l.panelControlGray};
  border-radius: 0.25rem;
  min-width: 40px;
  min-height: 40px;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${({theme:l})=>l.pureBlack};
  width: ${({$controlled:l})=>l?"auto":"100%"};

  ${({$controlled:l,theme:m})=>!l&&`
    @media ${m.isLargerThanPhone} {
      width: auto;
    }
  `}
`,eh=D(Mr).attrs({className:"noDrag"})`
  ${pa}

  border: none;
  flex-grow: 1;
  margin: 0;
  padding: 0;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  &:active {
    color: ${({theme:l})=>l.gbaThemeBlue};
  }
`,rh=D.li`
  ${pa}
  grid-area: ${({$gridArea:l})=>l};
  max-height: 40px;
`,th=D(Sp)`
  flex-grow: 1;

  > .MuiSlider-markActive {
    opacity: 1;
    background-color: currentColor;
  }
`,Wr=({ariaLabel:l,children:m,controlled:s,id:p,onClick:b})=>o.jsx(Zp,{children:o.jsx(eh,{"aria-label":l,id:p,onClick:b,$controlled:s,children:m})}),Xr=({icon:l,...m})=>{const s=Pe();return o.jsx(sr,{size:"small",sx:{padding:0,color:s.pureBlack,"&:active":{color:s.gbaThemeBlue}},...m,children:l})},qn=({controlled:l,gridArea:m,id:s,maxIcon:p,minIcon:b,...x})=>o.jsxs(rh,{id:s,$gridArea:m,$controlled:l,children:[b,o.jsx(th,{marks:!0,sx:{width:"85px",margin:"0 10px",maxHeight:"40px"},valueLabelDisplay:"auto",...x}),p]}),nh=()=>{var ne,we,Ce,tr;const{emulator:l}=me(),{isRunning:m}=ir(),{areItemsDraggable:s,setAreItemsDraggable:p}=tt(),{areItemsResizable:b,setAreItemsResizable:x}=ma(),{layouts:v,setLayout:_}=Er(),k=Pe(),w=fr(k.isLargerThanPhone),[S,L]=T.useState(!1),[R,N]=T.useState(!1),O=T.useId(),B=Kp(),[W,z]=Fe(la,1),[Y,ee]=Fe(ua,1);qp({isPaused:S});const H=T.useCallback(ie=>{var Ae,Se;!((Ae=v==null?void 0:v.controlPanel)!=null&&Ae.initialBounds)&&ie&&_("controlPanel",{initialBounds:(Se=ie.resizableElement.current)==null?void 0:Se.getBoundingClientRect()})},[_,v]),G=(ne=v==null?void 0:v.screen)==null?void 0:ne.initialBounds;if(!G)return null;const q=w?5:0,V=!!((we=v==null?void 0:v.controlPanel)!=null&&we.size)||R,I=()=>{m&&(S?l==null||l.resume():l==null||l.pause(),L(ie=>!ie))},f=ie=>{l==null||l.setVolume(ie),z(ie)},X=ie=>{var Se;const Ae=Number((Se=ie.target)==null?void 0:Se.value);f(Ae)},K=ie=>{l==null||l.setFastForwardMultiplier(ie),ee(ie)},oe=ie=>{var Se;const Ae=Number((Se=ie.target)==null?void 0:Se.value);l==null||l.setFastForwardMultiplier(Ae),ee(Ae)},Me=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the control panel to quickly perform in game actions and reposition controls."}),o.jsx("p",{children:"Click next to take a tour of the controls!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(O)}`},{content:o.jsx("p",{children:"Use the this button to pause and resume your game if it is running."}),placementBeacon:"bottom",target:`#${CSS.escape(`${O}--play`)}`},{content:o.jsx("p",{children:"Use this button to quit your current game."}),placementBeacon:"bottom",target:`#${CSS.escape(`${O}--quit-game`)}`},{content:o.jsx("p",{children:"Use this button to enable dragging and repositioning of the screen, controls, and control panel."}),placement:w?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${O}--drag`)}`},{content:o.jsx("p",{children:"Use this button to resize the screen and control panel."}),placement:w?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${O}--resize`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the emulator volume."}),o.jsx("p",{children:"Your volume setting will be saved between refreshes!"})]}),placementBeacon:"bottom",target:`#${CSS.escape(`${O}--volume-slider`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this slider to increase and decrease the fast forward speed."}),o.jsx("p",{children:"Your fast forward setting will be saved between refreshes!"})]}),placement:w?"auto":"right",placementBeacon:"bottom",target:`#${CSS.escape(`${O}--fast-forward`)}`}],De={x:Math.floor(G.left),y:Math.floor(G.bottom+q)},He={width:w?"auto":"100dvw",height:"auto"},rr=((Ce=v==null?void 0:v.controlPanel)==null?void 0:Ce.position)??De,Je=((tr=v==null?void 0:v.controlPanel)==null?void 0:tr.size)??He,Ze={onFocus:l==null?void 0:l.disableKeyboardInput,onBlur:l==null?void 0:l.enableKeyboardInput,onClick:l==null?void 0:l.enableKeyboardInput};return o.jsxs(o.Fragment,{children:[o.jsx(Zn,{"data-testid":"control-panel-wrapper",id:O,disableDragging:!s,enableResizing:b,resizeHandleComponent:{bottomRight:o.jsx(Sr,{variation:"bottomRight"}),bottomLeft:o.jsx(Sr,{variation:"bottomLeft"})},resizeHandleStyles:{bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"}},ref:H,cancel:".noDrag",position:rr,size:Je,onDragStop:(ie,Ae)=>{_("controlPanel",{position:{x:Ae.x,y:Ae.y}})},onResizeStart:()=>N(!0),onResizeStop:(ie,Ae,Se,gr,Ht)=>{_("controlPanel",{size:{width:Se.clientWidth,height:Se.clientHeight},position:{...Ht}}),N(!1)},default:{...De,...He},children:o.jsx(Jp,{$controlled:V,$isLargerThanPhone:w,children:o.jsxs(ea.Provider,{value:{size:"2em"},children:[o.jsx(Wr,{id:`${O}--play`,ariaLabel:S||!m?"Play":"Pause",onClick:I,controlled:V,children:S||!m?o.jsx(Im,{}):o.jsx($m,{})}),o.jsx(Wr,{id:`${O}--quit-game`,ariaLabel:"Quit Game",onClick:()=>{B(),L(!1)},controlled:V,children:o.jsx(Nm,{})}),o.jsx(Wr,{id:`${O}--drag`,ariaLabel:s?"Anchor Items":"Drag Items",onClick:()=>{p(ie=>!ie)},controlled:V,children:s?o.jsx(Nn,{color:k.gbaThemeBlue}):o.jsx(Nn,{})}),o.jsx(Wr,{id:`${O}--resize`,ariaLabel:b?"Stop Resizing Items":"Resize Items",onClick:()=>{x(ie=>!ie)},controlled:V,children:b?o.jsx(Un,{color:k.gbaThemeBlue}):o.jsx(Un,{})}),o.jsx(qn,{id:`${O}--volume-slider`,"aria-label":"Volume Slider",gridArea:"volume",controlled:V,value:W,step:.1,min:0,max:1,minIcon:o.jsx(Xr,{"aria-label":"Mute Volume",icon:o.jsx(Um,{style:{maxHeight:"100%"}}),onClick:()=>f(0)}),maxIcon:o.jsx(Xr,{"aria-label":"Max Volume",icon:o.jsx(Om,{style:{maxHeight:"100%"}}),onClick:()=>f(1)}),valueLabelFormat:`${W*100}`,onChange:X,...Ze}),o.jsx(qn,{id:`${O}--fast-forward`,"aria-label":"Fast Forward Slider",gridArea:"fastForward",controlled:V,value:Y,step:1,min:1,max:5,minIcon:o.jsx(Xr,{"aria-label":"Regular Speed",icon:o.jsx(Gm,{style:{maxHeight:"100%"}}),onClick:()=>K(1)}),maxIcon:o.jsx(Xr,{"aria-label":"Max Fast Forward",icon:o.jsx(zm,{style:{maxHeight:"100%"}}),onClick:()=>K(5)}),valueLabelFormat:`x${Y}`,onChange:oe,...Ze})]})})}),o.jsx(Ve,{steps:Me,completedProductTourStepName:"hasCompletedControlPanelTour",zIndex:w?160:0,renderWithoutDelay:!0,isNotInModal:!0})]})},ha="currentSaveStateSlot",va="areVirtualControlsEnabled",ah=D.section`
  position: absolute;
  background-color: red;
  border-radius: 50%;
  width: 12rem;
  height: 12rem;
  background: ${({theme:l})=>l.pureBlack};
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};
  border-width: 2px;
  z-index: 12;

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `};
`,oh=D.div`
  position: absolute;
  height: 4rem;
  width: 4rem;
  border: 2px solid ${({theme:l})=>l.gbaThemeBlue};
  border-radius: 50%;
  background-color: ${({theme:l})=>l.pureBlack};
  transition: ${({$isControlled:l=!1})=>l?"transform 0.3s ease-in-out":"none"};

  &:before {
    position: absolute;
    content: '';
    top: -0.8rem;
    left: -0.8rem;
    right: -0.8rem;
    bottom: -0.8rem;
    border: 0.8rem solid ${({theme:l})=>l.gbaThemeBlue}50;
    border-radius: 50%;
  }
`,nt=D.div`
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
`,sh=D(nt)`
  border-width: 0 15px 25px 15px;
  border-color: transparent transparent ${({theme:l})=>l.pureWhite}
    transparent;
  top: 10px;
`,ih=D(nt)`
  border-width: 25px 15px 0 15px;
  border-color: ${({theme:l})=>l.pureWhite} transparent transparent
    transparent;
  bottom: 10px;
`,lh=D(nt)`
  border-width: 15px 25px 15px 0;
  border-color: transparent ${({theme:l})=>l.pureWhite} transparent
    transparent;
  left: 10px;
`,ch=D(nt)`
  border-width: 15px 0 15px 25px;
  border-color: transparent transparent transparent
    ${({theme:l})=>l.pureWhite};
  right: 10px;
`,dh=({initialPosition:l})=>{var H;const{emulator:m}=me(),{areItemsDraggable:s}=tt(),{layouts:p,setLayout:b}=Er(),[x,v]=T.useState({x:0,y:0}),[_,k]=T.useState(!0),w=T.useRef(null),S=T.useRef(null),[L,R]=T.useState({});T.useEffect(()=>{Object.keys(L).forEach(G=>{L[G]?m==null||m.simulateKeyDown(G):m==null||m.simulateKeyUp(G)})},[L,m]);const N=T.useCallback((G,q)=>R(V=>({...V,[G]:q})),[]),O=T.useCallback(G=>R(q=>Object.fromEntries(Object.entries(q).map(([V,I])=>[V,I===G?void 0:I]))),[]),B=({x:G,y:q})=>{const V=G*Math.cos(Math.PI/4)-q*Math.sin(Math.PI/4),I=G*Math.sin(Math.PI/4)+q*Math.cos(Math.PI/4);return V>=0&&I>=0?"RIGHT":V<0&&I>=0?"DOWN":V<0&&I<0?"LEFT":V>=0&&I<0?"UP":null},W=T.useCallback(G=>{if(!w.current||!S.current)return;const q=w.current.getBoundingClientRect(),V=S.current.getBoundingClientRect(),I=Math.max(-q.width/2+V.width/2,Math.min(G.clientX-q.left-q.width/2,q.width/2-V.width/2)),f=Math.max(-q.height/2+V.height/2,Math.min(G.clientY-q.top-q.height/2,q.height/2-V.height/2));s||v({x:I,y:f});const X=B({x:I,y:f});X&&!L[X]&&(O(G.pointerId),N(X,G.pointerId))},[s,L,N,O]),z=T.useCallback(G=>{if(k(!1),!w.current)return;const q=w.current.getBoundingClientRect(),V=G.clientX-q.left-q.width/2,I=G.clientY-q.top-q.width/2;s||v({x:V,y:I});const f=B({x:V,y:I});f&&N(f,G.pointerId)},[s,N]),Y=G=>{k(!0),v({x:0,y:0}),O(G.pointerId)},ee=((H=p==null?void 0:p.oPad)==null?void 0:H.position)??{x:0,y:0};return o.jsx(Lt,{nodeRef:w,disabled:!s,position:ee,onStop:(G,q)=>b("oPad",{position:{x:q.x,y:q.y}}),children:o.jsxs(ah,{"aria-label":"O-Pad",ref:w,$initialPosition:l,$areItemsDraggable:s,onPointerDown:z,onPointerMove:W,onPointerUp:Y,onPointerCancel:Y,onPointerOut:Y,onPointerLeave:Y,children:[o.jsx(Lt,{disabled:!0,nodeRef:S,position:x,children:o.jsx(oh,{ref:S,$isControlled:_})}),o.jsx(lh,{}),o.jsx(ch,{}),o.jsx(sh,{}),o.jsx(ih,{})]})})},ga=D(Mr)`
  background-color: ${({theme:l})=>l.darkGray};
  border-style: solid;
  border-color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  cursor: pointer;
  box-sizing: content-box;
  border-width: 2px;
`,uh=D(ga)`
  width: ${({$diameter:l=60})=>l}px;
  height: ${({$diameter:l=60})=>l}px;
  border-radius: 100px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,fh=D(ga)`
  border-radius: 16px;
  width: fit-content;
  min-width: 85px;
  border-color: ${({$areItemsDraggable:l=!1,theme:m})=>l?m.gbaThemeBlue:"rgba(255, 255, 255, 0.9)"};
  border-style: ${({$areItemsDraggable:l=!1})=>l?"dashed":"solid"};

  ${({$initialPosition:l={top:"0",left:"0"}})=>`
    top: ${l.top};
    left: ${l.left};
    `}
`,mh=({isRectangular:l=!1,width:m=60,children:s,keyId:p,inputName:b,onClick:x,initialPosition:v,initialOffset:_,enabled:k=!1,ariaLabel:w})=>{var ee;const{emulator:S}=me(),{areItemsDraggable:L}=tt(),{layouts:R,setLayout:N}=Er(),O=T.useRef(null);if(!k)return null;const B=x?{onClick:x}:{},W=p?{onPointerDown:()=>{S==null||S.simulateKeyDown(p)},onPointerUp:()=>{S==null||S.simulateKeyUp(p)},onPointerLeave:()=>{S==null||S.simulateKeyUp(p)},onPointerOut:()=>{S==null||S.simulateKeyUp(p)},onPointerCancel:()=>{S==null||S.simulateKeyUp(p)}}:{},z=p?{onKeyDown:H=>{(H.code=="Space"||H.key==" ")&&(S==null||S.simulateKeyDown(p))},onKeyUp:H=>{(H.code=="Space"||H.key==" ")&&(S==null||S.simulateKeyUp(p))}}:{},Y=((ee=R==null?void 0:R[b])==null?void 0:ee.position)??{x:0,y:0};return o.jsx(Lt,{nodeRef:O,positionOffset:_,position:Y,disabled:!L,onStop:(H,G)=>N(b,{position:{x:G.x,y:G.y}}),children:l?o.jsx(fh,{ref:O,$initialPosition:v,$areItemsDraggable:L,"aria-label":w,...W,...B,...z,children:s}):o.jsx(uh,{ref:O,$initialPosition:v,$diameter:m,$areItemsDraggable:L,"aria-label":w,...W,...B,...z,children:s})})},at=()=>{const{emulator:l}=me(),{setIsRunning:m}=ir(),[,s]=Fe(da),[p]=Fe(ca),[b]=Fe(la,1),[x]=Fe(ua,1);return T.useCallback(_=>{const k=l==null?void 0:l.run(_);return m(!!k),s(_),l==null||l.setVolume(b),k&&(p&&(l==null||l.remapKeyBindings(p)),x>1&&!(l!=null&&l.isFastForwardEnabled())&&(l==null||l.setFastForwardMultiplier(x))),!!k},[b,p,l,x,m,s])},xa=()=>{const l=at(),{isRunning:m,setIsRunning:s}=ir(),{emulator:p}=me(),[b]=Fe(da);return T.useCallback(()=>{if(m)p==null||p.quickReload();else if(p!=null&&p.getCurrentGameName()){const v=l(p.filePaths().gamePath+"/"+p.getCurrentGameName());s(!!v)}else if(b){const v=l(b);s(!!v)}},[p,m,s,l,b])},ba=D.div`
  text-align: center;
`,Tr=D.p`
  text-align: center;
  margin: 0;
`,_a=D.h3`
  margin: 0;
`,ya=D.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,wa=D.div`
  padding: 1rem;
  overflow-y: auto;
`,Sa=D.div`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
  border-top: 1px solid ${({theme:l})=>l.pattensBlue};
  padding: 1rem 1rem;
`,Ge=({children:l})=>o.jsx(wa,{children:l}),ze=({children:l})=>o.jsx(Sa,{"data-testid":"modal-footer:wrapper",children:l}),ph=D.button`
  width: 1em;
  height: 1em;
  padding: 1rem;
  margin: 0 0 0 auto;
  cursor: pointer;
  color: ${({theme:l})=>l.pureBlack};
  border: 0;
  border-radius: 0.25rem;
  opacity: 0.5;

  &:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    opacity: 1;
  }

  &:hover {
    opacity: 0.75;
  }

  background: transparent
    url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e")
    center/1em auto no-repeat;
`,Te=({title:l,showExitIndicator:m=!0})=>{const{setIsModalOpen:s}=ke();return o.jsxs(ya,{children:[o.jsx(_a,{id:"modalHeader",children:l}),m&&o.jsx(ph,{"aria-label":"Close",onClick:()=>s(!1)})]})},hh=()=>{const{accessToken:m}=fa(),s=T.useCallback(async _=>{const k="undefined/api/save/upload",w=new FormData;w.append("save",(_==null?void 0:_.saveFile)??"");const S={method:"POST",headers:{Authorization:`Bearer ${m}`},body:w},L=await fetch(k,S);if(!L.ok)throw new Error(`Received unexpected status code: ${L.status}`);return L},[void 0,m]),{data:p,isLoading:b,error:x,execute:v}=Pr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:b,error:x,execute:v}},vh=D.div`
  display: flex;
  align-items: center;
  gap: 5px;
`,gh=D.p`
  margin: 0;
  color: ${({theme:l})=>l.errorRed};
`,mr=({icon:l,text:m,className:s})=>o.jsxs(vh,{"data-testid":"error-with-icon",className:s,children:[l,o.jsx(gh,{children:m})]}),xh=({errorColor:l,loadingColor:m,respStatus:s,isLoading:p,hasError:b})=>{const x=()=>o.jsx(Mt,{"data-testid":"upload-save-spinner",color:m,cssOverride:{margin:"0 auto"}});let v=null;return p?v=x:b?v=()=>o.jsx(mr,{icon:o.jsx(ur,{style:{color:l}}),text:"Save file upload has failed"}):s===200?v=()=>o.jsx(Tr,{children:"Save file upload was successful!"}):v=()=>o.jsx(Tr,{children:"Are you sure you want to upload your current save file to the server?"}),o.jsx(Ge,{children:o.jsx(v,{})})},bh=()=>{const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:s}=me(),p=T.useId(),{data:b,isLoading:x,error:v,execute:_}=hh(),k=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to upload your current save file to the server."}),o.jsx("p",{children:"Remember to save in game before uploading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Send Save to Server"}),o.jsx(xh,{errorColor:l.errorRed,loadingColor:l.gbaThemeBlue,isLoading:x,hasError:!!v,respStatus:b==null?void 0:b.status}),o.jsxs(ze,{children:[o.jsx(fe,{id:p,variant:"contained",onClick:()=>{const w=s==null?void 0:s.getCurrentSave(),S=s==null?void 0:s.getCurrentSaveName();if(w&&S){const L=new Blob([w]),R=new File([L],S);_({saveFile:R})}},children:"Upload"}),o.jsx(fe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(Ve,{steps:k,completedProductTourStepName:"hasCompletedUploadSaveToServerTour"})]})},Vn=D.p`
  text-align: center;
  vertical-align: middle;
  line-height: 54px;
  color: ${({theme:l})=>l.pureWhite};
  margin: 0;
  font-size: 1.5em;
`,Kr=D.p`
  color: ${({theme:l})=>l.pureWhite};
  margin: 4px 5px;
`,_h=l=>l.replace("-"," ").replace(/\w\S*/g,m=>m.charAt(0).toUpperCase()+m.substring(1).toLowerCase()),yh=()=>{var V;const l=Pe(),m=fr(l.isLargerThanPhone),s=fr(l.isMobileWithUrlBar),{emulator:p}=me(),{isRunning:b}=ir(),{isAuthenticated:x}=fa(),{setModalContent:v,setIsModalOpen:_}=ke(),{layouts:k}=Er(),w=T.useId(),S=xa(),[L]=Fe(ha,0),[R]=Fe(va),N=(V=k==null?void 0:k.controlPanel)==null?void 0:V.initialBounds;if(!N)return null;const O=I=>I===void 0&&!m||!!I,B=O(R==null?void 0:R.OpadAndButtons),W=(R==null?void 0:R.NotificationsEnabled)??!0,z=N.bottom,Y=N.left,ee={"a-button":{defaultMobile:{top:`calc(${z}px + 12%)`,left:"calc(100dvw - 25px)"},mobileWithUrlBar:{top:`calc(${z}px + 10%)`},largerThanPhone:{top:`calc(${z}px + 35px - 3%)`,left:`calc(${Y}px + 450px)`}},"b-button":{defaultMobile:{top:`calc(${z}px + 15%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${z}px + 13%)`},largerThanPhone:{top:`calc(${z}px + 35px)`,left:`calc(${Y}px + 375px)`}},"start-button":{defaultMobile:{top:"88dvh",left:"25dvw"},mobileWithUrlBar:{top:"92dvh",left:"50dvw"},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`${Y}px`}},"select-button":{defaultMobile:{top:"88dvh",left:"55dvw"},mobileWithUrlBar:{top:"92dvh",left:"75dvw"},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`calc(${Y}px + 103px)`}},"l-button":{defaultMobile:{top:`${z+15}px`,left:"15px"},largerThanPhone:{top:`calc(${z}px + 15px)`,left:`${Y}px`}},"r-button":{defaultMobile:{top:`${z+15}px`,left:"calc(100dvw - 15px)"},largerThanPhone:{top:`calc(${z}px + 15px)`,left:`calc(${Y}px + 190px)`}},"quickreload-button":{defaultMobile:{top:`${z+10}px`,left:"135px"},largerThanPhone:{top:`calc(${z}px + 10px)`,left:`calc(${Y}px + 205px)`}},"uploadsave-button":{defaultMobile:{top:`${z+10}px`,left:"calc(100dvw - 135px)"},largerThanPhone:{top:`calc(${z}px + 10px)`,left:`calc(${Y}px + 300px)`}},"loadstate-button":{defaultMobile:{top:`calc(${z}px + 25%)`,left:"calc(100dvw - 40px)"},mobileWithUrlBar:{top:`calc(${z}px + 23%)`},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`calc(${Y}px + 248px)`}},"savestate-button":{defaultMobile:{top:`calc(${z}px + 27%)`,left:"calc(100dvw - 100px)"},mobileWithUrlBar:{top:`calc(${z}px + 25%)`},largerThanPhone:{top:`calc(${z}px + 60px)`,left:`calc(${Y}px + 300px)`}},"o-pad":{defaultMobile:{top:`calc(${z}px + 11%)`,left:"10px"},largerThanPhone:{top:`calc(${z}px + 10px)`,left:`calc(${Y}px + 450px)`}}},H=I=>{var X,K,oe,Me;let f;return s&&((X=ee[I])!=null&&X.mobileWithUrlBar)?f=(K=ee[I])==null?void 0:K.mobileWithUrlBar:m&&((oe=ee[I])!=null&&oe.largerThanPhone)&&(f=(Me=ee[I])==null?void 0:Me.largerThanPhone),{...ee[I].defaultMobile,...f}},G=(I,f,X)=>{W&&Qe[I?"success":"error"](I?f:X,{id:w})},q=[{keyId:"A",children:o.jsx(Vn,{children:"A"}),initialPosition:H("a-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"a-button",enabled:B},{keyId:"B",children:o.jsx(Vn,{children:"B"}),initialPosition:H("b-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"b-button",enabled:B},{keyId:"START",isRectangular:!0,children:o.jsx(Kr,{children:"Start"}),initialPosition:H("start-button"),keyName:"start-button",enabled:B},{keyId:"SELECT",isRectangular:!0,children:o.jsx(Kr,{children:"Select"}),initialPosition:H("select-button"),keyName:"select-button",enabled:B},{keyId:"L",isRectangular:!0,children:o.jsx(Kr,{children:"L"}),initialPosition:H("l-button"),keyName:"l-button",enabled:B},{keyId:"R",isRectangular:!0,children:o.jsx(Kr,{children:"R"}),initialPosition:H("r-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"r-button",enabled:B},{children:o.jsx(qm,{}),onClick:()=>{S(),!(p!=null&&p.getCurrentGameName())&&W&&Qe.error("Load a game to quick reload",{id:w})},width:40,initialPosition:H("quickreload-button"),keyName:"quickreload-button",enabled:O(R==null?void 0:R.QuickReload)},{children:o.jsx(Vm,{}),onClick:()=>{x()&&b?(v(o.jsx(bh,{})),_(!0)):W&&Qe.error("Please log in and load a game",{id:w})},width:40,initialPosition:H("uploadsave-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"uploadsave-button",enabled:O(R==null?void 0:R.SendSaveToServer)},{children:o.jsx(Hm,{}),onClick:()=>{const I=p==null?void 0:p.loadSaveState(L);G(!!I,`Loaded slot: ${L}`,`Failed to load slot: ${L}`)},width:40,initialPosition:H("loadstate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"loadstate-button",enabled:O(R==null?void 0:R.LoadState)},{children:o.jsx(Wm,{}),onClick:()=>{const I=p==null?void 0:p.createSaveState(L);G(!!I,`Saved slot: ${L}`,`Failed to save slot: ${L}`)},width:40,initialPosition:H("savestate-button"),initialOffset:{x:"-100%",y:"0px"},keyName:"savestate-button",enabled:O(R==null?void 0:R.SaveState)}];return o.jsxs(ea.Provider,{value:{color:l.pureWhite,size:"2em"},children:[B&&o.jsx(dh,{initialPosition:H("o-pad")}),q.map(I=>o.jsx(mh,{ariaLabel:_h(I.keyName),inputName:I.keyName,...I},I.keyName))]})},wh={overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:400},content:{width:"calc(100dvw - 20px)",height:"fit-content",margin:"25px auto auto auto",backgroundColor:"#fff",inset:"10px",maxWidth:"500px",padding:"0",maxHeight:"90dvh",display:"flex",touchAction:"none",flexDirection:"column",userSelect:"text"}},Sh=()=>{const{modalContent:l,isModalOpen:m,setIsModalOpen:s}=ke(),{emulator:p}=me();return o.jsx(Xm,{appElement:document.getElementById("root")||void 0,closeTimeoutMS:400,isOpen:m,style:wh,onRequestClose:()=>s(!1),onAfterOpen:p==null?void 0:p.disableKeyboardInput,onAfterClose:p==null?void 0:p.enableKeyboardInput,aria:{labelledby:"modalHeader"},children:l})},pr=250,Eh=D.li`
  color: ${({theme:l})=>l.gbaThemeBlue};
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}
`,Ch=D(Mr)`
  background-color: unset;
  border: none;
  color: inherit;
  cursor: pointer;
  height: 100%;
  padding: 0.5rem 1rem;
  text-align: inherit;
  width: 100%;

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,kh=D.span`
  margin-left: 0.5rem;
`,jh=D.ul`
  padding-left: 2rem;
`,kt=({title:l,icon:m,children:s,$isExpanded:p=!1,$disabled:b=!1})=>{const[x,v]=T.useState(p?"auto":0);return T.useEffect(()=>{v(p?"auto":0)},[p]),o.jsxs(Eh,{$disabled:b,children:[o.jsxs(Ch,{disabled:b,onClick:()=>{v(x===0?"auto":0)},children:[m,o.jsx(kh,{children:l})]}),o.jsx(Km,{duration:350,easing:"ease-in-out",height:x,children:o.jsx(jh,{children:s})})]})},Lh=D.li`
  cursor: pointer;
  color: ${({theme:l})=>l.gbaThemeBlue};
  list-style-type: none;
  padding: 0 2px;

  ${({$disabled:l=!1,theme:m})=>l&&`color: ${m.disabledGray};
     pointer-events: none;
     cursor: default;
    `}

  &:hover {
    color: ${({theme:l})=>l.menuHover};
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Fh=D(Mr)`
  background-color: unset;
  border: none;
  color: inherit;
  height: 100%;
  margin: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};

  text-align: inherit;
  width: 100%;
  cursor: pointer;
`,Rh=D.span`
  margin-left: 0.5rem;
`,Th=D.a`
  display: block;
  text-decoration: none;
  color: unset;
  outline-offset: 0;

  padding: 0.5rem
    ${({$withPadding:l=!1})=>l?"1rem":"0.5rem"};
`,Le=({title:l,icon:m,onClick:s=void 0,$link:p=void 0,$disabled:b=!1,$withPadding:x=!1})=>{const v=o.jsxs(o.Fragment,{children:[m,o.jsx(Rh,{children:l})]});return o.jsx(Lh,{$disabled:b,children:p?o.jsx(Th,{href:p,$withPadding:x,target:"_blank",children:v}):o.jsx(Fh,{disabled:b,onClick:s,$withPadding:x,children:v})})},Ph=()=>{const{setIsModalOpen:l}=ke(),[,m]=Fe(qt);return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"About"}),o.jsxs(Ge,{children:[o.jsx("p",{children:"Gbajs3 is a full featured Game Boy Advance emulator meant to operate online and offline in the browser."}),o.jsx("p",{children:"We currently support the mGBA core through the use of webassembly."}),o.jsx("p",{children:"Getting Started:"}),o.jsxs("ul",{children:[o.jsxs("li",{children:["Using the ",o.jsx("i",{children:"Pre Game Actions"})," menu, upload a sav file if you have one available"]}),o.jsxs("li",{children:["Then, load a rom of your choice through the ",o.jsx("i",{children:"Upload Rom"})," or"," ",o.jsx("i",{children:"Load Local Rom"})," menu items"]}),o.jsx("li",{children:"Enjoy, your game will boot!"})]})]}),o.jsxs(ze,{children:[o.jsx(fe,{variant:"contained",onClick:()=>{m({}),l(!1)},children:"Take a tour"}),o.jsx(fe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]})]})},Ea=Dt`
  100% {
    stroke-dashoffset: 0;
  }
`,Mh=Dt`
  0%,
  100% {
    transform: none;
  }
  50% {
    transform: scale3d(1.1, 1.1, 1);
  }
`,Dh=Dt`
  100% {
    box-shadow: inset 0 0 0 100vh var(--checkmark-fill-color);
  }
`,Ah=D.svg`
  position: absolute;
  width: 24px;
  height: 24px;

  display: block;
  margin-left: auto;
  margin-right: auto;
  border-radius: 50%;
  stroke: ${({theme:l})=>l.pureWhite};
  stroke-width: 5;
  stroke-miterlimit: 10;
  animation: ${Dh} 0.2s ease-in-out 0.2s forwards,
    ${Mh} 0.12s ease-in-out 0.45s both;
`,Bh=D.circle`
  stroke-dasharray: 166;
  stroke-dashoffset: 166;
  stroke-width: 5;
  stroke-miterlimit: 10;
  stroke: ${({theme:l})=>l.checkMarkGreen};
  fill: none;
  animation: ${Ea} 0.3s cubic-bezier(0.65, 0, 0.45, 1) forwards;
`,Ih=D.path`
  transform-origin: 50% 50%;
  stroke-dasharray: 48;
  stroke-dashoffset: 48;
  animation: ${Ea} 0.15s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
`,$h=D.span`
  ${({$isSuccessCheckVisible:l=!1})=>l&&"visibility: hidden;"}
`,Cr=({copy:l,msDuration:m=1100,onClick:s,showSuccess:p=!0,...b})=>{const x=T.useId(),[v,_]=T.useState(!1),k=!!p&&v;return Pt(()=>_(!1),k?m:null),o.jsxs(fe,{onClick:w=>{_(!0),s==null||s(w)},variant:"contained",...b,children:[k&&o.jsxs(Ah,{role:"graphics-symbol","aria-labelledby":x,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 52 52",children:[o.jsx("title",{id:x,children:"Circle Check"}),o.jsx(Bh,{cx:"26",cy:"26",r:"25",fill:"none"}),o.jsx(Ih,{fill:"none",d:"M14.1 27.2l7.1 7.2 16.7-16.8"})]}),o.jsx($h,{$isSuccessCheckVisible:k,children:l})]})},wr=et.forwardRef(({id:l,label:m,watcher:s,...p},b)=>o.jsx(na,{"data-testid":"managed-checkbox:label",id:l,control:o.jsx(Rr,{ref:b,checked:!!s,...p}),label:m,style:{margin:0}})),Nh=D.ul`
  list-style: none;
  display: ${({$shouldHide:l=!1})=>l?"none":"flex"};
  flex-direction: column;
  gap: 10px;
  padding: 10px;
  margin: 0;
  max-width: 100%;
`,Uh=D.li`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  padding-bottom: 10px;
  width: 100%;
`,Oh=D(Ym)`
  min-height: 40px;
  min-width: 40px;
`,Gh=D(ra)`
  width: 25px;
  height: 25px;
`,Hn=D.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: ${({$fullWidth:l=!1})=>l?"100%":"auto"};

  @media ${({theme:l})=>l.isLargerThanPhone} {
    flex-direction: row;
  }
`,zh=D.div`
  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: space-between;
`,qh=D.p`
  margin-bottom: 0;
  margin-left: 0;
  margin-right: 0;
  margin-top: ${({$withMargin:l=!1})=>l?"5px":"0"};
`,Vh=()=>{var q;const l=Pe(),m=fr(l.isLargerThanPhone),{setIsModalOpen:s}=ke(),{emulator:p}=me(),[b,x]=T.useState(!1),v=T.useId(),_={desc:"",code:"",enable:!1},[k,w]=T.useMemo(()=>{const V=p==null?void 0:p.getCurrentCheatsFile(),I=new TextDecoder().decode(V);return[I,p==null?void 0:p.parseCheatsString(I)]},[p]),{register:S,control:L,handleSubmit:R,watch:N,setValue:O,formState:{errors:B,isSubmitSuccessful:W}}=hr({defaultValues:{rawCheats:k,cheats:w!=null&&w.length?w:[_]}}),{fields:z,append:Y,remove:ee}=Qm({control:L,name:"cheats"}),H=T.useCallback(()=>{const V=p==null?void 0:p.getCurrentCheatsFile(),I=new TextDecoder().decode(V),f=(p==null?void 0:p.parseCheatsString(I))??[];b?O("cheats",f):O("rawCheats",I)},[p,O,b]),G=[{content:o.jsx("p",{children:"Use this form to enter, add, and delete cheats."}),target:`#${CSS.escape(`${v}--cheats-form`)}`},{content:o.jsx("p",{children:"This form field is for the name of the cheat."}),target:`#${CSS.escape(`${v}--name`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Put your cheat code into this field."}),o.jsx("p",{children:"Remember to separate multi-line cheats with the '+' character!"})]}),target:`#${CSS.escape(`${v}--cheat-code`)}`},{content:o.jsx("p",{children:"Use the checkbox to enable/disable a cheat."}),placement:"right",target:`#${CSS.escape(`${v}--enabled`)}`},{content:o.jsx("p",{children:"Use the trash button to remove a cheat entirely."}),placement:"right",target:`#${CSS.escape(`${v}--remove`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new cheat."]}),target:`#${CSS.escape(`${v}--add-cheat`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Submit"})," button to save your cheats, and convert them to libretro format."]}),target:`#${CSS.escape(`${v}--submit-button`)}`},{content:o.jsx("p",{children:"Use this button to toggle between viewing parsed cheats or raw cheats in libretro file format."}),placement:"right",target:`#${CSS.escape(`${v}--toggle-raw-cheats`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Manage Cheats"}),o.jsx(Ge,{children:o.jsxs("form",{"aria-label":"Cheats Form",id:`${v}--cheats-form`,onSubmit:R(V=>{const I=b?new File([new Blob([V.rawCheats],{type:"text/plain"})],(p==null?void 0:p.getCurrentCheatsFileName())??"unknown.cheats"):p==null?void 0:p.parsedCheatsToFile(V.cheats);I&&(p==null||p.uploadCheats(I,()=>{p.autoLoadCheats(),H()}))}),children:[o.jsx(dr,{error:!!(B!=null&&B.rawCheats),label:"Raw Libretro Cheats",InputLabelProps:{shrink:!0},multiline:!0,fullWidth:!0,minRows:6,variant:"outlined",InputProps:{sx:{textarea:{whiteSpace:"pre",overflowX:"auto !important"}}},helperText:(q=B==null?void 0:B.rawCheats)==null?void 0:q.message,style:{display:b?"block":"none"},...S("rawCheats")}),o.jsx(Nh,{$shouldHide:b,children:z.map((V,I)=>{var X,K,oe,Me,De,He,rr,Je,Ze,ne;const f=we=>I===0?we:void 0;return o.jsxs(Uh,{children:[o.jsxs(Hn,{$fullWidth:!0,children:[o.jsx(dr,{id:f(`${v}--name`),label:"Name",error:!!((K=(X=B==null?void 0:B.cheats)==null?void 0:X[I])!=null&&K.desc),size:"small",autoComplete:"Name",style:m?{maxWidth:100}:void 0,helperText:(De=(Me=(oe=B==null?void 0:B.cheats)==null?void 0:oe[I])==null?void 0:Me.desc)==null?void 0:De.message,...S(`cheats.${I}.desc`,{required:{value:!0,message:"required"}})}),o.jsx(dr,{id:f(`${v}--cheat-code`),label:"Cheat Code",error:!!((rr=(He=B==null?void 0:B.cheats)==null?void 0:He[I])!=null&&rr.code),size:"small",autoComplete:"Code",helperText:(ne=(Ze=(Je=B==null?void 0:B.cheats)==null?void 0:Je[I])==null?void 0:Ze.code)==null?void 0:ne.message,...S(`cheats.${I}.code`,{required:{value:!0,message:"required"}})})]}),o.jsxs(Hn,{children:[o.jsx(wr,{id:f(`${v}--enabled`),label:"Enabled",watcher:N(`cheats.${I}.enable`),...S(`cheats.${I}.enable`)}),o.jsx(sr,{"aria-label":"Delete",id:f(`${v}--remove`),sx:{padding:0,marginRight:"auto","&:hover":{borderRadius:"10px"},"&:focus":{borderRadius:"10px"},"& .MuiTouchRipple-root .MuiTouchRipple-child":{borderRadius:"10px"}},onClick:()=>ee(I),children:o.jsx(Oh,{})})]})]},V.id)})}),o.jsxs(zh,{children:[o.jsx(sr,{"aria-label":"Create new cheat",id:`${v}--add-cheat`,sx:{padding:0,display:b?"none":"flex"},onClick:()=>Y(_),children:o.jsx(Gh,{})}),o.jsx(qh,{$withMargin:b,children:"Join multi-line codes with '+'"})]})]})}),o.jsxs(ze,{children:[o.jsx(Cr,{copy:"Submit",form:`${v}--cheats-form`,id:`${v}--submit-button`,showSuccess:W,type:"submit"}),o.jsx(fe,{id:`${v}--toggle-raw-cheats`,color:"info",variant:"contained",onClick:()=>x(V=>!V),children:b?"Parsed":"Raw"}),o.jsx(fe,{variant:"outlined",onClick:()=>s(!1),children:"Close"})]}),o.jsx(Ve,{steps:G,completedProductTourStepName:"hasCompletedCheatsTour"})]})},Hh=D.form`
  display: flex;
  flex-direction: column;
  gap: 10px;
`,Wh=({id:l,onAfterSubmit:m})=>{const{emulator:s}=me(),{isRunning:p}=ir(),{handleSubmit:b,setValue:x,control:v,formState:{errors:_}}=hr(),k=s==null?void 0:s.defaultKeyBindings(),[w,S]=Fe(ca),L=N=>{const O=Object.entries(N).filter(([,B])=>!!B).map(([,B])=>B);p&&(s==null||s.remapKeyBindings(O)),S(O),m()},R=w??k;return o.jsx(Hh,{"aria-label":"Key Bindings Form",id:l,onSubmit:b(L),children:R==null?void 0:R.map(N=>o.jsx(rt,{control:v,name:N.gbaInput,defaultValue:N,rules:{validate:{noSpace:O=>O.key!==" "||"Space is reserved for accessibility requirements",noTab:O=>{var B;return((B=O.key)==null?void 0:B.toLowerCase())!=="tab"||"Tab is reserved for accessibility requirements"}}},render:({field:{value:O}})=>{var B;return o.jsx(dr,{variant:"outlined",label:O.gbaInput,value:O.key,onKeyDown:W=>{W.key.toLowerCase()!=="tab"&&(x(O.gbaInput,{gbaInput:O.gbaInput,key:W.key,location:W.location}),W.preventDefault())},error:!!_[N.gbaInput],helperText:(B=_==null?void 0:_[N.gbaInput])==null?void 0:B.message})}},`gba_input_${N.gbaInput.toLowerCase()}`))})},Xh=et.forwardRef(({id:l,label:m,watcher:s,...p},b)=>o.jsx(na,{"data-testid":"managed-switch:label",id:l,control:o.jsx(Ep,{ref:b,checked:!!s,...p}),label:m,style:{margin:0}})),Kh=D.form`
  display: flex;
  flex-direction: column;
`,Yh=({id:l,onAfterSubmit:m})=>{const[s,p]=Fe(va),b=Pe(),x=fr(b.isLargerThanPhone),v=L=>L===void 0&&!x||!!L,{register:_,handleSubmit:k,watch:w}=hr({values:s??{OpadAndButtons:v(void 0),SaveState:v(void 0),LoadState:v(void 0),QuickReload:v(void 0),SendSaveToServer:v(void 0),NotificationsEnabled:!0},resetOptions:{keepDirtyValues:!0}}),S=async L=>{p(R=>({...R,...L})),m()};return o.jsxs(Kh,{"aria-label":"Virtual Controls Form",id:l,onSubmit:k(S),children:[o.jsx(wr,{label:"Virtual D-pad/Buttons",watcher:w("OpadAndButtons"),..._("OpadAndButtons")}),o.jsx(wr,{label:"Save State",watcher:w("SaveState"),..._("SaveState")}),o.jsx(wr,{label:"Load State",watcher:w("LoadState"),..._("LoadState")}),o.jsx(wr,{label:"Quick Reload",watcher:w("QuickReload"),..._("QuickReload")}),o.jsx(wr,{label:"Send save to server",watcher:w("SendSaveToServer"),..._("SendSaveToServer")}),o.jsx(Xh,{label:"Enable Notifications",watcher:w("NotificationsEnabled"),..._("NotificationsEnabled")})]})},Qh=D(Cp)`
  border-bottom: 1px solid;
  border-color: rgba(0, 0, 0, 0.12);
`,Jh=D.div`
  padding: 24px;
`,Rt=l=>({id:`control-tab-${l}`,"aria-controls":`tabpanel-${l}`}),Wn=({children:l,index:m,value:s})=>o.jsx("div",{role:"tabpanel",hidden:s!==m,id:`tabpanel-${m}`,"aria-labelledby":`tab-${m}`,children:s===m&&o.jsx(Jh,{children:l})}),Zh=({setFormId:l,virtualControlsFormId:m,keyBindingsFormId:s,resetPositionsButtonId:p,setIsSuccessfulSubmit:b})=>{const{clearLayouts:x}=Er(),[v,_]=T.useState(0),k=(S,L)=>{_(L),l(L===0?m:s),b(!1)},w=()=>b(!0);return o.jsxs(o.Fragment,{children:[o.jsxs(Qh,{value:v,onChange:k,"aria-label":"Control tabs",children:[o.jsx(zn,{label:"Virtual Controls",...Rt(0)}),o.jsx(zn,{label:"Key Bindings",...Rt(1)})]}),o.jsxs(Wn,{value:v,index:0,children:[o.jsx(Yh,{id:m,onAfterSubmit:w}),o.jsx(fe,{id:p,sx:{marginTop:"10px"},onClick:x,children:"Reset All Positions"})]}),o.jsx(Wn,{value:v,index:1,children:o.jsx(Wh,{id:s,onAfterSubmit:w})})]})},ev=()=>{const{setIsModalOpen:l}=ke(),m=T.useId(),[s,p]=T.useState(`${m}--virtual-controls-form`),[b,x]=T.useState(!1),v=[{content:o.jsx("p",{children:"Select which virtual controls you wish to enable in this form tab."}),target:`#${CSS.escape(`${m}--virtual-controls-form`)}`},{content:o.jsx("p",{children:"Use this button to reset the positions of the screen, control panel, and all virtual controls."}),target:`#${CSS.escape(`${m}--reset-positions-button`)}`},{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use the tab panel to change which form you are seeing."}),o.jsxs("p",{children:["Select the ",o.jsx("i",{children:"KEY BINDINGS"})," tab above, then click next!"]})]}),placement:"right",target:`#${CSS.escape(Rt(1).id)}`,disableBeacon:!0,disableOverlayClose:!0,hideCloseButton:!1,spotlightClicks:!0},{content:o.jsx("p",{children:"Remap keybindings by selecting a form field and typing your desired input."}),placement:"top-end",target:`#${CSS.escape(`${m}--key-bindings-form`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"Save Changes"})," button to persist changes from the current form tab."]}),target:`#${CSS.escape(`${m}--save-changes-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Controls"}),o.jsx(Ge,{children:o.jsx(Zh,{setFormId:p,virtualControlsFormId:`${m}--virtual-controls-form`,keyBindingsFormId:`${m}--key-bindings-form`,resetPositionsButtonId:`${m}--reset-positions-button`,setIsSuccessfulSubmit:x})}),o.jsxs(ze,{children:[o.jsx(Cr,{copy:"Save Changes",form:s,id:`${m}--save-changes-button`,type:"submit",showSuccess:b}),o.jsx(fe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:v,completedProductTourStepName:"hasCompletedControlsTour"})]})},rv=()=>{const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:s}=me(),p=T.useId(),[b,x]=T.useState(!1),v=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this button to download your current save file."}),o.jsx("p",{children:"Remember to save in game before downloading!"})]}),placement:"right",target:`#${CSS.escape(p)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Download Save"}),o.jsx(Ge,{children:b?o.jsx(mr,{icon:o.jsx(ur,{style:{color:l.errorRed}}),text:"Load a rom to download its save file"}):o.jsx(Tr,{children:"Remember to save in game before downloading your save file!"})}),o.jsxs(ze,{children:[o.jsx(fe,{id:p,variant:"contained",onClick:()=>{const _=s==null?void 0:s.getCurrentSave(),k=s==null?void 0:s.getCurrentSaveName();if(_&&k){const w=new Blob([_],{type:"data:application/octet-stream"}),S=document.createElement("a");S.download=k,S.href=URL.createObjectURL(w),S.click(),S.remove()}else x(!0)},children:"Download"}),o.jsx(fe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(Ve,{steps:v,completedProductTourStepName:"hasCompletedDownloadSaveTour"})]})},tv=l=>o.jsx(Bt,{"data-testid":"action-box:minus",className:"minus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})}),nv=l=>o.jsx(Bt,{"data-testid":"action-box:plus",className:"plus",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})}),av=l=>o.jsx(Bt,{"data-testid":"action-box:close",className:"close",fontSize:"inherit",style:{width:14,height:14},...l,children:o.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})}),ov=kp(l=>o.jsx(jp,{...l}))(({theme:l})=>({marginTop:5,[`& .${Ct.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${Ct.groupTransition}`]:{marginLeft:15,paddingLeft:10,borderLeft:`1px dashed ${Lp(l.palette.text.primary,.4)}`},[`& .${Ct.content}`]:{width:"auto",alignItems:"baseline"}})),sv=D.div`
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: space-between;

  > p {
    margin: 0;
    word-wrap: break-word;
    max-width: 100%;
  }
`,iv=D.div`
  display: flex;
  gap: 15px;
`,lv=({id:l,allFiles:m,deleteFile:s,downloadFile:p})=>{if(!m)return null;const b=x=>{const v=x.path.split("/").pop(),_=o.jsxs(sv,{children:[o.jsx("p",{children:v}),o.jsxs(iv,{children:[o.jsx(sr,{"aria-label":`Download ${v}`,sx:{padding:0,margin:0},onClick:()=>p(x.path),children:o.jsx(ta,{})}),o.jsx(sr,{"aria-label":`Delete ${v}`,sx:{padding:0},onClick:()=>s(x.path),children:o.jsx(At,{})})]})]});return o.jsx(ov,{itemId:x.path,label:x.isDir?v:_,children:x.isDir&&x.children?x.children.map(k=>b(k)):null},x.path)};return o.jsx(Fp,{id:l,"aria-label":"File System",defaultExpandedItems:[m.path],slots:{collapseIcon:tv,endIcon:av,expandIcon:nv},sx:{minHeight:264},children:b(m)})},cv=()=>{const{setIsModalOpen:l}=ke(),{emulator:m}=me(),[s,p]=T.useState(),b=T.useId(),x=T.useCallback(w=>{m==null||m.deleteFile(w),p(m==null?void 0:m.listAllFiles())},[m]),v=w=>{const S=w.split("/").pop(),L=m==null?void 0:m.getFile(w);if(L&&S){const R=new Blob([L],{type:"data:application/octet-stream"}),N=document.createElement("a");N.download=S,N.href=URL.createObjectURL(R),N.click(),N.remove()}},_=s??(m==null?void 0:m.listAllFiles()),k=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to view your current file tree, download files, and delete files from the tree."}),o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," and ",o.jsx("i",{children:"minus"})," icons to open and close file tree branches!"]})]}),target:`#${CSS.escape(`${b}--emulator-fs`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"SAVE FILE SYSTEM"})," button to persist all of your files to your device!"]}),target:`#${CSS.escape(`${b}--save-file-system-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"File System"}),o.jsx(Ge,{children:o.jsx(lv,{id:`${b}--emulator-fs`,allFiles:_,deleteFile:x,downloadFile:v})}),o.jsxs(ze,{children:[o.jsx(Cr,{copy:"Save File System",id:`${b}--save-file-system-button`,onClick:m==null?void 0:m.fsSync}),o.jsx(fe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:k,completedProductTourStepName:"hasCompletedFileSystemTour"})]})},Qr=D.button`
  padding: 0.5rem 1rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  text-decoration: none;
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Jr=D.li`
  cursor: pointer;
`,dv=D.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Jr}:first-child > ${Qr} {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Jr}:last-child > ${Qr} {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Jr}:not(:first-child) > ${Qr} {
    border-top-width: 0;
  }
`,uv=()=>{var _,k,w;const{setIsModalOpen:l}=ke(),{emulator:m}=me(),s=T.useId(),p=at(),b=[".",".."],x=(k=(_=m==null?void 0:m.listRoms)==null?void 0:_.call(m))==null?void 0:k.filter(S=>!b.includes(S)),v=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to load local roms that have been saved to your device."}),o.jsx("p",{children:"Tap the name of your rom file and your game will boot!"}),o.jsxs("p",{children:["To persist roms and other files, use the ",o.jsx("i",{children:"File System"})," menu item."]})]}),target:`#${CSS.escape(s)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Load Local Rom"}),o.jsx(Ge,{children:o.jsxs(dv,{id:s,children:[(w=x==null?void 0:x.map)==null?void 0:w.call(x,(S,L)=>o.jsx(Jr,{children:o.jsx(Qr,{onClick:()=>{p((m==null?void 0:m.filePaths().gamePath)+"/"+S),l(!1)},children:S})},`${S}_${L}`)),!(x!=null&&x.length)&&o.jsx("li",{children:o.jsx(Tr,{children:"No local roms, load a game and save your file system"})})]})}),o.jsx(ze,{children:o.jsx(fe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})}),o.jsx(Ve,{steps:v,completedProductTourStepName:"hasCompletedLoadLocalRomTour"})]})},fv=D.button`
  padding: 0.5rem 0.5rem;
  width: 100%;
  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: none;
  text-align: left;

  &:hover {
    color: ${({theme:l})=>l.darkGrayBlue};
    background-color: ${({theme:l})=>l.aliceBlue1};
  }
`,Zr=D.li`
  cursor: pointer;
  display: grid;
  grid-template-columns: auto 32px;
  gap: 10px;

  color: ${({theme:l})=>l.blueCharcoal};
  background-color: ${({theme:l})=>l.pureWhite};
  border: 1px solid rgba(0, 0, 0, 0.125);
`,mv=D.ul`
  list-style-type: none;
  display: flex;
  flex-direction: column;
  margin: 0;
  padding: 0;

  & > ${Zr}:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
  }

  & > ${Zr}:last-child {
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  & > ${Zr}:not(:first-child) {
    border-top-width: 0;
  }
`,pv=D(ra)`
  width: 25px;
  height: 25px;
`,hv=D(At)`
  height: 100%;
  width: 20px;
`,vv=D.form`
  display: flex;
  justify-content: space-between;
  gap: 16px;
  border-bottom: 1px solid ${({theme:l})=>l.pattensBlue};
  margin-bottom: 16px;
  padding-bottom: 16px;
`,gv=()=>{var ee,H,G;const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:s}=me(),[p,b]=T.useState(),[x,v]=T.useState(null),[_,k]=Fe(ha,0),w=T.useId(),{register:S,handleSubmit:L,setValue:R,formState:{errors:N,isSubmitSuccessful:O}}=hr({defaultValues:{saveStateSlot:_}}),B=T.useCallback(()=>{var V;const q=(V=s==null?void 0:s.listSaveStates())==null?void 0:V.filter(I=>I!=="."&&I!=="..");b(q)},[s]);T.useEffect(()=>{R("saveStateSlot",_)},[_,R]);const W=async q=>{k(q.saveStateSlot)},z=p??((ee=s==null?void 0:s.listSaveStates())==null?void 0:ee.filter(q=>q!=="."&&q!=="..")),Y=[{content:o.jsx("p",{children:"Use this input and button to manually update the current save state slot in use."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${w}--save-state-slot-form`)}`},{content:o.jsx("p",{children:"Tap a row to load a save state, or use the trash can icon to delete a save state."}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${w}--save-state-list`)}`},{content:o.jsxs("p",{children:["Use the ",o.jsx("i",{children:"plus"})," button to add a new save state. This will automatically increase the current save state number!"]}),placementBeacon:"bottom-end",target:`#${CSS.escape(`${w}--add-state-button`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Manage Save States"}),o.jsxs(Ge,{children:[o.jsxs(vv,{id:`${w}--save-state-slot-form`,onSubmit:L(W),children:[o.jsx(dr,{label:"Current Save State Slot",type:"number",InputLabelProps:{shrink:!0},size:"small",error:!!(N!=null&&N.saveStateSlot),helperText:(H=N==null?void 0:N.saveStateSlot)==null?void 0:H.message,...S("saveStateSlot",{required:{value:!0,message:"Slot is required"},min:{value:0,message:"Slot must be >= 0"},valueAsNumber:!0})}),o.jsx(Cr,{copy:"Update Slot",showSuccess:O,size:"small",type:"submit",sx:{maxHeight:"40px"}})]}),o.jsxs(mv,{id:`${w}--save-state-list`,children:[(G=z==null?void 0:z.map)==null?void 0:G.call(z,(q,V)=>o.jsxs(Zr,{children:[o.jsx(fv,{onClick:()=>{const I=q.split(".").pop(),f=I==null?void 0:I.replace("ss","");if(f){const X=parseInt(f);(s==null?void 0:s.loadSaveState(X))?(k(X),v(null)):v("Failed to load save state")}},children:q}),o.jsx(sr,{"aria-label":`Delete ${q}`,sx:{padding:0},onClick:()=>{const I=q.split(".").pop(),f=I==null?void 0:I.replace("ss","");if(f){const X=parseInt(f);s==null||s.deleteSaveState(X),B()}},children:o.jsx(hv,{})})]},`${q}_${V}`)),!(z!=null&&z.length)&&o.jsx("li",{children:o.jsx(Tr,{children:"No save states"})})]}),o.jsx(sr,{id:`${w}--add-state-button`,"aria-label":"Create new save state",sx:{padding:0},onClick:()=>{(s==null?void 0:s.createSaveState(_+1))?(B(),k(V=>V+1),v(null)):v("Failed to create save state")},children:o.jsx(pv,{})}),x&&o.jsx(mr,{icon:o.jsx(ur,{style:{color:l.errorRed}}),text:x})]}),o.jsx(ze,{children:o.jsx(fe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})}),o.jsx(Ve,{steps:Y,completedProductTourStepName:"hasCompletedSaveStatesTour"})]})},xv=D.div`
  cursor: pointer;
  border-color: ${({theme:l})=>l.blackRussian};
  background-color: ${({$isDragActive:l=!1,theme:m})=>l?m.arcticAirBlue:m.aliceBlue2};
  border-width: 1px;
  border-style: dashed;
  padding: 0.5rem;
  text-align: center;
`,bv=D(Ft)`
  height: 60px;
  width: auto;
`,_v=D.div`
  padding-top: 3px;
`,yv=D.ul`
  display: flex;
  flex-direction: column;
  gap: 10px;
  list-style: none;
  margin: 0;
  max-width: 100%;
  padding: 10px 5px 5px 5px;

  > p {
    margin: 0;
  }
`,wv=D.li`
  align-items: center;
  display: flex;
  gap: 10px;
  justify-content: space-between;

  > p {
    margin: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
`,Sv=D.div`
  display: flex;
  gap: 15px;
`,Ev=({fileNames:l,onDeleteFile:m})=>o.jsxs(yv,{children:[o.jsxs("p",{children:["File",l.length>1&&"s"," to upload:"]}),l.map((s,p)=>o.jsxs(wv,{children:[o.jsx("p",{children:s}),o.jsx(Sv,{children:o.jsx(sr,{"aria-label":`Delete ${s}`,sx:{padding:0},onClick:()=>m(s),children:o.jsx(At,{})})})]},`${s}_${p}`))]}),Cv=(l,m)=>{const s=`.${l.name.split(".").pop()}`;return m.some(p=>typeof p=="string"?p===s:!!p.regex.exec(s))},jt=l=>typeof l=="string"?l:l.displayText,kv=(l,m)=>{if(!l.length)return;const s=m?"At least one":"One";let p=`${s} `+l.slice(0,-1).map(jt).join(", ")+`, or ${jt(l.slice(-1)[0])} file is required`;return l.length==1&&(p=`${s} ${jt(l[0])} file is required`),b=>!(b instanceof File)||b&&Cv(b,l)?null:{message:p,code:Zm.FileInvalidType}},Vt=({ariaLabel:l,children:m,error:s,hideAcceptedFiles:p,hideErrors:b,id:x,multiple:v=!1,name:_,onDrop:k,validFileExtensions:w})=>{const S=Pe(),[L,R]=T.useState([]),{getRootProps:N,getInputProps:O,isDragActive:B,fileRejections:W}=Jm({multiple:v,onDrop:H=>{R(H),k(H)},validator:kv(w,v)}),z=s?[s]:W.length&&L.length?["Some files were rejected"]:[...new Set(W.flatMap(H=>H.errors).map(H=>H.message))],Y=H=>{const G=L.filter(q=>q.name!==H);R(G),k(G)},ee=L.map(H=>H.name);return o.jsxs(o.Fragment,{children:[o.jsxs(xv,{...N({id:x,$isDragActive:B,"aria-label":l}),children:[o.jsx("input",{"data-testid":"hidden-file-input",...O({name:_})}),o.jsx(bv,{}),m]}),!!ee.length&&!p&&o.jsx(Ev,{fileNames:ee,onDeleteFile:Y}),!!z.length&&!b&&o.jsx(_v,{children:z.map(H=>o.jsx(mr,{icon:o.jsx(ur,{style:{color:S.errorRed}}),text:H},H))})]})},jv=[".cheats"],Lv=()=>{const{setIsModalOpen:l}=ke(),{emulator:m}=me(),{reset:s,handleSubmit:p,setValue:b,formState:{isSubmitSuccessful:x},control:v}=hr(),_=T.useId(),k=T.useCallback(L=>{s(),b("cheatFiles",L,{shouldValidate:!0})},[s,b]),w=({cheatFiles:L})=>{L.forEach(R=>m==null?void 0:m.uploadCheats(R)),s()},S=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your cheat files, or click to select files."}),o.jsx("p",{children:"Cheat files should be in libretro format and have the extension '.cheats'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${_}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Upload Cheats"}),o.jsx(Ge,{children:o.jsxs("form",{id:_,"aria-label":"Upload Cheats Form",onSubmit:p(w),children:[o.jsx(rt,{control:v,name:"cheatFiles",rules:{validate:L=>(L==null?void 0:L.length)>0||"At least one .cheats file is required"},render:({field:{name:L,value:R},fieldState:{error:N}})=>o.jsx(Vt,{ariaLabel:"Upload Cheats",id:`${_}--drag-and-drop`,onDrop:k,name:L,validFileExtensions:jv,error:N==null?void 0:N.message,hideAcceptedFiles:!(R!=null&&R.length),hideErrors:x,multiple:!0,children:o.jsxs("p",{children:["Drag and drop cheat files here,",o.jsx("br",{}),"or click to upload files"]})})}),x&&o.jsx(ba,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(ze,{children:[o.jsx(Cr,{copy:"Upload",form:_,showSuccess:x,type:"submit"}),o.jsx(fe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:S,completedProductTourStepName:"hasCompletedUploadCheatsTour"})]})},Fv=()=>{const l=T.useCallback(async x=>{var R,N,O;const v={method:"GET"};if(!x)return;const _=await fetch(x.url,v),k=(O=(N=(R=_.headers.get("Content-Disposition"))==null?void 0:R.split(";").pop())==null?void 0:N.split("=").pop())==null?void 0:O.replace(/"/g,""),w=decodeURIComponent(x.url.pathname.split("/").pop()??"unknown_external.gba");if(!_.ok)throw new Error(`Received unexpected status code: ${_.status}`);const S=await _.blob();return new File([S],k??w)},[]),{data:m,isLoading:s,error:p,execute:b}=Pr({fetchFn:l,clearDataOnLoad:!0});return{data:m,isLoading:s,error:p,execute:b}},Rv=D.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,Tv=D.p`
  word-wrap: break-word;
  max-width: 100%;
`,Xn=[".gba",".gbc",".gb",".zip",".7z"],Pv=({isLoading:l,currentRomURL:m,children:s,indicator:p})=>l?o.jsxs(Rv,{children:[o.jsxs(Tv,{children:["Loading rom from url:",o.jsx("br",{}),m]}),p]}):s,Mv=()=>{var V,I;const l=Pe(),{setIsModalOpen:m}=ke(),{emulator:s}=me(),{register:p,handleSubmit:b,setValue:x,reset:v,formState:{errors:_},watch:k,control:w}=hr(),[S,L]=T.useState(null),{data:R,isLoading:N,error:O,execute:B}=Fv(),W=T.useId(),z=at(),Y=!N&&!!R&&!!S;T.useEffect(()=>{if(Y){const f=()=>{z((s==null?void 0:s.filePaths().gamePath)+"/"+R.name)&&m(!1)};s==null||s.uploadRom(R,f),L(null)}},[Y,R,s,m,z]);const ee=T.useCallback(f=>{v(),x("romFile",f[0],{shouldValidate:!0})},[v,x]),H=async({romFile:f,romURL:X})=>{if(X){L(X),await B({url:new URL(X)});return}const K=()=>{z((s==null?void 0:s.filePaths().gamePath)+"/"+f.name)&&m(!1)};s==null||s.uploadRom(f,K)},G=!!k("romFile"),q=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your rom or zipped rom file, or click to select a file."}),o.jsxs("p",{children:["Rom files should have an extension of:"," ",Xn.map(f=>`'${f}'`).join(", "),"."]}),o.jsx("p",{children:"You may drop or select one rom at a time, once uploaded your game will boot!"})]}),target:`#${CSS.escape(`${W}--drag-and-drop`)}`},{content:o.jsx("p",{children:"Alternatively, you may load a rom file from an external URL."}),target:`#${CSS.escape(`${W}--rom-url`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Upload Rom"}),o.jsx(Ge,{children:o.jsx(Pv,{isLoading:N,currentRomURL:S,indicator:o.jsx(Mt,{color:l.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),children:o.jsxs("form",{id:W,"aria-label":"Upload Rom Form",onSubmit:b(H),children:[o.jsx(rt,{control:w,name:"romFile",rules:{validate:(f,X)=>!!X.romURL||!!f||"A rom file or URL is required"},render:({field:{name:f},fieldState:{error:X}})=>o.jsx(Vt,{ariaLabel:"Upload Rom",id:`${W}--drag-and-drop`,onDrop:ee,name:f,validFileExtensions:Xn,hideErrors:!!X,children:o.jsx("p",{children:"Drag and drop a rom or zipped rom file here, or click to upload a file"})})}),!G&&o.jsxs(o.Fragment,{children:[o.jsx(Yr,{sx:{padding:"10px 0"},children:"or"}),o.jsx(dr,{id:`${W}--rom-url`,error:!!(_!=null&&_.romURL),label:"Upload from a URL",size:"small",autoComplete:"romURL",variant:"filled",helperText:(V=_==null?void 0:_.romURL)==null?void 0:V.message,"aria-label":"Upload Rom From URL",fullWidth:!0,...p("romURL",{validate:(f,X)=>{if(!f)return!0;if(X.romFile)return"Cannot specify both a file and a URL";try{return new URL(f),!0}catch{return"Invalid URL"}}})}),!!O&&o.jsx(mr,{icon:o.jsx(ur,{style:{color:l.errorRed}}),text:"Loading rom from URL has failed"})]}),((I=_.romFile)==null?void 0:I.message)&&o.jsx(mr,{icon:o.jsx(ur,{style:{color:l.errorRed}}),text:_.romFile.message})]})})}),o.jsxs(ze,{children:[o.jsx(fe,{form:W,type:"submit",variant:"contained",children:"Upload"}),o.jsx(fe,{variant:"outlined",onClick:()=>m(!1),children:"Close"})]}),o.jsx(Ve,{steps:q,completedProductTourStepName:"hasCompletedUploadRomTour"})]})},Dv=[".sav",{regex:/\.ss[0-9]+/,displayText:".ss"}],Av=()=>{const{setIsModalOpen:l}=ke(),{emulator:m}=me(),{reset:s,handleSubmit:p,setValue:b,formState:{isSubmitSuccessful:x},control:v}=hr(),_=T.useId(),k=T.useCallback(L=>{s(),b("saveFiles",L,{shouldValidate:!0})},[s,b]),w=({saveFiles:L})=>{L.forEach(R=>m==null?void 0:m.uploadSaveOrSaveState(R)),s()},S=[{content:o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"Use this area to drag and drop your save or save state files, or click to select files."}),o.jsx("p",{children:"The name of your files must match the name of your rom."}),o.jsx("p",{children:"Save and save state files should have an extension '.sav' or start with '.ss'."}),o.jsx("p",{children:"You may drop or select multiple files!"})]}),target:`#${CSS.escape(`${_}--drag-and-drop`)}`}];return o.jsxs(o.Fragment,{children:[o.jsx(Te,{title:"Upload Saves"}),o.jsx(Ge,{children:o.jsxs("form",{id:_,"aria-label":"Upload Saves Form",onSubmit:p(w),children:[o.jsx(rt,{control:v,name:"saveFiles",rules:{validate:L=>(L==null?void 0:L.length)>0||"At least one .sav, or .ss file is required"},render:({field:{name:L,value:R},fieldState:{error:N}})=>o.jsx(Vt,{ariaLabel:"Upload Saves",id:`${_}--drag-and-drop`,onDrop:k,name:L,validFileExtensions:Dv,error:N==null?void 0:N.message,hideAcceptedFiles:!(R!=null&&R.length),hideErrors:x,multiple:!0,children:o.jsx("p",{children:"Drag and drop save or save state files here, or click to upload files"})})}),x&&o.jsx(ba,{children:o.jsx("p",{children:"Upload complete!"})})]})}),o.jsxs(ze,{children:[o.jsx(Cr,{copy:"Upload",form:_,showSuccess:x,type:"submit"}),o.jsx(fe,{variant:"outlined",onClick:()=>l(!1),children:"Close"})]}),o.jsx(Ve,{steps:S,completedProductTourStepName:"hasCompletedUploadSavesTour"})]})},Bv=()=>{const[l,m]=T.useState(0),s=T.useCallback(_=>_?new Promise((k,w)=>{const S=new XMLHttpRequest;S.open("GET",_.url,!0),S.responseType="arraybuffer",S.overrideMimeType("text/plain; charset=x-user-defined"),S.onprogress=function(L){if(L.lengthComputable){const R=L.loaded/L.total*100;m(R)}},S.onload=()=>{var L,R;if(S.status>=200&&S.status<300){const N=S.getResponseHeader("Content-Disposition"),O=(R=(L=N==null?void 0:N.split(";").pop())==null?void 0:L.split("=").pop())==null?void 0:R.replace(/"/g,""),B=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.gba"),W=new File([S.response],_.fullName??O??B);if(_.patchFile!=null&&_.patchFile!=""){console.log("applying bps patch to file: "+_.patchFile);const z=new XMLHttpRequest;z.open("GET",_.patchFile,!0),z.responseType="arraybuffer",z.overrideMimeType("text/plain; charset=x-user-defined"),z.onload=()=>{const Y=new Uint8Array(z.response),{instructions:ee,checksum:H}=ep(Y);console.log(H);const G=new Uint8Array(S.response),q=rp(ee,G),V=new File([q],_.fullName??O??B);k(V)},z.onerror=()=>{console.error("Request for patch file failed"),w(new Error("Network error occurred: Patch File"))},z.send(null)}else console.log("resolved file"),k(W)}else console.error("Request failed2"),w(new Error(`Received unexpected status code: ${S.status}`))},S.onerror=()=>{console.error("Request failed"),w(new Error("Network error occurred"))},S.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:b,error:x,execute:v}=Pr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:b,error:x,execute:v,progress:l}},Iv=()=>{const[l,m]=T.useState(0),s=T.useCallback(_=>_?new Promise((k,w)=>{console.log(_.fullName);const S=new XMLHttpRequest;S.open("GET",_.url,!0),S.responseType="arraybuffer",S.overrideMimeType("text/plain; charset=x-user-defined"),S.onprogress=function(L){if(L.lengthComputable){const R=L.loaded/L.total*100;m(R)}},S.onload=()=>{var L,R;if(S.status>=200&&S.status<300){const N=S.getResponseHeader("Content-Disposition"),O=(R=(L=N==null?void 0:N.split(";").pop())==null?void 0:L.split("=").pop())==null?void 0:R.replace(/"/g,""),B=decodeURIComponent(_.url.pathname.split("/").pop()??"unknown_external.sav"),W=new File([S.response],_.fullName??O??B);k(W)}else w(new Error(`Received unexpected status code: ${S.status}`))},S.onerror=()=>{console.error("Request failed"),w(new Error("Network error occurred"))},S.send(null)}):Promise.reject(new Error("fetchProps is required")),[]),{data:p,isLoading:b,error:x,execute:v}=Pr({fetchFn:s,clearDataOnLoad:!0});return{data:p,isLoading:b,error:x,execute:v,progress:l}},Tt=l=>(console.log("Save Type: "+l),l[0]=="N"?0:l[0]=="E"?1:l[0]=="S"?3:l[0]=="F"&&l[5]=="1"?5:l[0]=="F"?4:l[0]=="R"&&l[11]=="1"?55:(console.log("Invalid Save Type"),-1)),$v=(l,m)=>{let s=Number(m.cartSize/1024/1024),p="";return s==1?p=l.checksum_1MB:s==2?p=l.checksum_2MB:s==4?p=l.checksum_4MB:s==8?p=l.checksum_8MB:s==16&&(p=l.checksum_16MB),p.toUpperCase()},Nv=l=>new Promise(m=>setTimeout(m,l)),Uv=async l=>{let m,s,p="";try{if(m=await(await fetch(`${l}/get_game_info`,{method:"GET",headers:{"Access-Control-Request-Private-Network":"true"}})).json(),s=await(await fetch(`./information_rom/${m.cartID}.json`)).json(),p=$v(m,s),p!=s.checksum1000){console.log("Checksums do not match. Trying to get a different one...");try{const v=await fetch(`./information_rom/${p}-${m.cartID}.json`);if(!v.ok||v.status!=200)throw new Error(`HTTP error! Status: ${v.status}`);let _=await v.json();_&&Object.keys(_).length>0?(console.log("Additional Data exists"),s=_):console.log("Additional Data does not exist or is empty")}catch(v){console.error("An error occurred while fetching additional data: ",v)}}return[m,s,p]}catch(b){console.error("Error fetching game information:",b)}finally{return[m,s,p]}},Ov=({gameData:l,checksum1000String:m,selectedSave:s,setSelectedSave:p,saveName:b})=>{var k;const{emulator:x}=me(),v=w=>{p(w)},_=((k=x==null?void 0:x.listSaves)==null?void 0:k.call(x).filter(w=>w.includes(l.cartID+"_"+m)))||[];return T.useEffect(()=>{for(const w of _)b===w&&p(w)},[]),o.jsx(o.Fragment,{children:o.jsx(aa,{children:o.jsxs(oa,{children:[o.jsx(sa,{children:o.jsxs(or,{children:[o.jsx(ye,{children:"Select"}),o.jsx(ye,{children:"Save"}),o.jsx(ye,{children:"Last Saved"})]})}),o.jsxs(ia,{children:[o.jsxs(or,{children:[o.jsx(ye,{children:o.jsx(Rr,{checked:s==="Cartridge Save",onChange:()=>v("Cartridge Save")})}),o.jsx(ye,{children:"Cartridge Save"}),o.jsx(ye,{children:"-"})]},"cartridge-save"),_.length>0?_.map((w,S)=>{var L;return o.jsxs(or,{sx:{borderBottom:S===_.length-1?"none":void 0},children:[o.jsx(ye,{sx:{borderBottom:S===_.length-1?"none":void 0},children:o.jsx(Rr,{checked:s===w,onChange:()=>v(w)})}),o.jsx(ye,{sx:{borderBottom:S===_.length-1?"none":void 0},children:w}),o.jsx(ye,{sx:{borderBottom:S===_.length-1?"none":void 0},children:(L=x==null?void 0:x.getStatSaves)==null?void 0:L.call(x,w).mtime.toLocaleString()})]},S)}):o.jsx(or,{children:o.jsx(ye,{colSpan:3,children:"None"})})]})]})})})},Gv=({gameData:l,checksum1000String:m,selectedGame:s,setSelectedGame:p,romName:b})=>{var k;const{emulator:x}=me(),v=w=>{p(w)},_=((k=x==null?void 0:x.listRoms)==null?void 0:k.call(x).filter(w=>w.includes(l.cartID+"_"+m)))||[];return T.useEffect(()=>{for(const w of _)b===w&&p(w)},[]),o.jsx(o.Fragment,{children:o.jsx(aa,{children:o.jsxs(oa,{children:[o.jsx(sa,{children:o.jsxs(or,{children:[o.jsx(ye,{children:"Select"}),o.jsx(ye,{children:"Rom File"}),o.jsx(ye,{children:"Created"})]})}),o.jsxs(ia,{children:[o.jsxs(or,{children:[o.jsx(ye,{children:o.jsx(Rr,{checked:s==="Cartridge Rom",onChange:()=>v("Cartridge Rom")})}),o.jsx(ye,{children:"Cartridge Rom"}),o.jsx(ye,{children:"-"})]},"cartridge-game"),_.length>0?_.map((w,S)=>{var L;return o.jsxs(or,{sx:{borderBottom:S===_.length-1?"none":void 0},children:[o.jsx(ye,{sx:{borderBottom:S===_.length-1?"none":void 0},children:o.jsx(Rr,{checked:s===w,onChange:()=>v(w)})}),o.jsx(ye,{sx:{borderBottom:S===_.length-1?"none":void 0},children:w}),o.jsx(ye,{sx:{borderBottom:S===_.length-1?"none":void 0},children:(L=x==null?void 0:x.getStatRoms)==null?void 0:L.call(x,w).mtime.toLocaleString()})]},S)}):o.jsx(or,{children:o.jsx(ye,{colSpan:3,children:"None"})})]})]})})})},zv=D.form`
  display: flex;
  flex-direction: column;
  gap: 15px;
  width: 100dvw;
  max-width: fill-available;
  max-width: stretch;
  max-width: -webkit-fill-available;
  max-width: -moz-available;
`,qv=D.div`
  display: flex;
  flex-direction: column;
  gap: 10px;
  text-align: center;
  align-items: center;
  margin-bottom: 15px;
`,Ke=D.p`
  margin: 0;
  font-size: 16px;
`,Ye=D.strong`
`,Oe=D.option`
`,Kn=D.select`
`,Vv=D.img`
  max-width: 75%;
  height: auto;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid black;
`,Hv=D.div`
display: flex;
flex-direction: column;
align-items: center;
text-align: center;
margin: 0px auto;
padding: 0px;
max-width: 600px;
`,Wv=D.div`
display: flex;
gap: 10px;
width: 100%;
flex-direction: column;
`,Yn=D.p`
  word-wrap: break-word;
  max-width: 100%;
`,Xv=D.div`
  background-color: #e0e0e0;
  border-radius: 4px;
  position: relative;
  height: 24px;
  width: 100%;
  margin-top: 16px;
  overflow: hidden;

  &::after {
    content: '';
    background-color: ${l=>l.theme.gbaThemeBlue};
    height: 100%;
    width: ${l=>l.progress}%;
    position: absolute;
    left: 0;
    top: 0;
    transition: width 0.2s ease-in-out;
  }
`,Kv=({isLoading:l,isExternalRomLoading:m,children:s,indicator:p,progress:b})=>l?o.jsxs(qv,{children:[m&&o.jsx(Yn,{children:"Dumping Rom from cartridge..."}),!m&&o.jsx(Yn,{children:"Dumping Save from cartridge..."}),p,o.jsx(Xv,{progress:b,children:o.jsxs("span",{style:{position:"relative",width:"100%",textAlign:"center",zIndex:600},children:[Math.round(b),"%"]})})]}):s,Qn=({additionalData:l,setAdditionalData:m,gameData:s,setGameData:p,esp32IP:b,setEsp32IP:x})=>{const v=Pe(),{setIsModalOpen:_}=ke(),{emulator:k}=me(),{data:w,isLoading:S,error:L,execute:R,progress:N}=Bv(),{data:O,execute:B}=Iv(),W=at(),[z,Y]=T.useState(!1),[ee,H]=T.useState(!1),G=!S&&!!w,[q,V]=T.useState(null),[I,f]=T.useState("Cartridge Save"),[X,K]=T.useState("Cartridge Rom"),oe=ne=>{const{name:we,value:Ce}=ne.target;m(tr=>({...tr,[we]:Ce}))};T.useEffect(()=>{if(G){const ne=()=>{W((k==null?void 0:k.filePaths().gamePath)+"/"+w.name)&&_(!1)};k==null||k.uploadRom(w,ne)}},[G,w,k,_,W]);const Me=async()=>{try{Y(!0);const[ne,we,Ce]=await Uv([b]);p(ne),m(we),V(Ce),Y(!1)}catch(ne){console.error("Error fetching game info:",ne)}};T.useEffect(()=>{O!=null&&(k==null||k.uploadSaveOrSaveState(O))},[O,k]),T.useEffect(()=>{z||Me()},[]);const De=()=>l.fullName+"_"+s.cartID+"_"+q,He=async()=>{console.log("Using save: "+I),H(!0);let ne=De()+".sav";I=="Cartridge Save"&&await Ze(l.saveType,ne),await Nv(300),console.log("save loaded"),await Je(),H(!1)},rr=async ne=>{var Ce;let we=(Ce=k==null?void 0:k.listRoms)==null?void 0:Ce.call(k);return console.log(we),we&&we.includes(ne)?(console.log("rom exists locally"),W((k==null?void 0:k.filePaths().gamePath)+"/"+ne),_(!1),H(!1),!0):!1},Je=async()=>{if(H(!0),X!="Cartridge Rom")await rr(X)||console.log("Unable to load local rom");else{let ne=De()+".gba",we=l.cartSize,Ce=`${b}/get_current_game.gba?cartSize=${we}&saveType=4`;await R({url:new URL(Ce),fullName:ne,patchFile:l.patchFile})}H(!1)},Ze=async(ne,we)=>{try{console.log(ne);var Ce=Tt(ne);if(Ce==-1){console.log("Invalid Save Type");return}console.log(Ce);var tr=`${b}/get_current_save?saveType=${Ce}`;await B({url:new URL(tr),fullName:we})}catch(ie){console.error("Error fetching save:",ie)}finally{}};return o.jsxs(o.Fragment,{children:[s&&l?o.jsx(Te,{title:l.fullName}):s&&!l?o.jsx(Te,{title:s.romName}):!s&&l?o.jsx(Te,{title:l.fullName}):o.jsx(Te,{title:"No Response from Cart Reader"}),o.jsx(Ge,{children:o.jsxs(Kv,{isLoading:ee,isExternalRomLoading:S,indicator:o.jsx(Mt,{color:v.gbaThemeBlue,cssOverride:{margin:"0 auto"}}),progress:N,children:[!!L&&o.jsx(mr,{icon:o.jsx(ur,{style:{color:v.errorRed}}),text:"Loading rom from URL has failed"}),s&&l&&o.jsxs(o.Fragment,{children:[o.jsxs(Hv,{id:"game-info",children:[o.jsx(Vv,{id:"cover-image",src:l.coverImage.startsWith("/")?`.${l.coverImage}`:l.coverImage,alt:`${l.fullName} Cover`}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Full Name:"})," ",l.fullName]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"ROM Name:"})," ",s.romName]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Cart Size (MB):"}),o.jsxs(Kn,{name:"cartSize",value:l.cartSize/1024/1024,onChange:oe,children:[o.jsxs(Oe,{value:l.cartSize,children:[(l.cartSize/1024/1024).toFixed(2),"MB"]},(l.cartSize/1024/1024).toFixed(2)),[1,2,4,8,16,32,64].map(ne=>o.jsxs(Oe,{value:ne*1024*1024,children:[ne,"MB"]},ne))]})]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Save Type:"}),o.jsxs(Kn,{name:"saveType",value:l.saveType,onChange:oe,children:[o.jsx(Oe,{value:"FLASH1M_V102",children:"FLASH1M_V102"}),o.jsx(Oe,{value:"FLASH1M_V103",children:"FLASH1M_V103"}),o.jsx(Oe,{value:"FLASH_V124",children:"FLASH_V124"}),o.jsx(Oe,{value:"FLASH_V126",children:"FLASH_V126"}),o.jsx(Oe,{value:"FLASH_ECLA",children:"FLASH_ECLA"}),o.jsx(Oe,{value:"EEPROM_V122",children:"EEPROM_V122"}),o.jsx(Oe,{value:"EEPROM_V124",children:"EEPROM_V124"}),o.jsx(Oe,{value:"SRAM_V112",children:"SRAM_V112"}),o.jsx(Oe,{value:"SRAM_V113",children:"SRAM_V113"}),o.jsx(Oe,{value:"REPRO_FLASH1M",children:"REPRO_FLASH1M"}),o.jsx(Oe,{value:"NONE",children:"NONE"})]})]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Cart ID:"})," ",s.cartID]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"ROM Version:"})," ",s.romVersion]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Checksum:"})," 0x",q]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Publisher:"})," ",l.publisher]}),o.jsxs(Ke,{children:[o.jsx(Ye,{children:"Release Date:"})," ",l.releaseDate]}),l.patchFile!=null&&l.patchFile.length>0&&o.jsxs(Ke,{children:[o.jsx(Ye,{children:"BPS Patch File:"})," ",l.patchFile]})]}),k&&o.jsxs(o.Fragment,{children:[o.jsx(Yr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Saves"}),o.jsx(Ov,{gameData:s,checksum1000String:q,selectedSave:I,setSelectedSave:f,saveName:De()+".sav"}),o.jsx(Yr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Local Roms"}),o.jsx(Gv,{gameData:s,checksum1000String:q,selectedGame:X,setSelectedGame:K,romName:De()+".gba"})]}),o.jsx(Yr,{sx:{padding:"10px 0",color:"darkgrey"},children:"Cart Reader"})]}),o.jsxs(zv,{"aria-label":"Login Form",children:[o.jsx(dr,{label:"ESP32 IP Address",autoComplete:"esp32IPInputField",variant:"filled",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"5px"},defaultValue:b,onChange:ne=>{x(ne.target.value)}}),o.jsxs(fe,{variant:"outlined",style:{padding:"3px 8px 3px 8px",fontSize:"14px",marginLeft:"8px"},onClick:()=>{Me()},children:[o.jsx(tp,{style:{fontSize:"18px"}})," ","Refresh"]})]})]})}),o.jsx(ze,{children:!ee&&o.jsxs(Wv,{children:[o.jsxs(fe,{variant:"contained",color:"primary",style:{padding:"10px 20px 10px 10px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>He(),children:[o.jsx(np,{style:{fontSize:"30px",marginRight:"10px"}})," ","Start Game"]}),o.jsx(fe,{variant:"outlined",style:{padding:"10px 20px 10px 20px",fontSize:"16px",display:"flex",alignItems:"center",gap:"5px"},onClick:()=>_(!1),children:"Close"})]})})]})},Yv=D.div`
  width: ${pr}px;
  height: 100dvh;
  position: fixed;
  background-color: ${({theme:l})=>l.mediumBlack};
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  z-index: 150;
  overflow-y: auto;
  text-align: left;
  left: 0;
  top: 0;
  touch-action: none;

  ${({$isExpanded:l=!1})=>!l&&`left: -${pr+5}px;
    `}

  &::-webkit-scrollbar {
    display: none;
  }
`,Qv=D.h2`
  color: ${({theme:l})=>l.pureWhite};
  padding: 0.5rem 1rem;
  font-size: calc(1.3rem + 0.6vw);
  font-weight: 500;
  line-height: 1.2;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;

  &:hover {
    background-color: ${({theme:l})=>l.menuHighlight};
  }
`,Jv=D.ul`
  display: flex;
  flex-direction: column;
  padding-left: 0;
  margin-bottom: 0;
  margin-top: 0;
  list-style: none;
  padding: 0;
`,Zv=D(Mr)`
  background-color: ${({theme:l})=>l.mediumBlack};
  color: ${({theme:l})=>l.pureWhite};
  z-index: 200;
  position: fixed;
  left: ${pr-6}px;
  top: 12px;
  transition: 0.4s ease-in-out;
  -webkit-transition: 0.4s ease-in-out;
  cursor: pointer;
  padding: 0.375rem 0.75rem;
  border-radius: 0.25rem;
  border: none;
  min-height: 36px;
  min-width: 40px;

  ${({$isExpanded:l=!1})=>!l&&`left: -8px;
    `}

  &:focus {
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
`,eg=D.button`
  position: absolute;
  width: calc(100dvw - ${pr}px);
  left: ${pr}px;
  height: 99%;
  background: 0 0;
  z-index: 140;
  border: none;
`,rg=()=>{const[l,m]=T.useState(!0),{setModalContent:s,setIsModalOpen:p}=ke(),{canvas:b,emulator:x}=me(),{isRunning:v}=ir(),_=Pe(),k=fr(_.isLargerThanPhone),w=T.useId(),S=xa(),[L,R]=T.useState(null),[N,O]=T.useState(null),B="https://192.168.1.3",[W,z]=T.useState(B);return T.useEffect(()=>{const ee=new URLSearchParams(window.location.search).get("esp32_ip");ee&&z(ee);const H=setTimeout(()=>{console.log("run12"),s(o.jsx(Qn,{additionalData:L,setAdditionalData:R,gameData:N,setGameData:O,esp32IP:W,setEsp32IP:z})),p(!0)},500);return()=>clearTimeout(H)},[L,N,W]),o.jsxs(o.Fragment,{children:[o.jsx(Zv,{id:"menu-btn",$isExpanded:l,onClick:()=>m(Y=>!Y),"aria-label":"Menu Toggle",children:o.jsx(ap,{})}),o.jsxs(Yv,{"data-testid":"menu-wrapper",id:"menu-wrapper",$isExpanded:l,children:[o.jsx(Qv,{id:w,children:"Menu"}),o.jsxs(Jv,{"aria-labelledby":w,children:[o.jsx(Le,{title:"My Cartridge",icon:o.jsx(On,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Qn,{additionalData:L,setAdditionalData:R,gameData:N,setGameData:O,esp32IP:W,setEsp32IP:z})),p(!0)}}),o.jsxs(kt,{title:"Pre Game Actions",$disabled:v,$isExpanded:!v,icon:o.jsx(op,{}),children:[o.jsx(Le,{title:"Upload Saves",$disabled:v,icon:o.jsx(Ft,{}),onClick:()=>{s(o.jsx(Av,{})),p(!0)}}),o.jsx(Le,{title:"Upload Cheats",$disabled:v,icon:o.jsx(Ft,{}),onClick:()=>{s(o.jsx(Lv,{})),p(!0)}}),o.jsx(Le,{title:"Upload Rom",$disabled:v,icon:o.jsx(Gn,{}),onClick:()=>{s(o.jsx(Mv,{})),p(!0)}}),o.jsx(Le,{title:"Load Local Rom",$disabled:v,icon:o.jsx(Gn,{}),onClick:()=>{s(o.jsx(uv,{})),p(!0)}})]}),o.jsxs(kt,{title:"Cartridge Actions",$disabled:!v,$isExpanded:v,icon:o.jsx(sp,{}),children:[o.jsx(Le,{title:"Save to Cartridge",$disabled:!v,icon:o.jsx(ip,{}),onClick:()=>{const Y=x==null?void 0:x.getCurrentSave(),ee=x==null?void 0:x.getCurrentSaveName();if(Y&&ee){const G=new XMLHttpRequest;if(!L){console.log("No save type information.");return}var H=Tt(L.saveType);if(H==-1){console.log("Invalid Save Type");return}console.log(H);const q=new Promise((V,I)=>{G.open("POST",`${W}/upload_save_file?saveType=${H}`,!0),G.onload=()=>{if(G.status>=200&&G.status<300){const f=new XMLHttpRequest;f.open("POST",`${W}/verify_save_file?saveType=${H}`,!0),f.onload=()=>{f.status>=200&&f.status<300?V("Uploaded  and verified save on cartridge"):I("Save on cartridge has errors")},f.onerror=()=>I("Failed to upload save for verification"),f.send(Y)}else I("Failed to upload save to cartridge")},G.onerror=()=>I("Failed to upload save to cartridge"),G.send(Y)});Qe.promise(q,{loading:"Uploading save to cartridge...",success:V=>`${V}`,error:V=>`${V}`})}else Qe.error("Current save not available")}}),o.jsx(Le,{title:"Verify Cartridge Save",$disabled:!v,icon:o.jsx(lp,{}),onClick:()=>{const Y=x==null?void 0:x.getCurrentSave(),ee=x==null?void 0:x.getCurrentSaveName();if(Y&&ee){const G=new XMLHttpRequest;if(!L){console.log("No save type information.");return}var H=Tt(L.saveType);if(H==-1){console.log("Invalid Save Type");return}const q=new Promise((V,I)=>{G.open("POST",`${W}/verify_save_file?saveType=${H}`,!0),G.onload=()=>{G.status>=200&&G.status<300?V("Verified save on cartridge"):I("Save on cartridge is not the same.")},G.onerror=()=>I("Failed to upload save"),G.send(Y)});Qe.promise(q,{loading:"Verifying save on cartridge...",success:V=>`${V}`,error:V=>`${V}`})}else Qe.error("Current save not available")}})]}),o.jsxs(kt,{title:"In Game Actions",$disabled:!v,$isExpanded:v,icon:o.jsx(cp,{}),children:[o.jsx(Le,{title:"Screenshot",$disabled:!v,icon:o.jsx(dp,{}),onClick:()=>{x!=null&&x.screenshot()?Qe.success("Screenshot saved successfully"):Qe.error("Screenshot has failed")}}),o.jsx(Le,{title:"Full Screen",$disabled:!v,icon:o.jsx(up,{}),onClick:()=>{b==null||b.requestFullscreen().catch(()=>{Qe.error("Full screen request has failed")})}}),o.jsx(Le,{title:"Download Save",$disabled:!v,icon:o.jsx(ta,{}),onClick:()=>{s(o.jsx(rv,{})),p(!0)}}),o.jsx(Le,{title:"Quick Reload",$disabled:!v,icon:o.jsx(fp,{}),onClick:S}),o.jsx(Le,{title:"Manage Save States",$disabled:!v,icon:o.jsx(mp,{}),onClick:()=>{s(o.jsx(gv,{})),p(!0)}}),o.jsx(Le,{title:"Manage Cheats",$disabled:!v,icon:o.jsx(pp,{}),onClick:()=>{s(o.jsx(Vh,{})),p(!0)}})]}),o.jsx(Le,{title:"Controls",icon:o.jsx(On,{}),$withPadding:!0,onClick:()=>{s(o.jsx(ev,{})),p(!0)}}),o.jsx(Le,{title:"File System",icon:o.jsx(hp,{}),$withPadding:!0,onClick:()=>{s(o.jsx(cv,{})),p(!0)}}),o.jsx(Le,{title:"About",icon:o.jsx(vp,{}),$withPadding:!0,onClick:()=>{s(o.jsx(Ph,{})),p(!0)}})]})]}),l&&!k&&o.jsx(eg,{"aria-label":"Menu Dismiss",onClick:()=>{m(!1)}})]})};D.ul`
  text-align: left;
`;const tg=()=>!0,ng=()=>{const[l]=Fe(qt);return l!=null&&l.hasCompletedProductTourIntro?o.jsx(gp,{}):null},ag=240,og=160,sg=D.canvas`
  background-color: ${({theme:l})=>l.pureBlack};
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -moz-crisp-edges;
  image-rendering: -o-crisp-edges;
  width: 100%;
  height: 100%;
  display: block;
  margin: 0 auto;
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  image-rendering: pixelated;
`,ig=D(Zn)`
  background-color: ${({theme:l})=>l.pureBlack};
  border: solid 1px ${({theme:l})=>l.pureBlack};
  overflow: visible;
  width: 100dvw;
  height: calc(100dvw * 2 / 3);

  @media ${({theme:l})=>l.isLargerThanPhone} {
    width: min(
      calc(100dvw - ${pr+35}px),
      calc(85dvh * 3 / 2)
    );
    height: 85dvh;
  }
`,lg={width:"",height:""},cg=()=>{var O,B;const l=Pe(),m=fr(l.isLargerThanPhone),{setCanvas:s}=me(),{areItemsDraggable:p}=tt(),{areItemsResizable:b}=ma(),{layouts:x,setLayout:v,hasSetLayout:_}=Er(),k=m?pr+10:0,w=m?15:0,S=T.useCallback(W=>{var z,Y,ee,H,G,q,V,I;_||((ee=(Y=(z=W==null?void 0:W.resizableElement)==null?void 0:z.current)==null?void 0:Y.style)==null||ee.removeProperty("width"),(q=(G=(H=W==null?void 0:W.resizableElement)==null?void 0:H.current)==null?void 0:G.style)==null||q.removeProperty("height")),!((V=x==null?void 0:x.screen)!=null&&V.initialBounds)&&W&&v("screen",{initialBounds:(I=W.resizableElement.current)==null?void 0:I.getBoundingClientRect()})},[_,x,v]),L=T.useCallback(W=>s(W),[s]),R=((O=x==null?void 0:x.screen)==null?void 0:O.position)??{x:k,y:w},N=((B=x==null?void 0:x.screen)==null?void 0:B.size)??lg;return o.jsx(ig,{"data-testid":"screen-wrapper",disableDragging:!p,ref:S,enableResizing:b,resizeHandleComponent:{topRight:o.jsx(Sr,{variation:"topRight"}),bottomRight:o.jsx(Sr,{variation:"bottomRight"}),bottomLeft:o.jsx(Sr,{variation:"bottomLeft"}),topLeft:o.jsx(Sr,{variation:"topLeft"})},resizeHandleStyles:{topRight:{marginTop:"15px",marginRight:"15px"},bottomRight:{marginBottom:"15px",marginRight:"15px"},bottomLeft:{marginBottom:"15px",marginLeft:"15px"},topLeft:{marginTop:"15px",marginLeft:"15px"}},position:R,size:N,onDragStop:(W,z)=>{v("screen",{position:{x:z.x,y:z.y}})},onResizeStop:(W,z,Y,ee,H)=>{v("screen",{size:{width:Y.clientWidth,height:Y.clientHeight},position:{...H}})},children:o.jsx(sg,{"data-testid":"screen-wrapper:render-canvas",ref:L,width:ag,height:og})})},dg=D.div`
  background-color: #fff;
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  height: fit-content;
  inset: 10px;
  margin: 25px auto auto;
  padding-top: 25px;
  max-height: 80%;
  max-width: calc(100dvw - 20px);
  padding: 0;
  touch-action: none;
  user-select: text;
  width: fit-content;

  @media ${({theme:l})=>l.isLargerThanPhone} {
    max-width: 600px;
  }
`,ug=D.div`
  background-color: rgba(0, 0, 0, 0.5);
  width: 100dvw;
  height: 100dvh;
  position: absolute;
`,fg=D(ya)`
  justify-content: center;
`,mg=D(wa)`
  padding: 1em 1em 0 1em;
`,pg=D.img`
  object-fit: contain;
  max-width: 100%;
`,hg=D(Sa)`
  justify-content: center;
  flex-wrap: wrap;
`,vg=D.div`
  position: relative;
`,gg=D.a`
  font-size: 5px;
  position: absolute;
  right: 15%;
  bottom: 6%;
`,Jn=()=>o.jsx("span",{children:""}),xg=({error:l,resetErrorBoundary:m})=>o.jsx(ug,{children:o.jsxs(dg,{role:"alert",children:[o.jsx(fg,{children:o.jsx(_a,{children:"An irrecoverable error occurred"})}),o.jsxs(mg,{children:[o.jsxs(vg,{children:[o.jsx(pg,{src:"/img/error-512x512.png",alt:"GameBoy Advance with error icon"}),o.jsx(gg,{target:"_blank",href:"https://www.freepik.com/free-vector/editable-text-effect-error-3d-hack-virus-font-style_21408324.htm",children:"Font by NACreative"})]}),o.jsx("pre",{style:{color:"red"},children:l.message}),o.jsx("p",{children:"Please use the buttons below to copy the stack trace and create an issue, this helps a lot with error reporting!"})]}),o.jsxs(hg,{children:[o.jsx(fe,{color:"info",variant:"contained",onClick:()=>{navigator.clipboard.writeText(l.stack??"No stack available")},children:"Copy trace"}),o.jsx(Jn,{}),o.jsx(fe,{color:"success",variant:"contained",href:"https://github.com/thenick775/gbajs3/issues",target:"_blank",children:"Create issue"}),o.jsx(Jn,{}),o.jsx(fe,{color:"secondary",variant:"contained",onClick:m,children:"Dismiss and reset"})]})]})}),bg=({children:l})=>o.jsx(xp,{fallbackRender:xg,children:l}),_g=()=>{const l=Pe();return o.jsx(bp,{toastOptions:{success:{duration:1e3},error:{duration:1500},style:{background:l.darkCharcoal,color:l.pureWhite}}})},yg=({children:l})=>o.jsx(Ip,{children:o.jsx(Np,{children:o.jsx(Pp,{children:o.jsx($p,{children:l})})})}),wg={isLargerThanPhone:"only screen and (min-width: 600px)",isMobileLandscape:"only screen and (max-height: 1000px) and (max-width: 1000px) and (orientation: landscape)",isMobilePortrait:"only screen and (max-width: 1000px) and (orientation: portrait)",isMobileWithUrlBar:"only screen and (max-height: 700px) and (orientation: portrait)",aliceBlue1:"#f8f9fa",aliceBlue2:"#edf2f7",arcticAirBlue:"#cad8e5",blackRussian:"#1a202c",blueCharcoal:"#212529",checkMarkGreen:"#7ac142",darkCharcoal:"#333",darkGrayBlue:"#495057",disabledGray:"#6c757d",errorRed:"#d32f2f",gbaThemeBlue:"#0d6efd",mediumBlack:"#100901",menuHighlight:"#ffffff26",menuHover:"#0a58ca",pattensBlue:"#dee2e6",pureBlack:"#000",pureWhite:"#fff",darkGray:"#111",panelControlGray:"#a9a9a9",panelBlueGray:"#4f555a"},Sg=()=>o.jsx(_p,{theme:wg,children:o.jsxs(bg,{children:[o.jsx(tg,{}),o.jsx(_g,{}),o.jsx(ng,{}),o.jsx(Tp,{children:o.jsx(yg,{children:o.jsx(Gp,{children:o.jsxs(zp,{children:[o.jsx(rg,{}),o.jsx(cg,{}),o.jsx(nh,{}),o.jsx(yh,{}),o.jsx(Sh,{})]})})})})]})});yp.createRoot(document.getElementById("root")).render(o.jsx(et.StrictMode,{children:o.jsx(Sg,{})}));
